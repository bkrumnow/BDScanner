!function(t){if("function"==typeof define&&define.amd){var e=define;define=t}!function t(e,n,r){function i(a,s){if(!n[a]){if(!e[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[a]={exports:{}};e[a][0].call(l.exports,function(t){var n=e[a][1][t];return i(n||t)},l,l.exports,t,e,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(t,e,n){"use strict";e.exports=t("./lib/emojisService.js")},{"./lib/emojisService.js":3}],2:[function(t,e,n){"use strict";e.exports={"<3":"heavy-black-heart","</3":"broken-heart",":)":"slightly-smiling-face","(:":"slightly-smiling-face",":-)":"slightly-smiling-face","C:":"grinning-face","c:":"grinning-face",":D":"grinning-face",":-D":"grinning-face",";)":"winking-face",";-)":"winking-face","):":"slightly-frowning-face",":(":"slightly-frowning-face",":-(":"slightly-frowning-face",":'(":"crying-face","=)":"smiling-face-with-open-mouth","=-)":"smiling-face-with-open-mouth",":*":"kissing-face",":-*":"kissing-face",":>":"grinning-face",":->":"grinning-face","8)":"smiling-face-with-sunglasses",":\\":"confused-face",":-\\":"confused-face",":/":"confused-face",":-/":"confused-face",":|":"neutral-face",":-|":"neutral-face",":O":"face-with-open-mouth",":-o":"face-with-open-mouth",">:(":"angry-face",">:-(":"angry-face",":-p":"face-with-stuck-out-tongue",":P":"face-with-stuck-out-tongue",":-P":"face-with-stuck-out-tongue",":-b":"face-with-stuck-out-tongue",";p":"face-with-stuck-out-tongue-and-winking-eye",";-p":"face-with-stuck-out-tongue-and-winking-eye",";b":"face-with-stuck-out-tongue-and-winking-eye",";-b":"face-with-stuck-out-tongue-and-winking-eye",";P":"face-with-stuck-out-tongue-and-winking-eye",";-P":"face-with-stuck-out-tongue-and-winking-eye",":o)":"monkey-face","D:":"anguished-face",":fu:":"reversed-hand-with-middle-finger-extended",xD:"rolling-on-the-floor-laughing"}},{}],3:[function(t,e,n){"use strict";function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var i=t("lodash"),o=t("emoji-aware").split,a=t("store"),s=t("./aliases.js");e.exports=function(t){var e=i.get(t,"baseUrl","/"),n=i.get(t,"blackList",[]),c=/:([a-z0-9-]+):/gm,u=i.chain(i.clone(s)).mapKeys(function(t,e){return e.replace("\\","\\\\").replace(")","\\)").replace(":","\\:").replace(";","\\;").replace("-","\\-").replace("*","\\*").replace("|","\\|").replace("(","\\(").replace("/","\\/")}).keys().value().join("|"),l=new RegExp("(\\s|^)("+u+")(?:(?=\\s|$))","mg"),d={recents:"idz-icon-emojis-recent",people:"idz-icon-emojis-people",nature:"idz-icon-emojis-animals-plants","food-drink":"idz-icon-emojis-food",objects:"idz-icon-emojis-objects","travel-places":"idz-icon-emojis-car",activity:"idz-icon-emojis-activity",symbols:"idz-icon-emojis-symbols",flags:"idz-icon-emojis-flag"},f={},h={},p={},m={},g={},v=function(t){for(var e=0,n=0,r=0,i=[];e<t.length;)n=t.charCodeAt(e++),r?(i.push((65536+(r-55296<<10)+(n-56320)).toString(16)),r=0):55296<=n&&n<=56319?r=n:i.push(n.toString(16));return i.join("-")},_=function(t,n){var r=m[t][n];return e+"/"+t+"/"+r.category+"/"+n+".png"},b=function(t){var e=i.get(a.get("emojis"),t,{name:"recents",emojis:[{char:"no recent",shortname:"noRecent",category:"recent",count:0}],fullName:"Recents"});return e.emojis=i.chain(e.emojis).sortBy(function(t){return t.count}).reverse().value(),e},y=function(t){var e=i.assign({},t);return i.forEach(e,function(t){t.emojis=i.filter(t.emojis,function(t){return!i.includes(n,t.shortname)})}),e},w=function(t,e){p[t]={},h[t]={},m[t]={},g[t]={},i.each(e,function(e){"recents"!==e.name&&i.each(e.emojis,function(e){p[t][e.unicode]=e.shortname,h[t][e.shortname]=e.char,m[t][e.shortname]=e,g[t][e.unicode]=e,i.has(e,"modifiers")&&i.each(e.modifiers,function(e){p[t][e.unicode]=e.shortname,h[t][e.shortname]=e.char,m[t][e.shortname]=e,g[t][e.unicode]=e})})})},C=function(t,e){var n=o(e);return!1===n?x(e):(n=i.map(n,function(e){var n=v(e);return i.has(g[t],n)?":"+p[t][n]+":":i.has(g.apple,n)?":"+p.apple[n]+":":e}),x(n.join("")))},x=function(t){return t.replace(l,function(t,e,n){return e+":"+s[n]+":"})},O=function(t,e,n){var r='<img src="<%url%>" data-char="<%char%>" data-shortname="<%shortname%>" class="emoji idzEmoji'+(n?" emojiBig":"")+'" alt="<%char%>"/>';return e=e.replace(c,function(e,n){var o=e;return i.has(h.apple,n)&&(o=r.replace(/<%char%>/g,h.apple[n]).replace(/<%url%>/g,_("apple",n)).replace(/<%shortname%>/g,n)),i.has(h[t],n)&&(o=r.replace(/<%char%>/g,h[t][n]).replace(/<%url%>/g,_(t,n)).replace(/<%shortname%>/g,n)),o})};return{getUnicode:v,getEmojiUrl:_,getSpriteUrl:function(t){return e+"/"+t+"/"+t+".png"},getJSONUrl:function(t){return e+"/"+t+"/"+t+".json"},getHistory:b,updateHistory:function(t,e){var n=a.get("emojis"),o=b(t).emojis;i.remove(o,{shortname:"noRecent"}),-1===i.findIndex(o,function(t){return t.unicode===e.unicode})?o=o.concat({shortname:e.shortname,char:e.char,category:"recent",count:1,unicode:e.unicode}):i.find(o,function(t){return t.unicode===e.unicode}).count+=1,i.size(o)>14&&(o=i.chain(o).sortBy("count").drop().value()),a.set("emojis",i.assign({},n,r({},t,i.assign(b(t),{emojis:o}))))},getEmojis:function(t,e){var n=f[t]||{};return e&&(n=i.assign(n,{recents:b(t)})),n},setEmojis:function(t,e){var n=y(e);return f[t]=i.merge(f[t]||{},n),w(t,n),f[t]},hasTheme:function(t){return i.has(f,t)},getIcons:function(){return d},replaceUtf8ToImage:function(t,e){var n=o(e),r=n&&1===n.length;return O(t,C(t,e),r)},replaceUtf8ToShortname:C,replaceAliasesToShortname:x,replaceShortnameToImage:O,replaceShortnameToUtf8:function(t,e){var n=x(e);return n=n.replace(c,function(e,n){var r=e;return i.has(h.apple,n)&&(r=h.apple[n]),i.has(h[t],n)&&(r=h[t][n]),r})}}}},{"./aliases.js":2,"emoji-aware":10,lodash:30,store:32}],4:[function(t,e,n){e.exports=function(t){t.addConnectionPlugin("fileupload",{connection:null,init:function(t){this.connection=t},requestSlot:function(e,n,r,i){var o=$iq({id:this.connection.getUniqueId(),from:this.connection.jid,to:"upload."+t.getDomainFromJid(this.connection.jid),type:"get"}).c("request",{xmlns:"urn:xmpp:http:upload"}).c("filename",{},e.name).c("size",{},e.size).c("content-type",{},e.contentType);this.connection.sendIQ(o,n,r,i)}})}},{}],5:[function(t,e,n){var r,i,o={}.hasOwnProperty,a=function(t,e){return function(){return t.apply(e,arguments)}};Strophe.addConnectionPlugin("muc",{_connection:null,rooms:{},roomNames:[],init:function(t){return this._connection=t,this._muc_handler=null,Strophe.addNamespace("MUC_OWNER",Strophe.NS.MUC+"#owner"),Strophe.addNamespace("MUC_ADMIN",Strophe.NS.MUC+"#admin"),Strophe.addNamespace("MUC_USER",Strophe.NS.MUC+"#user"),Strophe.addNamespace("MUC_ROOMCONF",Strophe.NS.MUC+"#roomconfig"),Strophe.addNamespace("MUC_REGISTER","jabber:iq:register")},join:function(t,e,n,r,o,a,s,c){var u,l;return l=this.test_append_nick(t,e),u=$pres({from:this._connection.jid,to:l}).c("x",{xmlns:Strophe.NS.MUC}),null!=s&&(u=u.c("history",s).up()),null!=a&&u.cnode(Strophe.xmlElement("password",[],a)),null!=c&&u.up().cnode(c),null==this._muc_handler&&(this._muc_handler=this._connection.addHandler(function(e){return function(n){var r,i,o,a,s,c,u,l,d;if(!(r=n.getAttribute("from")))return!0;if(c=r.split("/")[0],!e.rooms[c])return!0;if(t=e.rooms[c],i={},"message"===n.nodeName)i=t._message_handlers;else if("presence"===n.nodeName&&(d=n.getElementsByTagName("x")).length>0)for(o=0,s=d.length;o<s;o++)if(u=d[o],(l=u.getAttribute("xmlns"))&&l.match(Strophe.NS.MUC)){i=t._presence_handlers;break}for(a in i)(0,i[a])(n,t)||delete i[a];return!0}}(this))),this.rooms.hasOwnProperty(t)||(this.rooms[t]=new i(this,t,e,a),r&&this.rooms[t].addHandler("presence",r),n&&this.rooms[t].addHandler("message",n),o&&this.rooms[t].addHandler("roster",o),this.roomNames.push(t)),this._connection.send(u)},leave:function(t,e,n,r){var i,o,a,s;return i=this.roomNames.indexOf(t),delete this.rooms[t],i>=0&&(this.roomNames.splice(i,1),0===this.roomNames.length&&(this._connection.deleteHandler(this._muc_handler),this._muc_handler=null)),s=this.test_append_nick(t,e),a=this._connection.getUniqueId(),o=$pres({type:"unavailable",id:a,from:this._connection.jid,to:s}),null!=r&&o.c("status",r),null!=n&&this._connection.addHandler(n,null,"presence",null,a),this._connection.send(o),a},message:function(t,e,n,r,i,o){var a,s,c;return c=this.test_append_nick(t,e),i=i||(null!=e?"chat":"groupchat"),o=o||this._connection.getUniqueId(),(a=$msg({to:c,from:this._connection.jid,type:i,id:o}).c("body").t(n)).up(),null!=r&&(a.c("html",{xmlns:Strophe.NS.XHTML_IM}).c("body",{xmlns:Strophe.NS.XHTML}).h(r),0===a.node.childNodes.length?(s=a.node.parentNode,a.up().up(),a.node.removeChild(s)):a.up().up()),a.c("x",{xmlns:"jabber:x:event"}).c("composing"),this._connection.send(a),o},groupchat:function(t,e,n,r){return this.message(t,null,e,n,void 0,r)},invite:function(t,e,n){var r,i;return i=this._connection.getUniqueId(),r=$msg({from:this._connection.jid,to:t,id:i}).c("x",{xmlns:Strophe.NS.MUC_USER}).c("invite",{to:e}),null!=n&&r.c("reason",n),this._connection.send(r),i},multipleInvites:function(t,e,n){var r,i,o,a,s;for(a=this._connection.getUniqueId(),i=$msg({from:this._connection.jid,to:t,id:a}).c("x",{xmlns:Strophe.NS.MUC_USER}),r=0,o=e.length;r<o;r++)s=e[r],i.c("invite",{to:s}),null!=n&&(i.c("reason",n),i.up()),i.up();return this._connection.send(i),a},directInvite:function(t,e,n,r){var i,o,a;return a=this._connection.getUniqueId(),i={xmlns:"jabber:x:conference",jid:t},null!=n&&(i.reason=n),null!=r&&(i.password=r),o=$msg({from:this._connection.jid,to:e,id:a}).c("x",i),this._connection.send(o),a},queryOccupants:function(t,e,n){var r,i;return r={xmlns:Strophe.NS.DISCO_ITEMS},i=$iq({from:this._connection.jid,to:t,type:"get"}).c("query",r),this._connection.sendIQ(i,e,n)},configure:function(t,e,n){var r,i;return r=$iq({to:t,type:"get"}).c("query",{xmlns:Strophe.NS.MUC_OWNER}),i=r.tree(),this._connection.sendIQ(i,e,n)},cancelConfigure:function(t){var e,n;return e=$iq({to:t,type:"set"}).c("query",{xmlns:Strophe.NS.MUC_OWNER}).c("x",{xmlns:"jabber:x:data",type:"cancel"}),n=e.tree(),this._connection.sendIQ(n)},saveConfiguration:function(t,e,n,r){var i,o,a,s,c;if(a=$iq({to:t,type:"set"}).c("query",{xmlns:Strophe.NS.MUC_OWNER}),void 0!==Strophe.x&&void 0!==Strophe.x.Form&&e instanceof Strophe.x.Form)e.type="submit",a.cnode(e.toXML());else for(a.c("x",{xmlns:"jabber:x:data",type:"submit"}),o=0,s=e.length;o<s;o++)i=e[o],a.cnode(i).up();return c=a.tree(),this._connection.sendIQ(c,n,r)},createInstantRoom:function(t,e,n){var r;return r=$iq({to:t,type:"set"}).c("query",{xmlns:Strophe.NS.MUC_OWNER}).c("x",{xmlns:"jabber:x:data",type:"submit"}),this._connection.sendIQ(r.tree(),e,n)},createConfiguredRoom:function(t,e,n,r){var i,a,s;(a=$iq({to:t,type:"set"}).c("query",{xmlns:Strophe.NS.MUC_OWNER}).c("x",{xmlns:"jabber:x:data",type:"submit"})).c("field",{var:"FORM_TYPE"}).c("value").t("http://jabber.org/protocol/muc#roomconfig").up().up();for(i in e)o.call(e,i)&&(s=e[i],a.c("field",{var:i}).c("value").t(s).up().up());return this._connection.sendIQ(a.tree(),n,r)},setTopic:function(t,e){var n;return n=$msg({to:t,from:this._connection.jid,type:"groupchat"}).c("subject",{xmlns:"jabber:client"}).t(e),this._connection.send(n.tree())},_modifyPrivilege:function(t,e,n,r,i){var o;return o=$iq({to:t,type:"set"}).c("query",{xmlns:Strophe.NS.MUC_ADMIN}).cnode(e.node),null!=n&&o.c("reason",n),this._connection.sendIQ(o.tree(),r,i)},modifyRole:function(t,e,n,r,i,o){var a;return a=$build("item",{nick:e,role:n}),this._modifyPrivilege(t,a,r,i,o)},kick:function(t,e,n,r,i){return this.modifyRole(t,e,"none",n,r,i)},voice:function(t,e,n,r,i){return this.modifyRole(t,e,"participant",n,r,i)},mute:function(t,e,n,r,i){return this.modifyRole(t,e,"visitor",n,r,i)},op:function(t,e,n,r,i){return this.modifyRole(t,e,"moderator",n,r,i)},deop:function(t,e,n,r,i){return this.modifyRole(t,e,"participant",n,r,i)},modifyAffiliation:function(t,e,n,r,i,o){var a;return a=$build("item",{jid:e,affiliation:n}),this._modifyPrivilege(t,a,r,i,o)},ban:function(t,e,n,r,i){return this.modifyAffiliation(t,e,"outcast",n,r,i)},member:function(t,e,n,r,i){return this.modifyAffiliation(t,e,"member",n,r,i)},revoke:function(t,e,n,r,i){return this.modifyAffiliation(t,e,"none",n,r,i)},owner:function(t,e,n,r,i){return this.modifyAffiliation(t,e,"owner",n,r,i)},admin:function(t,e,n,r,i){return this.modifyAffiliation(t,e,"admin",n,r,i)},changeNick:function(t,e){var n,r;return r=this.test_append_nick(t,e),n=$pres({from:this._connection.jid,to:r,id:this._connection.getUniqueId()}),this._connection.send(n.tree())},setStatus:function(t,e,n,r){var i,o;return o=this.test_append_nick(t,e),i=$pres({from:this._connection.jid,to:o}),null!=n&&i.c("show",n).up(),null!=r&&i.c("status",r),this._connection.send(i.tree())},registrationRequest:function(t,e,n){var r;return r=$iq({to:t,from:this._connection.jid,type:"get"}).c("query",{xmlns:Strophe.NS.MUC_REGISTER}),this._connection.sendIQ(r,function(t){var n,r,i,o,a,s;for((r=t.getElementsByTagName("field")).length,o={required:[],optional:[]},a=0,s=r.length;a<s;a++)i={var:(n=r[a]).getAttribute("var"),label:n.getAttribute("label"),type:n.getAttribute("type")},n.getElementsByTagName("required").length>0?o.required.push(i):o.optional.push(i);return e(o)},n)},submitRegistrationForm:function(t,e,n,r){var i,o,a;(i=$iq({to:t,type:"set"}).c("query",{xmlns:Strophe.NS.MUC_REGISTER})).c("x",{xmlns:"jabber:x:data",type:"submit"}),i.c("field",{var:"FORM_TYPE"}).c("value").t("http://jabber.org/protocol/muc#register").up().up();for(o in e)a=e[o],i.c("field",{var:o}).c("value").t(a).up().up();return this._connection.sendIQ(i,n,r)},listRooms:function(t,e,n){var r;return r=$iq({to:t,from:this._connection.jid,type:"get"}).c("query",{xmlns:Strophe.NS.DISCO_ITEMS}),this._connection.sendIQ(r,e,n)},test_append_nick:function(t,e){var n,r;return r=Strophe.escapeNode(Strophe.getNodeFromJid(t)),n=Strophe.getDomainFromJid(t),r+"@"+n+(null!=e?"/"+e:"")}}),i=function(){function t(t,e,n,r){this.client=t,this.name=e,this.nick=n,this.password=r,this._roomRosterHandler=a(this._roomRosterHandler,this),this._addOccupant=a(this._addOccupant,this),this.roster={},this._message_handlers={},this._presence_handlers={},this._roster_handlers={},this._handler_ids=0,this.client.muc&&(this.client=this.client.muc),this.name=Strophe.getBareJidFromJid(this.name),this.addHandler("presence",this._roomRosterHandler)}return t.prototype.join=function(t,e,n){return this.client.join(this.name,this.nick,t,e,n,this.password)},t.prototype.leave=function(t,e){return this.client.leave(this.name,this.nick,t,e),delete this.client.rooms[this.name]},t.prototype.message=function(t,e,n,r){return this.client.message(this.name,t,e,n,r)},t.prototype.groupchat=function(t,e){return this.client.groupchat(this.name,t,e)},t.prototype.invite=function(t,e){return this.client.invite(this.name,t,e)},t.prototype.multipleInvites=function(t,e){return this.client.invite(this.name,t,e)},t.prototype.directInvite=function(t,e){return this.client.directInvite(this.name,t,e,this.password)},t.prototype.configure=function(t){return this.client.configure(this.name,t)},t.prototype.cancelConfigure=function(){return this.client.cancelConfigure(this.name)},t.prototype.saveConfiguration=function(t){return this.client.saveConfiguration(this.name,t)},t.prototype.queryOccupants=function(t,e){return this.client.queryOccupants(this.name,t,e)},t.prototype.setTopic=function(t){return this.client.setTopic(this.name,t)},t.prototype.modifyRole=function(t,e,n,r,i){return this.client.modifyRole(this.name,t,e,n,r,i)},t.prototype.kick=function(t,e,n,r){return this.client.kick(this.name,t,e,n,r)},t.prototype.voice=function(t,e,n,r){return this.client.voice(this.name,t,e,n,r)},t.prototype.mute=function(t,e,n,r){return this.client.mute(this.name,t,e,n,r)},t.prototype.op=function(t,e,n,r){return this.client.op(this.name,t,e,n,r)},t.prototype.deop=function(t,e,n,r){return this.client.deop(this.name,t,e,n,r)},t.prototype.modifyAffiliation=function(t,e,n,r,i){return this.client.modifyAffiliation(this.name,t,e,n,r,i)},t.prototype.ban=function(t,e,n,r){return this.client.ban(this.name,t,e,n,r)},t.prototype.member=function(t,e,n,r){return this.client.member(this.name,t,e,n,r)},t.prototype.revoke=function(t,e,n,r){return this.client.revoke(this.name,t,e,n,r)},t.prototype.owner=function(t,e,n,r){return this.client.owner(this.name,t,e,n,r)},t.prototype.admin=function(t,e,n,r){return this.client.admin(this.name,t,e,n,r)},t.prototype.changeNick=function(t){return this.nick=t,this.client.changeNick(this.name,nick)},t.prototype.setStatus=function(t,e){return this.client.setStatus(this.name,this.nick,t,e)},t.prototype.addHandler=function(t,e){var n;switch(n=this._handler_ids++,t){case"presence":this._presence_handlers[n]=e;break;case"message":this._message_handlers[n]=e;break;case"roster":this._roster_handlers[n]=e;break;default:return this._handler_ids--,null}return n},t.prototype.removeHandler=function(t){return delete this._presence_handlers[t],delete this._message_handlers[t],delete this._roster_handlers[t]},t.prototype._addOccupant=function(t){var e;return e=new r(t,this),this.roster[e.nick]=e,e},t.prototype._roomRosterHandler=function(e){var n,r,i,o,a;switch(n=t._parsePresence(e),o=n.nick,i=n.newnick||null,n.type){case"error":return!0;case"unavailable":i&&(n.nick=i,this.roster[o]&&this.roster[i]&&(this.roster[o].update(this.roster[i]),this.roster[i]=this.roster[o]),this.roster[o]&&!this.roster[i]&&(this.roster[i]=this.roster[o].update(n))),delete this.roster[o];break;default:this.roster[o]?this.roster[o].update(n):this._addOccupant(n)}a=this._roster_handlers;for(r in a)(0,a[r])(this.roster,this)||delete this._roster_handlers[r];return!0},t._parsePresence=function(t){var e,n,r,i,o,a,s,c,u;for((r={}).nick=Strophe.getResourceFromJid(t.getAttribute("from")),r.type=t.getAttribute("type"),r.states=[],i=0,a=(c=t.childNodes).length;i<a;i++)switch((e=c[i]).nodeName){case"status":r.status=e.textContent||null;break;case"show":r.show=e.textContent||null;break;case"x":if(e.getAttribute("xmlns")===Strophe.NS.MUC_USER)for(o=0,s=(u=e.childNodes).length;o<s;o++)switch((n=u[o]).nodeName){case"item":r.affiliation=n.getAttribute("affiliation"),r.role=n.getAttribute("role"),r.jid=n.getAttribute("jid"),r.newnick=n.getAttribute("nick");break;case"status":n.getAttribute("code")&&r.states.push(n.getAttribute("code"))}}return r},t}(),function(){function t(t){this.parse=a(this.parse,this),null!=t&&this.parse(t)}t.prototype.parse=function(t){var e,n,r,i,o,a,s,c,u,l,d,f,h;for(f=t.getElementsByTagName("query")[0].childNodes,this.identities=[],this.features=[],this.x=[],o=0,u=f.length;o<u;o++)switch(r=f[o],n=r.attributes,r.nodeName){case"identity":for(a={},s=0,l=n.length;s<l;s++)a[(e=n[s]).name]=e.textContent;this.identities.push(a);break;case"feature":this.features.push(r.getAttribute("var"));break;case"x":if("FORM_TYPE"===!r.childNodes[0].getAttribute("var")||"hidden"===!r.childNodes[0].getAttribute("type"))break;for(c=0,d=(h=r.childNodes).length;c<d;c++)(i=h[c]).attributes.type||this.x.push({var:i.getAttribute("var"),label:i.getAttribute("label")||"",value:i.firstChild.textContent||""})}return{identities:this.identities,features:this.features,x:this.x}}}(),r=function(){function t(t,e){this.room=e,this.update=a(this.update,this),this.admin=a(this.admin,this),this.owner=a(this.owner,this),this.revoke=a(this.revoke,this),this.member=a(this.member,this),this.ban=a(this.ban,this),this.modifyAffiliation=a(this.modifyAffiliation,this),this.deop=a(this.deop,this),this.op=a(this.op,this),this.mute=a(this.mute,this),this.voice=a(this.voice,this),this.kick=a(this.kick,this),this.modifyRole=a(this.modifyRole,this),this.update(t)}return t.prototype.modifyRole=function(t,e,n,r){return this.room.modifyRole(this.nick,t,e,n,r)},t.prototype.kick=function(t,e,n){return this.room.kick(this.nick,t,e,n)},t.prototype.voice=function(t,e,n){return this.room.voice(this.nick,t,e,n)},t.prototype.mute=function(t,e,n){return this.room.mute(this.nick,t,e,n)},t.prototype.op=function(t,e,n){return this.room.op(this.nick,t,e,n)},t.prototype.deop=function(t,e,n){return this.room.deop(this.nick,t,e,n)},t.prototype.modifyAffiliation=function(t,e,n,r){return this.room.modifyAffiliation(this.jid,t,e,n,r)},t.prototype.ban=function(t,e,n){return this.room.ban(this.jid,t,e,n)},t.prototype.member=function(t,e,n){return this.room.member(this.jid,t,e,n)},t.prototype.revoke=function(t,e,n){return this.room.revoke(this.jid,t,e,n)},t.prototype.owner=function(t,e,n){return this.room.owner(this.jid,t,e,n)},t.prototype.admin=function(t,e,n){return this.room.admin(this.jid,t,e,n)},t.prototype.update=function(t){return this.nick=t.nick||null,this.affiliation=t.affiliation||null,this.role=t.role||null,this.jid=t.jid||null,this.status=t.status||null,this.show=t.show||null,this},t}()},{}],6:[function(t,e,n){e.exports=function(t){t.addConnectionPlugin("outofband",{_conn:null,init:function(e){this._conn=e,t.addNamespace("OUTOFBAND","jabber:iq:oob")},sendIq:function(e,n){var r=null;return $(e).filter("iq").each(function(){var e=$(this).find("url:first").text(),i=$(this).find("desc:first").text();switch(n){case null:r=$iq({to:$(this).attr("from"),from:$(this).attr("to"),type:"result",id:$(this).attr("id")});break;case"404":r=$iq({to:$(this).attr("from"),from:$(this).attr("to"),type:"error",id:$(this).attr("id")}).c("query",{xmlns:t.NS.OUTOFBAND}).c("url",{},e).c("desc",{},i).up().c("error",{code:"404",type:"cancel"}).c("item-not-found",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"});break;case"406":r=$iq({to:$(this).attr("from"),from:$(this).attr("to"),type:"error",id:$(this).attr("id")}).c("query",{xmlns:t.NS.OUTOFBAND}).c("url",{},e).c("desc",{},i).up().c("error",{code:"406",type:"modify"}).c("not-acceptable",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"});break;default:console.log("Unhandled errorcode: a response has not been sent")}}),r&&(console.log(r.toString()),this._conn.send(r)),r},sendUrl:function(e,n,r){var i=$iq({id:this._conn.getUniqueId(),type:"set",from:this._conn.jid,to:e}).c("query",{xmlns:t.NS.OUTOFBAND}).c("url",{},n).c("desc",{},r);this._conn.send(i)},addOutOfBandHandler:function(e,n,r,i){this._conn.addHandler(e,t.NS.OUTOFBAND,"iq",n,null,r,i)}})}},{}],7:[function(t,e,n){Strophe.addConnectionPlugin("receipts",{_conn:null,_msgQueue:{},_retries:{},_resendCount:10,_resendTime:9e3,_requestCallbacks:{},init:function(t){this._conn=t,Strophe.addNamespace("RECEIPTS","urn:xmpp:receipts")},statusChanged:function(t){if(t===Strophe.Status.CONNECTED||t===Strophe.Status.ATTACHED){var e=this;setTimeout(function(){e.resendQueue()},4e3)}},sendMessage:function(t,e,n){var r=t.tree().getAttribute("id");r||(r=+new Date,t.tree().setAttribute("id",r));var i=Strophe.xmlElement("request",{xmlns:Strophe.NS.RECEIPTS});return t.tree().appendChild(i),this._msgQueue[r]=t,this._retries[r]=0,(e||n)&&(this._requestCallbacks[r]=[e,n]),this._conn.send(t),n||this.resendMessage(r),r},resendMessage:function(t){var e=this;setTimeout(function(){if(e._msgQueue[t]){if(!e._conn.connected)return void e.resendMessage(t);if(++e._retries[t]>e._resendCount)return;e._msgQueue[t].tree().setAttribute("from",e._conn.jid),e._conn.send(e._msgQueue[t]),e.resendMessage(t)}},this._resendTime)},addReceiptHandler:function(t,e,n,r){var i=this;this._conn.addHandler(function(e){var n=t(e);return i._processReceipt(e,n),n},Strophe.NS.RECEIPTS,"message",e,null,n,r)},_processReceipt:function(t,e){var n=t.getAttribute("id"),r=t.getAttribute("from"),i=t.getElementsByTagName("request"),o=t.getElementsByTagName("received"),a="error"===t.getAttribute("type"),s=this;if(i.length>0&&!a&&(e&&"object"==typeof e&&"done"in e?e.done(function(){s.sendReceipt(r,n)}):this.sendReceipt(r,n)),o.length>0){var c=o[0].getAttribute("id");if(c&&(delete this._msgQueue[c],delete this._retries[c],c in this._requestCallbacks)){var u=this._requestCallbacks[c][a?1:0];u&&u.apply(null),delete this._requestCallbacks[c]}}},sendReceipt:function(t,e){var n=$msg({to:t,from:this._conn.jid,id:this._conn.getUniqueId()}),r=Strophe.xmlElement("received",{xmlns:Strophe.NS.RECEIPTS,id:e});n.tree().appendChild(r),this._conn.send(n)},resendQueue:function(){if(this._conn.connected)for(var t in this._msgQueue)this._msgQueue.hasOwnProperty(t)&&(this._msgQueue[t].tree().setAttribute("from",this._conn.jid),this._conn.send(this._msgQueue[t]));else{var e=this;setTimeout(function(){e.resendQueue()},4e3)}},getUnreceivedMsgs:function(){var t=[];for(var e in this._msgQueue)this._msgQueue.hasOwnProperty(e)&&t.push(this._msgQueue[e]);return t},clearMessages:function(){this._msgQueue={}}})},{}],8:[function(e,n,r){!function(t,e){"function"==typeof define&&define.amd?define("strophe-base64",function(){return e()}):t.Base64=e()}(this,function(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return{encode:function(e){var n,r,i,o,a,s,c,u="",l=0;do{o=(n=e.charCodeAt(l++))>>2,a=(3&n)<<4|(r=e.charCodeAt(l++))>>4,s=(15&r)<<2|(i=e.charCodeAt(l++))>>6,c=63&i,isNaN(r)?(a=(3&n)<<4,s=c=64):isNaN(i)&&(c=64),u=u+t.charAt(o)+t.charAt(a)+t.charAt(s)+t.charAt(c)}while(l<e.length);return u},decode:function(e){var n,r,i,o,a,s,c="",u=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{n=t.indexOf(e.charAt(u++))<<2|(o=t.indexOf(e.charAt(u++)))>>4,r=(15&o)<<4|(a=t.indexOf(e.charAt(u++)))>>2,i=(3&a)<<6|(s=t.indexOf(e.charAt(u++))),c+=String.fromCharCode(n),64!=a&&(c+=String.fromCharCode(r)),64!=s&&(c+=String.fromCharCode(i))}while(u<e.length);return c}}}),function(t,e){"function"==typeof define&&define.amd?define("strophe-sha1",function(){return e()}):t.SHA1=e()}(this,function(){function t(t,r){t[r>>5]|=128<<24-r%32,t[15+(r+64>>9<<4)]=r;var a,s,c,u,l,d,f,h,p=new Array(80),m=1732584193,g=-271733879,v=-1732584194,_=271733878,b=-1009589776;for(a=0;a<t.length;a+=16){for(u=m,l=g,d=v,f=_,h=b,s=0;s<80;s++)p[s]=s<16?t[a+s]:o(p[s-3]^p[s-8]^p[s-14]^p[s-16],1),c=i(i(o(m,5),e(s,g,v,_)),i(i(b,p[s]),n(s))),b=_,_=v,v=o(g,30),g=m,m=c;m=i(m,u),g=i(g,l),v=i(v,d),_=i(_,f),b=i(b,h)}return[m,g,v,_,b]}function e(t,e,n,r){return t<20?e&n|~e&r:t<40?e^n^r:t<60?e&n|e&r|n&r:e^n^r}function n(t){return t<20?1518500249:t<40?1859775393:t<60?-1894007588:-899497514}function r(e,n){var r=a(e);r.length>16&&(r=t(r,8*e.length));for(var i=new Array(16),o=new Array(16),s=0;s<16;s++)i[s]=909522486^r[s],o[s]=1549556828^r[s];var c=t(i.concat(a(n)),512+8*n.length);return t(o.concat(c),672)}function i(t,e){var n=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(n>>16)<<16|65535&n}function o(t,e){return t<<e|t>>>32-e}function a(t){for(var e=[],n=0;n<8*t.length;n+=8)e[n>>5]|=(255&t.charCodeAt(n/8))<<24-n%32;return e}function s(t){for(var e="",n=0;n<32*t.length;n+=8)e+=String.fromCharCode(t[n>>5]>>>24-n%32&255);return e}function c(t){for(var e,n,r="",i=0;i<4*t.length;i+=3)for(e=(t[i>>2]>>8*(3-i%4)&255)<<16|(t[i+1>>2]>>8*(3-(i+1)%4)&255)<<8|t[i+2>>2]>>8*(3-(i+2)%4)&255,n=0;n<4;n++)8*i+6*n>32*t.length?r+="=":r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e>>6*(3-n)&63);return r}return{b64_hmac_sha1:function(t,e){return c(r(t,e))},b64_sha1:function(e){return c(t(a(e),8*e.length))},binb2str:s,core_hmac_sha1:r,str_hmac_sha1:function(t,e){return s(r(t,e))},str_sha1:function(e){return s(t(a(e),8*e.length))}}}),function(t,e){"function"==typeof define&&define.amd?define("strophe-md5",function(){return e()}):t.MD5=e()}(this,function(t){var e=function(t,e){var n=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(n>>16)<<16|65535&n},n=function(t,e){return t<<e|t>>>32-e},r=function(t){for(var e=[],n=0;n<8*t.length;n+=8)e[n>>5]|=(255&t.charCodeAt(n/8))<<n%32;return e},i=function(t){for(var e="",n=0;n<32*t.length;n+=8)e+=String.fromCharCode(t[n>>5]>>>n%32&255);return e},o=function(t){for(var e="",n=0;n<4*t.length;n++)e+="0123456789abcdef".charAt(t[n>>2]>>n%4*8+4&15)+"0123456789abcdef".charAt(t[n>>2]>>n%4*8&15);return e},a=function(t,r,i,o,a,s){return e(n(e(e(r,t),e(o,s)),a),i)},s=function(t,e,n,r,i,o,s){return a(e&n|~e&r,t,e,i,o,s)},c=function(t,e,n,r,i,o,s){return a(e&r|n&~r,t,e,i,o,s)},u=function(t,e,n,r,i,o,s){return a(e^n^r,t,e,i,o,s)},l=function(t,e,n,r,i,o,s){return a(n^(e|~r),t,e,i,o,s)},d=function(t,n){t[n>>5]|=128<<n%32,t[14+(n+64>>>9<<4)]=n;for(var r,i,o,a,d=1732584193,f=-271733879,h=-1732584194,p=271733878,m=0;m<t.length;m+=16)r=d,i=f,o=h,a=p,d=s(d,f,h,p,t[m+0],7,-680876936),p=s(p,d,f,h,t[m+1],12,-389564586),h=s(h,p,d,f,t[m+2],17,606105819),f=s(f,h,p,d,t[m+3],22,-1044525330),d=s(d,f,h,p,t[m+4],7,-176418897),p=s(p,d,f,h,t[m+5],12,1200080426),h=s(h,p,d,f,t[m+6],17,-1473231341),f=s(f,h,p,d,t[m+7],22,-45705983),d=s(d,f,h,p,t[m+8],7,1770035416),p=s(p,d,f,h,t[m+9],12,-1958414417),h=s(h,p,d,f,t[m+10],17,-42063),f=s(f,h,p,d,t[m+11],22,-1990404162),d=s(d,f,h,p,t[m+12],7,1804603682),p=s(p,d,f,h,t[m+13],12,-40341101),h=s(h,p,d,f,t[m+14],17,-1502002290),f=s(f,h,p,d,t[m+15],22,1236535329),d=c(d,f,h,p,t[m+1],5,-165796510),p=c(p,d,f,h,t[m+6],9,-1069501632),h=c(h,p,d,f,t[m+11],14,643717713),f=c(f,h,p,d,t[m+0],20,-373897302),d=c(d,f,h,p,t[m+5],5,-701558691),p=c(p,d,f,h,t[m+10],9,38016083),h=c(h,p,d,f,t[m+15],14,-660478335),f=c(f,h,p,d,t[m+4],20,-405537848),d=c(d,f,h,p,t[m+9],5,568446438),p=c(p,d,f,h,t[m+14],9,-1019803690),h=c(h,p,d,f,t[m+3],14,-187363961),f=c(f,h,p,d,t[m+8],20,1163531501),d=c(d,f,h,p,t[m+13],5,-1444681467),p=c(p,d,f,h,t[m+2],9,-51403784),h=c(h,p,d,f,t[m+7],14,1735328473),f=c(f,h,p,d,t[m+12],20,-1926607734),d=u(d,f,h,p,t[m+5],4,-378558),p=u(p,d,f,h,t[m+8],11,-2022574463),h=u(h,p,d,f,t[m+11],16,1839030562),f=u(f,h,p,d,t[m+14],23,-35309556),d=u(d,f,h,p,t[m+1],4,-1530992060),p=u(p,d,f,h,t[m+4],11,1272893353),h=u(h,p,d,f,t[m+7],16,-155497632),f=u(f,h,p,d,t[m+10],23,-1094730640),d=u(d,f,h,p,t[m+13],4,681279174),p=u(p,d,f,h,t[m+0],11,-358537222),h=u(h,p,d,f,t[m+3],16,-722521979),f=u(f,h,p,d,t[m+6],23,76029189),d=u(d,f,h,p,t[m+9],4,-640364487),p=u(p,d,f,h,t[m+12],11,-421815835),h=u(h,p,d,f,t[m+15],16,530742520),f=u(f,h,p,d,t[m+2],23,-995338651),d=l(d,f,h,p,t[m+0],6,-198630844),p=l(p,d,f,h,t[m+7],10,1126891415),h=l(h,p,d,f,t[m+14],15,-1416354905),f=l(f,h,p,d,t[m+5],21,-57434055),d=l(d,f,h,p,t[m+12],6,1700485571),p=l(p,d,f,h,t[m+3],10,-1894986606),h=l(h,p,d,f,t[m+10],15,-1051523),f=l(f,h,p,d,t[m+1],21,-2054922799),d=l(d,f,h,p,t[m+8],6,1873313359),p=l(p,d,f,h,t[m+15],10,-30611744),h=l(h,p,d,f,t[m+6],15,-1560198380),f=l(f,h,p,d,t[m+13],21,1309151649),d=l(d,f,h,p,t[m+4],6,-145523070),p=l(p,d,f,h,t[m+11],10,-1120210379),h=l(h,p,d,f,t[m+2],15,718787259),f=l(f,h,p,d,t[m+9],21,-343485551),d=e(d,r),f=e(f,i),h=e(h,o),p=e(p,a);return[d,f,h,p]};return{hexdigest:function(t){return o(d(r(t),8*t.length))},hash:function(t){return i(d(r(t),8*t.length))}}}),function(t,e){"function"==typeof define&&define.amd?define("strophe-utils",function(){return e()}):t.stropheUtils=e()}(this,function(){return{utf16to8:function(t){var e,n,r="",i=t.length;for(e=0;e<i;e++)(n=t.charCodeAt(e))>=0&&n<=127?r+=t.charAt(e):n>2047?(r+=String.fromCharCode(224|n>>12&15),r+=String.fromCharCode(128|n>>6&63),r+=String.fromCharCode(128|n>>0&63)):(r+=String.fromCharCode(192|n>>6&31),r+=String.fromCharCode(128|n>>0&63));return r},addCookies:function(t){var e,n,r,i,o,a,s;for(e in t||{})o="",a="",s="",r="object"==typeof(n=t[e]),i=escape(unescape(r?n.value:n)),r&&(o=n.expires?";expires="+n.expires:"",a=n.domain?";domain="+n.domain:"",s=n.path?";path="+n.path:""),document.cookie=e+"="+i+o+a+s}}}),function(t,e){"function"==typeof define&&define.amd?define("strophe-polyfill",[],function(){return e()}):t.polyfills=e()}(this,function(){var t={bind:function(t,e){var n=Array.prototype.slice,r=Array.prototype.concat,i=n.call(arguments,2);return function(){return t.apply(e||this,r.call(i,n.call(arguments,0)))}}};return Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(t){var e=this.length,n=Number(arguments[1])||0;for((n=n<0?Math.ceil(n):Math.floor(n))<0&&(n+=e);n<e;n++)if(n in this&&this[n]===t)return n;return-1}),t}),function(t,e){if("function"==typeof define&&define.amd)define("strophe-core",["strophe-sha1","strophe-base64","strophe-md5","strophe-utils","strophe-polyfill"],function(){return e.apply(this,arguments)});else{var n=e(t.SHA1,t.Base64,t.MD5,t.stropheUtils,t.polyfills);t.Strophe=n.Strophe,t.$build=n.$build,t.$iq=n.$iq,t.$msg=n.$msg,t.$pres=n.$pres}}(this,function(e,n,r,i,o){function a(t,e){return new u.Builder(t,e)}function s(t){return new u.Builder("iq",t)}function c(t){return new u.Builder("presence",t)}var u,l=o.bind;return u={bind:l,VERSION:"3.2.0",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",FRAMING:"urn:ietf:params:xml:ns:xmpp-framing",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},XHTML:{tags:["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul","body"],attributes:{a:["href"],blockquote:["style"],br:[],cite:["style"],em:[],img:["src","alt","style","height","width"],li:["style"],ol:["style"],p:["style"],span:["style"],strong:[],ul:["style"],body:[]},css:["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"],validTag:function(t){for(var e=0;e<u.XHTML.tags.length;e++)if(t==u.XHTML.tags[e])return!0;return!1},validAttribute:function(t,e){if(void 0!==u.XHTML.attributes[t]&&u.XHTML.attributes[t].length>0)for(var n=0;n<u.XHTML.attributes[t].length;n++)if(e==u.XHTML.attributes[t][n])return!0;return!1},validCSS:function(t){for(var e=0;e<u.XHTML.css.length;e++)if(t==u.XHTML.css[e])return!0;return!1}},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8,REDIRECT:9,CONNTIMEOUT:10},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11},TIMEOUT:1.1,SECONDARY_TIMEOUT:.1,addNamespace:function(t,e){u.NS[t]=e},forEachChild:function(t,e,n){var r,i;for(r=0;r<t.childNodes.length;r++)(i=t.childNodes[r]).nodeType!=u.ElementType.NORMAL||e&&!this.isTagEqual(i,e)||n(i)},isTagEqual:function(t,e){return t.tagName==e},_xmlGenerator:null,_makeGenerator:function(){var e;return document.implementation.createDocument===t||document.implementation.createDocument&&document.documentMode&&document.documentMode<10?(e=this._getIEXmlDom()).appendChild(e.createElement("strophe")):e=document.implementation.createDocument("jabber:client","strophe",null),e},xmlGenerator:function(){return u._xmlGenerator||(u._xmlGenerator=u._makeGenerator()),u._xmlGenerator},_getIEXmlDom:function(){for(var t=null,e=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.5.0","Msxml2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"],n=0;n<e.length&&null===t;n++)try{t=new ActiveXObject(e[n])}catch(e){t=null}return t},xmlElement:function(e){if(!e)return null;var n,r,i,o=u.xmlGenerator().createElement(e);for(n=1;n<arguments.length;n++){var a=arguments[n];if(a)if("string"==typeof a||"number"==typeof a)o.appendChild(u.xmlTextNode(a));else if("object"==typeof a&&"function"==typeof a.sort)for(r=0;r<a.length;r++){var s=a[r];"object"==typeof s&&"function"==typeof s.sort&&s[1]!==t&&null!==s[1]&&o.setAttribute(s[0],s[1])}else if("object"==typeof a)for(i in a)a.hasOwnProperty(i)&&a[i]!==t&&null!==a[i]&&o.setAttribute(i,a[i])}return o},xmlescape:function(t){return t=t.replace(/\&/g,"&amp;"),t=t.replace(/</g,"&lt;"),t=t.replace(/>/g,"&gt;"),t=t.replace(/'/g,"&apos;"),t=t.replace(/"/g,"&quot;")},xmlunescape:function(t){return t=t.replace(/\&amp;/g,"&"),t=t.replace(/&lt;/g,"<"),t=t.replace(/&gt;/g,">"),t=t.replace(/&apos;/g,"'"),t=t.replace(/&quot;/g,'"')},xmlTextNode:function(t){return u.xmlGenerator().createTextNode(t)},xmlHtmlNode:function(t){var e;return window.DOMParser?e=(new DOMParser).parseFromString(t,"text/xml"):((e=new ActiveXObject("Microsoft.XMLDOM")).async="false",e.loadXML(t)),e},getText:function(t){if(!t)return null;var e="";0===t.childNodes.length&&t.nodeType==u.ElementType.TEXT&&(e+=t.nodeValue);for(var n=0;n<t.childNodes.length;n++)t.childNodes[n].nodeType==u.ElementType.TEXT&&(e+=t.childNodes[n].nodeValue);return u.xmlescape(e)},copyElement:function(t){var e,n;if(t.nodeType==u.ElementType.NORMAL){for(n=u.xmlElement(t.tagName),e=0;e<t.attributes.length;e++)n.setAttribute(t.attributes[e].nodeName,t.attributes[e].value);for(e=0;e<t.childNodes.length;e++)n.appendChild(u.copyElement(t.childNodes[e]))}else t.nodeType==u.ElementType.TEXT&&(n=u.xmlGenerator().createTextNode(t.nodeValue));return n},createHtml:function(t){var e,n,r,i,o,a,s,c,l,d,f;if(t.nodeType==u.ElementType.NORMAL)if(i=t.nodeName.toLowerCase(),u.XHTML.validTag(i))try{for(n=u.xmlElement(i),e=0;e<u.XHTML.attributes[i].length;e++)if(o=u.XHTML.attributes[i][e],void 0!==(a=t.getAttribute(o))&&null!==a&&""!==a&&!1!==a&&0!==a)if("style"==o&&"object"==typeof a&&void 0!==a.cssText&&(a=a.cssText),"style"==o){for(s=[],c=a.split(";"),r=0;r<c.length;r++)d=(l=c[r].split(":"))[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase(),u.XHTML.validCSS(d)&&(f=l[1].replace(/^\s*/,"").replace(/\s*$/,""),s.push(d+": "+f));s.length>0&&(a=s.join("; "),n.setAttribute(o,a))}else n.setAttribute(o,a);for(e=0;e<t.childNodes.length;e++)n.appendChild(u.createHtml(t.childNodes[e]))}catch(t){n=u.xmlTextNode("")}else for(n=u.xmlGenerator().createDocumentFragment(),e=0;e<t.childNodes.length;e++)n.appendChild(u.createHtml(t.childNodes[e]));else if(t.nodeType==u.ElementType.FRAGMENT)for(n=u.xmlGenerator().createDocumentFragment(),e=0;e<t.childNodes.length;e++)n.appendChild(u.createHtml(t.childNodes[e]));else t.nodeType==u.ElementType.TEXT&&(n=u.xmlTextNode(t.nodeValue));return n},escapeNode:function(t){return"string"!=typeof t?t:t.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},unescapeNode:function(t){return"string"!=typeof t?t:t.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},getNodeFromJid:function(t){return t.indexOf("@")<0?null:t.split("@")[0]},getDomainFromJid:function(t){var e=u.getBareJidFromJid(t);if(e.indexOf("@")<0)return e;var n=e.split("@");return n.splice(0,1),n.join("@")},getResourceFromJid:function(t){var e=t.split("/");return e.length<2?null:(e.splice(0,1),e.join("/"))},getBareJidFromJid:function(t){return t?t.split("/")[0]:null},log:function(t,e){},debug:function(t){this.log(this.LogLevel.DEBUG,t)},info:function(t){this.log(this.LogLevel.INFO,t)},warn:function(t){this.log(this.LogLevel.WARN,t)},error:function(t){this.log(this.LogLevel.ERROR,t)},fatal:function(t){this.log(this.LogLevel.FATAL,t)},serialize:function(t){var e;if(!t)return null;"function"==typeof t.tree&&(t=t.tree());var n,r,i=t.nodeName;for(t.getAttribute("_realname")&&(i=t.getAttribute("_realname")),e="<"+i,n=0;n<t.attributes.length;n++)"_realname"!=t.attributes[n].nodeName&&(e+=" "+t.attributes[n].nodeName+"='"+u.xmlescape(t.attributes[n].value)+"'");if(t.childNodes.length>0){for(e+=">",n=0;n<t.childNodes.length;n++)switch((r=t.childNodes[n]).nodeType){case u.ElementType.NORMAL:e+=u.serialize(r);break;case u.ElementType.TEXT:e+=u.xmlescape(r.nodeValue);break;case u.ElementType.CDATA:e+="<![CDATA["+r.nodeValue+"]]>"}e+="</"+i+">"}else e+="/>";return e},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(t,e){u._connectionPlugins[t]=e}},u.Builder=function(t,e){"presence"!=t&&"message"!=t&&"iq"!=t||(e&&!e.xmlns?e.xmlns=u.NS.CLIENT:e||(e={xmlns:u.NS.CLIENT})),this.nodeTree=u.xmlElement(t,e),this.node=this.nodeTree},u.Builder.prototype={tree:function(){return this.nodeTree},toString:function(){return u.serialize(this.nodeTree)},up:function(){return this.node=this.node.parentNode,this},attrs:function(e){for(var n in e)e.hasOwnProperty(n)&&(e[n]===t?this.node.removeAttribute(n):this.node.setAttribute(n,e[n]));return this},c:function(t,e,n){var r=u.xmlElement(t,e,n);return this.node.appendChild(r),"string"!=typeof n&&"number"!=typeof n&&(this.node=r),this},cnode:function(e){var n,r=u.xmlGenerator();try{n=r.importNode!==t}catch(t){n=!1}var i=n?r.importNode(e,!0):u.copyElement(e);return this.node.appendChild(i),this.node=i,this},t:function(t){var e=u.xmlTextNode(t);return this.node.appendChild(e),this},h:function(t){var e=document.createElement("body");e.innerHTML=t;for(var n=u.createHtml(e);n.childNodes.length>0;)this.node.appendChild(n.childNodes[0]);return this}},u.Handler=function(t,e,n,r,i,o,a){this.handler=t,this.ns=e,this.name=n,this.type=r,this.id=i,this.options=a||{matchBare:!1},this.options.matchBare||(this.options.matchBare=!1),this.options.matchBare?this.from=o?u.getBareJidFromJid(o):null:this.from=o,this.user=!0},u.Handler.prototype={isMatch:function(t){var e,n=null;if(n=this.options.matchBare?u.getBareJidFromJid(t.getAttribute("from")):t.getAttribute("from"),e=!1,this.ns){var r=this;u.forEachChild(t,null,function(t){t.getAttribute("xmlns")==r.ns&&(e=!0)}),e=e||t.getAttribute("xmlns")==this.ns}else e=!0;var i=t.getAttribute("type");return!(!e||this.name&&!u.isTagEqual(t,this.name)||this.type&&(Array.isArray(this.type)?-1==this.type.indexOf(i):i!=this.type)||this.id&&t.getAttribute("id")!=this.id||this.from&&n!=this.from)},run:function(t){var e=null;try{e=this.handler(t)}catch(t){throw t.sourceURL?u.fatal("error: "+this.handler+" "+t.sourceURL+":"+t.line+" - "+t.name+": "+t.message):t.fileName?("undefined"!=typeof console&&(console.trace(),console.error(this.handler," - error - ",t,t.message)),u.fatal("error: "+this.handler+" "+t.fileName+":"+t.lineNumber+" - "+t.name+": "+t.message)):u.fatal("error: "+t.message+"\n"+t.stack),t}return e},toString:function(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}},u.TimedHandler=function(t,e){this.period=t,this.handler=e,this.lastCalled=(new Date).getTime(),this.user=!0},u.TimedHandler.prototype={run:function(){return this.lastCalled=(new Date).getTime(),this.handler()},reset:function(){this.lastCalled=(new Date).getTime()},toString:function(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}},u.Connection=function(t,e){this.service=t,this.options=e||{};var n=this.options.protocol||"";0===t.indexOf("ws:")||0===t.indexOf("wss:")||0===n.indexOf("ws")?this._proto=new u.Websocket(this):this._proto=new u.Bosh(this),this.jid="",this.domain=null,this.features=null,this._sasl_data={},this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._authentication={},this._idleTimeout=null,this._disconnectTimeout=null,this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.do_authentication=!0,this.paused=!1,this.restored=!1,this._data=[],this._uniqueId=0,this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this.maxRetries=5,this._idleTimeout=setTimeout(l(this._onIdle,this),100),i.addCookies(this.options.cookies);for(var r in u._connectionPlugins)if(u._connectionPlugins.hasOwnProperty(r)){var o=u._connectionPlugins[r],a=function(){};a.prototype=o,this[r]=new a,this[r].init(this)}},u.Connection.prototype={reset:function(){this._proto._reset(),this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._authentication={},this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.restored=!1,this._data=[],this._requests=[],this._uniqueId=0},pause:function(){this.paused=!0},resume:function(){this.paused=!1},getUniqueId:function(t){var e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)});return"string"==typeof t||"number"==typeof t?e+":"+t:e+""},connect:function(t,e,n,r,i,o,a){this.jid=t,this.authzid=u.getBareJidFromJid(this.jid),this.authcid=a||u.getNodeFromJid(this.jid),this.pass=e,this.servtype="xmpp",this.connect_callback=n,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.restored=!1,this.domain=u.getDomainFromJid(this.jid),this._changeConnectStatus(u.Status.CONNECTING,null),this._proto._connect(r,i,o)},attach:function(t,e,n,r,i,o,a){if(!(this._proto instanceof u.Bosh))throw{name:"StropheSessionError",message:'The "attach" method can only be used with a BOSH connection.'};this._proto._attach(t,e,n,r,i,o,a)},restore:function(t,e,n,r,i){if(!this._sessionCachingSupported())throw{name:"StropheSessionError",message:'The "restore" method can only be used with a BOSH connection.'};this._proto._restore(t,e,n,r,i)},_sessionCachingSupported:function(){if(this._proto instanceof u.Bosh){if(!JSON)return!1;try{window.sessionStorage.setItem("_strophe_","_strophe_"),window.sessionStorage.removeItem("_strophe_")}catch(t){return!1}return!0}return!1},xmlInput:function(t){},xmlOutput:function(t){},rawInput:function(t){},rawOutput:function(t){},nextValidRid:function(t){},send:function(t){if(null!==t){if("function"==typeof t.sort)for(var e=0;e<t.length;e++)this._queueData(t[e]);else"function"==typeof t.tree?this._queueData(t.tree()):this._queueData(t);this._proto._send()}},flush:function(){clearTimeout(this._idleTimeout),this._onIdle()},sendIQ:function(t,e,n,r){var i=null,o=this;"function"==typeof t.tree&&(t=t.tree());var a=t.getAttribute("id");a||(a=this.getUniqueId("sendIQ"),t.setAttribute("id",a));var s=t.getAttribute("to"),c=this.jid,l=this.addHandler(function(t){i&&o.deleteTimedHandler(i);var r=!1,a=t.getAttribute("from");if(a!==s&&(s||a!==u.getBareJidFromJid(c)&&a!==u.getDomainFromJid(c)&&a!==c)||(r=!0),!r)throw{name:"StropheError",message:"Got answer to IQ from wrong jid:"+a+"\nExpected jid: "+s};var l=t.getAttribute("type");if("result"==l)e&&e(t);else{if("error"!=l)throw{name:"StropheError",message:"Got bad IQ type of "+l};n&&n(t)}},null,"iq",["error","result"],a);return r&&(i=this.addTimedHandler(r,function(){return o.deleteHandler(l),n&&n(null),!1})),this.send(t),a},_queueData:function(t){if(null===t||!t.tagName||!t.childNodes)throw{name:"StropheError",message:"Cannot queue non-DOMElement."};this._data.push(t)},_sendRestart:function(){this._data.push("restart"),this._proto._sendRestart(),this._idleTimeout=setTimeout(l(this._onIdle,this),100)},addTimedHandler:function(t,e){var n=new u.TimedHandler(t,e);return this.addTimeds.push(n),n},deleteTimedHandler:function(t){this.removeTimeds.push(t)},addHandler:function(t,e,n,r,i,o,a){var s=new u.Handler(t,e,n,r,i,o,a);return this.addHandlers.push(s),s},deleteHandler:function(t){this.removeHandlers.push(t);var e=this.addHandlers.indexOf(t);e>=0&&this.addHandlers.splice(e,1)},disconnect:function(t){if(this._changeConnectStatus(u.Status.DISCONNECTING,t),u.info("Disconnect was called because: "+t),this.connected){var e=!1;this.disconnecting=!0,this.authenticated&&(e=c({xmlns:u.NS.CLIENT,type:"unavailable"})),this._disconnectTimeout=this._addSysTimedHandler(3e3,l(this._onDisconnectTimeout,this)),this._proto._disconnect(e)}else u.info("Disconnect was called before Strophe connected to the server"),this._proto._abortAllRequests()},_changeConnectStatus:function(t,e){for(var n in u._connectionPlugins)if(u._connectionPlugins.hasOwnProperty(n)){var r=this[n];if(r.statusChanged)try{r.statusChanged(t,e)}catch(t){u.error(n+" plugin caused an exception changing status: "+t)}}if(this.connect_callback)try{this.connect_callback(t,e)}catch(t){u.error("User connection callback caused an exception: "+t)}},_doDisconnect:function(t){"number"==typeof this._idleTimeout&&clearTimeout(this._idleTimeout),null!==this._disconnectTimeout&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null),u.info("_doDisconnect was called"),this._proto._doDisconnect(),this.authenticated=!1,this.disconnecting=!1,this.restored=!1,this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._changeConnectStatus(u.Status.DISCONNECTED,t),this.connected=!1},_dataRecv:function(t,e){u.info("_dataRecv called");var n=this._proto._reqToData(t);if(null!==n){this.xmlInput!==u.Connection.prototype.xmlInput&&(n.nodeName===this._proto.strip&&n.childNodes.length?this.xmlInput(n.childNodes[0]):this.xmlInput(n)),this.rawInput!==u.Connection.prototype.rawInput&&(e?this.rawInput(e):this.rawInput(u.serialize(n)));for(var r,i;this.removeHandlers.length>0;)i=this.removeHandlers.pop(),(r=this.handlers.indexOf(i))>=0&&this.handlers.splice(r,1);for(;this.addHandlers.length>0;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&this._proto._emptyQueue())this._doDisconnect();else{var o,a,s=n.getAttribute("type");if(null!==s&&"terminate"==s){if(this.disconnecting)return;return o=n.getAttribute("condition"),a=n.getElementsByTagName("conflict"),null!==o?("remote-stream-error"==o&&a.length>0&&(o="conflict"),this._changeConnectStatus(u.Status.CONNFAIL,o)):this._changeConnectStatus(u.Status.CONNFAIL,"unknown"),void this._doDisconnect(o)}var c=this;u.forEachChild(n,null,function(t){var e,n;for(n=c.handlers,c.handlers=[],e=0;e<n.length;e++){var r=n[e];try{!r.isMatch(t)||!c.authenticated&&r.user?c.handlers.push(r):r.run(t)&&c.handlers.push(r)}catch(t){u.warn("Removing Strophe handlers due to uncaught exception: "+t.message)}}})}}},mechanisms:{},_connect_cb:function(t,e,n){u.info("_connect_cb was called"),this.connected=!0;var r;try{r=this._proto._reqToData(t)}catch(t){if("badformat"!=t)throw t;this._changeConnectStatus(u.Status.CONNFAIL,"bad-format"),this._doDisconnect("bad-format")}if(r&&(this.xmlInput!==u.Connection.prototype.xmlInput&&(r.nodeName===this._proto.strip&&r.childNodes.length?this.xmlInput(r.childNodes[0]):this.xmlInput(r)),this.rawInput!==u.Connection.prototype.rawInput&&(n?this.rawInput(n):this.rawInput(u.serialize(r))),this._proto._connect_cb(r)!==u.Status.CONNFAIL)){this._authentication.sasl_scram_sha1=!1,this._authentication.sasl_plain=!1,this._authentication.sasl_digest_md5=!1,this._authentication.sasl_anonymous=!1,this._authentication.legacy_auth=!1;var i;i=r.getElementsByTagNameNS?r.getElementsByTagNameNS(u.NS.STREAM,"features").length>0:r.getElementsByTagName("stream:features").length>0||r.getElementsByTagName("features").length>0;var o,a,s=r.getElementsByTagName("mechanism"),c=[];if(i){if(s.length>0)for(o=0;o<s.length;o++)a=u.getText(s[o]),this.mechanisms[a]&&c.push(this.mechanisms[a]);this._authentication.legacy_auth=r.getElementsByTagName("auth").length>0,this._authentication.legacy_auth||c.length>0?!1!==this.do_authentication&&this.authenticate(c):this._proto._no_auth_received(e)}else this._proto._no_auth_received(e)}},authenticate:function(t){var e;for(e=0;e<t.length-1;++e){for(var r=e,i=e+1;i<t.length;++i)t[i].prototype.priority>t[r].prototype.priority&&(r=i);if(r!=e){var o=t[e];t[e]=t[r],t[r]=o}}var c=!1;for(e=0;e<t.length;++e)if(t[e].prototype.test(this)){this._sasl_success_handler=this._addSysHandler(l(this._sasl_success_cb,this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(l(this._sasl_failure_cb,this),null,"failure",null,null),this._sasl_challenge_handler=this._addSysHandler(l(this._sasl_challenge_cb,this),null,"challenge",null,null),this._sasl_mechanism=new t[e],this._sasl_mechanism.onStart(this);var d=a("auth",{xmlns:u.NS.SASL,mechanism:this._sasl_mechanism.name});if(this._sasl_mechanism.isClientFirst){var f=this._sasl_mechanism.onChallenge(this,null);d.t(n.encode(f))}this.send(d.tree()),c=!0;break}c||(null===u.getNodeFromJid(this.jid)?(this._changeConnectStatus(u.Status.CONNFAIL,"x-strophe-bad-non-anon-jid"),this.disconnect("x-strophe-bad-non-anon-jid")):(this._changeConnectStatus(u.Status.AUTHENTICATING,null),this._addSysHandler(l(this._auth1_cb,this),null,null,null,"_auth_1"),this.send(s({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:u.NS.AUTH}).c("username",{}).t(u.getNodeFromJid(this.jid)).tree())))},_sasl_challenge_cb:function(t){var e=n.decode(u.getText(t)),r=this._sasl_mechanism.onChallenge(this,e),i=a("response",{xmlns:u.NS.SASL});return""!==r&&i.t(n.encode(r)),this.send(i.tree()),!0},_auth1_cb:function(t){var e=s({type:"set",id:"_auth_2"}).c("query",{xmlns:u.NS.AUTH}).c("username",{}).t(u.getNodeFromJid(this.jid)).up().c("password").t(this.pass);return u.getResourceFromJid(this.jid)||(this.jid=u.getBareJidFromJid(this.jid)+"/strophe"),e.up().c("resource",{}).t(u.getResourceFromJid(this.jid)),this._addSysHandler(l(this._auth2_cb,this),null,null,null,"_auth_2"),this.send(e.tree()),!1},_sasl_success_cb:function(t){if(this._sasl_data["server-signature"]){var e,r=/([a-z]+)=([^,]+)(,|$)/,i=n.decode(u.getText(t)).match(r);if("v"==i[1]&&(e=i[2]),e!=this._sasl_data["server-signature"])return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data={},this._sasl_failure_cb(null)}u.info("SASL authentication succeeded."),this._sasl_mechanism&&this._sasl_mechanism.onSuccess(),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null);var o=[],a=function(t,e){for(;t.length;)this.deleteHandler(t.pop());return l(this._sasl_auth1_cb,this)(e),!1};return o.push(this._addSysHandler(l(function(t){l(a,this)(o,t)},this),null,"stream:features",null,null)),o.push(this._addSysHandler(l(function(t){l(a,this)(o,t)},this),u.NS.STREAM,"features",null,null)),this._sendRestart(),!1},_sasl_auth1_cb:function(t){this.features=t;var e,n;for(e=0;e<t.childNodes.length;e++)"bind"==(n=t.childNodes[e]).nodeName&&(this.do_bind=!0),"session"==n.nodeName&&(this.do_session=!0);if(!this.do_bind)return this._changeConnectStatus(u.Status.AUTHFAIL,null),!1;this._addSysHandler(l(this._sasl_bind_cb,this),null,null,null,"_bind_auth_2");var r=u.getResourceFromJid(this.jid);return r?this.send(s({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:u.NS.BIND}).c("resource",{}).t(r).tree()):this.send(s({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:u.NS.BIND}).tree()),!1},_sasl_bind_cb:function(t){if("error"==t.getAttribute("type")){u.info("SASL binding failed.");var e;return t.getElementsByTagName("conflict").length>0&&(e="conflict"),this._changeConnectStatus(u.Status.AUTHFAIL,e),!1}var n,r=t.getElementsByTagName("bind");if(!(r.length>0))return u.info("SASL binding failed."),this._changeConnectStatus(u.Status.AUTHFAIL,null),!1;(n=r[0].getElementsByTagName("jid")).length>0&&(this.jid=u.getText(n[0]),this.do_session?(this._addSysHandler(l(this._sasl_session_cb,this),null,null,null,"_session_auth_2"),this.send(s({type:"set",id:"_session_auth_2"}).c("session",{xmlns:u.NS.SESSION}).tree())):(this.authenticated=!0,this._changeConnectStatus(u.Status.CONNECTED,null)))},_sasl_session_cb:function(t){if("result"==t.getAttribute("type"))this.authenticated=!0,this._changeConnectStatus(u.Status.CONNECTED,null);else if("error"==t.getAttribute("type"))return u.info("Session creation failed."),this._changeConnectStatus(u.Status.AUTHFAIL,null),!1;return!1},_sasl_failure_cb:function(t){return this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_mechanism&&this._sasl_mechanism.onFailure(),this._changeConnectStatus(u.Status.AUTHFAIL,null),!1},_auth2_cb:function(t){return"result"==t.getAttribute("type")?(this.authenticated=!0,this._changeConnectStatus(u.Status.CONNECTED,null)):"error"==t.getAttribute("type")&&(this._changeConnectStatus(u.Status.AUTHFAIL,null),this.disconnect("authentication failed")),!1},_addSysTimedHandler:function(t,e){var n=new u.TimedHandler(t,e);return n.user=!1,this.addTimeds.push(n),n},_addSysHandler:function(t,e,n,r,i){var o=new u.Handler(t,e,n,r,i);return o.user=!1,this.addHandlers.push(o),o},_onDisconnectTimeout:function(){return u.info("_onDisconnectTimeout was called"),this._changeConnectStatus(u.Status.CONNTIMEOUT,null),this._proto._onDisconnectTimeout(),this._doDisconnect(),!1},_onIdle:function(){for(var t,e,n;this.addTimeds.length>0;)this.timedHandlers.push(this.addTimeds.pop());for(;this.removeTimeds.length>0;)e=this.removeTimeds.pop(),(t=this.timedHandlers.indexOf(e))>=0&&this.timedHandlers.splice(t,1);var r=(new Date).getTime();for(n=[],t=0;t<this.timedHandlers.length;t++)e=this.timedHandlers[t],!this.authenticated&&e.user||(e.lastCalled+e.period-r<=0?e.run()&&n.push(e):n.push(e));this.timedHandlers=n,clearTimeout(this._idleTimeout),this._proto._onIdle(),this.connected&&(this._idleTimeout=setTimeout(l(this._onIdle,this),100))}},u.SASLMechanism=function(t,e,n){this.name=t,this.isClientFirst=e,this.priority=n},u.SASLMechanism.prototype={test:function(t){return!0},onStart:function(t){this._connection=t},onChallenge:function(t,e){throw new Error("You should implement challenge handling!")},onFailure:function(){this._connection=null},onSuccess:function(){this._connection=null}},u.SASLAnonymous=function(){},u.SASLAnonymous.prototype=new u.SASLMechanism("ANONYMOUS",!1,10),u.SASLAnonymous.prototype.test=function(t){return null===t.authcid},u.Connection.prototype.mechanisms[u.SASLAnonymous.prototype.name]=u.SASLAnonymous,u.SASLPlain=function(){},u.SASLPlain.prototype=new u.SASLMechanism("PLAIN",!0,20),u.SASLPlain.prototype.test=function(t){return null!==t.authcid},u.SASLPlain.prototype.onChallenge=function(t){var e=t.authzid;return e+="\0",e+=t.authcid,e+="\0",e+=t.pass,i.utf16to8(e)},u.Connection.prototype.mechanisms[u.SASLPlain.prototype.name]=u.SASLPlain,u.SASLSHA1=function(){},u.SASLSHA1.prototype=new u.SASLMechanism("SCRAM-SHA-1",!0,40),u.SASLSHA1.prototype.test=function(t){return null!==t.authcid},u.SASLSHA1.prototype.onChallenge=function(t,o,a){var s=a||r.hexdigest(1234567890*Math.random()),c="n="+i.utf16to8(t.authcid);return c+=",r=",c+=s,t._sasl_data.cnonce=s,t._sasl_data["client-first-message-bare"]=c,c="n,,"+c,this.onChallenge=l(function(t,r){for(var o,a,s,c,u,l,d,f,h,p,m,g="c=biws,",v=t._sasl_data["client-first-message-bare"]+","+r+",",_=t._sasl_data.cnonce,b=/([a-z]+)=([^,]+)(,|$)/;r.match(b);){var y=r.match(b);switch(r=r.replace(y[0],""),y[1]){case"r":o=y[2];break;case"s":a=y[2];break;case"i":s=y[2]}}if(o.substr(0,_.length)!==_)return t._sasl_data={},t._sasl_failure_cb();v+=g+="r="+o,a=n.decode(a),a+="\0\0\0";var w=i.utf16to8(t.pass);for(c=l=e.core_hmac_sha1(w,a),d=1;d<s;d++){for(u=e.core_hmac_sha1(w,e.binb2str(l)),f=0;f<5;f++)c[f]^=u[f];l=u}for(c=e.binb2str(c),h=e.core_hmac_sha1(c,"Client Key"),p=e.str_hmac_sha1(c,"Server Key"),m=e.core_hmac_sha1(e.str_sha1(e.binb2str(h)),v),t._sasl_data["server-signature"]=e.b64_hmac_sha1(p,v),f=0;f<5;f++)h[f]^=m[f];return g+=",p="+n.encode(e.binb2str(h))},this),c},u.Connection.prototype.mechanisms[u.SASLSHA1.prototype.name]=u.SASLSHA1,u.SASLMD5=function(){},u.SASLMD5.prototype=new u.SASLMechanism("DIGEST-MD5",!1,30),u.SASLMD5.prototype.test=function(t){return null!==t.authcid},u.SASLMD5.prototype._quote=function(t){return'"'+t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'},u.SASLMD5.prototype.onChallenge=function(t,e,n){for(var o,a=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/,s=n||r.hexdigest(""+1234567890*Math.random()),c="",u=null,d="";e.match(a);)switch(o=e.match(a),e=e.replace(o[0],""),o[2]=o[2].replace(/^"(.+)"$/,"$1"),o[1]){case"realm":c=o[2];break;case"nonce":d=o[2];break;case"qop":o[2];break;case"host":u=o[2]}var f=t.servtype+"/"+t.domain;null!==u&&(f=f+"/"+u);var h=i.utf16to8(t.authcid+":"+c+":"+this._connection.pass),p=r.hash(h)+":"+d+":"+s,m="AUTHENTICATE:"+f,g="";return g+="charset=utf-8,",g+="username="+this._quote(i.utf16to8(t.authcid))+",",g+="realm="+this._quote(c)+",",g+="nonce="+this._quote(d)+",",g+="nc=00000001,",g+="cnonce="+this._quote(s)+",",g+="digest-uri="+this._quote(f)+",",g+="response="+r.hexdigest(r.hexdigest(p)+":"+d+":00000001:"+s+":auth:"+r.hexdigest(m))+",",g+="qop=auth",this.onChallenge=l(function(){return""},this),g},u.Connection.prototype.mechanisms[u.SASLMD5.prototype.name]=u.SASLMD5,u.SASLOAuthBearer=function(){},u.SASLOAuthBearer.prototype=new u.SASLMechanism("OAUTHBEARER",!0,50),u.SASLOAuthBearer.prototype.test=function(t){return null!==t.authcid},u.SASLOAuthBearer.prototype.onChallenge=function(t){var e="n,a=";return e+=t.authzid,e+=",",e+="",e+="auth=Bearer ",e+=t.pass,e+="",e+="",i.utf16to8(e)},u.Connection.prototype.mechanisms[u.SASLOAuthBearer.prototype.name]=u.SASLOAuthBearer,u.SASLExternal=function(){},u.SASLExternal.prototype=new u.SASLMechanism("EXTERNAL",!0,60),u.SASLExternal.prototype.onChallenge=function(t){return t.authcid===t.authzid?"":t.authzid},u.Connection.prototype.mechanisms[u.SASLExternal.prototype.name]=u.SASLExternal,{Strophe:u,$build:a,$msg:function(t){return new u.Builder("message",t)},$iq:s,$pres:c,SHA1:e,Base64:n,MD5:r,polyfills:o}}),function(t,e){if("function"!=typeof define||!define.amd)return e(t.Strophe,t.$build,t.polyfills);define("strophe-bosh",["strophe-core"],function(t){return e(t.Strophe,t.$build,t.polyfills)})}(this,function(t,e,n){var r=n.bind;return t.Request=function(e,n,r,i){this.id=++t._requestId,this.xmlData=e,this.data=t.serialize(e),this.origFunc=n,this.func=n,this.rid=r,this.date=NaN,this.sends=i||0,this.abort=!1,this.dead=null,this.age=function(){return this.date?(new Date-this.date)/1e3:0},this.timeDead=function(){return this.dead?(new Date-this.dead)/1e3:0},this.xhr=this._newXHR()},t.Request.prototype={getResponse:function(){var e=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){if("parsererror"==(e=this.xhr.responseXML.documentElement).tagName)throw t.error("invalid response received"),t.error("responseText: "+this.xhr.responseText),t.error("responseXML: "+t.serialize(this.xhr.responseXML)),"parsererror"}else if(this.xhr.responseText)throw t.error("invalid response received"),t.error("responseText: "+this.xhr.responseText),"badformat";return e},_newXHR:function(){var t=null;return window.XMLHttpRequest?(t=new XMLHttpRequest).overrideMimeType&&t.overrideMimeType("text/xml; charset=utf-8"):window.ActiveXObject&&(t=new ActiveXObject("Microsoft.XMLHTTP")),t.onreadystatechange=r(this.func,null,this),t}},t.Bosh=function(t){this._conn=t,this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.hold=1,this.wait=60,this.window=5,this.errors=0,this._requests=[]},t.Bosh.prototype={strip:null,_buildBody:function(){var n=e("body",{rid:this.rid++,xmlns:t.NS.HTTPBIND});return null!==this.sid&&n.attrs({sid:this.sid}),this._conn.options.keepalive&&this._conn._sessionCachingSupported()&&this._cacheSession(),n},_reset:function(){this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.errors=0,this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_connect:function(e,n,i){this.wait=e||this.wait,this.hold=n||this.hold,this.errors=0;var o=this._buildBody().attrs({to:this._conn.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":t.NS.BOSH});i&&o.attrs({route:i});var a=this._conn._connect_cb;this._requests.push(new t.Request(o.tree(),r(this._onRequestStateChange,this,r(a,this._conn)),o.tree().getAttribute("rid"))),this._throttledRequestHandler()},_attach:function(e,n,r,i,o,a,s){this._conn.jid=e,this.sid=n,this.rid=r,this._conn.connect_callback=i,this._conn.domain=t.getDomainFromJid(this._conn.jid),this._conn.authenticated=!0,this._conn.connected=!0,this.wait=o||this.wait,this.hold=a||this.hold,this.window=s||this.window,this._conn._changeConnectStatus(t.Status.ATTACHED,null)},_restore:function(e,n,r,i,o){var a=JSON.parse(window.sessionStorage.getItem("strophe-bosh-session"));if(!(void 0!==a&&null!==a&&a.rid&&a.sid&&a.jid)||void 0!==e&&null!==e&&t.getBareJidFromJid(a.jid)!=t.getBareJidFromJid(e))throw{name:"StropheSessionError",message:"_restore: no restoreable session."};this._conn.restored=!0,this._attach(a.jid,a.sid,a.rid,n,r,i,o)},_cacheSession:function(){this._conn.authenticated?this._conn.jid&&this.rid&&this.sid&&window.sessionStorage.setItem("strophe-bosh-session",JSON.stringify({jid:this._conn.jid,rid:this.rid,sid:this.sid})):window.sessionStorage.removeItem("strophe-bosh-session")},_connect_cb:function(e){var n,r,i=e.getAttribute("type");if(null!==i&&"terminate"==i)return n=e.getAttribute("condition"),t.error("BOSH-Connection failed: "+n),r=e.getElementsByTagName("conflict"),null!==n?("remote-stream-error"==n&&r.length>0&&(n="conflict"),this._conn._changeConnectStatus(t.Status.CONNFAIL,n)):this._conn._changeConnectStatus(t.Status.CONNFAIL,"unknown"),this._conn._doDisconnect(n),t.Status.CONNFAIL;this.sid||(this.sid=e.getAttribute("sid"));var o=e.getAttribute("requests");o&&(this.window=parseInt(o,10));var a=e.getAttribute("hold");a&&(this.hold=parseInt(a,10));var s=e.getAttribute("wait");s&&(this.wait=parseInt(s,10))},_disconnect:function(t){this._sendTerminate(t)},_doDisconnect:function(){this.sid=null,this.rid=Math.floor(4294967295*Math.random()),this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_emptyQueue:function(){return 0===this._requests.length},_hitError:function(e){this.errors++,t.warn("request errored, status: "+e+", number of errors: "+this.errors),this.errors>4&&this._conn._onDisconnectTimeout()},_no_auth_received:function(e){e=e?r(e,this._conn):r(this._conn._connect_cb,this._conn);var n=this._buildBody();this._requests.push(new t.Request(n.tree(),r(this._onRequestStateChange,this,r(e,this._conn)),n.tree().getAttribute("rid"))),this._throttledRequestHandler()},_onDisconnectTimeout:function(){this._abortAllRequests()},_abortAllRequests:function(){for(var t;this._requests.length>0;)(t=this._requests.pop()).abort=!0,t.xhr.abort(),t.xhr.onreadystatechange=function(){}},_onIdle:function(){var e=this._conn._data;if(this._conn.authenticated&&0===this._requests.length&&0===e.length&&!this._conn.disconnecting&&(t.info("no requests during idle cycle, sending blank request"),e.push(null)),!this._conn.paused){if(this._requests.length<2&&e.length>0){for(var n=this._buildBody(),i=0;i<e.length;i++)null!==e[i]&&("restart"===e[i]?n.attrs({to:this._conn.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":t.NS.BOSH}):n.cnode(e[i]).up());delete this._conn._data,this._conn._data=[],this._requests.push(new t.Request(n.tree(),r(this._onRequestStateChange,this,r(this._conn._dataRecv,this._conn)),n.tree().getAttribute("rid"))),this._throttledRequestHandler()}if(this._requests.length>0){var o=this._requests[0].age();null!==this._requests[0].dead&&this._requests[0].timeDead()>Math.floor(t.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler(),o>Math.floor(t.TIMEOUT*this.wait)&&(t.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(t.TIMEOUT*this.wait)+" seconds since last activity"),this._throttledRequestHandler())}}},_onRequestStateChange:function(e,n){if(t.debug("request id "+n.id+"."+n.sends+" state changed to "+n.xhr.readyState),n.abort)n.abort=!1;else{var r;if(4==n.xhr.readyState){r=0;try{r=n.xhr.status}catch(t){}if(void 0===r&&(r=0),this.disconnecting&&r>=400)return void this._hitError(r);var i=this._requests[0]==n,o=this._requests[1]==n;(r>0&&r<500||n.sends>5)&&(this._removeRequest(n),t.debug("request id "+n.id+" should now be removed")),200==r?((o||i&&this._requests.length>0&&this._requests[0].age()>Math.floor(t.SECONDARY_TIMEOUT*this.wait))&&this._restartRequest(0),this._conn.nextValidRid(Number(n.rid)+1),t.debug("request id "+n.id+"."+n.sends+" got 200"),e(n),this.errors=0):(t.error("request id "+n.id+"."+n.sends+" error "+r+" happened"),(0===r||r>=400&&r<600||r>=12e3)&&(this._hitError(r),r>=400&&r<500&&(this._conn._changeConnectStatus(t.Status.DISCONNECTING,null),this._conn._doDisconnect()))),r>0&&r<500||n.sends>5||this._throttledRequestHandler()}}},_processRequest:function(e){var n=this,r=this._requests[e],i=-1;try{4==r.xhr.readyState&&(i=r.xhr.status)}catch(n){t.error("caught an error in _requests["+e+"], reqStatus: "+i)}if(void 0===i&&(i=-1),r.sends>this._conn.maxRetries)this._conn._onDisconnectTimeout();else{var o=r.age(),a=!isNaN(o)&&o>Math.floor(t.TIMEOUT*this.wait),s=null!==r.dead&&r.timeDead()>Math.floor(t.SECONDARY_TIMEOUT*this.wait),c=4==r.xhr.readyState&&(i<1||i>=500);if((a||s||c)&&(s&&t.error("Request "+this._requests[e].id+" timed out (secondary), restarting"),r.abort=!0,r.xhr.abort(),r.xhr.onreadystatechange=function(){},this._requests[e]=new t.Request(r.xmlData,r.origFunc,r.rid,r.sends),r=this._requests[e]),0===r.xhr.readyState){t.debug("request id "+r.id+"."+r.sends+" posting");try{var u=this._conn.options.contentType||"text/xml; charset=utf-8";r.xhr.open("POST",this._conn.service,!this._conn.options.sync),r.xhr.setRequestHeader("Content-Type",u),this._conn.options.withCredentials&&(r.xhr.withCredentials=!0)}catch(e){return t.error("XHR open failed."),this._conn.connected||this._conn._changeConnectStatus(t.Status.CONNFAIL,"bad-service"),void this._conn.disconnect()}var l=function(){if(r.date=new Date,n._conn.options.customHeaders){var t=n._conn.options.customHeaders;for(var e in t)t.hasOwnProperty(e)&&r.xhr.setRequestHeader(e,t[e])}r.xhr.send(r.data)};if(r.sends>1){var d=1e3*Math.min(Math.floor(t.TIMEOUT*this.wait),Math.pow(r.sends,3));setTimeout(function(){l()},d)}else l();r.sends++,this._conn.xmlOutput!==t.Connection.prototype.xmlOutput&&(r.xmlData.nodeName===this.strip&&r.xmlData.childNodes.length?this._conn.xmlOutput(r.xmlData.childNodes[0]):this._conn.xmlOutput(r.xmlData)),this._conn.rawOutput!==t.Connection.prototype.rawOutput&&this._conn.rawOutput(r.data)}else t.debug("_processRequest: "+(0===e?"first":"second")+" request has readyState of "+r.xhr.readyState)}},_removeRequest:function(e){t.debug("removing request");var n;for(n=this._requests.length-1;n>=0;n--)e==this._requests[n]&&this._requests.splice(n,1);e.xhr.onreadystatechange=function(){},this._throttledRequestHandler()},_restartRequest:function(t){var e=this._requests[t];null===e.dead&&(e.dead=new Date),this._processRequest(t)},_reqToData:function(t){try{return t.getResponse()}catch(t){if("parsererror"!=t)throw t;this._conn.disconnect("strophe-parsererror")}},_sendTerminate:function(e){t.info("_sendTerminate was called");var n=this._buildBody().attrs({type:"terminate"});e&&n.cnode(e.tree());var i=new t.Request(n.tree(),r(this._onRequestStateChange,this,r(this._conn._dataRecv,this._conn)),n.tree().getAttribute("rid"));this._requests.push(i),this._throttledRequestHandler()},_send:function(){clearTimeout(this._conn._idleTimeout),this._throttledRequestHandler(),this._conn._idleTimeout=setTimeout(r(this._conn._onIdle,this._conn),100)},_sendRestart:function(){this._throttledRequestHandler(),clearTimeout(this._conn._idleTimeout)},_throttledRequestHandler:function(){this._requests?t.debug("_throttledRequestHandler called with "+this._requests.length+" requests"):t.debug("_throttledRequestHandler called with undefined requests"),this._requests&&0!==this._requests.length&&(this._requests.length>0&&this._processRequest(0),this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))}},t}),function(t,e){if("function"!=typeof define||!define.amd)return e(t.Strophe,t.$build,t.polyfills);define("strophe-websocket",["strophe-core"],function(t){return e(t.Strophe,t.$build)})}(this,function(t,e,n){var r=n.bind;return t.Websocket=function(t){this._conn=t,this.strip="wrapper";var e=t.service;if(0!==e.indexOf("ws:")&&0!==e.indexOf("wss:")){var n="";"ws"===t.options.protocol&&"https:"!==window.location.protocol?n+="ws":n+="wss",n+="://"+window.location.host,0!==e.indexOf("/")?n+=window.location.pathname+e:n+=e,t.service=n}},t.Websocket.prototype={_buildStream:function(){return e("open",{xmlns:t.NS.FRAMING,to:this._conn.domain,version:"1.0"})},_check_streamerror:function(e,n){var r;if(0===(r=e.getElementsByTagNameNS?e.getElementsByTagNameNS(t.NS.STREAM,"error"):e.getElementsByTagName("stream:error")).length)return!1;for(var i=r[0],o="",a="",s=0;s<i.childNodes.length;s++){var c=i.childNodes[s];if("urn:ietf:params:xml:ns:xmpp-streams"!==c.getAttribute("xmlns"))break;"text"===c.nodeName?a=c.textContent:o=c.nodeName}var u="WebSocket stream error: ";return u+=o||"unknown",a&&(u+=" - "+o),t.error(u),this._conn._changeConnectStatus(n,o),this._conn._doDisconnect(),!0},_reset:function(){},_connect:function(){this._closeSocket(),this.socket=new WebSocket(this._conn.service,"xmpp"),this.socket.onopen=r(this._onOpen,this),this.socket.onerror=r(this._onError,this),this.socket.onclose=r(this._onClose,this),this.socket.onmessage=r(this._connect_cb_wrapper,this)},_connect_cb:function(e){if(this._check_streamerror(e,t.Status.CONNFAIL))return t.Status.CONNFAIL},_handleStreamStart:function(e){var n=!1,r=e.getAttribute("xmlns");"string"!=typeof r?n="Missing xmlns in <open />":r!==t.NS.FRAMING&&(n="Wrong xmlns in <open />: "+r);var i=e.getAttribute("version");return"string"!=typeof i?n="Missing version in <open />":"1.0"!==i&&(n="Wrong version in <open />: "+i),!n||(this._conn._changeConnectStatus(t.Status.CONNFAIL,n),this._conn._doDisconnect(),!1)},_connect_cb_wrapper:function(e){if(0===e.data.indexOf("<open ")||0===e.data.indexOf("<?xml")){var n=e.data.replace(/^(<\?.*?\?>\s*)*/,"");if(""===n)return;var i=(new DOMParser).parseFromString(n,"text/xml").documentElement;this._conn.xmlInput(i),this._conn.rawInput(e.data),this._handleStreamStart(i)&&this._connect_cb(i)}else if(0===e.data.indexOf("<close ")){this._conn.rawInput(e.data),this._conn.xmlInput(e);var o=e.getAttribute("see-other-uri");o?(this._conn._changeConnectStatus(t.Status.REDIRECT,"Received see-other-uri, resetting connection"),this._conn.reset(),this._conn.service=o,this._connect()):(this._conn._changeConnectStatus(t.Status.CONNFAIL,"Received closing stream"),this._conn._doDisconnect())}else{var a=this._streamWrap(e.data),s=(new DOMParser).parseFromString(a,"text/xml").documentElement;this.socket.onmessage=r(this._onMessage,this),this._conn._connect_cb(s,null,e.data)}},_disconnect:function(n){if(this.socket&&this.socket.readyState!==WebSocket.CLOSED){n&&this._conn.send(n);var r=e("close",{xmlns:t.NS.FRAMING});this._conn.xmlOutput(r);var i=t.serialize(r);this._conn.rawOutput(i);try{this.socket.send(i)}catch(e){t.info("Couldn't send <close /> tag.")}}this._conn._doDisconnect()},_doDisconnect:function(){t.info("WebSockets _doDisconnect was called"),this._closeSocket()},_streamWrap:function(t){return"<wrapper>"+t+"</wrapper>"},_closeSocket:function(){if(this.socket)try{this.socket.close()}catch(t){}this.socket=null},_emptyQueue:function(){return!0},_onClose:function(){this._conn.connected&&!this._conn.disconnecting?(t.error("Websocket closed unexpectedly"),this._conn._doDisconnect()):t.info("Websocket closed")},_no_auth_received:function(e){t.error("Server did not send any auth methods"),this._conn._changeConnectStatus(t.Status.CONNFAIL,"Server did not send any auth methods"),e&&(e=r(e,this._conn))(),this._conn._doDisconnect()},_onDisconnectTimeout:function(){},_abortAllRequests:function(){},_onError:function(e){t.error("Websocket error "+e),this._conn._changeConnectStatus(t.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._disconnect()},_onIdle:function(){var e=this._conn._data;if(e.length>0&&!this._conn.paused){for(var n=0;n<e.length;n++)if(null!==e[n]){var r,i;r="restart"===e[n]?this._buildStream().tree():e[n],i=t.serialize(r),this._conn.xmlOutput(r),this._conn.rawOutput(i),this.socket.send(i)}this._conn._data=[]}},_onMessage:function(e){var n,r,i='<close xmlns="urn:ietf:params:xml:ns:xmpp-framing" />';if(e.data===i)return this._conn.rawInput(i),this._conn.xmlInput(e),void(this._conn.disconnecting||this._conn._doDisconnect());if(0===e.data.search("<open ")){if(n=(new DOMParser).parseFromString(e.data,"text/xml").documentElement,!this._handleStreamStart(n))return}else r=this._streamWrap(e.data),n=(new DOMParser).parseFromString(r,"text/xml").documentElement;return this._check_streamerror(n,t.Status.ERROR)?void 0:this._conn.disconnecting&&"presence"===n.firstChild.nodeName&&"unavailable"===n.firstChild.getAttribute("type")?(this._conn.xmlInput(n),void this._conn.rawInput(t.serialize(n))):void this._conn._dataRecv(n,e.data)},_onOpen:function(){t.info("Websocket open");var e=this._buildStream();this._conn.xmlOutput(e.tree());var n=t.serialize(e);this._conn.rawOutput(n),this.socket.send(n)},_reqToData:function(t){return t},_send:function(){this._conn.flush()},_sendRestart:function(){clearTimeout(this._conn._idleTimeout),r(this._conn._onIdle,this._conn)()}},t})},{}],9:[function(t,e,n){!function(){"use strict";function t(){for(var e=[],r=0;r<arguments.length;r++){var i=arguments[r];if(i){var o=typeof i;if("string"===o||"number"===o)e.push(i);else if(Array.isArray(i))e.push(t.apply(null,i));else if("object"===o)for(var a in i)n.call(i,a)&&i[a]&&e.push(a)}}return e.join(" ")}var n={}.hasOwnProperty;void 0!==e&&e.exports?e.exports=t:"function"==typeof define&&"object"==typeof define.amd&&define.amd?define("classnames",[],function(){return t}):window.classNames=t}()},{}],10:[function(t,e,n){"use strict";n.consoleFormat=t("./lib/console-format.js");var r=n.isEmoji=t("./lib/is-emoji.js"),i=n.split=t("./parsers/unicode-and-emoji.js").parse;n.withoutEmoji=function(t){var e=i(t);return e?e.filter(function(t){return!r(t)}):e},n.onlyEmoji=function(t){var e=i(t);return e?e.filter(function(t){return r(t)}):e}},{"./lib/console-format.js":11,"./lib/is-emoji.js":12,"./parsers/unicode-and-emoji.js":14}],11:[function(t,e,n){"use strict";var r=t("./is-emoji.js"),i=t("../parsers/unicode-and-emoji.js").parse;e.exports=function(t){var e="";return i(t).forEach(function(t){e+=r(t)?t+" ":t}),e}},{"../parsers/unicode-and-emoji.js":14,"./is-emoji.js":12}],12:[function(t,e,n){"use strict";var r=t("../parsers/emoji.js").Emoji;e.exports=function(t){return r.parse(t).status}},{"../parsers/emoji.js":13}],13:[function(t,e,n){"use strict";var r=t("parsimmon"),i=t("lodash.flattendeep"),o=n.OptionalVariationSelector=r.regex(/[\uFE0E\uFE0F]{0,1}/).desc("an optional variation selector (\\uFE0E or \\uFE0F)"),a=r.seq(r.regex(/[0-9#*]/),o,r.string("")).desc("a keycap emoji"),s=r.regex(/\uD83C[\uDDE6-\uDDFF]/).times(2).desc("a flag emoji"),c=r.string("").desc("zero-width joiner (\\u200D)"),u=r.regex(/(\uD83C[\uDFFB-\uDFFF]){0,1}/).desc("an optional Fitzpatrick modifier"),l=r.alt(r.regex(/[\u203C-\u3299]/),r.regex(/[\u2702-\u27B0]/),s,r.regex(/\uD83C[\uDC04-\uDFFF]/),r.regex(/\uD83D[\uDC00-\uDFFF]/),r.regex(/\uD83E[\uDC00-\uDFFF]/),r.string(""),r.string("")),d=r.seq(l,o,r.seq(c,l,o).times(1,3)),f=n.Emoji=r.seq(r.alt(d,r.seq(l,o),a),u).map(function(t){return i(t).join("")});n.parseOne=function(t){var e=f.parse(t);return!!e.status&&e.value},n.parse=function(t){var e=f.many().parse(t);return!!e.status&&e.value}},{"lodash.flattendeep":26,parsimmon:31}],14:[function(t,e,n){"use strict";var r=t("./emoji.js").Emoji,i=t("parsimmon"),o=t("lodash.flattendeep"),a=i.regex(/[\uD800-\uDBFF][\uDC00-\uDFFF]/),s=n.Unicode=i.alt(r,i.regex(/[\u0000-\uD799]/),a);n.parseOne=function(t){var e=s.parse(t);return!!e.status&&o(e.value).join("")},n.parse=function(t){var e=s.many().parse(t);return!!e.status&&e.value.map(function(t){return o(t).join("")})}},{"./emoji.js":13,"lodash.flattendeep":26,parsimmon:31}],15:[function(e,n,r){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||t}function o(t){return"function"==typeof t}function a(t){return"number"==typeof t}function s(t){return"object"==typeof t&&null!==t}function c(t){return void 0===t}n.exports=i,i.EventEmitter=i,i.prototype._events=t,i.prototype._maxListeners=t,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(t){if(!a(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},i.prototype.emit=function(t){var e,n,r,i,a,u;if(this._events||(this._events={}),"error"===t&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if((e=arguments[1])instanceof Error)throw e;var l=new Error('Uncaught, unspecified "error" event. ('+e+")");throw l.context=e,l}if(n=this._events[t],c(n))return!1;if(o(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:i=Array.prototype.slice.call(arguments,1),n.apply(this,i)}else if(s(n))for(i=Array.prototype.slice.call(arguments,1),r=(u=n.slice()).length,a=0;a<r;a++)u[a].apply(this,i);return!0},i.prototype.addListener=function(t,e){var n;if(!o(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,o(e.listener)?e.listener:e),this._events[t]?s(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,s(this._events[t])&&!this._events[t].warned&&(n=c(this._maxListeners)?i.defaultMaxListeners:this._maxListeners)&&n>0&&this._events[t].length>n&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()),this},i.prototype.on=i.prototype.addListener,i.prototype.once=function(t,e){function n(){this.removeListener(t,n),r||(r=!0,e.apply(this,arguments))}if(!o(e))throw TypeError("listener must be a function");var r=!1;return n.listener=e,this.on(t,n),this},i.prototype.removeListener=function(t,e){var n,r,i,a;if(!o(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(n=this._events[t],i=n.length,r=-1,n===e||o(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(s(n)){for(a=i;a-- >0;)if(n[a]===e||n[a].listener&&n[a].listener===e){r=a;break}if(r<0)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},i.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[t],o(n))this.removeListener(t,n);else if(n)for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},i.prototype.listeners=function(t){return this._events&&this._events[t]?o(this._events[t])?[this._events[t]]:this._events[t].slice():[]},i.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(o(e))return 1;if(e)return e.length}return 0},i.listenerCount=function(t,e){return t.listenerCount(e)}},{}],16:[function(e,n,r){(function(e){"use strict";!function(e){function i(e){var n=arguments.length>1&&arguments[1]!==t?arguments[1]:{},r=[],i=0,c=void 0,u=void 0,l=void 0,d=void 0,f=void 0,h=void 0,p=void 0,m=void 0,g=void 0,v=void 0,_=void 0,b=void 0,y=void 0,w=void 0,C=void 0;if(isNaN(e))throw new Error("Invalid arguments");return l=!0===n.bits,_=!0===n.unix,u=n.base||2,v=void 0!==n.round?n.round:_?1:2,b=void 0!==n.separator?n.separator||"":"",y=void 0!==n.spacer?n.spacer:_?"":" ",C=n.symbols||n.suffixes||{},w=2===u?n.standard||"jedec":"jedec",g=n.output||"string",f=!0===n.fullform,h=n.fullforms instanceof Array?n.fullforms:[],c=void 0!==n.exponent?n.exponent:-1,m=Number(e),p=m<0,d=u>2?1e3:1024,p&&(m=-m),(-1===c||isNaN(c))&&(c=Math.floor(Math.log(m)/Math.log(d)))<0&&(c=0),c>8&&(c=8),0===m?(r[0]=0,r[1]=_?"":a[w][l?"bits":"bytes"][c]):(i=m/(2===u?Math.pow(2,10*c):Math.pow(1e3,c)),l&&(i*=8)>=d&&c<8&&(i/=d,c++),r[0]=Number(i.toFixed(c>0?v:0)),r[1]=10===u&&1===c?l?"kb":"kB":a[w][l?"bits":"bytes"][c],_&&(r[1]="jedec"===w?r[1].charAt(0):c>0?r[1].replace(/B$/,""):r[1],o.test(r[1])&&(r[0]=Math.floor(r[0]),r[1]=""))),p&&(r[0]=-r[0]),r[1]=C[r[1]]||r[1],"array"===g?r:"exponent"===g?c:"object"===g?{value:r[0],suffix:r[1],symbol:r[1]}:(f&&(r[1]=h[c]?h[c]:s[w][c]+(l?"bit":"byte")+(1===r[0]?"":"s")),b.length>0&&(r[0]=r[0].toString().replace(".",b)),r.join(y))}var o=/^(b|B)$/,a={iec:{bits:["b","Kib","Mib","Gib","Tib","Pib","Eib","Zib","Yib"],bytes:["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"]},jedec:{bits:["b","Kb","Mb","Gb","Tb","Pb","Eb","Zb","Yb"],bytes:["B","KB","MB","GB","TB","PB","EB","ZB","YB"]}},s={iec:["","kibi","mebi","gibi","tebi","pebi","exbi","zebi","yobi"],jedec:["","kilo","mega","giga","tera","peta","exa","zetta","yotta"]};i.partial=function(t){return function(e){return i(e,t)}},void 0!==r?n.exports=i:"function"==typeof define&&define.amd?define(function(){return i}):e.filesize=i}("undefined"!=typeof window?window:e)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],17:[function(t,e,n){e.exports=function(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}},{}],18:[function(t,e,n){e.exports=function(t,e){for(var n=-1,r=t.length;++n<r&&!1!==e(t[n],n,t););return t}},{}],19:[function(t,e,n){var r=t("lodash._basecopy"),i=t("lodash.keys");e.exports=function(t,e){return null==e?t:r(e,i(e),t)}},{"lodash._basecopy":21,"lodash.keys":29}],20:[function(e,n,r){(function(r){function i(e,n,r,a,p,g,_){var b;if(r&&(b=p?r(e,a,p):r(e)),b!==t)return b;if(!l(e))return e;var w=m(e);if(w){if(b=s(e),!n)return d(e,b)}else{var x=L.call(e),O=x==y;if(x!=C&&x!=v&&(!O||p))return D[x]?u(e,x,n):p?e:{};if(b=c(O?{}:e),!n)return h(b,e)}g||(g=[]),_||(_=[]);for(var S=g.length;S--;)if(g[S]==e)return _[S];return g.push(e),_.push(b),(w?f:o)(e,function(t,o){b[o]=i(t,n,r,o,e,g,_)}),b}function o(t,e){return p(t,e,g)}function a(t){var e=new U(t.byteLength);return new H(e).set(new H(t)),e}function s(t){var e=t.length,n=new t.constructor(e);return e&&"string"==typeof t[0]&&B.call(t,"index")&&(n.index=t.index,n.input=t.input),n}function c(t){var e=t.constructor;return"function"==typeof e&&e instanceof e||(e=Object),new e}function u(t,e,n){var r=t.constructor;switch(e){case S:return a(t);case _:case b:return new r(+t);case T:case E:case A:case I:case k:case R:case j:case N:case M:var i=t.buffer;return new r(n?a(i):i,t.byteOffset,t.length);case w:case O:return new r(t);case x:var o=new r(t.source,z.exec(t));o.lastIndex=t.lastIndex}return o}function l(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}var d=e("lodash._arraycopy"),f=e("lodash._arrayeach"),h=e("lodash._baseassign"),p=e("lodash._basefor"),m=e("lodash.isarray"),g=e("lodash.keys"),v="[object Arguments]",_="[object Boolean]",b="[object Date]",y="[object Function]",w="[object Number]",C="[object Object]",x="[object RegExp]",O="[object String]",S="[object ArrayBuffer]",T="[object Float32Array]",E="[object Float64Array]",A="[object Int8Array]",I="[object Int16Array]",k="[object Int32Array]",R="[object Uint8Array]",j="[object Uint8ClampedArray]",N="[object Uint16Array]",M="[object Uint32Array]",z=/\w*$/,D={};D[v]=D["[object Array]"]=D[S]=D[_]=D[b]=D[T]=D[E]=D[A]=D[I]=D[k]=D[w]=D[C]=D[x]=D[O]=D[R]=D[j]=D[N]=D[M]=!0,D["[object Error]"]=D[y]=D["[object Map]"]=D["[object Set]"]=D["[object WeakMap]"]=!1;var P=Object.prototype,B=P.hasOwnProperty,L=P.toString,U=r.ArrayBuffer,H=r.Uint8Array;n.exports=i}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"lodash._arraycopy":17,"lodash._arrayeach":18,"lodash._baseassign":19,"lodash._basefor":22,"lodash.isarray":28,"lodash.keys":29}],21:[function(t,e,n){e.exports=function(t,e,n){n||(n={});for(var r=-1,i=e.length;++r<i;){var o=e[r];n[o]=t[o]}return n}},{}],22:[function(t,e,n){var r=function(t){return function(e,n,r){for(var i=-1,o=Object(e),a=r(e),s=a.length;s--;){var c=a[t?s:++i];if(!1===n(o[c],c,o))break}return e}}();e.exports=r},{}],23:[function(e,n,r){function i(t){return t}n.exports=function(e,n,r){if("function"!=typeof e)return i;if(n===t)return e;switch(r){case 1:return function(t){return e.call(n,t)};case 3:return function(t,r,i){return e.call(n,t,r,i)};case 4:return function(t,r,i,o){return e.call(n,t,r,i,o)};case 5:return function(t,r,i,o,a){return e.call(n,t,r,i,o,a)}}return function(){return e.apply(n,arguments)}}},{}],24:[function(e,n,r){function i(t){return!!t&&"object"==typeof t}function o(t){return a(t)&&h.call(t)==c}function a(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function s(t){return null!=t&&(o(t)?p.test(d.call(t)):i(t)&&u.test(t))}var c="[object Function]",u=/^\[object .+?Constructor\]$/,l=Object.prototype,d=Function.prototype.toString,f=l.hasOwnProperty,h=l.toString,p=RegExp("^"+d.call(f).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");n.exports=function(e,n){var r=null==e?t:e[n];return s(r)?r:t}},{}],25:[function(t,e,n){var r=t("lodash._baseclone"),i=t("lodash._bindcallback");e.exports=function(t,e,n){return"function"==typeof e?r(t,!0,i(e,n,3)):r(t,!0)}},{"lodash._baseclone":20,"lodash._bindcallback":23}],26:[function(e,n,r){(function(e){function r(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}function i(t,e,n,a,s){var c=-1,u=t.length;for(n||(n=o),s||(s=[]);++c<u;){var l=t[c];e>0&&n(l)?e>1?i(l,e-1,n,a,s):r(s,l):a||(s[s.length]=l)}return s}function o(t){return E(t)||a(t)||!!(T&&t&&t[T])}function a(t){return c(t)&&C.call(t,"callee")&&(!S.call(t,"callee")||x.call(t)==m)}function s(t){return null!=t&&l(t.length)&&!u(t)}function c(t){return f(t)&&s(t)}function u(t){var e=d(t)?x.call(t):"";return e==g||e==v}function l(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=p}function d(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function f(t){return!!t&&"object"==typeof t}var h=1/0,p=9007199254740991,m="[object Arguments]",g="[object Function]",v="[object GeneratorFunction]",_="object"==typeof e&&e&&e.Object===Object&&e,b="object"==typeof self&&self&&self.Object===Object&&self,y=_||b||Function("return this")(),w=Object.prototype,C=w.hasOwnProperty,x=w.toString,O=y.Symbol,S=w.propertyIsEnumerable,T=O?O.isConcatSpreadable:t,E=Array.isArray;n.exports=function(t){return(t?t.length:0)?i(t,h):[]}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],27:[function(t,e,n){function r(t){return null!=t&&a(t.length)&&!o(t)}function i(t){return c(t)&&r(t)}function o(t){var e=s(t)?m.call(t):"";return e==d||e==f}function a(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=u}function s(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function c(t){return!!t&&"object"==typeof t}var u=9007199254740991,l="[object Arguments]",d="[object Function]",f="[object GeneratorFunction]",h=Object.prototype,p=h.hasOwnProperty,m=h.toString,g=h.propertyIsEnumerable;e.exports=function(t){return i(t)&&p.call(t,"callee")&&(!g.call(t,"callee")||m.call(t)==l)}},{}],28:[function(e,n,r){function i(t){return!!t&&"object"==typeof t}function o(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=g}function a(t){return s(t)&&p.call(t)==u}function s(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function c(t){return null!=t&&(a(t)?m.test(f.call(t)):i(t)&&l.test(t))}var u="[object Function]",l=/^\[object .+?Constructor\]$/,d=Object.prototype,f=Function.prototype.toString,h=d.hasOwnProperty,p=d.toString,m=RegExp("^"+f.call(h).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),g=9007199254740991,v=function(e,n){var r=null==e?t:e[n];return c(r)?r:t}(Array,"isArray")||function(t){return i(t)&&o(t.length)&&"[object Array]"==p.call(t)};n.exports=v},{}],29:[function(e,n,r){function i(t){return null!=t&&a(v(t))}function o(t,e){return t="number"==typeof t||h.test(t)?+t:-1,e=null==e?g:e,t>-1&&t%1==0&&t<e}function a(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=g}function s(t){for(var e=u(t),n=e.length,r=n&&t.length,i=!!r&&a(r)&&(f(t)||d(t)),s=-1,c=[];++s<n;){var l=e[s];(i&&o(l,r)||p.call(t,l))&&c.push(l)}return c}function c(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function u(t){if(null==t)return[];c(t)||(t=Object(t));var e=t.length;e=e&&a(e)&&(f(t)||d(t))&&e||0;for(var n=t.constructor,r=-1,i="function"==typeof n&&n.prototype===t,s=Array(e),u=e>0;++r<e;)s[r]=r+"";for(var l in t)u&&o(l,e)||"constructor"==l&&(i||!p.call(t,l))||s.push(l);return s}var l=e("lodash._getnative"),d=e("lodash.isarguments"),f=e("lodash.isarray"),h=/^\d+$/,p=Object.prototype.hasOwnProperty,m=l(Object,"keys"),g=9007199254740991,v=function(e){return function(n){return null==n?t:n[e]}}("length"),_=m?function(e){var n=null==e?t:e.constructor;return"function"==typeof n&&n.prototype===e||"function"!=typeof e&&i(e)?s(e):c(e)?m(e):[]}:s;n.exports=_},{"lodash._getnative":24,"lodash.isarguments":27,"lodash.isarray":28}],30:[function(t,e,n){(function(t){(function(){function r(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function i(t,e,n,r){for(var i=-1,o=null==t?0:t.length;++i<o;){var a=t[i];e(r,a,n(a),t)}return r}function o(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););return t}function a(t,e){for(var n=null==t?0:t.length;n--&&!1!==e(t[n],n,t););return t}function s(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(!e(t[n],n,t))return!1;return!0}function c(t,e){for(var n=-1,r=null==t?0:t.length,i=0,o=[];++n<r;){var a=t[n];e(a,n,t)&&(o[i++]=a)}return o}function u(t,e){return!!(null==t?0:t.length)&&y(t,e,0)>-1}function l(t,e,n){for(var r=-1,i=null==t?0:t.length;++r<i;)if(n(e,t[r]))return!0;return!1}function d(t,e){for(var n=-1,r=null==t?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}function f(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}function h(t,e,n,r){var i=-1,o=null==t?0:t.length;for(r&&o&&(n=t[++i]);++i<o;)n=e(n,t[i],i,t);return n}function p(t,e,n,r){var i=null==t?0:t.length;for(r&&i&&(n=t[--i]);i--;)n=e(n,t[i],i,t);return n}function m(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}function g(t){return t.split("")}function v(t){return t.match(De)||[]}function _(t,e,n){var r;return n(t,function(t,n,i){if(e(t,n,i))return r=n,!1}),r}function b(t,e,n,r){for(var i=t.length,o=n+(r?1:-1);r?o--:++o<i;)if(e(t[o],o,t))return o;return-1}function y(t,e,n){return e===e?J(t,e,n):b(t,C,n)}function w(t,e,n,r){for(var i=n-1,o=t.length;++i<o;)if(r(t[i],e))return i;return-1}function C(t){return t!==t}function x(t,e){var n=null==t?0:t.length;return n?A(t,e)/n:jt}function O(t){return function(e){return null==e?et:e[t]}}function S(t){return function(e){return null==t?et:t[e]}}function T(t,e,n,r,i){return i(t,function(t,i,o){n=r?(r=!1,t):e(n,t,i,o)}),n}function E(t,e){var n=t.length;for(t.sort(e);n--;)t[n]=t[n].value;return t}function A(t,e){for(var n,r=-1,i=t.length;++r<i;){var o=e(t[r]);o!==et&&(n=n===et?o:n+o)}return n}function I(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}function k(t,e){return d(e,function(e){return[e,t[e]]})}function R(t){return function(e){return t(e)}}function j(t,e){return d(e,function(e){return t[e]})}function N(t,e){return t.has(e)}function M(t,e){for(var n=-1,r=t.length;++n<r&&y(e,t[n],0)>-1;);return n}function z(t,e){for(var n=t.length;n--&&y(e,t[n],0)>-1;);return n}function D(t,e){for(var n=t.length,r=0;n--;)t[n]===e&&++r;return r}function P(t){return"\\"+xn[t]}function B(t,e){return null==t?et:t[e]}function L(t){return pn.test(t)}function U(t){return mn.test(t)}function H(t){for(var e,n=[];!(e=t.next()).done;)n.push(e.value);return n}function F(t){var e=-1,n=Array(t.size);return t.forEach(function(t,r){n[++e]=[r,t]}),n}function q(t,e){return function(n){return t(e(n))}}function V(t,e){for(var n=-1,r=t.length,i=0,o=[];++n<r;){var a=t[n];a!==e&&a!==st||(t[n]=st,o[i++]=n)}return o}function $(t,e){return"__proto__"==e?et:t[e]}function G(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=t}),n}function W(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=[t,t]}),n}function J(t,e,n){for(var r=n-1,i=t.length;++r<i;)if(t[r]===e)return r;return-1}function X(t,e,n){for(var r=n+1;r--;)if(t[r]===e)return r;return r}function Q(t){return L(t)?Z(t):Un(t)}function Y(t){return L(t)?K(t):g(t)}function Z(t){for(var e=fn.lastIndex=0;fn.test(t);)++e;return e}function K(t){return t.match(fn)||[]}function tt(t){return t.match(hn)||[]}var et,nt=200,rt="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",it="Expected a function",ot="__lodash_hash_undefined__",at=500,st="__lodash_placeholder__",ct=1,ut=2,lt=4,dt=1,ft=2,ht=1,pt=2,mt=4,gt=8,vt=16,_t=32,bt=64,yt=128,wt=256,Ct=512,xt=30,Ot="...",St=800,Tt=16,Et=1,At=2,It=1/0,kt=9007199254740991,Rt=1.7976931348623157e308,jt=NaN,Nt=4294967295,Mt=Nt-1,zt=Nt>>>1,Dt=[["ary",yt],["bind",ht],["bindKey",pt],["curry",gt],["curryRight",vt],["flip",Ct],["partial",_t],["partialRight",bt],["rearg",wt]],Pt="[object Arguments]",Bt="[object Array]",Lt="[object AsyncFunction]",Ut="[object Boolean]",Ht="[object Date]",Ft="[object DOMException]",qt="[object Error]",Vt="[object Function]",$t="[object GeneratorFunction]",Gt="[object Map]",Wt="[object Number]",Jt="[object Null]",Xt="[object Object]",Qt="[object Proxy]",Yt="[object RegExp]",Zt="[object Set]",Kt="[object String]",te="[object Symbol]",ee="[object Undefined]",ne="[object WeakMap]",re="[object WeakSet]",ie="[object ArrayBuffer]",oe="[object DataView]",ae="[object Float32Array]",se="[object Float64Array]",ce="[object Int8Array]",ue="[object Int16Array]",le="[object Int32Array]",de="[object Uint8Array]",fe="[object Uint8ClampedArray]",he="[object Uint16Array]",pe="[object Uint32Array]",me=/\b__p \+= '';/g,ge=/\b(__p \+=) '' \+/g,ve=/(__e\(.*?\)|\b__t\)) \+\n'';/g,_e=/&(?:amp|lt|gt|quot|#39);/g,be=/[&<>"']/g,ye=RegExp(_e.source),we=RegExp(be.source),Ce=/<%-([\s\S]+?)%>/g,xe=/<%([\s\S]+?)%>/g,Oe=/<%=([\s\S]+?)%>/g,Se=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Te=/^\w*$/,Ee=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Ae=/[\\^$.*+?()[\]{}|]/g,Ie=RegExp(Ae.source),ke=/^\s+|\s+$/g,Re=/^\s+/,je=/\s+$/,Ne=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Me=/\{\n\/\* \[wrapped with (.+)\] \*/,ze=/,? & /,De=/[^ -/:-@[-`{-]+/g,Pe=/\\(\\)?/g,Be=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Le=/\w*$/,Ue=/^[-+]0x[0-9a-f]+$/i,He=/^0b[01]+$/i,Fe=/^\[object .+?Constructor\]$/,qe=/^0o[0-7]+$/i,Ve=/^(?:0|[1-9]\d*)$/,$e=/[---\u0100-\u017f]/g,Ge=/($^)/,We=/['\n\r\u2028\u2029\\]/g,Je="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",Xe="\\\\\ -\/\:-\@\[-\`\{-\\\u2000-\\u206f \\t\\\f\\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Qe="["+Xe+"]",Ye="["+Je+"]",Ze="[a-z\-\\-\]",Ke="[^\\ud800-\\udfff"+Xe+"\\d+\\u2700-\\u27bfa-z\-\\-\A-Z\-\\-\]",tn="\\ud83c[\\udffb-\\udfff]",en="(?:\\ud83c[\\udde6-\\uddff]){2}",nn="[\\ud800-\\udbff][\\udc00-\\udfff]",rn="[A-Z\-\\-\]",on="(?:"+Ze+"|"+Ke+")",an="(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?",sn="[\\ufe0e\\ufe0f]?"+an+("(?:\\u200d(?:"+["[^\\ud800-\\udfff]",en,nn].join("|")+")[\\ufe0e\\ufe0f]?"+an+")*"),cn="(?:"+["[\\u2700-\\u27bf]",en,nn].join("|")+")"+sn,un="(?:"+["[^\\ud800-\\udfff]"+Ye+"?",Ye,en,nn,"[\\ud800-\\udfff]"].join("|")+")",ln=RegExp("[']","g"),dn=RegExp(Ye,"g"),fn=RegExp(tn+"(?="+tn+")|"+un+sn,"g"),hn=RegExp([rn+"?"+Ze+"+(?:['](?:d|ll|m|re|s|t|ve))?(?="+[Qe,rn,"$"].join("|")+")","(?:[A-Z\-\\-\]|[^\\ud800-\\udfff\\\\\ -\/\:-\@\[-\`\{-\\\u2000-\\u206f \\t\\\f\\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\d+\\u2700-\\u27bfa-z\-\\-\A-Z\-\\-\])+(?:['](?:D|LL|M|RE|S|T|VE))?(?="+[Qe,rn+on,"$"].join("|")+")",rn+"?"+on+"+(?:['](?:d|ll|m|re|s|t|ve))?",rn+"+(?:['](?:D|LL|M|RE|S|T|VE))?","\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])","\\d+",cn].join("|"),"g"),pn=RegExp("[\\u200d\\ud800-\\udfff"+Je+"\\ufe0e\\ufe0f]"),mn=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,gn=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],vn=-1,_n={};_n[ae]=_n[se]=_n[ce]=_n[ue]=_n[le]=_n[de]=_n[fe]=_n[he]=_n[pe]=!0,_n[Pt]=_n[Bt]=_n[ie]=_n[Ut]=_n[oe]=_n[Ht]=_n[qt]=_n[Vt]=_n[Gt]=_n[Wt]=_n[Xt]=_n[Yt]=_n[Zt]=_n[Kt]=_n[ne]=!1;var bn={};bn[Pt]=bn[Bt]=bn[ie]=bn[oe]=bn[Ut]=bn[Ht]=bn[ae]=bn[se]=bn[ce]=bn[ue]=bn[le]=bn[Gt]=bn[Wt]=bn[Xt]=bn[Yt]=bn[Zt]=bn[Kt]=bn[te]=bn[de]=bn[fe]=bn[he]=bn[pe]=!0,bn[qt]=bn[Vt]=bn[ne]=!1;var yn={"":"A","":"A","":"A","":"A","":"A","":"A","":"a","":"a","":"a","":"a","":"a","":"a","":"C","":"c","":"D","":"d","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"N","":"n","":"O","":"O","":"O","":"O","":"O","":"O","":"o","":"o","":"o","":"o","":"o","":"o","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"Y","":"y","":"y","":"Ae","":"ae","":"Th","":"th","":"ss","":"A","":"A","":"A","":"a","":"a","":"a","":"C","":"C","":"C","":"C","":"c","":"c","":"c","":"c","":"D","":"D","":"d","":"d","":"E","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"e","":"G","":"G","":"G","":"G","":"g","":"g","":"g","":"g","":"H","":"H","":"h","":"h","":"I","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"i","":"J","":"j","":"K","":"k","":"k","":"L","":"L","":"L","":"L","":"L","":"l","":"l","":"l","":"l","":"l","":"N","":"N","":"N","":"N","":"n","":"n","":"n","":"n","":"O","":"O","":"O","":"o","":"o","":"o","":"R","":"R","":"R","":"r","":"r","":"r","":"S","":"S","":"S","":"S","":"s","":"s","":"s","":"s","":"T","":"T","":"T","":"t","":"t","":"t","":"U","":"U","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"u","":"u","":"W","":"w","":"Y","":"y","":"Y","":"Z","":"Z","":"Z","":"z","":"z","":"z","":"IJ","":"ij","":"Oe","":"oe","":"'n","":"s"},wn={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Cn={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},xn={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},On=parseFloat,Sn=parseInt,Tn="object"==typeof t&&t&&t.Object===Object&&t,En="object"==typeof self&&self&&self.Object===Object&&self,An=Tn||En||Function("return this")(),In="object"==typeof n&&n&&!n.nodeType&&n,kn=In&&"object"==typeof e&&e&&!e.nodeType&&e,Rn=kn&&kn.exports===In,jn=Rn&&Tn.process,Nn=function(){try{return jn&&jn.binding&&jn.binding("util")}catch(t){}}(),Mn=Nn&&Nn.isArrayBuffer,zn=Nn&&Nn.isDate,Dn=Nn&&Nn.isMap,Pn=Nn&&Nn.isRegExp,Bn=Nn&&Nn.isSet,Ln=Nn&&Nn.isTypedArray,Un=O("length"),Hn=S(yn),Fn=S(wn),qn=S(Cn),Vn=function t(e){function n(t){if(Yo(t)&&!Uc(t)&&!(t instanceof J)){if(t instanceof S)return t;if(Ua.call(t,"__wrapped__"))return wo(t)}return new S(t)}function g(){}function S(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=et}function J(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Nt,this.__views__=[]}function Z(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function K(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function De(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Je(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new De;++e<n;)this.add(t[e])}function Xe(t){var e=this.__data__=new K(t);this.size=e.size}function Qe(t,e){var n=Uc(t),r=!n&&Lc(t),i=!n&&!r&&Fc(t),o=!n&&!r&&!i&&Wc(t),a=n||r||i||o,s=a?I(t.length,Na):[],c=s.length;for(var u in t)!e&&!Ua.call(t,u)||a&&("length"==u||i&&("offset"==u||"parent"==u)||o&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||Ki(u,c))||s.push(u);return s}function Ye(t){var e=t.length;return e?t[yr(0,e-1)]:et}function Ze(t,e){return vo(ni(t),un(e,0,t.length))}function Ke(t){return vo(ni(t))}function tn(t,e,n){(n===et||qo(t[e],n))&&(n!==et||e in t)||sn(t,e,n)}function en(t,e,n){var r=t[e];Ua.call(t,e)&&qo(r,n)&&(n!==et||e in t)||sn(t,e,n)}function nn(t,e){for(var n=t.length;n--;)if(qo(t[n][0],e))return n;return-1}function rn(t,e,n,r){return Bs(t,function(t,i,o){e(r,t,n(t),o)}),r}function on(t,e){return t&&ri(e,da(e),t)}function an(t,e){return t&&ri(e,fa(e),t)}function sn(t,e,n){"__proto__"==e&&is?is(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function cn(t,e){for(var n=-1,r=e.length,i=Ta(r),o=null==t;++n<r;)i[n]=o?et:ua(t,e[n]);return i}function un(t,e,n){return t===t&&(n!==et&&(t=t<=n?t:n),e!==et&&(t=t>=e?t:e)),t}function fn(t,e,n,r,i,a){var s,c=e&ct,u=e&ut,l=e&lt;if(n&&(s=i?n(t,r,i,a):n(t)),s!==et)return s;if(!Qo(t))return t;var d=Uc(t);if(d){if(s=Ji(t),!c)return ni(t,s)}else{var f=Qs(t),h=f==Vt||f==$t;if(Fc(t))return Gr(t,c);if(f==Xt||f==Pt||h&&!i){if(s=u||h?{}:Xi(t),!c)return u?oi(t,an(s,t)):ii(t,on(s,t))}else{if(!bn[f])return i?t:{};s=Qi(t,f,c)}}a||(a=new Xe);var p=a.get(t);if(p)return p;if(a.set(t,s),Gc(t))return t.forEach(function(r){s.add(fn(r,e,n,r,t,a))}),s;if(Vc(t))return t.forEach(function(r,i){s.set(i,fn(r,e,n,i,t,a))}),s;var m=l?u?Pi:Di:u?fa:da,g=d?et:m(t);return o(g||t,function(r,i){g&&(r=t[i=r]),en(s,i,fn(r,e,n,i,t,a))}),s}function hn(t){var e=da(t);return function(n){return pn(n,t,e)}}function pn(t,e,n){var r=n.length;if(null==t)return!r;for(t=Ra(t);r--;){var i=n[r],o=e[i],a=t[i];if(a===et&&!(i in t)||!o(a))return!1}return!0}function mn(t,e,n){if("function"!=typeof t)throw new Ma(it);return Ks(function(){t.apply(et,n)},e)}function yn(t,e,n,r){var i=-1,o=u,a=!0,s=t.length,c=[],f=e.length;if(!s)return c;n&&(e=d(e,R(n))),r?(o=l,a=!1):e.length>=nt&&(o=N,a=!1,e=new Je(e));t:for(;++i<s;){var h=t[i],p=null==n?h:n(h);if(h=r||0!==h?h:0,a&&p===p){for(var m=f;m--;)if(e[m]===p)continue t;c.push(h)}else o(e,p,r)||c.push(h)}return c}function wn(t,e){var n=!0;return Bs(t,function(t,r,i){return n=!!e(t,r,i)}),n}function Cn(t,e,n){for(var r=-1,i=t.length;++r<i;){var o=t[r],a=e(o);if(null!=a&&(s===et?a===a&&!ea(a):n(a,s)))var s=a,c=o}return c}function xn(t,e,n,r){var i=t.length;for((n=ia(n))<0&&(n=-n>i?0:i+n),(r=r===et||r>i?i:ia(r))<0&&(r+=i),r=n>r?0:oa(r);n<r;)t[n++]=e;return t}function Tn(t,e){var n=[];return Bs(t,function(t,r,i){e(t,r,i)&&n.push(t)}),n}function En(t,e,n,r,i){var o=-1,a=t.length;for(n||(n=Zi),i||(i=[]);++o<a;){var s=t[o];e>0&&n(s)?e>1?En(s,e-1,n,r,i):f(i,s):r||(i[i.length]=s)}return i}function In(t,e){return t&&Us(t,e,da)}function kn(t,e){return t&&Hs(t,e,da)}function jn(t,e){return c(e,function(e){return Wo(t[e])})}function Nn(t,e){for(var n=0,r=(e=Vr(e,t)).length;null!=t&&n<r;)t=t[_o(e[n++])];return n&&n==r?t:et}function Un(t,e,n){var r=e(t);return Uc(t)?r:f(r,n(t))}function $n(t){return null==t?t===et?ee:Jt:rs&&rs in Ra(t)?Vi(t):lo(t)}function Gn(t,e){return t>e}function Wn(t,e){return null!=t&&Ua.call(t,e)}function Jn(t,e){return null!=t&&e in Ra(t)}function Xn(t,e,n){return t>=gs(e,n)&&t<ms(e,n)}function Qn(t,e,n){for(var r=n?l:u,i=t[0].length,o=t.length,a=o,s=Ta(o),c=1/0,f=[];a--;){var h=t[a];a&&e&&(h=d(h,R(e))),c=gs(h.length,c),s[a]=!n&&(e||i>=120&&h.length>=120)?new Je(a&&h):et}h=t[0];var p=-1,m=s[0];t:for(;++p<i&&f.length<c;){var g=h[p],v=e?e(g):g;if(g=n||0!==g?g:0,!(m?N(m,v):r(f,v,n))){for(a=o;--a;){var _=s[a];if(!(_?N(_,v):r(t[a],v,n)))continue t}m&&m.push(v),f.push(g)}}return f}function Yn(t,e,n,r){return In(t,function(t,i,o){e(r,n(t),i,o)}),r}function Zn(t,e,n){var i=null==(t=ho(t,e=Vr(e,t)))?t:t[_o(To(e))];return null==i?et:r(i,t,n)}function Kn(t){return Yo(t)&&$n(t)==Pt}function tr(t,e,n,r,i){return t===e||(null==t||null==e||!Yo(t)&&!Yo(e)?t!==t&&e!==e:er(t,e,n,r,tr,i))}function er(t,e,n,r,i,o){var a=Uc(t),s=Uc(e),c=a?Bt:Qs(t),u=s?Bt:Qs(e),l=(c=c==Pt?Xt:c)==Xt,d=(u=u==Pt?Xt:u)==Xt,f=c==u;if(f&&Fc(t)){if(!Fc(e))return!1;a=!0,l=!1}if(f&&!l)return o||(o=new Xe),a||Wc(t)?ji(t,e,n,r,i,o):Ni(t,e,c,n,r,i,o);if(!(n&dt)){var h=l&&Ua.call(t,"__wrapped__"),p=d&&Ua.call(e,"__wrapped__");if(h||p){var m=h?t.value():t,g=p?e.value():e;return o||(o=new Xe),i(m,g,n,r,o)}}return!!f&&(o||(o=new Xe),Mi(t,e,n,r,i,o))}function nr(t,e,n,r){var i=n.length,o=i,a=!r;if(null==t)return!o;for(t=Ra(t);i--;){var s=n[i];if(a&&s[2]?s[1]!==t[s[0]]:!(s[0]in t))return!1}for(;++i<o;){var c=(s=n[i])[0],u=t[c],l=s[1];if(a&&s[2]){if(u===et&&!(c in t))return!1}else{var d=new Xe;if(r)var f=r(u,l,c,t,e,d);if(!(f===et?tr(l,u,dt|ft,r,d):f))return!1}}return!0}function rr(t){return!(!Qo(t)||io(t))&&(Wo(t)?Ga:Fe).test(bo(t))}function ir(t){return"function"==typeof t?t:null==t?ba:"object"==typeof t?Uc(t)?lr(t[0],t[1]):ur(t):xa(t)}function or(t){if(!oo(t))return ps(t);var e=[];for(var n in Ra(t))Ua.call(t,n)&&"constructor"!=n&&e.push(n);return e}function ar(t){if(!Qo(t))return uo(t);var e=oo(t),n=[];for(var r in t)("constructor"!=r||!e&&Ua.call(t,r))&&n.push(r);return n}function sr(t,e){return t<e}function cr(t,e){var n=-1,r=Vo(t)?Ta(t.length):[];return Bs(t,function(t,i,o){r[++n]=e(t,i,o)}),r}function ur(t){var e=Fi(t);return 1==e.length&&e[0][2]?so(e[0][0],e[0][1]):function(n){return n===t||nr(n,t,e)}}function lr(t,e){return eo(t)&&ao(e)?so(_o(t),e):function(n){var r=ua(n,t);return r===et&&r===e?la(n,t):tr(e,r,dt|ft)}}function dr(t,e,n,r,i){t!==e&&Us(e,function(o,a){if(Qo(o))i||(i=new Xe),fr(t,e,a,n,dr,r,i);else{var s=r?r($(t,a),o,a+"",t,e,i):et;s===et&&(s=o),tn(t,a,s)}},fa)}function fr(t,e,n,r,i,o,a){var s=$(t,n),c=$(e,n),u=a.get(c);if(u)tn(t,n,u);else{var l=o?o(s,c,n+"",t,e,a):et,d=l===et;if(d){var f=Uc(c),h=!f&&Fc(c),p=!f&&!h&&Wc(c);l=c,f||h||p?Uc(s)?l=s:$o(s)?l=ni(s):h?(d=!1,l=Gr(c,!0)):p?(d=!1,l=Yr(c,!0)):l=[]:Ko(c)||Lc(c)?(l=s,Lc(s)?l=sa(s):(!Qo(s)||r&&Wo(s))&&(l=Xi(c))):d=!1}d&&(a.set(c,l),i(l,c,r,o,a),a.delete(c)),tn(t,n,l)}}function hr(t,e){var n=t.length;if(n)return e+=e<0?n:0,Ki(e,n)?t[e]:et}function pr(t,e,n){var r=-1;return e=d(e.length?e:[ba],R(Ui())),E(cr(t,function(t,n,i){return{criteria:d(e,function(e){return e(t)}),index:++r,value:t}}),function(t,e){return Kr(t,e,n)})}function mr(t,e){return gr(t,e,function(e,n){return la(t,n)})}function gr(t,e,n){for(var r=-1,i=e.length,o={};++r<i;){var a=e[r],s=Nn(t,a);n(s,a)&&Tr(o,Vr(a,t),s)}return o}function vr(t){return function(e){return Nn(e,t)}}function _r(t,e,n,r){var i=r?w:y,o=-1,a=e.length,s=t;for(t===e&&(e=ni(e)),n&&(s=d(t,R(n)));++o<a;)for(var c=0,u=e[o],l=n?n(u):u;(c=i(s,l,c,r))>-1;)s!==t&&ts.call(s,c,1),ts.call(t,c,1);return t}function br(t,e){for(var n=t?e.length:0,r=n-1;n--;){var i=e[n];if(n==r||i!==o){var o=i;Ki(i)?ts.call(t,i,1):Dr(t,i)}}return t}function yr(t,e){return t+us(bs()*(e-t+1))}function wr(t,e,n,r){for(var i=-1,o=ms(cs((e-t)/(n||1)),0),a=Ta(o);o--;)a[r?o:++i]=t,t+=n;return a}function Cr(t,e){var n="";if(!t||e<1||e>kt)return n;do{e%2&&(n+=t),(e=us(e/2))&&(t+=t)}while(e);return n}function xr(t,e){return tc(fo(t,e,ba),t+"")}function Or(t){return Ye(pa(t))}function Sr(t,e){var n=pa(t);return vo(n,un(e,0,n.length))}function Tr(t,e,n,r){if(!Qo(t))return t;for(var i=-1,o=(e=Vr(e,t)).length,a=o-1,s=t;null!=s&&++i<o;){var c=_o(e[i]),u=n;if(i!=a){var l=s[c];(u=r?r(l,c,s):et)===et&&(u=Qo(l)?l:Ki(e[i+1])?[]:{})}en(s,c,u),s=s[c]}return t}function Er(t){return vo(pa(t))}function Ar(t,e,n){var r=-1,i=t.length;e<0&&(e=-e>i?0:i+e),(n=n>i?i:n)<0&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;for(var o=Ta(i);++r<i;)o[r]=t[r+e];return o}function Ir(t,e){var n;return Bs(t,function(t,r,i){return!(n=e(t,r,i))}),!!n}function kr(t,e,n){var r=0,i=null==t?r:t.length;if("number"==typeof e&&e===e&&i<=zt){for(;r<i;){var o=r+i>>>1,a=t[o];null!==a&&!ea(a)&&(n?a<=e:a<e)?r=o+1:i=o}return i}return Rr(t,e,ba,n)}function Rr(t,e,n,r){e=n(e);for(var i=0,o=null==t?0:t.length,a=e!==e,s=null===e,c=ea(e),u=e===et;i<o;){var l=us((i+o)/2),d=n(t[l]),f=d!==et,h=null===d,p=d===d,m=ea(d);if(a)var g=r||p;else g=u?p&&(r||f):s?p&&f&&(r||!h):c?p&&f&&!h&&(r||!m):!h&&!m&&(r?d<=e:d<e);g?i=l+1:o=l}return gs(o,Mt)}function jr(t,e){for(var n=-1,r=t.length,i=0,o=[];++n<r;){var a=t[n],s=e?e(a):a;if(!n||!qo(s,c)){var c=s;o[i++]=0===a?0:a}}return o}function Nr(t){return"number"==typeof t?t:ea(t)?jt:+t}function Mr(t){if("string"==typeof t)return t;if(Uc(t))return d(t,Mr)+"";if(ea(t))return Ds?Ds.call(t):"";var e=t+"";return"0"==e&&1/t==-It?"-0":e}function zr(t,e,n){var r=-1,i=u,o=t.length,a=!0,s=[],c=s;if(n)a=!1,i=l;else if(o>=nt){var d=e?null:Gs(t);if(d)return G(d);a=!1,i=N,c=new Je}else c=e?[]:s;t:for(;++r<o;){var f=t[r],h=e?e(f):f;if(f=n||0!==f?f:0,a&&h===h){for(var p=c.length;p--;)if(c[p]===h)continue t;e&&c.push(h),s.push(f)}else i(c,h,n)||(c!==s&&c.push(h),s.push(f))}return s}function Dr(t,e){return e=Vr(e,t),null==(t=ho(t,e))||delete t[_o(To(e))]}function Pr(t,e,n,r){return Tr(t,e,n(Nn(t,e)),r)}function Br(t,e,n,r){for(var i=t.length,o=r?i:-1;(r?o--:++o<i)&&e(t[o],o,t););return n?Ar(t,r?0:o,r?o+1:i):Ar(t,r?o+1:0,r?i:o)}function Lr(t,e){var n=t;return n instanceof J&&(n=n.value()),h(e,function(t,e){return e.func.apply(e.thisArg,f([t],e.args))},n)}function Ur(t,e,n){var r=t.length;if(r<2)return r?zr(t[0]):[];for(var i=-1,o=Ta(r);++i<r;)for(var a=t[i],s=-1;++s<r;)s!=i&&(o[i]=yn(o[i]||a,t[s],e,n));return zr(En(o,1),e,n)}function Hr(t,e,n){for(var r=-1,i=t.length,o=e.length,a={};++r<i;){var s=r<o?e[r]:et;n(a,t[r],s)}return a}function Fr(t){return $o(t)?t:[]}function qr(t){return"function"==typeof t?t:ba}function Vr(t,e){return Uc(t)?t:eo(t,e)?[t]:ec(ca(t))}function $r(t,e,n){var r=t.length;return n=n===et?r:n,!e&&n>=r?t:Ar(t,e,n)}function Gr(t,e){if(e)return t.slice();var n=t.length,r=Qa?Qa(n):new t.constructor(n);return t.copy(r),r}function Wr(t){var e=new t.constructor(t.byteLength);return new Xa(e).set(new Xa(t)),e}function Jr(t,e){var n=e?Wr(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}function Xr(t){var e=new t.constructor(t.source,Le.exec(t));return e.lastIndex=t.lastIndex,e}function Qr(t){return zs?Ra(zs.call(t)):{}}function Yr(t,e){var n=e?Wr(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}function Zr(t,e){if(t!==e){var n=t!==et,r=null===t,i=t===t,o=ea(t),a=e!==et,s=null===e,c=e===e,u=ea(e);if(!s&&!u&&!o&&t>e||o&&a&&c&&!s&&!u||r&&a&&c||!n&&c||!i)return 1;if(!r&&!o&&!u&&t<e||u&&n&&i&&!r&&!o||s&&n&&i||!a&&i||!c)return-1}return 0}function Kr(t,e,n){for(var r=-1,i=t.criteria,o=e.criteria,a=i.length,s=n.length;++r<a;){var c=Zr(i[r],o[r]);if(c)return r>=s?c:c*("desc"==n[r]?-1:1)}return t.index-e.index}function ti(t,e,n,r){for(var i=-1,o=t.length,a=n.length,s=-1,c=e.length,u=ms(o-a,0),l=Ta(c+u),d=!r;++s<c;)l[s]=e[s];for(;++i<a;)(d||i<o)&&(l[n[i]]=t[i]);for(;u--;)l[s++]=t[i++];return l}function ei(t,e,n,r){for(var i=-1,o=t.length,a=-1,s=n.length,c=-1,u=e.length,l=ms(o-s,0),d=Ta(l+u),f=!r;++i<l;)d[i]=t[i];for(var h=i;++c<u;)d[h+c]=e[c];for(;++a<s;)(f||i<o)&&(d[h+n[a]]=t[i++]);return d}function ni(t,e){var n=-1,r=t.length;for(e||(e=Ta(r));++n<r;)e[n]=t[n];return e}function ri(t,e,n,r){var i=!n;n||(n={});for(var o=-1,a=e.length;++o<a;){var s=e[o],c=r?r(n[s],t[s],s,n,t):et;c===et&&(c=t[s]),i?sn(n,s,c):en(n,s,c)}return n}function ii(t,e){return ri(t,Js(t),e)}function oi(t,e){return ri(t,Xs(t),e)}function ai(t,e){return function(n,r){var o=Uc(n)?i:rn,a=e?e():{};return o(n,t,Ui(r,2),a)}}function si(t){return xr(function(e,n){var r=-1,i=n.length,o=i>1?n[i-1]:et,a=i>2?n[2]:et;for(o=t.length>3&&"function"==typeof o?(i--,o):et,a&&to(n[0],n[1],a)&&(o=i<3?et:o,i=1),e=Ra(e);++r<i;){var s=n[r];s&&t(e,s,r,o)}return e})}function ci(t,e){return function(n,r){if(null==n)return n;if(!Vo(n))return t(n,r);for(var i=n.length,o=e?i:-1,a=Ra(n);(e?o--:++o<i)&&!1!==r(a[o],o,a););return n}}function ui(t){return function(e,n,r){for(var i=-1,o=Ra(e),a=r(e),s=a.length;s--;){var c=a[t?s:++i];if(!1===n(o[c],c,o))break}return e}}function li(t,e,n){function r(){return(this&&this!==An&&this instanceof r?o:t).apply(i?n:this,arguments)}var i=e&ht,o=hi(t);return r}function di(t){return function(e){var n=L(e=ca(e))?Y(e):et,r=n?n[0]:e.charAt(0),i=n?$r(n,1).join(""):e.slice(1);return r[t]()+i}}function fi(t){return function(e){return h(va(ga(e).replace(ln,"")),t,"")}}function hi(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var n=Ps(t.prototype),r=t.apply(n,e);return Qo(r)?r:n}}function pi(t,e,n){function i(){for(var a=arguments.length,s=Ta(a),c=a,u=Li(i);c--;)s[c]=arguments[c];var l=a<3&&s[0]!==u&&s[a-1]!==u?[]:V(s,u);return(a-=l.length)<n?Si(t,e,vi,i.placeholder,et,s,l,et,et,n-a):r(this&&this!==An&&this instanceof i?o:t,this,s)}var o=hi(t);return i}function mi(t){return function(e,n,r){var i=Ra(e);if(!Vo(e)){var o=Ui(n,3);e=da(e),n=function(t){return o(i[t],t,i)}}var a=t(e,n,r);return a>-1?i[o?e[a]:a]:et}}function gi(t){return zi(function(e){var n=e.length,r=n,i=S.prototype.thru;for(t&&e.reverse();r--;){var o=e[r];if("function"!=typeof o)throw new Ma(it);if(i&&!a&&"wrapper"==Bi(o))var a=new S([],!0)}for(r=a?r:n;++r<n;){var s=Bi(o=e[r]),c="wrapper"==s?Ws(o):et;a=c&&ro(c[0])&&c[1]==(yt|gt|_t|wt)&&!c[4].length&&1==c[9]?a[Bi(c[0])].apply(a,c[3]):1==o.length&&ro(o)?a[s]():a.thru(o)}return function(){var t=arguments,r=t[0];if(a&&1==t.length&&Uc(r))return a.plant(r).value();for(var i=0,o=n?e[i].apply(this,t):r;++i<n;)o=e[i].call(this,o);return o}})}function vi(t,e,n,r,i,o,a,s,c,u){function l(){for(var v=arguments.length,_=Ta(v),b=v;b--;)_[b]=arguments[b];if(p)var y=Li(l),w=D(_,y);if(r&&(_=ti(_,r,i,p)),o&&(_=ei(_,o,a,p)),v-=w,p&&v<u){var C=V(_,y);return Si(t,e,vi,l.placeholder,n,_,C,s,c,u-v)}var x=f?n:this,O=h?x[t]:t;return v=_.length,s?_=po(_,s):m&&v>1&&_.reverse(),d&&c<v&&(_.length=c),this&&this!==An&&this instanceof l&&(O=g||hi(O)),O.apply(x,_)}var d=e&yt,f=e&ht,h=e&pt,p=e&(gt|vt),m=e&Ct,g=h?et:hi(t);return l}function _i(t,e){return function(n,r){return Yn(n,t,e(r),{})}}function bi(t,e){return function(n,r){var i;if(n===et&&r===et)return e;if(n!==et&&(i=n),r!==et){if(i===et)return r;"string"==typeof n||"string"==typeof r?(n=Mr(n),r=Mr(r)):(n=Nr(n),r=Nr(r)),i=t(n,r)}return i}}function yi(t){return zi(function(e){return e=d(e,R(Ui())),xr(function(n){var i=this;return t(e,function(t){return r(t,i,n)})})})}function wi(t,e){var n=(e=e===et?" ":Mr(e)).length;if(n<2)return n?Cr(e,t):e;var r=Cr(e,cs(t/Q(e)));return L(e)?$r(Y(r),0,t).join(""):r.slice(0,t)}function Ci(t,e,n,i){function o(){for(var e=-1,c=arguments.length,u=-1,l=i.length,d=Ta(l+c),f=this&&this!==An&&this instanceof o?s:t;++u<l;)d[u]=i[u];for(;c--;)d[u++]=arguments[++e];return r(f,a?n:this,d)}var a=e&ht,s=hi(t);return o}function xi(t){return function(e,n,r){return r&&"number"!=typeof r&&to(e,n,r)&&(n=r=et),e=ra(e),n===et?(n=e,e=0):n=ra(n),r=r===et?e<n?1:-1:ra(r),wr(e,n,r,t)}}function Oi(t){return function(e,n){return"string"==typeof e&&"string"==typeof n||(e=aa(e),n=aa(n)),t(e,n)}}function Si(t,e,n,r,i,o,a,s,c,u){var l=e&gt,d=l?a:et,f=l?et:a,h=l?o:et,p=l?et:o;e|=l?_t:bt,(e&=~(l?bt:_t))&mt||(e&=~(ht|pt));var m=[t,e,i,h,d,p,f,s,c,u],g=n.apply(et,m);return ro(t)&&Zs(g,m),g.placeholder=r,mo(g,t,e)}function Ti(t){var e=ka[t];return function(t,n){if(t=aa(t),n=null==n?0:gs(ia(n),292)){var r=(ca(t)+"e").split("e");return+((r=(ca(e(r[0]+"e"+(+r[1]+n)))+"e").split("e"))[0]+"e"+(+r[1]-n))}return e(t)}}function Ei(t){return function(e){var n=Qs(e);return n==Gt?F(e):n==Zt?W(e):k(e,t(e))}}function Ai(t,e,n,r,i,o,a,s){var c=e&pt;if(!c&&"function"!=typeof t)throw new Ma(it);var u=r?r.length:0;if(u||(e&=~(_t|bt),r=i=et),a=a===et?a:ms(ia(a),0),s=s===et?s:ia(s),u-=i?i.length:0,e&bt){var l=r,d=i;r=i=et}var f=c?et:Ws(t),h=[t,e,n,r,i,l,d,o,a,s];if(f&&co(h,f),t=h[0],e=h[1],n=h[2],r=h[3],i=h[4],!(s=h[9]=h[9]===et?c?0:t.length:ms(h[9]-u,0))&&e&(gt|vt)&&(e&=~(gt|vt)),e&&e!=ht)p=e==gt||e==vt?pi(t,e,s):e!=_t&&e!=(ht|_t)||i.length?vi.apply(et,h):Ci(t,e,n,r);else var p=li(t,e,n);return mo((f?Fs:Zs)(p,h),t,e)}function Ii(t,e,n,r){return t===et||qo(t,Pa[n])&&!Ua.call(r,n)?e:t}function ki(t,e,n,r,i,o){return Qo(t)&&Qo(e)&&(o.set(e,t),dr(t,e,et,ki,o),o.delete(e)),t}function Ri(t){return Ko(t)?et:t}function ji(t,e,n,r,i,o){var a=n&dt,s=t.length,c=e.length;if(s!=c&&!(a&&c>s))return!1;var u=o.get(t);if(u&&o.get(e))return u==e;var l=-1,d=!0,f=n&ft?new Je:et;for(o.set(t,e),o.set(e,t);++l<s;){var h=t[l],p=e[l];if(r)var g=a?r(p,h,l,e,t,o):r(h,p,l,t,e,o);if(g!==et){if(g)continue;d=!1;break}if(f){if(!m(e,function(t,e){if(!N(f,e)&&(h===t||i(h,t,n,r,o)))return f.push(e)})){d=!1;break}}else if(h!==p&&!i(h,p,n,r,o)){d=!1;break}}return o.delete(t),o.delete(e),d}function Ni(t,e,n,r,i,o,a){switch(n){case oe:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case ie:return!(t.byteLength!=e.byteLength||!o(new Xa(t),new Xa(e)));case Ut:case Ht:case Wt:return qo(+t,+e);case qt:return t.name==e.name&&t.message==e.message;case Yt:case Kt:return t==e+"";case Gt:var s=F;case Zt:var c=r&dt;if(s||(s=G),t.size!=e.size&&!c)return!1;var u=a.get(t);if(u)return u==e;r|=ft,a.set(t,e);var l=ji(s(t),s(e),r,i,o,a);return a.delete(t),l;case te:if(zs)return zs.call(t)==zs.call(e)}return!1}function Mi(t,e,n,r,i,o){var a=n&dt,s=Di(t),c=s.length;if(c!=Di(e).length&&!a)return!1;for(var u=c;u--;){var l=s[u];if(!(a?l in e:Ua.call(e,l)))return!1}var d=o.get(t);if(d&&o.get(e))return d==e;var f=!0;o.set(t,e),o.set(e,t);for(var h=a;++u<c;){var p=t[l=s[u]],m=e[l];if(r)var g=a?r(m,p,l,e,t,o):r(p,m,l,t,e,o);if(!(g===et?p===m||i(p,m,n,r,o):g)){f=!1;break}h||(h="constructor"==l)}if(f&&!h){var v=t.constructor,_=e.constructor;v!=_&&"constructor"in t&&"constructor"in e&&!("function"==typeof v&&v instanceof v&&"function"==typeof _&&_ instanceof _)&&(f=!1)}return o.delete(t),o.delete(e),f}function zi(t){return tc(fo(t,et,Oo),t+"")}function Di(t){return Un(t,da,Js)}function Pi(t){return Un(t,fa,Xs)}function Bi(t){for(var e=t.name+"",n=As[e],r=Ua.call(As,e)?n.length:0;r--;){var i=n[r],o=i.func;if(null==o||o==t)return i.name}return e}function Li(t){return(Ua.call(n,"placeholder")?n:t).placeholder}function Ui(){var t=n.iteratee||ya;return t=t===ya?ir:t,arguments.length?t(arguments[0],arguments[1]):t}function Hi(t,e){var n=t.__data__;return no(e)?n["string"==typeof e?"string":"hash"]:n.map}function Fi(t){for(var e=da(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,ao(i)]}return e}function qi(t,e){var n=B(t,e);return rr(n)?n:et}function Vi(t){var e=Ua.call(t,rs),n=t[rs];try{t[rs]=et;var r=!0}catch(t){}var i=qa.call(t);return r&&(e?t[rs]=n:delete t[rs]),i}function $i(t,e,n){for(var r=-1,i=n.length;++r<i;){var o=n[r],a=o.size;switch(o.type){case"drop":t+=a;break;case"dropRight":e-=a;break;case"take":e=gs(e,t+a);break;case"takeRight":t=ms(t,e-a)}}return{start:t,end:e}}function Gi(t){var e=t.match(Me);return e?e[1].split(ze):[]}function Wi(t,e,n){for(var r=-1,i=(e=Vr(e,t)).length,o=!1;++r<i;){var a=_o(e[r]);if(!(o=null!=t&&n(t,a)))break;t=t[a]}return o||++r!=i?o:!!(i=null==t?0:t.length)&&Xo(i)&&Ki(a,i)&&(Uc(t)||Lc(t))}function Ji(t){var e=t.length,n=new t.constructor(e);return e&&"string"==typeof t[0]&&Ua.call(t,"index")&&(n.index=t.index,n.input=t.input),n}function Xi(t){return"function"!=typeof t.constructor||oo(t)?{}:Ps(Ya(t))}function Qi(t,e,n){var r=t.constructor;switch(e){case ie:return Wr(t);case Ut:case Ht:return new r(+t);case oe:return Jr(t,n);case ae:case se:case ce:case ue:case le:case de:case fe:case he:case pe:return Yr(t,n);case Gt:return new r;case Wt:case Kt:return new r(t);case Yt:return Xr(t);case Zt:return new r;case te:return Qr(t)}}function Yi(t,e){var n=e.length;if(!n)return t;var r=n-1;return e[r]=(n>1?"& ":"")+e[r],e=e.join(n>2?", ":" "),t.replace(Ne,"{\n\n")}function Zi(t){return Uc(t)||Lc(t)||!!(es&&t&&t[es])}function Ki(t,e){var n=typeof t;return!!(e=null==e?kt:e)&&("number"==n||"symbol"!=n&&Ve.test(t))&&t>-1&&t%1==0&&t<e}function to(t,e,n){if(!Qo(n))return!1;var r=typeof e;return!!("number"==r?Vo(n)&&Ki(e,n.length):"string"==r&&e in n)&&qo(n[e],t)}function eo(t,e){if(Uc(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!ea(t))||(Te.test(t)||!Se.test(t)||null!=e&&t in Ra(e))}function no(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}function ro(t){var e=Bi(t),r=n[e];if("function"!=typeof r||!(e in J.prototype))return!1;if(t===r)return!0;var i=Ws(r);return!!i&&t===i[0]}function io(t){return!!Fa&&Fa in t}function oo(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Pa)}function ao(t){return t===t&&!Qo(t)}function so(t,e){return function(n){return null!=n&&(n[t]===e&&(e!==et||t in Ra(n)))}}function co(t,e){var n=t[1],r=e[1],i=n|r,o=i<(ht|pt|yt),a=r==yt&&n==gt||r==yt&&n==wt&&t[7].length<=e[8]||r==(yt|wt)&&e[7].length<=e[8]&&n==gt;if(!o&&!a)return t;r&ht&&(t[2]=e[2],i|=n&ht?0:mt);var s=e[3];if(s){var c=t[3];t[3]=c?ti(c,s,e[4]):s,t[4]=c?V(t[3],st):e[4]}return(s=e[5])&&(c=t[5],t[5]=c?ei(c,s,e[6]):s,t[6]=c?V(t[5],st):e[6]),(s=e[7])&&(t[7]=s),r&yt&&(t[8]=null==t[8]?e[8]:gs(t[8],e[8])),null==t[9]&&(t[9]=e[9]),t[0]=e[0],t[1]=i,t}function uo(t){var e=[];if(null!=t)for(var n in Ra(t))e.push(n);return e}function lo(t){return qa.call(t)}function fo(t,e,n){return e=ms(e===et?t.length-1:e,0),function(){for(var i=arguments,o=-1,a=ms(i.length-e,0),s=Ta(a);++o<a;)s[o]=i[e+o];o=-1;for(var c=Ta(e+1);++o<e;)c[o]=i[o];return c[e]=n(s),r(t,this,c)}}function ho(t,e){return e.length<2?t:Nn(t,Ar(e,0,-1))}function po(t,e){for(var n=t.length,r=gs(e.length,n),i=ni(t);r--;){var o=e[r];t[r]=Ki(o,n)?i[o]:et}return t}function mo(t,e,n){var r=e+"";return tc(t,Yi(r,yo(Gi(r),n)))}function go(t){var e=0,n=0;return function(){var r=vs(),i=Tt-(r-n);if(n=r,i>0){if(++e>=St)return arguments[0]}else e=0;return t.apply(et,arguments)}}function vo(t,e){var n=-1,r=t.length,i=r-1;for(e=e===et?r:e;++n<e;){var o=yr(n,i),a=t[o];t[o]=t[n],t[n]=a}return t.length=e,t}function _o(t){if("string"==typeof t||ea(t))return t;var e=t+"";return"0"==e&&1/t==-It?"-0":e}function bo(t){if(null!=t){try{return La.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function yo(t,e){return o(Dt,function(n){var r="_."+n[0];e&n[1]&&!u(t,r)&&t.push(r)}),t.sort()}function wo(t){if(t instanceof J)return t.clone();var e=new S(t.__wrapped__,t.__chain__);return e.__actions__=ni(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}function Co(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=null==n?0:ia(n);return i<0&&(i=ms(r+i,0)),b(t,Ui(e,3),i)}function xo(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=r-1;return n!==et&&(i=ia(n),i=n<0?ms(r+i,0):gs(i,r-1)),b(t,Ui(e,3),i,!0)}function Oo(t){return(null==t?0:t.length)?En(t,1):[]}function So(t){return t&&t.length?t[0]:et}function To(t){var e=null==t?0:t.length;return e?t[e-1]:et}function Eo(t,e){return t&&t.length&&e&&e.length?_r(t,e):t}function Ao(t){return null==t?t:ys.call(t)}function Io(t){if(!t||!t.length)return[];var e=0;return t=c(t,function(t){if($o(t))return e=ms(t.length,e),!0}),I(e,function(e){return d(t,O(e))})}function ko(t,e){if(!t||!t.length)return[];var n=Io(t);return null==e?n:d(n,function(t){return r(e,et,t)})}function Ro(t){var e=n(t);return e.__chain__=!0,e}function jo(t,e){return e(t)}function No(t,e){return(Uc(t)?o:Bs)(t,Ui(e,3))}function Mo(t,e){return(Uc(t)?a:Ls)(t,Ui(e,3))}function zo(t,e){return(Uc(t)?d:cr)(t,Ui(e,3))}function Do(t,e,n){return e=n?et:e,e=t&&null==e?t.length:e,Ai(t,yt,et,et,et,et,e)}function Po(t,e){var n;if("function"!=typeof e)throw new Ma(it);return t=ia(t),function(){return--t>0&&(n=e.apply(this,arguments)),t<=1&&(e=et),n}}function Bo(t,e,n){var r=Ai(t,gt,et,et,et,et,et,e=n?et:e);return r.placeholder=Bo.placeholder,r}function Lo(t,e,n){var r=Ai(t,vt,et,et,et,et,et,e=n?et:e);return r.placeholder=Lo.placeholder,r}function Uo(t,e,n){function r(e){var n=l,r=d;return l=d=et,g=e,h=t.apply(r,n)}function i(t){return g=t,p=Ks(s,e),v?r(t):h}function o(t){var n=t-g,r=e-(t-m);return _?gs(r,f-n):r}function a(t){var n=t-m,r=t-g;return m===et||n>=e||n<0||_&&r>=f}function s(){var t=Ac();if(a(t))return c(t);p=Ks(s,o(t))}function c(t){return p=et,b&&l?r(t):(l=d=et,h)}function u(){var t=Ac(),n=a(t);if(l=arguments,d=this,m=t,n){if(p===et)return i(m);if(_)return p=Ks(s,e),r(m)}return p===et&&(p=Ks(s,e)),h}var l,d,f,h,p,m,g=0,v=!1,_=!1,b=!0;if("function"!=typeof t)throw new Ma(it);return e=aa(e)||0,Qo(n)&&(v=!!n.leading,f=(_="maxWait"in n)?ms(aa(n.maxWait)||0,e):f,b="trailing"in n?!!n.trailing:b),u.cancel=function(){p!==et&&$s(p),g=0,l=m=d=p=et},u.flush=function(){return p===et?h:c(Ac())},u}function Ho(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new Ma(it);var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var a=t.apply(this,r);return n.cache=o.set(i,a)||o,a};return n.cache=new(Ho.Cache||De),n}function Fo(t){if("function"!=typeof t)throw new Ma(it);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}function qo(t,e){return t===e||t!==t&&e!==e}function Vo(t){return null!=t&&Xo(t.length)&&!Wo(t)}function $o(t){return Yo(t)&&Vo(t)}function Go(t){if(!Yo(t))return!1;var e=$n(t);return e==qt||e==Ft||"string"==typeof t.message&&"string"==typeof t.name&&!Ko(t)}function Wo(t){if(!Qo(t))return!1;var e=$n(t);return e==Vt||e==$t||e==Lt||e==Qt}function Jo(t){return"number"==typeof t&&t==ia(t)}function Xo(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=kt}function Qo(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function Yo(t){return null!=t&&"object"==typeof t}function Zo(t){return"number"==typeof t||Yo(t)&&$n(t)==Wt}function Ko(t){if(!Yo(t)||$n(t)!=Xt)return!1;var e=Ya(t);if(null===e)return!0;var n=Ua.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&La.call(n)==Va}function ta(t){return"string"==typeof t||!Uc(t)&&Yo(t)&&$n(t)==Kt}function ea(t){return"symbol"==typeof t||Yo(t)&&$n(t)==te}function na(t){if(!t)return[];if(Vo(t))return ta(t)?Y(t):ni(t);if(ns&&t[ns])return H(t[ns]());var e=Qs(t);return(e==Gt?F:e==Zt?G:pa)(t)}function ra(t){return t?(t=aa(t),t===It||t===-It?(t<0?-1:1)*Rt:t===t?t:0):0===t?t:0}function ia(t){var e=ra(t),n=e%1;return e===e?n?e-n:e:0}function oa(t){return t?un(ia(t),0,Nt):0}function aa(t){if("number"==typeof t)return t;if(ea(t))return jt;if(Qo(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=Qo(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(ke,"");var n=He.test(t);return n||qe.test(t)?Sn(t.slice(2),n?2:8):Ue.test(t)?jt:+t}function sa(t){return ri(t,fa(t))}function ca(t){return null==t?"":Mr(t)}function ua(t,e,n){var r=null==t?et:Nn(t,e);return r===et?n:r}function la(t,e){return null!=t&&Wi(t,e,Jn)}function da(t){return Vo(t)?Qe(t):or(t)}function fa(t){return Vo(t)?Qe(t,!0):ar(t)}function ha(t,e){if(null==t)return{};var n=d(Pi(t),function(t){return[t]});return e=Ui(e),gr(t,n,function(t,n){return e(t,n[0])})}function pa(t){return null==t?[]:j(t,da(t))}function ma(t){return bu(ca(t).toLowerCase())}function ga(t){return(t=ca(t))&&t.replace($e,Hn).replace(dn,"")}function va(t,e,n){return t=ca(t),e=n?et:e,e===et?U(t)?tt(t):v(t):t.match(e)||[]}function _a(t){return function(){return t}}function ba(t){return t}function ya(t){return ir("function"==typeof t?t:fn(t,ct))}function wa(t,e,n){var r=da(e),i=jn(e,r);null!=n||Qo(e)&&(i.length||!r.length)||(n=e,e=t,t=this,i=jn(e,da(e)));var a=!(Qo(n)&&"chain"in n&&!n.chain),s=Wo(t);return o(i,function(n){var r=e[n];t[n]=r,s&&(t.prototype[n]=function(){var e=this.__chain__;if(a||e){var n=t(this.__wrapped__);return(n.__actions__=ni(this.__actions__)).push({func:r,args:arguments,thisArg:t}),n.__chain__=e,n}return r.apply(t,f([this.value()],arguments))})}),t}function Ca(){}function xa(t){return eo(t)?O(_o(t)):vr(t)}function Oa(){return[]}function Sa(){return!1}var Ta=(e=null==e?An:Vn.defaults(An.Object(),e,Vn.pick(An,gn))).Array,Ea=e.Date,Aa=e.Error,Ia=e.Function,ka=e.Math,Ra=e.Object,ja=e.RegExp,Na=e.String,Ma=e.TypeError,za=Ta.prototype,Da=Ia.prototype,Pa=Ra.prototype,Ba=e["__core-js_shared__"],La=Da.toString,Ua=Pa.hasOwnProperty,Ha=0,Fa=function(){var t=/[^.]+$/.exec(Ba&&Ba.keys&&Ba.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),qa=Pa.toString,Va=La.call(Ra),$a=An._,Ga=ja("^"+La.call(Ua).replace(Ae,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Wa=Rn?e.Buffer:et,Ja=e.Symbol,Xa=e.Uint8Array,Qa=Wa?Wa.allocUnsafe:et,Ya=q(Ra.getPrototypeOf,Ra),Za=Ra.create,Ka=Pa.propertyIsEnumerable,ts=za.splice,es=Ja?Ja.isConcatSpreadable:et,ns=Ja?Ja.iterator:et,rs=Ja?Ja.toStringTag:et,is=function(){try{var t=qi(Ra,"defineProperty");return t({},"",{}),t}catch(t){}}(),os=e.clearTimeout!==An.clearTimeout&&e.clearTimeout,as=Ea&&Ea.now!==An.Date.now&&Ea.now,ss=e.setTimeout!==An.setTimeout&&e.setTimeout,cs=ka.ceil,us=ka.floor,ls=Ra.getOwnPropertySymbols,ds=Wa?Wa.isBuffer:et,fs=e.isFinite,hs=za.join,ps=q(Ra.keys,Ra),ms=ka.max,gs=ka.min,vs=Ea.now,_s=e.parseInt,bs=ka.random,ys=za.reverse,ws=qi(e,"DataView"),Cs=qi(e,"Map"),xs=qi(e,"Promise"),Os=qi(e,"Set"),Ss=qi(e,"WeakMap"),Ts=qi(Ra,"create"),Es=Ss&&new Ss,As={},Is=bo(ws),ks=bo(Cs),Rs=bo(xs),js=bo(Os),Ns=bo(Ss),Ms=Ja?Ja.prototype:et,zs=Ms?Ms.valueOf:et,Ds=Ms?Ms.toString:et,Ps=function(){function t(){}return function(e){if(!Qo(e))return{};if(Za)return Za(e);t.prototype=e;var n=new t;return t.prototype=et,n}}();n.templateSettings={escape:Ce,evaluate:xe,interpolate:Oe,variable:"",imports:{_:n}},n.prototype=g.prototype,n.prototype.constructor=n,S.prototype=Ps(g.prototype),S.prototype.constructor=S,J.prototype=Ps(g.prototype),J.prototype.constructor=J,Z.prototype.clear=function(){this.__data__=Ts?Ts(null):{},this.size=0},Z.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},Z.prototype.get=function(t){var e=this.__data__;if(Ts){var n=e[t];return n===ot?et:n}return Ua.call(e,t)?e[t]:et},Z.prototype.has=function(t){var e=this.__data__;return Ts?e[t]!==et:Ua.call(e,t)},Z.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=Ts&&e===et?ot:e,this},K.prototype.clear=function(){this.__data__=[],this.size=0},K.prototype.delete=function(t){var e=this.__data__,n=nn(e,t);return!(n<0||(n==e.length-1?e.pop():ts.call(e,n,1),--this.size,0))},K.prototype.get=function(t){var e=this.__data__,n=nn(e,t);return n<0?et:e[n][1]},K.prototype.has=function(t){return nn(this.__data__,t)>-1},K.prototype.set=function(t,e){var n=this.__data__,r=nn(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this},De.prototype.clear=function(){this.size=0,this.__data__={hash:new Z,map:new(Cs||K),string:new Z}},De.prototype.delete=function(t){var e=Hi(this,t).delete(t);return this.size-=e?1:0,e},De.prototype.get=function(t){return Hi(this,t).get(t)},De.prototype.has=function(t){return Hi(this,t).has(t)},De.prototype.set=function(t,e){var n=Hi(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this},Je.prototype.add=Je.prototype.push=function(t){return this.__data__.set(t,ot),this},Je.prototype.has=function(t){return this.__data__.has(t)},Xe.prototype.clear=function(){this.__data__=new K,this.size=0},Xe.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},Xe.prototype.get=function(t){return this.__data__.get(t)},Xe.prototype.has=function(t){return this.__data__.has(t)},Xe.prototype.set=function(t,e){var n=this.__data__;if(n instanceof K){var r=n.__data__;if(!Cs||r.length<nt-1)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new De(r)}return n.set(t,e),this.size=n.size,this};var Bs=ci(In),Ls=ci(kn,!0),Us=ui(),Hs=ui(!0),Fs=Es?function(t,e){return Es.set(t,e),t}:ba,qs=is?function(t,e){return is(t,"toString",{configurable:!0,enumerable:!1,value:_a(e),writable:!0})}:ba,Vs=xr,$s=os||function(t){return An.clearTimeout(t)},Gs=Os&&1/G(new Os([,-0]))[1]==It?function(t){return new Os(t)}:Ca,Ws=Es?function(t){return Es.get(t)}:Ca,Js=ls?function(t){return null==t?[]:(t=Ra(t),c(ls(t),function(e){return Ka.call(t,e)}))}:Oa,Xs=ls?function(t){for(var e=[];t;)f(e,Js(t)),t=Ya(t);return e}:Oa,Qs=$n;(ws&&Qs(new ws(new ArrayBuffer(1)))!=oe||Cs&&Qs(new Cs)!=Gt||xs&&"[object Promise]"!=Qs(xs.resolve())||Os&&Qs(new Os)!=Zt||Ss&&Qs(new Ss)!=ne)&&(Qs=function(t){var e=$n(t),n=e==Xt?t.constructor:et,r=n?bo(n):"";if(r)switch(r){case Is:return oe;case ks:return Gt;case Rs:return"[object Promise]";case js:return Zt;case Ns:return ne}return e});var Ys=Ba?Wo:Sa,Zs=go(Fs),Ks=ss||function(t,e){return An.setTimeout(t,e)},tc=go(qs),ec=function(t){var e=Ho(t,function(t){return n.size===at&&n.clear(),t}),n=e.cache;return e}(function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(Ee,function(t,n,r,i){e.push(r?i.replace(Pe,"$1"):n||t)}),e}),nc=xr(function(t,e){return $o(t)?yn(t,En(e,1,$o,!0)):[]}),rc=xr(function(t,e){var n=To(e);return $o(n)&&(n=et),$o(t)?yn(t,En(e,1,$o,!0),Ui(n,2)):[]}),ic=xr(function(t,e){var n=To(e);return $o(n)&&(n=et),$o(t)?yn(t,En(e,1,$o,!0),et,n):[]}),oc=xr(function(t){var e=d(t,Fr);return e.length&&e[0]===t[0]?Qn(e):[]}),ac=xr(function(t){var e=To(t),n=d(t,Fr);return e===To(n)?e=et:n.pop(),n.length&&n[0]===t[0]?Qn(n,Ui(e,2)):[]}),sc=xr(function(t){var e=To(t),n=d(t,Fr);return(e="function"==typeof e?e:et)&&n.pop(),n.length&&n[0]===t[0]?Qn(n,et,e):[]}),cc=xr(Eo),uc=zi(function(t,e){var n=null==t?0:t.length,r=cn(t,e);return br(t,d(e,function(t){return Ki(t,n)?+t:t}).sort(Zr)),r}),lc=xr(function(t){return zr(En(t,1,$o,!0))}),dc=xr(function(t){var e=To(t);return $o(e)&&(e=et),zr(En(t,1,$o,!0),Ui(e,2))}),fc=xr(function(t){var e=To(t);return e="function"==typeof e?e:et,zr(En(t,1,$o,!0),et,e)}),hc=xr(function(t,e){return $o(t)?yn(t,e):[]}),pc=xr(function(t){return Ur(c(t,$o))}),mc=xr(function(t){var e=To(t);return $o(e)&&(e=et),Ur(c(t,$o),Ui(e,2))}),gc=xr(function(t){var e=To(t);return e="function"==typeof e?e:et,Ur(c(t,$o),et,e)}),vc=xr(Io),_c=xr(function(t){var e=t.length,n=e>1?t[e-1]:et;return n="function"==typeof n?(t.pop(),n):et,ko(t,n)}),bc=zi(function(t){var e=t.length,n=e?t[0]:0,r=this.__wrapped__,i=function(e){return cn(e,t)};return!(e>1||this.__actions__.length)&&r instanceof J&&Ki(n)?((r=r.slice(n,+n+(e?1:0))).__actions__.push({func:jo,args:[i],thisArg:et}),new S(r,this.__chain__).thru(function(t){return e&&!t.length&&t.push(et),t})):this.thru(i)}),yc=ai(function(t,e,n){Ua.call(t,n)?++t[n]:sn(t,n,1)}),wc=mi(Co),Cc=mi(xo),xc=ai(function(t,e,n){Ua.call(t,n)?t[n].push(e):sn(t,n,[e])}),Oc=xr(function(t,e,n){var i=-1,o="function"==typeof e,a=Vo(t)?Ta(t.length):[];return Bs(t,function(t){a[++i]=o?r(e,t,n):Zn(t,e,n)}),a}),Sc=ai(function(t,e,n){sn(t,n,e)}),Tc=ai(function(t,e,n){t[n?0:1].push(e)},function(){return[[],[]]}),Ec=xr(function(t,e){if(null==t)return[];var n=e.length;return n>1&&to(t,e[0],e[1])?e=[]:n>2&&to(e[0],e[1],e[2])&&(e=[e[0]]),pr(t,En(e,1),[])}),Ac=as||function(){return An.Date.now()},Ic=xr(function(t,e,n){var r=ht;if(n.length){var i=V(n,Li(Ic));r|=_t}return Ai(t,r,e,n,i)}),kc=xr(function(t,e,n){var r=ht|pt;if(n.length){var i=V(n,Li(kc));r|=_t}return Ai(e,r,t,n,i)}),Rc=xr(function(t,e){return mn(t,1,e)}),jc=xr(function(t,e,n){return mn(t,aa(e)||0,n)});Ho.Cache=De;var Nc=Vs(function(t,e){var n=(e=1==e.length&&Uc(e[0])?d(e[0],R(Ui())):d(En(e,1),R(Ui()))).length;return xr(function(i){for(var o=-1,a=gs(i.length,n);++o<a;)i[o]=e[o].call(this,i[o]);return r(t,this,i)})}),Mc=xr(function(t,e){var n=V(e,Li(Mc));return Ai(t,_t,et,e,n)}),zc=xr(function(t,e){var n=V(e,Li(zc));return Ai(t,bt,et,e,n)}),Dc=zi(function(t,e){return Ai(t,wt,et,et,et,e)}),Pc=Oi(Gn),Bc=Oi(function(t,e){return t>=e}),Lc=Kn(function(){return arguments}())?Kn:function(t){return Yo(t)&&Ua.call(t,"callee")&&!Ka.call(t,"callee")},Uc=Ta.isArray,Hc=Mn?R(Mn):function(t){return Yo(t)&&$n(t)==ie},Fc=ds||Sa,qc=zn?R(zn):function(t){return Yo(t)&&$n(t)==Ht},Vc=Dn?R(Dn):function(t){return Yo(t)&&Qs(t)==Gt},$c=Pn?R(Pn):function(t){return Yo(t)&&$n(t)==Yt},Gc=Bn?R(Bn):function(t){return Yo(t)&&Qs(t)==Zt},Wc=Ln?R(Ln):function(t){return Yo(t)&&Xo(t.length)&&!!_n[$n(t)]},Jc=Oi(sr),Xc=Oi(function(t,e){return t<=e}),Qc=si(function(t,e){if(oo(e)||Vo(e))ri(e,da(e),t);else for(var n in e)Ua.call(e,n)&&en(t,n,e[n])}),Yc=si(function(t,e){ri(e,fa(e),t)}),Zc=si(function(t,e,n,r){ri(e,fa(e),t,r)}),Kc=si(function(t,e,n,r){ri(e,da(e),t,r)}),tu=zi(cn),eu=xr(function(t,e){t=Ra(t);var n=-1,r=e.length,i=r>2?e[2]:et;for(i&&to(e[0],e[1],i)&&(r=1);++n<r;)for(var o=e[n],a=fa(o),s=-1,c=a.length;++s<c;){var u=a[s],l=t[u];(l===et||qo(l,Pa[u])&&!Ua.call(t,u))&&(t[u]=o[u])}return t}),nu=xr(function(t){return t.push(et,ki),r(su,et,t)}),ru=_i(function(t,e,n){null!=e&&"function"!=typeof e.toString&&(e=qa.call(e)),t[e]=n},_a(ba)),iu=_i(function(t,e,n){null!=e&&"function"!=typeof e.toString&&(e=qa.call(e)),Ua.call(t,e)?t[e].push(n):t[e]=[n]},Ui),ou=xr(Zn),au=si(function(t,e,n){dr(t,e,n)}),su=si(function(t,e,n,r){dr(t,e,n,r)}),cu=zi(function(t,e){var n={};if(null==t)return n;var r=!1;e=d(e,function(e){return e=Vr(e,t),r||(r=e.length>1),e}),ri(t,Pi(t),n),r&&(n=fn(n,ct|ut|lt,Ri));for(var i=e.length;i--;)Dr(n,e[i]);return n}),uu=zi(function(t,e){return null==t?{}:mr(t,e)}),lu=Ei(da),du=Ei(fa),fu=fi(function(t,e,n){return e=e.toLowerCase(),t+(n?ma(e):e)}),hu=fi(function(t,e,n){return t+(n?"-":"")+e.toLowerCase()}),pu=fi(function(t,e,n){return t+(n?" ":"")+e.toLowerCase()}),mu=di("toLowerCase"),gu=fi(function(t,e,n){return t+(n?"_":"")+e.toLowerCase()}),vu=fi(function(t,e,n){return t+(n?" ":"")+bu(e)}),_u=fi(function(t,e,n){return t+(n?" ":"")+e.toUpperCase()}),bu=di("toUpperCase"),yu=xr(function(t,e){try{return r(t,et,e)}catch(t){return Go(t)?t:new Aa(t)}}),wu=zi(function(t,e){return o(e,function(e){e=_o(e),sn(t,e,Ic(t[e],t))}),t}),Cu=gi(),xu=gi(!0),Ou=xr(function(t,e){return function(n){return Zn(n,t,e)}}),Su=xr(function(t,e){return function(n){return Zn(t,n,e)}}),Tu=yi(d),Eu=yi(s),Au=yi(m),Iu=xi(),ku=xi(!0),Ru=bi(function(t,e){return t+e},0),ju=Ti("ceil"),Nu=bi(function(t,e){return t/e},1),Mu=Ti("floor"),zu=bi(function(t,e){return t*e},1),Du=Ti("round"),Pu=bi(function(t,e){return t-e},0);return n.after=function(t,e){if("function"!=typeof e)throw new Ma(it);return t=ia(t),function(){if(--t<1)return e.apply(this,arguments)}},n.ary=Do,n.assign=Qc,n.assignIn=Yc,n.assignInWith=Zc,n.assignWith=Kc,n.at=tu,n.before=Po,n.bind=Ic,n.bindAll=wu,n.bindKey=kc,n.castArray=function(){if(!arguments.length)return[];var t=arguments[0];return Uc(t)?t:[t]},n.chain=Ro,n.chunk=function(t,e,n){e=(n?to(t,e,n):e===et)?1:ms(ia(e),0);var r=null==t?0:t.length;if(!r||e<1)return[];for(var i=0,o=0,a=Ta(cs(r/e));i<r;)a[o++]=Ar(t,i,i+=e);return a},n.compact=function(t){for(var e=-1,n=null==t?0:t.length,r=0,i=[];++e<n;){var o=t[e];o&&(i[r++]=o)}return i},n.concat=function(){var t=arguments.length;if(!t)return[];for(var e=Ta(t-1),n=arguments[0],r=t;r--;)e[r-1]=arguments[r];return f(Uc(n)?ni(n):[n],En(e,1))},n.cond=function(t){var e=null==t?0:t.length,n=Ui();return t=e?d(t,function(t){if("function"!=typeof t[1])throw new Ma(it);return[n(t[0]),t[1]]}):[],xr(function(n){for(var i=-1;++i<e;){var o=t[i];if(r(o[0],this,n))return r(o[1],this,n)}})},n.conforms=function(t){return hn(fn(t,ct))},n.constant=_a,n.countBy=yc,n.create=function(t,e){var n=Ps(t);return null==e?n:on(n,e)},n.curry=Bo,n.curryRight=Lo,n.debounce=Uo,n.defaults=eu,n.defaultsDeep=nu,n.defer=Rc,n.delay=jc,n.difference=nc,n.differenceBy=rc,n.differenceWith=ic,n.drop=function(t,e,n){var r=null==t?0:t.length;return r?(e=n||e===et?1:ia(e),Ar(t,e<0?0:e,r)):[]},n.dropRight=function(t,e,n){var r=null==t?0:t.length;return r?(e=n||e===et?1:ia(e),e=r-e,Ar(t,0,e<0?0:e)):[]},n.dropRightWhile=function(t,e){return t&&t.length?Br(t,Ui(e,3),!0,!0):[]},n.dropWhile=function(t,e){return t&&t.length?Br(t,Ui(e,3),!0):[]},n.fill=function(t,e,n,r){var i=null==t?0:t.length;return i?(n&&"number"!=typeof n&&to(t,e,n)&&(n=0,r=i),xn(t,e,n,r)):[]},n.filter=function(t,e){return(Uc(t)?c:Tn)(t,Ui(e,3))},n.flatMap=function(t,e){return En(zo(t,e),1)},n.flatMapDeep=function(t,e){return En(zo(t,e),It)},n.flatMapDepth=function(t,e,n){return n=n===et?1:ia(n),En(zo(t,e),n)},n.flatten=Oo,n.flattenDeep=function(t){return(null==t?0:t.length)?En(t,It):[]},n.flattenDepth=function(t,e){return(null==t?0:t.length)?(e=e===et?1:ia(e),En(t,e)):[]},n.flip=function(t){return Ai(t,Ct)},n.flow=Cu,n.flowRight=xu,n.fromPairs=function(t){for(var e=-1,n=null==t?0:t.length,r={};++e<n;){var i=t[e];r[i[0]]=i[1]}return r},n.functions=function(t){return null==t?[]:jn(t,da(t))},n.functionsIn=function(t){return null==t?[]:jn(t,fa(t))},n.groupBy=xc,n.initial=function(t){return(null==t?0:t.length)?Ar(t,0,-1):[]},n.intersection=oc,n.intersectionBy=ac,n.intersectionWith=sc,n.invert=ru,n.invertBy=iu,n.invokeMap=Oc,n.iteratee=ya,n.keyBy=Sc,n.keys=da,n.keysIn=fa,n.map=zo,n.mapKeys=function(t,e){var n={};return e=Ui(e,3),In(t,function(t,r,i){sn(n,e(t,r,i),t)}),n},n.mapValues=function(t,e){var n={};return e=Ui(e,3),In(t,function(t,r,i){sn(n,r,e(t,r,i))}),n},n.matches=function(t){return ur(fn(t,ct))},n.matchesProperty=function(t,e){return lr(t,fn(e,ct))},n.memoize=Ho,n.merge=au,n.mergeWith=su,n.method=Ou,n.methodOf=Su,n.mixin=wa,n.negate=Fo,n.nthArg=function(t){return t=ia(t),xr(function(e){return hr(e,t)})},n.omit=cu,n.omitBy=function(t,e){return ha(t,Fo(Ui(e)))},n.once=function(t){return Po(2,t)},n.orderBy=function(t,e,n,r){return null==t?[]:(Uc(e)||(e=null==e?[]:[e]),n=r?et:n,Uc(n)||(n=null==n?[]:[n]),pr(t,e,n))},n.over=Tu,n.overArgs=Nc,n.overEvery=Eu,n.overSome=Au,n.partial=Mc,n.partialRight=zc,n.partition=Tc,n.pick=uu,n.pickBy=ha,n.property=xa,n.propertyOf=function(t){return function(e){return null==t?et:Nn(t,e)}},n.pull=cc,n.pullAll=Eo,n.pullAllBy=function(t,e,n){return t&&t.length&&e&&e.length?_r(t,e,Ui(n,2)):t},n.pullAllWith=function(t,e,n){return t&&t.length&&e&&e.length?_r(t,e,et,n):t},n.pullAt=uc,n.range=Iu,n.rangeRight=ku,n.rearg=Dc,n.reject=function(t,e){return(Uc(t)?c:Tn)(t,Fo(Ui(e,3)))},n.remove=function(t,e){var n=[];if(!t||!t.length)return n;var r=-1,i=[],o=t.length;for(e=Ui(e,3);++r<o;){var a=t[r];e(a,r,t)&&(n.push(a),i.push(r))}return br(t,i),n},n.rest=function(t,e){if("function"!=typeof t)throw new Ma(it);return e=e===et?e:ia(e),xr(t,e)},n.reverse=Ao,n.sampleSize=function(t,e,n){return e=(n?to(t,e,n):e===et)?1:ia(e),(Uc(t)?Ze:Sr)(t,e)},n.set=function(t,e,n){return null==t?t:Tr(t,e,n)},n.setWith=function(t,e,n,r){return r="function"==typeof r?r:et,null==t?t:Tr(t,e,n,r)},n.shuffle=function(t){return(Uc(t)?Ke:Er)(t)},n.slice=function(t,e,n){var r=null==t?0:t.length;return r?(n&&"number"!=typeof n&&to(t,e,n)?(e=0,n=r):(e=null==e?0:ia(e),n=n===et?r:ia(n)),Ar(t,e,n)):[]},n.sortBy=Ec,n.sortedUniq=function(t){return t&&t.length?jr(t):[]},n.sortedUniqBy=function(t,e){return t&&t.length?jr(t,Ui(e,2)):[]},n.split=function(t,e,n){return n&&"number"!=typeof n&&to(t,e,n)&&(e=n=et),(n=n===et?Nt:n>>>0)?(t=ca(t),t&&("string"==typeof e||null!=e&&!$c(e))&&!(e=Mr(e))&&L(t)?$r(Y(t),0,n):t.split(e,n)):[]},n.spread=function(t,e){if("function"!=typeof t)throw new Ma(it);return e=null==e?0:ms(ia(e),0),xr(function(n){var i=n[e],o=$r(n,0,e);return i&&f(o,i),r(t,this,o)})},n.tail=function(t){var e=null==t?0:t.length;return e?Ar(t,1,e):[]},n.take=function(t,e,n){return t&&t.length?(e=n||e===et?1:ia(e),Ar(t,0,e<0?0:e)):[]},n.takeRight=function(t,e,n){var r=null==t?0:t.length;return r?(e=n||e===et?1:ia(e),e=r-e,Ar(t,e<0?0:e,r)):[]},n.takeRightWhile=function(t,e){return t&&t.length?Br(t,Ui(e,3),!1,!0):[]},n.takeWhile=function(t,e){return t&&t.length?Br(t,Ui(e,3)):[]},n.tap=function(t,e){return e(t),t},n.throttle=function(t,e,n){var r=!0,i=!0;if("function"!=typeof t)throw new Ma(it);return Qo(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),Uo(t,e,{leading:r,maxWait:e,trailing:i})},n.thru=jo,n.toArray=na,n.toPairs=lu,n.toPairsIn=du,n.toPath=function(t){return Uc(t)?d(t,_o):ea(t)?[t]:ni(ec(ca(t)))},n.toPlainObject=sa,n.transform=function(t,e,n){var r=Uc(t),i=r||Fc(t)||Wc(t);if(e=Ui(e,4),null==n){var a=t&&t.constructor;n=i?r?new a:[]:Qo(t)&&Wo(a)?Ps(Ya(t)):{}}return(i?o:In)(t,function(t,r,i){return e(n,t,r,i)}),n},n.unary=function(t){return Do(t,1)},n.union=lc,n.unionBy=dc,n.unionWith=fc,n.uniq=function(t){return t&&t.length?zr(t):[]},n.uniqBy=function(t,e){return t&&t.length?zr(t,Ui(e,2)):[]},n.uniqWith=function(t,e){return e="function"==typeof e?e:et,t&&t.length?zr(t,et,e):[]},n.unset=function(t,e){return null==t||Dr(t,e)},n.unzip=Io,n.unzipWith=ko,n.update=function(t,e,n){return null==t?t:Pr(t,e,qr(n))},n.updateWith=function(t,e,n,r){return r="function"==typeof r?r:et,null==t?t:Pr(t,e,qr(n),r)},n.values=pa,n.valuesIn=function(t){return null==t?[]:j(t,fa(t))},n.without=hc,n.words=va,n.wrap=function(t,e){return Mc(qr(e),t)},n.xor=pc,n.xorBy=mc,n.xorWith=gc,n.zip=vc,n.zipObject=function(t,e){return Hr(t||[],e||[],en)},n.zipObjectDeep=function(t,e){return Hr(t||[],e||[],Tr)},n.zipWith=_c,n.entries=lu,n.entriesIn=du,n.extend=Yc,n.extendWith=Zc,wa(n,n),n.add=Ru,n.attempt=yu,n.camelCase=fu,n.capitalize=ma,n.ceil=ju,n.clamp=function(t,e,n){return n===et&&(n=e,e=et),n!==et&&(n=(n=aa(n))===n?n:0),e!==et&&(e=(e=aa(e))===e?e:0),un(aa(t),e,n)},n.clone=function(t){return fn(t,lt)},n.cloneDeep=function(t){return fn(t,ct|lt)},n.cloneDeepWith=function(t,e){return e="function"==typeof e?e:et,fn(t,ct|lt,e)},n.cloneWith=function(t,e){return e="function"==typeof e?e:et,fn(t,lt,e)},n.conformsTo=function(t,e){return null==e||pn(t,e,da(e))},n.deburr=ga,n.defaultTo=function(t,e){return null==t||t!==t?e:t},n.divide=Nu,n.endsWith=function(t,e,n){t=ca(t),e=Mr(e);var r=t.length,i=n=n===et?r:un(ia(n),0,r);return(n-=e.length)>=0&&t.slice(n,i)==e},n.eq=qo,n.escape=function(t){return t=ca(t),t&&we.test(t)?t.replace(be,Fn):t},n.escapeRegExp=function(t){return t=ca(t),t&&Ie.test(t)?t.replace(Ae,"\\$&"):t},n.every=function(t,e,n){var r=Uc(t)?s:wn;return n&&to(t,e,n)&&(e=et),r(t,Ui(e,3))},n.find=wc,n.findIndex=Co,n.findKey=function(t,e){return _(t,Ui(e,3),In)},n.findLast=Cc,n.findLastIndex=xo,n.findLastKey=function(t,e){return _(t,Ui(e,3),kn)},n.floor=Mu,n.forEach=No,n.forEachRight=Mo,n.forIn=function(t,e){return null==t?t:Us(t,Ui(e,3),fa)},n.forInRight=function(t,e){return null==t?t:Hs(t,Ui(e,3),fa)},n.forOwn=function(t,e){return t&&In(t,Ui(e,3))},n.forOwnRight=function(t,e){return t&&kn(t,Ui(e,3))},n.get=ua,n.gt=Pc,n.gte=Bc,n.has=function(t,e){return null!=t&&Wi(t,e,Wn)},n.hasIn=la,n.head=So,n.identity=ba,n.includes=function(t,e,n,r){t=Vo(t)?t:pa(t),n=n&&!r?ia(n):0;var i=t.length;return n<0&&(n=ms(i+n,0)),ta(t)?n<=i&&t.indexOf(e,n)>-1:!!i&&y(t,e,n)>-1},n.indexOf=function(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=null==n?0:ia(n);return i<0&&(i=ms(r+i,0)),y(t,e,i)},n.inRange=function(t,e,n){return e=ra(e),n===et?(n=e,e=0):n=ra(n),t=aa(t),Xn(t,e,n)},n.invoke=ou,n.isArguments=Lc,n.isArray=Uc,n.isArrayBuffer=Hc,n.isArrayLike=Vo,n.isArrayLikeObject=$o,n.isBoolean=function(t){return!0===t||!1===t||Yo(t)&&$n(t)==Ut},n.isBuffer=Fc,n.isDate=qc,n.isElement=function(t){return Yo(t)&&1===t.nodeType&&!Ko(t)},n.isEmpty=function(t){if(null==t)return!0;if(Vo(t)&&(Uc(t)||"string"==typeof t||"function"==typeof t.splice||Fc(t)||Wc(t)||Lc(t)))return!t.length;var e=Qs(t);if(e==Gt||e==Zt)return!t.size;if(oo(t))return!or(t).length;for(var n in t)if(Ua.call(t,n))return!1;return!0},n.isEqual=function(t,e){return tr(t,e)},n.isEqualWith=function(t,e,n){var r=(n="function"==typeof n?n:et)?n(t,e):et;return r===et?tr(t,e,et,n):!!r},n.isError=Go,n.isFinite=function(t){return"number"==typeof t&&fs(t)},n.isFunction=Wo,n.isInteger=Jo,n.isLength=Xo,n.isMap=Vc,n.isMatch=function(t,e){return t===e||nr(t,e,Fi(e))},n.isMatchWith=function(t,e,n){return n="function"==typeof n?n:et,nr(t,e,Fi(e),n)},n.isNaN=function(t){return Zo(t)&&t!=+t},n.isNative=function(t){if(Ys(t))throw new Aa(rt);return rr(t)},n.isNil=function(t){return null==t},n.isNull=function(t){return null===t},n.isNumber=Zo,n.isObject=Qo,n.isObjectLike=Yo,n.isPlainObject=Ko,n.isRegExp=$c,n.isSafeInteger=function(t){return Jo(t)&&t>=-kt&&t<=kt},n.isSet=Gc,n.isString=ta,n.isSymbol=ea,n.isTypedArray=Wc,n.isUndefined=function(t){return t===et},n.isWeakMap=function(t){return Yo(t)&&Qs(t)==ne},n.isWeakSet=function(t){return Yo(t)&&$n(t)==re},n.join=function(t,e){return null==t?"":hs.call(t,e)},n.kebabCase=hu,n.last=To,n.lastIndexOf=function(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=r;return n!==et&&(i=(i=ia(n))<0?ms(r+i,0):gs(i,r-1)),e===e?X(t,e,i):b(t,C,i,!0)},n.lowerCase=pu,n.lowerFirst=mu,n.lt=Jc,n.lte=Xc,n.max=function(t){return t&&t.length?Cn(t,ba,Gn):et},n.maxBy=function(t,e){return t&&t.length?Cn(t,Ui(e,2),Gn):et},n.mean=function(t){return x(t,ba)},n.meanBy=function(t,e){return x(t,Ui(e,2))},n.min=function(t){return t&&t.length?Cn(t,ba,sr):et},n.minBy=function(t,e){return t&&t.length?Cn(t,Ui(e,2),sr):et},n.stubArray=Oa,n.stubFalse=Sa,n.stubObject=function(){return{}},n.stubString=function(){return""},n.stubTrue=function(){return!0},n.multiply=zu,n.nth=function(t,e){return t&&t.length?hr(t,ia(e)):et},n.noConflict=function(){return An._===this&&(An._=$a),this},n.noop=Ca,n.now=Ac,n.pad=function(t,e,n){t=ca(t);var r=(e=ia(e))?Q(t):0;if(!e||r>=e)return t;var i=(e-r)/2;return wi(us(i),n)+t+wi(cs(i),n)},n.padEnd=function(t,e,n){t=ca(t);var r=(e=ia(e))?Q(t):0;return e&&r<e?t+wi(e-r,n):t},n.padStart=function(t,e,n){t=ca(t);var r=(e=ia(e))?Q(t):0;return e&&r<e?wi(e-r,n)+t:t},n.parseInt=function(t,e,n){return n||null==e?e=0:e&&(e=+e),_s(ca(t).replace(Re,""),e||0)},n.random=function(t,e,n){if(n&&"boolean"!=typeof n&&to(t,e,n)&&(e=n=et),n===et&&("boolean"==typeof e?(n=e,e=et):"boolean"==typeof t&&(n=t,t=et)),t===et&&e===et?(t=0,e=1):(t=ra(t),e===et?(e=t,t=0):e=ra(e)),t>e){var r=t;t=e,e=r}if(n||t%1||e%1){var i=bs();return gs(t+i*(e-t+On("1e-"+((i+"").length-1))),e)}return yr(t,e)},n.reduce=function(t,e,n){var r=Uc(t)?h:T,i=arguments.length<3;return r(t,Ui(e,4),n,i,Bs)},n.reduceRight=function(t,e,n){var r=Uc(t)?p:T,i=arguments.length<3;return r(t,Ui(e,4),n,i,Ls)},n.repeat=function(t,e,n){return e=(n?to(t,e,n):e===et)?1:ia(e),Cr(ca(t),e)},n.replace=function(){var t=arguments,e=ca(t[0]);return t.length<3?e:e.replace(t[1],t[2])},n.result=function(t,e,n){var r=-1,i=(e=Vr(e,t)).length;for(i||(i=1,t=et);++r<i;){var o=null==t?et:t[_o(e[r])];o===et&&(r=i,o=n),t=Wo(o)?o.call(t):o}return t},n.round=Du,n.runInContext=t,n.sample=function(t){return(Uc(t)?Ye:Or)(t)},n.size=function(t){if(null==t)return 0;if(Vo(t))return ta(t)?Q(t):t.length;var e=Qs(t);return e==Gt||e==Zt?t.size:or(t).length},n.snakeCase=gu,n.some=function(t,e,n){var r=Uc(t)?m:Ir;return n&&to(t,e,n)&&(e=et),r(t,Ui(e,3))},n.sortedIndex=function(t,e){return kr(t,e)},n.sortedIndexBy=function(t,e,n){return Rr(t,e,Ui(n,2))},n.sortedIndexOf=function(t,e){var n=null==t?0:t.length;if(n){var r=kr(t,e);if(r<n&&qo(t[r],e))return r}return-1},n.sortedLastIndex=function(t,e){return kr(t,e,!0)},n.sortedLastIndexBy=function(t,e,n){return Rr(t,e,Ui(n,2),!0)},n.sortedLastIndexOf=function(t,e){if(null==t?0:t.length){var n=kr(t,e,!0)-1;if(qo(t[n],e))return n}return-1},n.startCase=vu,n.startsWith=function(t,e,n){return t=ca(t),n=null==n?0:un(ia(n),0,t.length),e=Mr(e),t.slice(n,n+e.length)==e},n.subtract=Pu,n.sum=function(t){return t&&t.length?A(t,ba):0},n.sumBy=function(t,e){return t&&t.length?A(t,Ui(e,2)):0},n.template=function(t,e,r){var i=n.templateSettings;r&&to(t,e,r)&&(e=et),t=ca(t),e=Zc({},e,i,Ii);var o,a,s=Zc({},e.imports,i.imports,Ii),c=da(s),u=j(s,c),l=0,d=e.interpolate||Ge,f="__p += '",h=ja((e.escape||Ge).source+"|"+d.source+"|"+(d===Oe?Be:Ge).source+"|"+(e.evaluate||Ge).source+"|$","g"),p="//# sourceURL="+("sourceURL"in e?e.sourceURL:"lodash.templateSources["+ ++vn+"]")+"\n";t.replace(h,function(e,n,r,i,s,c){return r||(r=i),f+=t.slice(l,c).replace(We,P),n&&(o=!0,f+="' +\n__e("+n+") +\n'"),s&&(a=!0,f+="';\n"+s+";\n__p += '"),r&&(f+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),l=c+e.length,e}),f+="';\n";var m=e.variable;m||(f="with (obj) {\n"+f+"\n}\n"),f=(a?f.replace(me,""):f).replace(ge,"$1").replace(ve,"$1;"),f="function("+(m||"obj")+") {\n"+(m?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(o?", __e = _.escape":"")+(a?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+f+"return __p\n}";var g=yu(function(){return Ia(c,p+"return "+f).apply(et,u)});if(g.source=f,Go(g))throw g;return g},n.times=function(t,e){if((t=ia(t))<1||t>kt)return[];var n=Nt,r=gs(t,Nt);e=Ui(e),t-=Nt;for(var i=I(r,e);++n<t;)e(n);return i},n.toFinite=ra,n.toInteger=ia,n.toLength=oa,n.toLower=function(t){return ca(t).toLowerCase()},n.toNumber=aa,n.toSafeInteger=function(t){return t?un(ia(t),-kt,kt):0===t?t:0},n.toString=ca,n.toUpper=function(t){return ca(t).toUpperCase()},n.trim=function(t,e,n){if((t=ca(t))&&(n||e===et))return t.replace(ke,"");if(!t||!(e=Mr(e)))return t;var r=Y(t),i=Y(e);return $r(r,M(r,i),z(r,i)+1).join("")},n.trimEnd=function(t,e,n){if((t=ca(t))&&(n||e===et))return t.replace(je,"");if(!t||!(e=Mr(e)))return t;var r=Y(t);return $r(r,0,z(r,Y(e))+1).join("")},n.trimStart=function(t,e,n){if((t=ca(t))&&(n||e===et))return t.replace(Re,"");if(!t||!(e=Mr(e)))return t;var r=Y(t);return $r(r,M(r,Y(e))).join("")},n.truncate=function(t,e){var n=xt,r=Ot;if(Qo(e)){var i="separator"in e?e.separator:i;n="length"in e?ia(e.length):n,r="omission"in e?Mr(e.omission):r}var o=(t=ca(t)).length;if(L(t)){var a=Y(t);o=a.length}if(n>=o)return t;var s=n-Q(r);if(s<1)return r;var c=a?$r(a,0,s).join(""):t.slice(0,s);if(i===et)return c+r;if(a&&(s+=c.length-s),$c(i)){if(t.slice(s).search(i)){var u,l=c;for(i.global||(i=ja(i.source,ca(Le.exec(i))+"g")),i.lastIndex=0;u=i.exec(l);)var d=u.index;c=c.slice(0,d===et?s:d)}}else if(t.indexOf(Mr(i),s)!=s){var f=c.lastIndexOf(i);f>-1&&(c=c.slice(0,f))}return c+r},n.unescape=function(t){return t=ca(t),t&&ye.test(t)?t.replace(_e,qn):t},n.uniqueId=function(t){var e=++Ha;return ca(t)+e},n.upperCase=_u,n.upperFirst=bu,n.each=No,n.eachRight=Mo,n.first=So,wa(n,function(){var t={};return In(n,function(e,r){Ua.call(n.prototype,r)||(t[r]=e)}),t}(),{chain:!1}),n.VERSION="4.17.5",o(["bind","bindKey","curry","curryRight","partial","partialRight"],function(t){n[t].placeholder=n}),o(["drop","take"],function(t,e){J.prototype[t]=function(n){n=n===et?1:ms(ia(n),0);var r=this.__filtered__&&!e?new J(this):this.clone();return r.__filtered__?r.__takeCount__=gs(n,r.__takeCount__):r.__views__.push({size:gs(n,Nt),type:t+(r.__dir__<0?"Right":"")}),r},J.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()}}),o(["filter","map","takeWhile"],function(t,e){var n=e+1,r=n==Et||3==n;J.prototype[t]=function(t){var e=this.clone();return e.__iteratees__.push({iteratee:Ui(t,3),type:n}),e.__filtered__=e.__filtered__||r,e}}),o(["head","last"],function(t,e){var n="take"+(e?"Right":"");J.prototype[t]=function(){return this[n](1).value()[0]}}),o(["initial","tail"],function(t,e){var n="drop"+(e?"":"Right");J.prototype[t]=function(){return this.__filtered__?new J(this):this[n](1)}}),J.prototype.compact=function(){return this.filter(ba)},J.prototype.find=function(t){return this.filter(t).head()},J.prototype.findLast=function(t){return this.reverse().find(t)},J.prototype.invokeMap=xr(function(t,e){return"function"==typeof t?new J(this):this.map(function(n){return Zn(n,t,e)})}),J.prototype.reject=function(t){return this.filter(Fo(Ui(t)))},J.prototype.slice=function(t,e){t=ia(t);var n=this;return n.__filtered__&&(t>0||e<0)?new J(n):(t<0?n=n.takeRight(-t):t&&(n=n.drop(t)),e!==et&&(n=(e=ia(e))<0?n.dropRight(-e):n.take(e-t)),n)},J.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},J.prototype.toArray=function(){return this.take(Nt)},In(J.prototype,function(t,e){var r=/^(?:filter|find|map|reject)|While$/.test(e),i=/^(?:head|last)$/.test(e),o=n[i?"take"+("last"==e?"Right":""):e],a=i||/^find/.test(e);o&&(n.prototype[e]=function(){var e=this.__wrapped__,s=i?[1]:arguments,c=e instanceof J,u=s[0],l=c||Uc(e),d=function(t){var e=o.apply(n,f([t],s));return i&&h?e[0]:e};l&&r&&"function"==typeof u&&1!=u.length&&(c=l=!1);var h=this.__chain__,p=!!this.__actions__.length,m=a&&!h,g=c&&!p;if(!a&&l){e=g?e:new J(this);var v=t.apply(e,s);return v.__actions__.push({func:jo,args:[d],thisArg:et}),new S(v,h)}return m&&g?t.apply(this,s):(v=this.thru(d),m?i?v.value()[0]:v.value():v)})}),o(["pop","push","shift","sort","splice","unshift"],function(t){var e=za[t],r=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",i=/^(?:pop|shift)$/.test(t);n.prototype[t]=function(){var t=arguments;if(i&&!this.__chain__){var n=this.value();return e.apply(Uc(n)?n:[],t)}return this[r](function(n){return e.apply(Uc(n)?n:[],t)})}}),In(J.prototype,function(t,e){var r=n[e];if(r){var i=r.name+"";(As[i]||(As[i]=[])).push({name:e,func:r})}}),As[vi(et,pt).name]=[{name:"wrapper",func:et}],J.prototype.clone=function(){var t=new J(this.__wrapped__);return t.__actions__=ni(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=ni(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=ni(this.__views__),t},J.prototype.reverse=function(){if(this.__filtered__){var t=new J(this);t.__dir__=-1,t.__filtered__=!0}else(t=this.clone()).__dir__*=-1;return t},J.prototype.value=function(){var t=this.__wrapped__.value(),e=this.__dir__,n=Uc(t),r=e<0,i=n?t.length:0,o=$i(0,i,this.__views__),a=o.start,s=o.end,c=s-a,u=r?s:a-1,l=this.__iteratees__,d=l.length,f=0,h=gs(c,this.__takeCount__);if(!n||!r&&i==c&&h==c)return Lr(t,this.__actions__);var p=[];t:for(;c--&&f<h;){for(var m=-1,g=t[u+=e];++m<d;){var v=l[m],_=v.iteratee,b=v.type,y=_(g);if(b==At)g=y;else if(!y){if(b==Et)continue t;break t}}p[f++]=g}return p},n.prototype.at=bc,n.prototype.chain=function(){return Ro(this)},n.prototype.commit=function(){return new S(this.value(),this.__chain__)},n.prototype.next=function(){this.__values__===et&&(this.__values__=na(this.value()));var t=this.__index__>=this.__values__.length;return{done:t,value:t?et:this.__values__[this.__index__++]}},n.prototype.plant=function(t){for(var e,n=this;n instanceof g;){var r=wo(n);r.__index__=0,r.__values__=et,e?i.__wrapped__=r:e=r;var i=r;n=n.__wrapped__}return i.__wrapped__=t,e},n.prototype.reverse=function(){var t=this.__wrapped__;if(t instanceof J){var e=t;return this.__actions__.length&&(e=new J(this)),(e=e.reverse()).__actions__.push({func:jo,args:[Ao],thisArg:et}),new S(e,this.__chain__)}return this.thru(Ao)},n.prototype.toJSON=n.prototype.valueOf=n.prototype.value=function(){return Lr(this.__wrapped__,this.__actions__)},n.prototype.first=n.prototype.head,ns&&(n.prototype[ns]=function(){return this}),n}();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(An._=Vn,define(function(){return Vn})):kn?((kn.exports=Vn)._=Vn,In._=Vn):An._=Vn}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],31:[function(e,n,r){!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof n&&n.exports?n.exports=e():t.Parsimmon=e()}(this,function(){"use strict";function e(t){if(!(this instanceof e))return new e(t);this._=t}function n(t){return t instanceof e}function r(t,e){return{status:!0,index:t,value:e,furthest:-1,expected:[]}}function i(t,e){return{status:!1,index:-1,value:null,furthest:t,expected:[e]}}function o(t,e){if(!e)return t;if(t.furthest>e.furthest)return t;var n=t.furthest===e.furthest?a(t.expected,e.expected):e.expected;return{status:t.status,index:t.index,value:t.value,furthest:e.furthest,expected:n}}function a(t,e){var n=t.length,r=e.length;if(0===n)return e;if(0===r)return t;for(var i={},o=0;o<n;o++)i[t[o]]=!0;for(var a=0;a<r;a++)i[e[a]]=!0;var s=[];for(var c in i)i.hasOwnProperty(c)&&s.push(c);return s.sort(),s}function s(t){if(!n(t))throw new Error("not a parser: "+t)}function c(t){if("number"!=typeof t)throw new Error("not a number: "+t)}function u(t){if(!(t instanceof RegExp))throw new Error("not a regexp: "+t);for(var e=y(t),n=0;n<e.length;n++){var r=e.charAt(n);if("i"!=r&&"m"!=r&&"u"!=r)throw new Error('unsupported regexp flag "'+r+'": '+t)}}function l(t){if("function"!=typeof t)throw new Error("not a function: "+t)}function d(t){if("string"!=typeof t)throw new Error("not a string: "+t)}function f(t){return 1===t.length?t[0]:"one of "+t.join(", ")}function h(t,e){var n=e.index,r=n.offset;if(r===t.length)return", got the end of the input";var i=r>0?"'...":"'",o=t.length-r>12?"...'":"'";return" at line "+n.line+" column "+n.column+", got "+i+t.slice(r,r+12)+o}function p(t,e){return"expected "+f(e.expected)+h(t,e)}function m(){for(var t=[].slice.call(arguments),n=t.length,i=0;i<n;i+=1)s(t[i]);return e(function(e,i){for(var a,s=new Array(n),c=0;c<n;c+=1){if(!(a=o(t[c]._(e,i),a)).status)return a;s[c]=a.value,i=a.index}return o(r(i,s),a)})}function g(){var t=[].slice.call(arguments);if(0===t.length)throw new Error("seqMap needs at least one argument");var e=t.pop();return l(e),m.apply(null,t).map(function(t){return e.apply(null,t)})}function v(){var t=[].slice.call(arguments),n=t.length;if(0===n)return O("zero alternates");for(var r=0;r<n;r+=1)s(t[r]);return e(function(e,n){for(var r,i=0;i<t.length;i+=1)if((r=o(t[i]._(e,n),r)).status)return r;return r})}function _(t,e){s(t),s(e);var n=e.then(t).many();return t.chain(function(t){return n.map(function(e){return[t].concat(e)})})}function b(t){d(t);var n="'"+t+"'";return e(function(e,o){var a=o+t.length,s=e.slice(o,a);return s===t?r(a,s):i(o,n)})}function y(t){var e=""+t;return e.slice(e.lastIndexOf("/")+1)}function w(t){return RegExp("^(?:"+t.source+")",y(t))}function C(t,n){u(t),arguments.length>=2?c(n):n=0;var o=w(t),a=""+t;return e(function(t,e){var s=o.exec(t.slice(e));if(s){var c=s[0],u=s[n];if(null!=u)return r(e+c.length,u)}return i(e,a)})}function x(t){return e(function(e,n){return r(n,t)})}function O(t){return e(function(e,n){return i(n,t)})}function S(t){if(n(t))return e(function(e,n){var r=t._(e,n);return r.index=n,r.value="",r});if("string"==typeof t)return S(b(t));if(t instanceof RegExp)return S(C(t));throw new Error("not a string, regexp, or parser: "+t)}function T(t){return l(t),e(function(e,n){var o=e.charAt(n);return n<e.length&&t(o)?r(n+1,o):i(n,"a character matching "+t)})}function E(t,e){var n=t.slice(0,e).split("\n");return{offset:e,line:n.length,column:n[n.length-1].length+1}}function A(){return O("fantasy-land/empty")}var I=e.prototype;I.parse=function(t){if("string"!=typeof t)throw new Error(".parse must be called with a string as its argument");var e=this.skip(j)._(t,0);return e.status?{status:!0,value:e.value}:{status:!1,index:E(t,e.furthest),expected:e.expected}},I.tryParse=function(t){var e=this.parse(t);if(e.status)return e.value;var n=p(t,e),r=new Error(n);throw r.type="ParsimmonError",r.result=e,r},I.or=function(t){return v(this,t)},I.then=function(t){if("function"==typeof t)throw new Error("chaining features of .then are no longer supported, use .chain instead");return s(t),m(this,t).map(function(t){return t[1]})},I.many=function(){var n=this;return e(function(e,i){for(var a=[],s=t;;){if(!(s=o(n._(e,i),s)).status)return o(r(i,a),s);i=s.index,a.push(s.value)}})},I.times=function(n,i){var a=this;return arguments.length<2&&(i=n),c(n),c(i),e(function(e,s){for(var c=[],u=t,l=t,d=0;d<n;d+=1){if(u=a._(e,s),l=o(u,l),!u.status)return l;s=u.index,c.push(u.value)}for(;d<i&&(u=a._(e,s),l=o(u,l),u.status);d+=1)s=u.index,c.push(u.value);return o(r(s,c),l)})},I.result=function(t){return this.map(function(){return t})},I.atMost=function(t){return this.times(0,t)},I.atLeast=function(t){return g(this.times(t),this.many(),function(t,e){return t.concat(e)})},I.map=function(t){l(t);var n=this;return e(function(e,i){var a=n._(e,i);return a.status?o(r(a.index,t(a.value)),a):a})},I["fantasy-land/map"]=I.map,I.skip=function(t){return m(this,t).map(function(t){return t[0]})},I.mark=function(){return g(N,this,N,function(t,e,n){return{start:t,value:e,end:n}})},I.lookahead=function(t){return this.skip(S(t))},I.desc=function(t){var n=this;return e(function(e,r){var i=n._(e,r);return i.status||(i.expected=[t]),i})},I.fallback=function(t){return this.or(x(t))};var k=e(function(t,e){return e>=t.length?i(e,"any character"):r(e+1,t.charAt(e))}),R=e(function(t,e){return r(t.length,t.slice(e))}),j=e(function(t,e){return e<t.length?i(e,"EOF"):r(e,null)}),N=e(function(t,e){return r(e,E(t,e))});I.concat=I.or,I["fantasy-land/concat"]=I.concat,I.empty=A,I["fantasy-land/empty"]=I.empty,I.of=x,I["fantasy-land/of"]=I.of,I.ap=function(t){return g(t,this,function(t,e){return t(e)})},I["fantasy-land/ap"]=I.ap,I.chain=function(t){var n=this;return e(function(e,r){var i=n._(e,r);return i.status?o(t(i.value)._(e,i.index),i):i})},I["fantasy-land/chain"]=I.chain;var M=C(/[0-9]/).desc("a digit"),z=C(/[0-9]*/).desc("optional digits"),D=C(/[a-z]/i).desc("a letter"),P=C(/[a-z]*/i).desc("optional letters"),B=C(/\s*/).desc("optional whitespace"),L=C(/\s+/).desc("whitespace");return e.all=R,e.alt=v,e.any=k,e.custom=function(t){return e(t(r,i))},e.digit=M,e.digits=z,e.eof=j,e.fail=O,e.formatError=p,e.index=N,e.isParser=n,e.lazy=function(n,r){arguments.length<2&&(r=n,n=t);var i=e(function(t,e){return i._=r()._,i._(t,e)});return n?i.desc(n):i},e.letter=D,e.letters=P,e.lookahead=S,e.makeFailure=i,e.makeSuccess=r,e.noneOf=function(t){return T(function(e){return t.indexOf(e)<0})},e.oneOf=function(t){return T(function(e){return t.indexOf(e)>=0})},e.optWhitespace=B,e.Parser=e,e.regex=C,e.regexp=C,e.sepBy=function(t,e){return _(t,e).or(x([]))},e.sepBy1=_,e.seq=m,e.seqMap=g,e.string=b,e.succeed=x,e.takeWhile=function(t){return l(t),e(function(e,n){for(var i=n;i<e.length&&t(e.charAt(i));)i++;return r(i,e.slice(n,i))})},e.test=T,e.whitespace=L,e.empty=A,e["fantasy-land/empty"]=A,e.of=x,e["fantasy-land/of"]=x,e})},{}],32:[function(e,n,r){(function(e){"use strict";!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof r?n.exports=e():t.store=e()}(this,function(){var n,r={},i="undefined"!=typeof window?window:e,o=i.document,a="localStorage";if(r.disabled=!1,r.version="1.3.20",r.set=function(t,e){},r.get=function(t,e){},r.has=function(e){return r.get(e)!==t},r.remove=function(t){},r.clear=function(){},r.transact=function(t,e,n){null==n&&(n=e,e=null),null==e&&(e={});var i=r.get(t,e);n(i),r.set(t,i)},r.getAll=function(){},r.forEach=function(){},r.serialize=function(t){return JSON.stringify(t)},r.deserialize=function(e){if("string"!=typeof e)return t;try{return JSON.parse(e)}catch(n){return e||t}},function(){try{return a in i&&i[a]}catch(t){return!1}}())n=i[a],r.set=function(e,i){return i===t?r.remove(e):(n.setItem(e,r.serialize(i)),i)},r.get=function(e,i){var o=r.deserialize(n.getItem(e));return o===t?i:o},r.remove=function(t){n.removeItem(t)},r.clear=function(){n.clear()},r.getAll=function(){var t={};return r.forEach(function(e,n){t[e]=n}),t},r.forEach=function(t){for(var e=0;e<n.length;e++){var i=n.key(e);t(i,r.get(i))}};else if(o&&o.documentElement.addBehavior){var s,c;try{(c=new ActiveXObject("htmlfile")).open(),c.write('<script>document.w=window<\/script><iframe src="/favicon.ico"></iframe>'),c.close(),s=c.w.frames[0].document,n=s.createElement("div")}catch(t){n=o.createElement("div"),s=o.body}var u=function(t){return function(){var e=Array.prototype.slice.call(arguments,0);e.unshift(n),s.appendChild(n),n.addBehavior("#default#userData"),n.load(a);var i=t.apply(r,e);return s.removeChild(n),i}},l=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g"),d=function(t){return t.replace(/^d/,"___$&").replace(l,"___")};r.set=u(function(e,n,i){return n=d(n),i===t?r.remove(n):(e.setAttribute(n,r.serialize(i)),e.save(a),i)}),r.get=u(function(e,n,i){n=d(n);var o=r.deserialize(e.getAttribute(n));return o===t?i:o}),r.remove=u(function(t,e){e=d(e),t.removeAttribute(e),t.save(a)}),r.clear=u(function(t){var e=t.XMLDocument.documentElement.attributes;t.load(a);for(var n=e.length-1;n>=0;n--)t.removeAttribute(e[n].name);t.save(a)}),r.getAll=function(t){var e={};return r.forEach(function(t,n){e[t]=n}),e},r.forEach=u(function(t,e){for(var n,i=t.XMLDocument.documentElement.attributes,o=0;n=i[o];++o)e(n.name,r.deserialize(t.getAttribute(n.name)))})}try{var f="__storejs__";r.set(f,f),r.get(f)!=f&&(r.disabled=!0),r.remove(f)}catch(t){r.disabled=!0}return r.enabled=!r.disabled,r})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],33:[function(t,e,n){!function(t,r){"use strict";var i="model",o="name",a="type",s="vendor",c="version",u="mobile",l="tablet",d={extend:function(t,e){var n={};for(var r in t)e[r]&&e[r].length%2==0?n[r]=e[r].concat(t[r]):n[r]=t[r];return n},has:function(t,e){return"string"==typeof t&&-1!==e.toLowerCase().indexOf(t.toLowerCase())},lowerize:function(t){return t.toLowerCase()},major:function(t){return"string"==typeof t?t.replace(/[^\d\.]/g,"").split(".")[0]:void 0},trim:function(t){return t.replace(/^[\s\uFEFF]+|[\s\uFEFF]+$/g,"")}},f={rgx:function(t,e){for(var n,r,i,o,a,s,c=0;c<e.length&&!a;){var u=e[c],l=e[c+1];for(n=r=0;n<u.length&&!a;)if(a=u[n++].exec(t))for(i=0;i<l.length;i++)s=a[++r],"object"==typeof(o=l[i])&&o.length>0?2==o.length?"function"==typeof o[1]?this[o[0]]=o[1].call(this,s):this[o[0]]=o[1]:3==o.length?"function"!=typeof o[1]||o[1].exec&&o[1].test?this[o[0]]=s?s.replace(o[1],o[2]):void 0:this[o[0]]=s?o[1].call(this,s,o[2]):void 0:4==o.length&&(this[o[0]]=s?o[3].call(this,s.replace(o[1],o[2])):void 0):this[o]=s||void 0;c+=2}},str:function(t,e){for(var n in e)if("object"==typeof e[n]&&e[n].length>0){for(var r=0;r<e[n].length;r++)if(d.has(e[n][r],t))return"?"===n?void 0:n}else if(d.has(e[n],t))return"?"===n?void 0:n;return t}},h={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2000:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},p={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[o,c],[/(opios)[\/\s]+([\w\.]+)/i],[[o,"Opera Mini"],c],[/\s(opr)\/([\w\.]+)/i],[[o,"Opera"],c],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser)\/([\w\.-]+)/i],[o,c],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[o,"IE"],c],[/(edge)\/((\d+)?[\w\.]+)/i],[o,c],[/(yabrowser)\/([\w\.]+)/i],[[o,"Yandex"],c],[/(puffin)\/([\w\.]+)/i],[[o,"Puffin"],c],[/((?:[\s\/])uc?\s?browser|(?:juc.+)ucweb)[\/\s]?([\w\.]+)/i],[[o,"UCBrowser"],c],[/(comodo_dragon)\/([\w\.]+)/i],[[o,/_/g," "],c],[/(micromessenger)\/([\w\.]+)/i],[[o,"WeChat"],c],[/(QQ)\/([\d\.]+)/i],[o,c],[/m?(qqbrowser)[\/\s]?([\w\.]+)/i],[o,c],[/xiaomi\/miuibrowser\/([\w\.]+)/i],[c,[o,"MIUI Browser"]],[/;fbav\/([\w\.]+);/i],[c,[o,"Facebook"]],[/headlesschrome(?:\/([\w\.]+)|\s)/i],[c,[o,"Chrome Headless"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[[o,/(.+)/,"$1 WebView"],c],[/((?:oculus|samsung)browser)\/([\w\.]+)/i],[[o,/(.+(?:g|us))(.+)/,"$1 $2"],c],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)*/i],[c,[o,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i],[o,c],[/(dolfin)\/([\w\.]+)/i],[[o,"Dolphin"],c],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[o,"Chrome"],c],[/(coast)\/([\w\.]+)/i],[[o,"Opera Coast"],c],[/fxios\/([\w\.-]+)/i],[c,[o,"Firefox"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[c,[o,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[c,o],[/webkit.+?(gsa)\/([\w\.]+).+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[[o,"GSA"],c],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[o,[c,f.str,h.browser.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[o,c],[/(navigator|netscape)\/([\w\.-]+)/i],[[o,"Netscape"],c],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/([\w\.-]+)/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]+)*/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[o,c]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[["architecture","amd64"]],[/(ia32(?=;))/i],[["architecture",d.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[["architecture","ia32"]],[/windows\s(ce|mobile);\sppc;/i],[["architecture","arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[["architecture",/ower/,"",d.lowerize]],[/(sun4\w)[;\)]/i],[["architecture","sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+;))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[["architecture",d.lowerize]]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[i,s,[a,l]],[/applecoremedia\/[\w\.]+ \((ipad)/],[i,[s,"Apple"],[a,l]],[/(apple\s{0,1}tv)/i],[[i,"Apple TV"],[s,"Apple"]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(hp).+(tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[s,i,[a,l]],[/(kf[A-z]+)\sbuild\/[\w\.]+.*silk\//i],[i,[s,"Amazon"],[a,l]],[/(sd|kf)[0349hijorstuw]+\sbuild\/[\w\.]+.*silk\//i],[[i,f.str,h.device.amazon.model],[s,"Amazon"],[a,u]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[i,s,[a,u]],[/\((ip[honed|\s\w*]+);/i],[i,[s,"Apple"],[a,u]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[\s_-]?([\w-]+)*/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[s,i,[a,u]],[/\(bb10;\s(\w+)/i],[i,[s,"BlackBerry"],[a,u]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7|padfone)/i],[i,[s,"Asus"],[a,l]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[s,"Sony"],[i,"Xperia Tablet"],[a,l]],[/android.+\s([c-g]\d{4}|so[-l]\w+)\sbuild\//i],[i,[s,"Sony"],[a,u]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[s,i,[a,"console"]],[/android.+;\s(shield)\sbuild/i],[i,[s,"Nvidia"],[a,"console"]],[/(playstation\s[34portablevi]+)/i],[i,[s,"Sony"],[a,"console"]],[/(sprint\s(\w+))/i],[[s,f.str,h.device.sprint.vendor],[i,f.str,h.device.sprint.model],[a,u]],[/(lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[s,i,[a,l]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w+)*/i,/(alcatel|geeksphone|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]+)*/i],[s,[i,/_/g," "],[a,u]],[/(nexus\s9)/i],[i,[s,"HTC"],[a,l]],[/d\/huawei([\w\s-]+)[;\)]/i,/(nexus\s6p)/i],[i,[s,"Huawei"],[a,u]],[/(microsoft);\s(lumia[\s\w]+)/i],[s,i,[a,u]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[i,[s,"Microsoft"],[a,"console"]],[/(kin\.[onetw]{3})/i],[[i,/\./g," "],[s,"Microsoft"],[a,u]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?(:?\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w+)*/i,/(XT\d{3,4}) build\//i,/(nexus\s6)/i],[i,[s,"Motorola"],[a,u]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[i,[s,"Motorola"],[a,l]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[[s,d.trim],[i,d.trim],[a,"smarttv"]],[/hbbtv.+maple;(\d+)/i],[[i,/^/,"SmartTV"],[s,"Samsung"],[a,"smarttv"]],[/\(dtv[\);].+(aquos)/i],[i,[s,"Sharp"],[a,"smarttv"]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n\d+|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[s,"Samsung"],i,[a,l]],[/smart-tv.+(samsung)/i],[s,[a,"smarttv"],i],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-\w[\w\d]+))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)*/i,/sec-((sgh\w+))/i],[[s,"Samsung"],i,[a,u]],[/sie-(\w+)*/i],[i,[s,"Siemens"],[a,u]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]+)*/i],[[s,"Nokia"],i,[a,u]],[/android\s3\.[\s\w;-]{10}(a\d{3})/i],[i,[s,"Acer"],[a,l]],[/android.+([vl]k\-?\d{3})\s+build/i],[i,[s,"LG"],[a,l]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[s,"LG"],i,[a,l]],[/(lg) netcast\.tv/i],[s,i,[a,"smarttv"]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w+)*/i,/android.+lg(\-?[\d\w]+)\s+build/i],[i,[s,"LG"],[a,u]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[i,[s,"Lenovo"],[a,l]],[/linux;.+((jolla));/i],[s,i,[a,u]],[/((pebble))app\/[\d\.]+\s/i],[s,i,[a,"wearable"]],[/android.+;\s(oppo)\s?([\w\s]+)\sbuild/i],[s,i,[a,u]],[/crkey/i],[[i,"Chromecast"],[s,"Google"]],[/android.+;\s(glass)\s\d/i],[i,[s,"Google"],[a,"wearable"]],[/android.+;\s(pixel c)\s/i],[i,[s,"Google"],[a,l]],[/android.+;\s(pixel xl|pixel)\s/i],[i,[s,"Google"],[a,u]],[/android.+(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:one|one[\s_]plus|note lte)?[\s_]*(?:\d\w)?)\s+build/i,/android.+(redmi[\s\-_]*(?:note)?(?:[\s_]*[\w\s]+)?)\s+build/i],[[i,/_/g," "],[s,"Xiaomi"],[a,u]],[/android.+(mi[\s\-_]*(?:pad)?(?:[\s_]*[\w\s]+)?)\s+build/i],[[i,/_/g," "],[s,"Xiaomi"],[a,l]],[/android.+;\s(m[1-5]\snote)\sbuild/i],[i,[s,"Meizu"],[a,l]],[/android.+a000(1)\s+build/i],[i,[s,"OnePlus"],[a,u]],[/android.+[;\/]\s*(RCT[\d\w]+)\s+build/i],[i,[s,"RCA"],[a,l]],[/android.+[;\/]\s*(Venue[\d\s]*)\s+build/i],[i,[s,"Dell"],[a,l]],[/android.+[;\/]\s*(Q[T|M][\d\w]+)\s+build/i],[i,[s,"Verizon"],[a,l]],[/android.+[;\/]\s+(Barnes[&\s]+Noble\s+|BN[RT])(V?.*)\s+build/i],[[s,"Barnes & Noble"],i,[a,l]],[/android.+[;\/]\s+(TM\d{3}.*\b)\s+build/i],[i,[s,"NuVision"],[a,l]],[/android.+[;\/]\s*(zte)?.+(k\d{2})\s+build/i],[[s,"ZTE"],i,[a,l]],[/android.+[;\/]\s*(gen\d{3})\s+build.*49h/i],[i,[s,"Swiss"],[a,u]],[/android.+[;\/]\s*(zur\d{3})\s+build/i],[i,[s,"Swiss"],[a,l]],[/android.+[;\/]\s*((Zeki)?TB.*\b)\s+build/i],[i,[s,"Zeki"],[a,l]],[/(android).+[;\/]\s+([YR]\d{2}x?.*)\s+build/i,/android.+[;\/]\s+(Dragon[\-\s]+Touch\s+|DT)(.+)\s+build/i],[[s,"Dragon Touch"],i,[a,l]],[/android.+[;\/]\s*(NS-?.+)\s+build/i],[i,[s,"Insignia"],[a,l]],[/android.+[;\/]\s*((NX|Next)-?.+)\s+build/i],[i,[s,"NextBook"],[a,l]],[/android.+[;\/]\s*(Xtreme\_?)?(V(1[045]|2[015]|30|40|60|7[05]|90))\s+build/i],[[s,"Voice"],i,[a,u]],[/android.+[;\/]\s*(LVTEL\-?)?(V1[12])\s+build/i],[[s,"LvTel"],i,[a,u]],[/android.+[;\/]\s*(V(100MD|700NA|7011|917G).*\b)\s+build/i],[i,[s,"Envizen"],[a,l]],[/android.+[;\/]\s*(Le[\s\-]+Pan)[\s\-]+(.*\b)\s+build/i],[s,i,[a,l]],[/android.+[;\/]\s*(Trio[\s\-]*.*)\s+build/i],[i,[s,"MachSpeed"],[a,l]],[/android.+[;\/]\s*(Trinity)[\-\s]*(T\d{3})\s+build/i],[s,i,[a,l]],[/android.+[;\/]\s*TU_(1491)\s+build/i],[i,[s,"Rotor"],[a,l]],[/android.+(KS(.+))\s+build/i],[i,[s,"Amazon"],[a,l]],[/android.+(Gigaset)[\s\-]+(Q.+)\s+build/i],[s,i,[a,l]],[/\s(tablet|tab)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[[a,d.lowerize],s,i],[/(android.+)[;\/].+build/i],[i,[s,"Generic"]]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[c,[o,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[o,c],[/rv\:([\w\.]+).*(gecko)/i],[c,o]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[o,c],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s]+\w)*/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[o,[c,f.str,h.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[o,"Windows"],[c,f.str,h.os.windows.version]],[/\((bb)(10);/i],[[o,"BlackBerry"],c],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],[o,c],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[o,"Symbian"],c],[/\((series40);/i],[o],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[o,"Firefox OS"],c],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[o,c],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[o,"Chromium OS"],c],[/(sunos)\s?([\w\.]+\d)*/i],[[o,"Solaris"],c],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[o,c],[/(haiku)\s(\w+)/i],[o,c],[/cfnetwork\/.+darwin/i,/ip[honead]+(?:.*os\s([\w]+)\slike\smac|;\sopera)/i],[[c,/_/g,"."],[o,"iOS"]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,/(macintosh|mac(?=_powerpc)\s)/i],[[o,"Mac OS"],[c,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]+)*/i],[o,c]]},m=function(e,n){if("object"==typeof e&&(n=e,e=void 0),!(this instanceof m))return new m(e,n).getResult();var r=e||(t&&t.navigator&&t.navigator.userAgent?t.navigator.userAgent:""),i=n?d.extend(p,n):p;return this.getBrowser=function(){var t={name:void 0,version:void 0};return f.rgx.call(t,r,i.browser),t.major=d.major(t.version),t},this.getCPU=function(){var t={architecture:void 0};return f.rgx.call(t,r,i.cpu),t},this.getDevice=function(){var t={vendor:void 0,model:void 0,type:void 0};return f.rgx.call(t,r,i.device),t},this.getEngine=function(){var t={name:void 0,version:void 0};return f.rgx.call(t,r,i.engine),t},this.getOS=function(){var t={name:void 0,version:void 0};return f.rgx.call(t,r,i.os),t},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return r},this.setUA=function(t){return r=t,this},this};m.VERSION="0.7.17",m.BROWSER={NAME:o,MAJOR:"major",VERSION:c},m.CPU={ARCHITECTURE:"architecture"},m.DEVICE={MODEL:i,VENDOR:s,TYPE:a,CONSOLE:"console",MOBILE:u,SMARTTV:"smarttv",TABLET:l,WEARABLE:"wearable",EMBEDDED:"embedded"},m.ENGINE={NAME:o,VERSION:c},m.OS={NAME:o,VERSION:c},void 0!==n?(void 0!==e&&e.exports&&(n=e.exports=m),n.UAParser=m):"function"==typeof define&&define.amd?define(function(){return m}):t&&(t.UAParser=m);var g=t&&(t.jQuery||t.Zepto);if(void 0!==g){var v=new m;g.ua=v.getResult(),g.ua.get=function(){return v.getUA()},g.ua.set=function(t){v.setUA(t);var e=v.getResult();for(var n in e)g.ua[n]=e[n]}}}("object"==typeof window?window:this)},{}],34:[function(t,e,n){!function(t){function e(){}function n(t){a=[t]}function r(t,e,n){return t&&t.apply&&t.apply(e.context||e,n)}function i(t){return/\?/.test(t)?"&":"?"}function o(o){function h(t){X++||(Q(),V&&(T[G]={s:[t]}),U&&(t=U.apply(o,[t])),r(P,o,[t,w,o]),r(L,o,[o,w]))}function R(t){X++||(Q(),V&&t!=C&&(T[G]=t),r(B,o,[o,t]),r(L,o,[o,t]))}var j,N,M,z,D,P=(o=t.extend({},A,o)).success,B=o.error,L=o.complete,U=o.dataFilter,H=o.callbackParameter,F=o.callback,q=o.cache,V=o.pageCache,$=o.charset,G=o.url,W=o.data,J=o.timeout,X=0,Q=e;return O&&O(function(t){t.done(P).fail(B),P=t.resolve,B=t.reject}).promise(o),o.abort=function(){!X++&&Q()},!1===r(o.beforeSend,o,[o])||X?o:(G=G||u,W=W?"string"==typeof W?W:t.param(W,o.traditional):u,G+=W?i(G)+W:u,H&&(G+=i(G)+encodeURIComponent(H)+"=?"),!q&&!V&&(G+=i(G)+"_"+(new Date).getTime()+"="),G=G.replace(/=\?(&|$)/,"="+F+"$1"),V&&(j=T[G])?j.s?h(j.s[0]):R(j):(x[F]=n,M=t(y)[0],M.id=f+E++,$&&(M[c]=$),I&&I.version()<11.6?(z=t(y)[0]).text="document.getElementById('"+M.id+"')."+m+"()":M[s]=s,k&&(M.htmlFor=M.id,M.event=p),M[g]=M[m]=M[v]=function(t){if(!M[_]||!/i/.test(M[_])){try{M[p]&&M[p]()}catch(t){}t=a,a=0,t?h(t[0]):R(l)}},M.src=G,Q=function(t){D&&clearTimeout(D),M[v]=M[g]=M[m]=null,S[b](M),z&&S[b](z)},S[d](M,N=S.firstChild),z&&S[d](z,N),D=J>0&&setTimeout(function(){R(C)},J)),o)}var a,s="async",c="charset",u="",l="error",d="insertBefore",f="_jqjsp",h="on",p="onclick",m=h+l,g="onload",v="onreadystatechange",_="readyState",b="removeChild",y="<script>",w="success",C="timeout",x=window,O=t.Deferred,S=t("head")[0]||document.documentElement,T={},E=0,A={callback:f,url:location.href},I=x.opera,k=!!t("<div>").html("<!--[if IE]><i><![endif]-->").find("i").length;o.setup=function(e){t.extend(A,e)},t.jsonp=o}(iAdvize.$)},{}],35:[function(t,e,n){!function(t){function e(){}var n=t.callbacks={onScriptLoaded:e,onInvitationDisplayed:e,onChatDisplayed:e,onChatHidden:e,onChatButtonDisplayed:e,onCallButtonDisplayed:e,onVideoButtonDisplayed:e,onChatStarted:e,onChatEnded:e,onCallStarted:e,onCallEnded:e,onStatusChanged:e,onCallStatusChanged:e,onRuleStarted:e,onCookieSaved:e,onMessageReceived:e,onMessageSent:e,onAlertReceived:e,onOperatorWriting:e,onOperatorStopWriting:e,onVisitorWriting:e,onVisitorStopWriting:e,onOfferReceived:e,onLinkReceived:e,onCobrowsingRequested:e,onCobrowsingAccepted:e,onCobrowsingRefused:e,onCobrowsingStopped:e,onSatisfactionDisplayed:e,onSatisfactionAnswered:e,onVisitorTransferred:e,onVisitorCallboxDisplayed:e,onTargetingRuleTriggered:e},r={onInvitation:"onInvitationDisplayed",onC2cStatusChanged:"onCallStatusChanged",onOperatorMsg:"onMessageReceived",onVisitorMsg:"onMessageSent"};if("undefined"!=typeof iAdvizeCallbacks){var i=iAdvizeCallbacks;for(var o in i)"function"==typeof i[o]&&(n[o in r?r[o]:o]=function(t){return function(){try{i[t].apply(this,arguments)}catch(t){}}}(o))}}(iAdvize)},{}],36:[function(t,e,n){function r(t,e){return["sid="+e.website_id,"u="+e.vuid,"data="+encodeURIComponent(JSON.stringify(t)),"callback=?"].join("&")}function i(){}var o=t("lodash");e.exports=function(t,e){var n={},a={};n.onSave=function(t){this.saveData(t)},n.save=function(n){var o=n;o||(o=a,a={}),t.getJSON(e.chaturl+"rpc/jsonstore.php?"+r(o,e),i)};var s=o.debounce(n.save,1600);return n.saveData=function(t){o.each(t,function(t,e){a[e]=t}),s()},n}},{lodash:30}],37:[function(e,n,r){"use strict";n.exports=function(){var e={set:function(){},get:function(){},remove:function(){},clear:function(){}},n={},r=function(t){return JSON.stringify(t)},i=function(e){var n=void 0;if("string"!=typeof e)return t;try{n=JSON.parse(e)}catch(t){}return n};return window.sessionStorage?(e.set=function(t,e){try{window.sessionStorage.setItem(t,r(e))}catch(t){}},e.get=function(t){return i(window.sessionStorage.getItem(t))},e.remove=function(t){window.sessionStorage.removeItem(t)},e.clear=function(){window.sessionStorage.clear()}):(e.get=function(t){return n[t]},e.set=function(t,e){return n[t]=e},e.remove=function(t){delete n[t]},e.clear=function(){for(var t in n)delete n[t]}),e.addToItem=function(t,n){var r=e.get(t);r=r?r+n:n,e.set(t,r)},e.incrementItem=function(t){this.addToItem(t,1)},e.decrementItem=function(t){this.addToItem(t,-1)},e}},{}],38:[function(t,e,n){e.exports=function(t,e){e.util={detectDoctype:function(){var t=/\s+(X?HTML)\s+([\d\.]+)\s*([^\/]+)*\//gi,e=0;if(void 0!==document.namespaces){if(8!=document.all[0].nodeType)return null;t.exec(document.all[0].nodeValue),-1!=document.all[0].nodeValue.indexOf("loose")&&(e=1)}else{if(null==document.doctype)return null;t.exec(document.doctype.publicId),document.doctype.systemId&&-1!=document.doctype.systemId.indexOf("loose")&&(e=1)}return{xhtml:RegExp.$1,version:RegExp.$2,importance:RegExp.$3,loose:e}},get_body:function(){var t=document.getElementsByTagName("html")||"",e=null;t.length<1?(e=document.createElement("html"),document.appendChild(e)):e=t[0];var n=null;return(t=document.getElementsByTagName("body")||"").length>0?n=document.getElementsByTagName("body").item(0):(n=document.createElement("body"),e.appendChild(n)),n},get_head:function(){var t=document.getElementsByTagName("html"),e=null;t.length<1?(e=document.createElement("html"),document.appendChild(e)):e=t[0];var n=null;return(t=document.getElementsByTagName("head")).length>0?n=document.getElementsByTagName("head").item(0):(n=document.createElement("head"),e.appendChild(n)),n},load_js:function(t,e){var n=this.get_head(),r=document.createElement("script");r.async=!0,r.setAttribute("language","javascript"),r.setAttribute("type","text/javascript"),r.setAttribute("src",t),n.insertBefore(r,n.firstChild);r.onload=r.onreadystatechange=function(){this.readyState&&"complete"!==this.readyState&&"loaded"!==this.readyState||e()}},load_css:function(t){var e=this.get_head(),n=document.createElement("link");n.setAttribute("rel","stylesheet"),n.setAttribute("type","text/css"),n.setAttribute("href",t),e.appendChild(n)},addScript:function(t,e){var n=new Date,r=document.getElementById(t);null!==r&&r.parentNode.removeChild(r);var i=this.get_head(),o=document.createElement("script");o.id=t,o.type="text/javascript",o.async=!0,o.src=e+"&random="+n.getTime(),i.insertBefore(o,i.firstChild);o.onload=o.onreadystatechange=function(){!this.readyState||"complete"===this.readyState||this.readyState}},delScript:function(t){var e=document.getElementById(t);null!==e&&e.parentNode.removeChild(e)},addEvent:function(t,e,n,r){return t.addEventListener?(t.addEventListener(e,n,r),!0):t.attachEvent?t.attachEvent("on"+e,n):void 0},removeEvent:function(t,e,n,r){return t.removeEventListener?(t.removeEventListener(e,n,r),!0):t.detachEvent?t.detachEvent("on"+e,n):void 0},setCookie:function(t,e){var n=new Date;n.setTime(n.getTime()+6e4),document.cookie=t+"="+e+"; expires="+n.toGMTString()},getCookie:function(t){var e=document.cookie.indexOf(t+"="),n=e+t.length+1;if(!e&&t!=document.cookie.substring(0,t.length))return null;if(-1==e)return null;var r=document.cookie.indexOf(";",n);return-1==r&&(r=document.cookie.length),unescape(document.cookie.substring(n,r))},delCookie:function(t){var e=new Date;e.setTime(e.getTime()-6e4),document.cookie=t+"= ; expires="+e.toGMTString()},nl2br:function(t){return(t+"").replace(/([^>]?)(\r\n|\n\r|\n|\r)/g,"$1<br/>")},htmlspecialchars:function(t){return"string"==typeof t&&(t=(t=(t=(t=(t=(t=t.replace(/&/g,"&amp;")).replace(/"/g,"&quot;")).replace(/'/g,"&#039;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;")).replace(/\\/g,"&#92;")),t},htmlSimpleEscape:function(t){return"string"==typeof t&&(t=(t=t.replace(/</g,"&lt;")).replace(/>/g,"&gt;")),t},long2ip:function(t){var e=!1;return!isNaN(t)&&(t>=0||t<=4294967295)&&(e=Math.floor(t/Math.pow(256,3))+"."+Math.floor(t%Math.pow(256,3)/Math.pow(256,2))+"."+Math.floor(t%Math.pow(256,3)%Math.pow(256,2)/Math.pow(256,1))+"."+Math.floor(t%Math.pow(256,3)%Math.pow(256,2)%Math.pow(256,1)/Math.pow(256,0))),e},sec2minsec:function(t){var e=Math.floor(t/60),n=t%60;return e<10&&(e="0"+e),n<10&&(n="0"+n),e+":"+n},getDebounce:function(t,e){var n=null,r=[],i=function(){e(r),r=[],n=null};return function(){n&&(clearTimeout(n),n=null),r.push(arguments),n=setTimeout(i,t)}},proxy:function(t,e){return outfunc=function(){return t.apply(e||this,arguments)},outfunc},runOnce:function(t,e){var n=null,r=!1;return function(){!1===r&&(r=!0,e(arguments)),n||(n=setTimeout(function(){r=!1,n=null},t))}},retry:function(t,n,r,i,o){var a=o||e.$.Deferred();return--t,n.apply(r,i).done(function(t){a.resolve(t)}).fail(function(){t?e.util.retry(t,n,r,i,a):a.reject()}),a.promise()},string:{padLeft:function(t,e,n){for(var r=t;r.length<n;)r=e+r;return r}},date:{getMonthName:function(t){if(!t)return"";switch(t.getMonth()){case 0:return e.T("january");case 1:return e.T("february");case 2:return e.T("march");case 3:return e.T("april");case 4:return e.T("may");case 5:return e.T("june");case 6:return e.T("july");case 7:return e.T("august");case 8:return e.T("september");case 9:return e.T("october");case 10:return e.T("november");case 11:return e.T("december");default:return""}},getDayName:function(t){if(!t)return"";switch(t.getDay()){case 0:return e.T("sunday");case 1:return e.T("monday");case 2:return e.T("tuesday");case 3:return e.T("wednesday");case 4:return e.T("thursday");case 5:return e.T("friday");case 6:return e.T("saturday");default:return""}},formatDate:function(t,n){var r=this.getMonthName(t),i=this.getDayName(t);return n.replace(/yyyy/g,t.getFullYear()).replace(/yy/g,String(t.getFullYear()).substr(2,2)).replace(/MMM/g,r.substr(0,3).toUpperCase()).replace(/Mmm/g,r.substr(0,3)).replace(/MM\*/g,r.toUpperCase()).replace(/Mm\*/g,r).replace(/mm/g,e.util.string.padLeft(String(t.getMonth()+1),"0",2)).replace(/DDD/g,i.substr(0,3).toUpperCase()).replace(/Ddd/g,i.substr(0,3)).replace(/DD\*/g,i.toUpperCase()).replace(/Dd\*/g,i).replace(/dd/g,e.util.string.padLeft(String(t.getDate()),"0",2)).replace(/d\*/g,t.getDate()).replace(/hh/g,e.util.string.padLeft(String(t.getHours()),"0",2)).replace(/ii/g,e.util.string.padLeft(String(t.getMinutes()),"0",2))},getDateISOString:function(t){if(t.toISOString)return t.toISOString();var n=e.util.string.padLeft(String(t.getUTCMonth()+1),"0",2),r=e.util.string.padLeft(String(t.getUTCDate()),"0",2),i=e.util.string.padLeft(String(t.getUTCHours()),"0",2),o=e.util.string.padLeft(String(t.getUTCMinutes()),"0",2),a=e.util.string.padLeft(String(t.getUTCSeconds()),"0",2),s=e.util.string.padLeft(String(t.getUTCMilliseconds()),"0",3),c=t.getUTCFullYear()+"-"+n+"-"+r+"T";return c+=i+":"+o+":"+a+"."+s+"Z"}},object:{mapKey:function(t,e){var n={};for(var r in t)t.hasOwnProperty(r)&&(n[e(r)]=t[r]);return n}},JSONStringify:function(e){for(var n="",r=["Array","Object","String"],i={},o=0;o<r.length;o++)t[r[o]].prototype.toJSON&&(i[r[o]]=t[r[o]].prototype.toJSON,delete t[r[o]].prototype.toJSON);try{n=JSON.stringify(e)}catch(t){}finally{for(var a in i)i.hasOwnProperty(a)&&(t[a].prototype.toJSON=i[a])}return n}}}},{}],39:[function(t,e,n){"use strict";e.exports=function(t,e,n){function r(){return u.closeC2cPopin(),!1}function i(t){return t.stopPropagation(),c("#c2cpopin_flag_list").show(),!1}function o(){c("body").unbind("click.clickoutsideCountry"),c("#c2cpopin_flag_list").is(":visible")&&c("#c2cpopin_flag_list").fadeOut()}function a(){var e=t.Templates.buildC2cPopin,n=t.call.countries,r=c(this).attr("id");return u.updateSelectedCountryC2c(r,e,n),c("#c2cpopin_flag_list").is(":visible")&&c("#c2cpopin_flag_list").fadeOut(),!1}function s(){return c(this).hasClass("c2cpopin_phone_default")&&c(this).removeClass("c2cpopin_phone_default"),!1}var c=t.$,u=void 0;return{init:function(t){u=t.CallView,e.on("call.popin.open",u.showC2cPopin)},bindEvents:function(t){t.find("#c2cpopin_close").click(r),t.find(".c2cpopin_call").off("click").click(n.onMakeCall),t.find("#c2cpopin_flag_selector").click(i),c("body").bind("click.clickoutsideCountry",o),t.find("#c2cpopin_flag_list li").click(a),t.find("#c2cpopin_phone").focus(s)}}}},{}],40:[function(t,e,n){"use strict";e.exports=function(t,e,n){function r(e,r){if(!t.ringing){t.activeCall=e,t.ringing=!0;var i=void 0!==window.idzCustomData?idzCustomData:{};a.each(i,function(t,e){"city_cp"==t?i.city=e:"name_firstname"==t?i.name=e:"extID"==t&&(i.extid=e)});var o={customData:i},s=t.routing.enabled?"c2c_routing.php":"c2c.php";n.connection.connect().done(function(){t.util.addScript("IDZc2cCall",t.chaturl+"rpc/"+s+"?sid="+t.website_id+"&oid="+t.c2coperator.id+"&vphone="+encodeURIComponent(e)+"&u="+t.vuid+"&visitorCountryCode="+r+"&visitorLocale="+t.visitor.locale+"&dep="+t.forceDep+"&vnick="+Strophe.getBareJidFromJid(n.connection.getConnection().jid)+"&forcedLang="+t.forcedLang+"&"+a.param(o))})}}function i(t,e){a("#c2cpopin_step1").hide(),a("#c2cpopin_step2").show(),r(t,e)}function o(e,n){var r=t.call.countries[n];if(!r)throw new Error("Unknown country or not referenced in the countries list");if(r.number_pattern&&!new RegExp(r.number_pattern).test(e))throw new Error("The given phone number format is unknown");return parseInt(r.zero_prefixed,10)&&(e=e.substr(1)),"+"+r.calling_code+e}var a=t.$,s=null;e.on("call.phone.format.validated",i),e.on("call.phone.callOperator",function(e,r,i){var o=void 0!==window.idzCustomData?idzCustomData:{};a.each(o,function(t,e){"city_cp"==t?o.city=e:"name_firstname"==t?o.name=e:"extID"==t&&(o.extid=e)});var s={customData:o};n.connection.connect().done(function(){t.util.addScript("IDZc2cCall",t.chaturl+"rpc/c2c_routing_operator.php?sid="+t.website_id+"&operator="+e+"&vphone="+encodeURIComponent(r)+"&u="+t.vuid+"&visitorCountryCode="+i+"&visitorLocale="+t.visitor.locale+"&dep="+t.forceDep+"&vnick="+Strophe.getBareJidFromJid(n.connection.getConnection().jid)+"&forcedLang="+t.forcedLang+"&"+a.param(s))})});return{onMakeCall:function(){var n=a("#c2cpopin_phone").val(),r=a("#c2cpopin_flag_selector div").attr("rel");try{if(!n)throw new Error("No phone number provided");s=o(n,r)}catch(e){return t.chat.showC2cError(t.T("INVALID_PHONE_NUMBER"))}return a("#c2cpopin_step1").removeClass("c2cpopin_error"),e.emit("call.phone.format.validated",s,r),!1},onCallOperator:function(t){var n=a("#c2cpopin_flag_selector div").attr("rel");return e.emit("call.phone.callOperator",t,s,n),!1},onPhoneValidated:i,getInternationalPhoneNumberFormat:o}}},{}],41:[function(t,e,n){"use strict";e.exports=function(t,e,n,r){function i(t,e){var n,r,i=[],a=[];for(n in t)r=t[n],i.push(o(r,e)),a.push(r);return d=a.shift(),"<ul>"+i.join("")+"</ul>"}function o(t,e){return e.replace(/{([\s\S]+?)}/g,function(e,n){return t[n]||""})}function a(e,n,r){var o,a,s=l(window).height();e?(o=i(n,r),a=t.Templates.buildC2cPopin(o)):a=t.Templates.c2cPopin;var c=l(a);return t.Templates.buildC2cPopin&&c.find("#c2cpopin_flag_list .flag").hide(),c.find("#c2coverlay").css({height:s}),c}function s(){var t=l(window).height();l("#c2coverlay").css({height:t}),l("#c2coverlay").show(),l("#c2cpopin").show()}function c(){l("#idzc2c").remove()}function u(e,n,r){var i,o=l("#c2cpopin_flag_selector div"),a=o.find("img"),s="";e&&"string"==typeof e&&(e=e.toLowerCase()),r[e]||r[e=t.curlang]||(e=d.country_code),o.removeClass().addClass("flag flag_"+e),o.attr({rel:e}),n&&(i=r[e].icon_path,o.css("background","none"),s=(a.data("basepath")||"")+i,a.attr("src",s))}var l=t.$,d=void 0;return{updateSelectedCountryC2c:u,showC2cBusyMessage:function(e){this.showC2cPopin(),l("#c2cpopin_step2").hide(),l("#c2cpopin_step1").show(),l("#c2cpopin_step1").addClass("c2cpopin_error"),l(".c2cpopin_label_error").html(t.util.htmlspecialchars(e)).css("color","black")},showC2cError:function(e){clearTimeout(t.c2cTimeout),this.showC2cPopin(),l("#c2cpopin_step2").hide(),l("#c2cpopin_step1").show(),l("#c2cpopin_step1").addClass("c2cpopin_error"),l(".c2cpopin_label_error").attr("style","").html(t.util.htmlspecialchars(e))},showC2cPopin:function(){var i,o=t.Templates.buildC2cPopin,c=t.call.countries,d=t.Templates.countryItemTemplate;if(t.ringing=!1,t.chat.connected||r.connection.connect(),l("#c2cpopin").length>0)s();else{var f=a(o,c,d);n.bindEvents(f),f.appendTo("body")}t.visitor.country&&(i=t.visitor.country),u(i,o,c),t.callInstant.available||l("#c2cpopin_step1 .c2cpopin_call").hide(),e.emit("call.popin.open.after")},closeC2cPopin:function(){t.ringing=!1,c(),l("#c2coverlay").hide(),l("#c2cpopin").hide()},resetC2cPopin:c}}},{}],42:[function(t,e,n){"use strict";e.exports=function(e,n,r){var i=t("./CallService")(e,n,r),o=t("./CallEvent")(e,n,i),a=t("./CallView")(e,n,o,r);e.define("livechat/call/service",function(){return i}),e.define("livechat/call/event",function(){return o}),e.define("livechat/call/view",function(){return a}),e.define("livechat/call",function(){return o.init({CallView:a}),{Service:i,Event:o,View:a}})}},{"./CallEvent":39,"./CallService":40,"./CallView":41}],43:[function(e,n,r){var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(n,r){function o(t){if("string"!=typeof t)return t;var e=/\b(3[47]\d{2}([ -]?)(?!(\d)\3{5}|123456|234567|345678)\d{6}\2(?!(\d)\4{4})\d{5}|((4\d|5[1-5]|65)\d{2}|6011)([ -]?)(?!(\d)\8{3}|1234|3456|5678)\d{4}\7(?!(\d)\9{3})\d{4}\7\d{4})\b/g;return t.replace(e,"xxxx-xxxx-xxxx-xxxx")}function a(){"use strict";r("#idz_postmsg").prop("disabled",!1),r(".idz_writting").html(""),n.chat.disableLoading()}function s(){"use strict";!0!==r("#idz_postmsg").prop("disabled")&&(r("#idz_postmsg").prop("disabled",!0),r(".idz_writting").html(n.T("livechat.xmpp.connection.disconnected")))}function c(){"use strict";r(".idz_writting").html(""),n.chat.putOpAlert(n.T("CONNECTION_ERREUR"))}function u(t,e,i){v.invitation.setFirstMessageId(i);var o=t.status,a=r.Deferred();if(n.opOffline=o.opOffline,n.c2cOffline=o.c2cOffline,n.opWatching=o.opWatching,n.opBusy=o.opBusy,n.initSession=!1,!o.opOffline){n.chat.history_id=t.chatId,n.vStats.history_id=t.chatId,n.chat.status=2,n.conversationJid=t.conversationJid,v.room.join(n.conversationJid,n.vuid,10).done(function(){v.room.groupchat(e,i),a.resolve()},a.reject),setTimeout(function(){v.getConnection().connected&&n.chat.sendPresence("dnd")},2500);var s=p();r("#idz_button_print").attr("href",n.chaturl+"gethistory.php?id="+t.chatId+"&u="+n.vuid),r("#idz_button_mail").attr("href",n.chaturl+"gethistory_mail.php?id="+t.chatId+"&u="+n.vuid+"&timezoneAbbr="+s),b.emit("conversation.chat.started")}return(o.opOffline||o.opBusy)&&a.reject(),a.promise()}function l(t){var e=t.status;n.opOffline=e.opOffline,n.c2cOffline=e.c2cOffline,n.opBusy=e.opBusy,n.initSession=!1;var i=r.Deferred();if(e.opOffline)setTimeout(function(){n.triggerOCallback()},400),n.chat.disableLoading();else{n.chat.history_id=t.chatId,n.vStats.history_id=t.chatId,n.chat.status=2,n.conversationJid=t.conversationJid,v.room.join(n.conversationJid,n.vuid,10).done(function(){v.getConnection().connected&&n.chat.sendPresence("dnd"),i.resolve()},i.reject),n.operator=t.operator,n.c2coperator=t.c2coperator?t.c2coperator:t.operator,n.on_call&&(n.operator=t.c2coperator);var o=p();r("#idz_button_print").attr("href",n.chaturl+"gethistory.php?id="+t.chatId+"&u="+n.vuid),r("#idz_button_mail").attr("href",n.chaturl+"gethistory_mail.php?id="+t.chatId+"&u="+n.vuid+"&timezoneAbbr="+o),b.emit("conversation.chat.started"),n.vaSCI&&n.chat.sendAlert("!vaSCI","",!0)}return(e.opOffline||e.opBusy)&&i.reject(),i.promise()}function d(){var t="visitor";(n.flags.proactif_alert||n.flags.proactif_invit)&&(t="proactif"),n.callbacks.onChatStarted({id:n.chat.history_id,startedBy:t})}function f(t){return!g.isUndefined(t)&&!g.isNull(t)&&(!!g.some(E,t)||(E.push(t),E.length>5&&E.shift(),!1))}function h(){n.lastPreview=null,n.livePreview=window.setInterval(function(){if(n.chat&&2===n.chat.status&&n.operator&&n.operator.barejid){var t=r("#idz_msgmsg").val();if(n.lastPreview!=t&&t!=n.T("POSER_VOTRE_QUESTION_ICI")&&t!=n.T("POSER_VOTRE_QUESTION_ICI_UN_CONSEILLER_VOUS_REPONDRA")&&t!=n.customize["chatbar_txt2_"+n.curlang]){n.lastPreview=t,"1"===n.preferences.bankcard_number_hidden&&(t=o(t));var e=$msg({to:Strophe.getBareJidFromJid(n.operator.barejid)+"/operators",from:v.getConnection().jid,type:"command",website:n.website_id}).c("body").t("!preview "+t);v.getConnection().send(e)}}},2800)}function p(){var t=String(new Date),e=/\((.*)\)/.exec(t,"g");return!e||e.length<2?"":e[1]}if(!iAdvize.lock){var m,g=e("lodash"),v=n.require("xmpp"),_=n.require("logger"),b=n.require("eventManager"),y=b.events,w=n.require("emojis-service");b.on(y.OnXmppRoomJoined,function(){v.sendChatState("paused")}),b.on(y.OnXmppConnectionDisconnected,function(){s()}),b.on(y.OnXmppReconnectionFailed,function(){c()}),b.on(y.OnXmppConnectionConnected,function(){a()});var C,x;n.call.isEnabled&&(C=n.require("livechat/call")),n.callMeeting.enabled&&n.require("livechat/callmeeting"),1==n.preferences.mirroring_enabled&&(x=n.require("mirror"))&&x.listen&&x.listen(b),n.visio.enabled&&n.require("visio"),n.define("emitter",function(){function t(t){function e(){for(var e=-1,r=n.length;++e<r;)n[e].apply(this,arguments);return t}var n=[];return e.on=function(e){return n.push(e),t},e}return function(){for(var e=-1,n=arguments.length,r={};++e<n;)r[arguments[e]]=t(r);return r.on=function(t,e){return r[t].on(e)},r}}),n.noDefaultScrollTemplate="iphone"==n.customize.layout||"mobile"==n.customize.layout||"tablette"==n.customize.layout||"chomette"==n.customize.layout||"monoprix2"==n.customize.layout||"interflora-uk"==n.customize.layout||"natixis-caissedepargne-espaceclient"==n.customize.layout||"nexecur"==n.customize.layout||"vvf"==n.customize.layout||"sfr3"==n.customize.layout||"boursorama3"==n.customize.layout||"fortuneo2"==n.customize.layout||"mecatechnic2"==n.customize.layout||"mecatechnic3"==n.customize.layout||"carglass"==n.customize.layout||"autosphere2"==n.customize.layout||"nordnet2"==n.customize.layout||"flowercampings"==n.customize.layout||"neckermannreisen"==n.customize.layout||"dermacenter"==n.customize.layout||"cdiscountv4"==n.customize.layout||"groupalia"==n.customize.layout||"entega2"==n.customize.layout;var O=function(){if(n.Templates.newTemplates)n.noOfferPanelTemplate=n.Templates.isResponsive;else{var t=n.require("template").customizer;n.noOfferPanelTemplate=t.noOfferPanelTemplate(n.customize.layout)}return n.noOfferPanelTemplate};n.initSession=!1;var S=function(t,e){return t&&e?t.toLowerCase()===e.toLowerCase():t===e},T=function(){1!==n.chat.satisfaction?(2===n.chat.status?window.confirm(n.T("VISITOR_CONFIRM_CLOSE"))&&(n.flags.visio_status&&b.emit(y.OnConversationVisioClosed),-1===n.operator.id||1===n.virtualOP||"1"!==n.preferences.param_satisfaction||2===n.chat.satisfaction||2!==n.chat.status||n.blocked?(n.Templates.hideUI(),n.chatbar_state=2,n.JSONStore.save({chatbar_state:n.chatbar_state})):(n.chat.satisfaction=1,n.Templates.displaySatisfaction(),n.callbacks.onSatisfactionDisplayed()),n.chat.sendChatClose(),n.callbacks.onChatEnded({id:n.chat.history_id,endedBy:"visitor"})):(n.Templates.hideUI(),n.chatbar_state=2,n.JSONStore.save({chatbar_state:n.chatbar_state})),n.chatbox_state=n.chat.CHATBOX_STATES.CHATBAR_HIDDEN):n.Templates.removeSatisfaction()};n.playSound=function(t){var e='<embed src="'+n.chaturl+"sounds/swf.php?s="+n.website_id+"&q="+t+'" width="1" height="1" quality="high" pluginspage="http://www.macromedia.com/shockwave/download/index.cgi?P1_Prod_Version=ShockwaveFlash" type="application/x-shockwave-flash">';r("#idz_sound_container").html(e)},n.onCoreLoaded=function(t){return n.coreloaded?("function"==typeof t&&t(),!1):(n.coreloaded=!0,r(document).keypress(function(t){27==t.keyCode&&t.preventDefault()}),n.chat.cCook=document.cookie,n.callbacks.onCookieSaved(),n.hasFocus=1,n.blinktm=null,n.oTitle=document.title,r(window).bind("scroll.activity",function(){n.onActivity()}),r(window.document).bind("keypress.activity",function(){n.onActivity()}),r("body").bind("mousemove.activity",function(){n.onActivity()}),r(window).focus(function(){n.hasFocus=1,null!==n.blinktm&&(clearInterval(n.blinktm),n.blinktm=null,document.title=n.oTitle)}),r(window).blur(function(){n.hasFocus=0,n.vStats.activeSince=null}),n.monitoredForms&&r("form").submit(function(t){if("post"==t.target.method.toLowerCase()){for(var e=n.monitoredForms.length;e--;)if(n.monitoredForms[e]==t.target.id){n.usePOST=t.target.id;break}}else n.usePOST=null}),n.onChatLoaded(t),!0)},n.onChatLoaded=function(t){if(!n.chatloaded){n.chatloaded=!0,n.chat.history_id=+n.flags.history_id,n.chat.prev_history=+n.flags.prev_history,n.chat.status=+n.flags.chat_status,n.chat.satisfaction=+n.flags.satisfaction_status,n.chat.cobrowsing=+n.flags.chat_cobrowsing,n.proactif_timeElapsed=n.flags.proactif_timeElapsed,n.proactif_activated=n.flags.proactif_activated,n.conversationJid=n.flags.conversationJid,n.chat.popinLeft=n.flags.popinLeft,n.chat.popinTop=n.flags.popinTop,n.callbacks.onScriptLoaded(),""===n.iframeID&&n.chat.bindWidgetEvents();var e=3===n.chat.status&&"0"===n.flags.operator_closed&&"1"===n.flags.visitor_closed;n.chat.history_id>0&&(2===n.chat.status||e)&&(b.on(y.OnXmppConnectionConnected,function(){v.room.join(n.conversationJid,n.vuid)}),v.connect(!0).fail(n.chat.showConnectionError));try{setTimeout(function(){n.Templates&&n.Templates.restoreState&&n.Templates.restoreState(),(n.chat.history_id>0||n.chat.prev_history>0)&&""==n.iframeID&&n.chat.reloadHistory(),2===n.chat.status&&"1"===n.flags.visio_status&&b.emit(y.OnConversationVisioRequested),r.each(["hideUI","hideDialog","minimizeChatbar"],function(t,e){var r=n.Templates[e];n.Templates[e]=function(){r.apply(n.Templates),n.callbacks.onChatHidden()}})},100)}catch(t){n.errorMailer("onChatLoaded try to connect: ",t,"")}}"function"==typeof t&&t()},n.transfer=function(t){var e=r.parseJSON(t);n.chat.putOpAlert(n.T("OPERATEUR_TRANSFER")),n.operator=e.operator,n.c2coperator=n.operator,n.chat.history_id=e.newConversationID,n.vStats.history_id=e.newConversationID,!0===n.operator.isExpert&&n.chat.putOpAlert(n.chat.getExpertDisclaimer());var i=p();r("#idz_button_print").attr("href",n.chaturl+"gethistory.php?id="+e.newConversationID+"&u="+n.vuid),r("#idz_button_mail").attr("href",n.chaturl+"gethistory_mail.php?id="+e.newConversationID+"&u="+n.vuid+"&timezoneAbbr="+i),n.chat.sendPresence("available"),n.callbacks.onVisitorTransferred({operatorId:n.operator.id,historyId:n.chat.history_id})},n.createConversation=function(t,e,i,o,a){if(n.initSession)return r.Deferred().reject().promise();n.initSession=!0;var s={sid:n.website_id,vuid:n.vuid,dep:n.forceDep,r:n.flags.proactif_activatedId||0,nick:Strophe.getNodeFromJid(v.getConnection().jid),msg:e?encodeURIComponent(e):"",messageId:a,op:n.operator.id||0,o:n.forceAgent?n.forceAgent:0,h:n.forceAgent&&n.vStats.merpHash?n.vStats.merpHash:"",br:n.vStats.browserInfo||""};if(void 0!==window.idzCustomData&&(idzCustomData.page_type&&(s.pt=encodeURIComponent(idzCustomData.page_type)),idzCustomData.brand&&(s.pb=encodeURIComponent(idzCustomData.brand)),idzCustomData.rayon&&(s.pr=encodeURIComponent(idzCustomData.rayon)),idzCustomData.univers&&(s.pu=encodeURIComponent(idzCustomData.univers)),idzCustomData.cust_name&&(s.pcna=encodeURIComponent(idzCustomData.cust_name)),idzCustomData.cust_firstname&&(s.pcfn=encodeURIComponent(idzCustomData.cust_firstname)),idzCustomData.cust_address&&(s.pcad=encodeURIComponent(idzCustomData.cust_address)),idzCustomData.cust_city&&(s.pcci=encodeURIComponent(idzCustomData.cust_city)),idzCustomData.cust_zipcode&&(s.pczc=encodeURIComponent(idzCustomData.cust_zipcode)),idzCustomData.cust_country&&(s.pcco=encodeURIComponent(idzCustomData.cust_country)),idzCustomData.cust_phonenumber&&(s.pcpn=encodeURIComponent(idzCustomData.cust_phonenumber)),idzCustomData.cust_email&&(s.pcem=encodeURIComponent(idzCustomData.cust_email))),"visio"===t)return r.getJSON(n.chaturl+"rpc/visio.php",s);n.vaSCI&&(s.va=n.vaSCI),s.cd=window.idzCustomData||[],s.h&&(n.routing.enabled=!1);var c=n.routing.enabled?"init_routing.php":"init_session.php";return(m=r.getJSON(n.chaturl+"rpc/"+c+"?lang="+n.curlang+"&log_uuid="+i+"&callback=?",s)).then(function(t){return n.routing.enabled?u(t,e,a):l(t)})},n.doInit=function(){2!=n.chat.status?n.chat.sendPresence("available"):n.chat.sendPresence("dnd"),n.chat.connected=!0};var E=[],A={OPERATOR:1,VISITOR:2,OPERATOR_ALERT:3,VISITOR_ALERT:4,VISITOR_NAVIGATION:5,OPERATOR_RICH_CONTENT:6,VISITOR_RICH_CONTENT:7},I={HIDDEN:1,OPENED:2,MINIMIZED:3,CHATBAR_HIDDEN:4};n.chat={MESSAGE_TYPES:A,CHATBOX_STATES:I,chatbox_state:I.HIDDEN,status:0,history_id:0,composing:0,watch:0,connected:!1,reconnecting:!1,started:!1,cobrowsing:0,offercount:1,satisfaction:0,automatedStartMessageId:555,automatedEndMessageId:777,buildChat:function(){try{if(n.chatbuilt)return;n.chatbuilt=!0,n.Templates.loadChatCss(),b.emit("events.chatBuilt")}catch(t){}try{n.Templates.appendChat();var t=document.createElement("div");t.setAttribute("id","idz_sound_container"),r("body").append(t);var e=n.Templates.append2header();""!=e&&r("head").append(e)}catch(t){n.errorMailer("buildChat 2: ",t,"")}try{var i=n.T("BESOIN_AIDE"),o=n.T("POSER_VOTRE_QUESTION_ICI_UN_CONSEILLER_VOUS_REPONDRA"),a="message";if(n.customize["chatbar_txt1_"+n.curlang]&&0!=n.customize["chatbar_txt1_"+n.curlang].length&&(i=n.customize["chatbar_txt1_"+n.curlang]),n.customize["chatbar_txt2_"+n.curlang]&&0!=n.customize["chatbar_txt2_"+n.curlang].length){o=n.customize["chatbar_txt2_"+n.curlang];a="message_edit"}var s=n.Templates.getChatContent().replace(/\{CHATBAR_TXT1\}/g,i).replace(/\{CHATBAR_TXT2\}/g,o).replace(/\{CHATBAR_TITLE\}/g,a);r("#idz_chatglobal").html(s),""!=(e=n.Templates.append2body())&&r("body").append(e),n.Templates.loadLayout()}catch(t){n.errorMailer("buildChat 3: ",t,"")}try{n.chat.loadLayout()}catch(t){n.errorMailer("buildChat 4: ",t,"")}},addCobrowsingImg:function(){r("body").append("<img src='https://static.iadvize.com/images/livechat/anim_clic.gif' id='anim_clic' width='163px' height='161px' style='position: absolute; z-index: 999999999998; top: -3000px; left: -3000px;' />"),r("body").append("<img src='https://static.iadvize.com/images/livechat/op_cursor.png' id='visitor_cursor' width='70px' height='70px' style='position: absolute; z-index: 999999999999; top: -3000px; left: -3000px;' />")},loadLayout:function(){1==n.chat.cobrowsing&&n.chat.addCobrowsingImg(),n.chat.bindSendMessage(),n.chat.bindChatStatesEvents(),r("#idz_chatbox_main").on("click","#idz_button_font_pos, .idz_button_font_pos",function(){var t=1.1*parseFloat(r("#idz_dialogbox").css("font-size"));return t<=21&&(r("#idz_dialogbox").css({"font-size":t+"px"}),n.chat.sendCommand(n.operator.barejid,"!textsize "+t)),!1}),r("#idz_chatbox_main").on("click","#idz_button_font_neg, .idz_button_font_neg",function(){var t=.9*parseFloat(r("#idz_dialogbox").css("font-size"));return t>=10&&(r("#idz_dialogbox").css({"font-size":t+"px"}),n.chat.sendCommand(n.operator.barejid,"!textsize "+t)),!1}),r("#idz_button_close, .idz_button_close").click(function(){if(b.emit("conversation.closed"),2===n.chat.status){var t=Strophe.getBareJidFromJid(v.getConnection().jid);v.getConnection().send($msg({to:t,from:t,type:"chat",website:n.website_id}).c("body").t("!magic_event disabled"))}return(n.Templates.closeDialog||T)(),!1}),r("#idz_button_hide, .idz_button_hide").click(function(){return r("#idz_chatbox").hasClass("idz_chatbox_hide")?(n.Templates.showDialog(),n.chat.sendAlert("!chatshow",n.T("VISITEUR_CHATBOX_OPEN")),n.chatbox_state=n.chat.CHATBOX_STATES.OPENED):(n.Templates.hideDialog(),n.chat.sendAlert("!chathide",n.T("VISITOR_CHATBOX_MINIMIZE")),n.chatbox_state=n.chat.CHATBOX_STATES.MINIMIZED),n.JSONStore.save({chat_status:n.chat.status,chatbox_state:n.chatbox_state}),!1}),setTimeout(function(){n.customize["chatbar_txt2_"+n.curlang]&&0==n.customize["chatbar_txt2_"+n.curlang].length&&r("#idz_msgmsg").width()<=370&&r("#idz_msgmsg").val(n.T("POSER_VOTRE_QUESTION_ICI"))},500),r("#idz_button_mail, .idz_button_mail").click(function(){var t=r("#idz_dialogbox div.idz_msg_visitor").last().size(),e=r("#idz_dialogbox div.idz_msg_operator").last().size();if(!(t>0||e>0))return r("#idz_button_print").attr("target","_self"),n.chat.put_dialog(n.Templates.opAlert.replace(/\{MSG\}/g,n.T("CHAT_VIDE_ACTION_IMPOSSIBLE")).replace(/\{TIME\}/g,n.chat.getMsgTime())),r("#idz_dialogbox div.idz_msg_alert_op").last().addClass("idz_noaction"),!1;var i=window.prompt(n.T("EMAIL_PROMPT"),"");if(""===i||null===i)return!1;var o=n.chat.history_id;0==n.chat.history_id&&(o=n.chat.prev_history);var a=p();r("#idz_button_mail").attr("href",n.chaturl+"gethistory_mail.php?id="+o+"&to="+encodeURIComponent(i)+"&u="+n.vuid+"&timezoneAbbr="+a),r("#mailFrame").length&&r("#mailFrame").remove(),r("body").append("<iframe id='mailFrame' name='mailFrame' style='width:0px; height:0px; border: 0px'></iframe>")}),r("#idz_button_print, .idz_button_print").click(function(){var t=r("#idz_dialogbox div.idz_msg_visitor").last().size(),e=r("#idz_dialogbox div.idz_msg_operator").last().size();return t>0||e>0?(r("#idz_button_print").attr("target","_blank"),!0):(r("#idz_button_print").attr("target","_self"),n.chat.put_dialog(n.Templates.opAlert.replace(/\{MSG\}/g,n.T("CHAT_VIDE_ACTION_IMPOSSIBLE")).replace(/\{TIME\}/g,n.chat.getMsgTime())),r("#idz_dialogbox div.idz_msg_alert_op").last().addClass("idz_noaction"),!1)}),r(".idz_slide_link_close a").click(function(t){t.preventDefault(),r(t.currentTarget).parents(".idz_slide").toggle()}),r("#idz_button_private").click(function(t){t.preventDefault(),r("#idz_chatbox_private").toggle()}),r(".idz_toggle").click(function(t){var e=r(t.currentTarget).find(".idz_toggle_button"),i=e.siblings("input"),o=i.val();e.toggleClass("idz_toggle_on"),e.toggleClass("idz_toggle_off"),1==o?(i.val(0),e.animate({"background-position-x":"-11px"},200)):(i.val(1),e.animate({"background-position-x":"-49px"},200));var a=i.val();n.JSONStore.saveData({visitorDeleteDataEnabled:a}),"1"===a?n.chat.sendAlert("!datadeletionenabled"):n.chat.sendAlert("!datadeletiondisabled")}),1==n.flags.visitorDeleteDataEnabled&&r(".idz_toggle").trigger("click"),setTimeout(function(){n.Templates.minimizeChatbarHide()},1e3),r("#idz_chatbar_minifier, .idz_chatbar_minifier").click(function(){return n.chat.sendAlert("!chatmini",n.T("VISITEUR_CHATBAR_MINIMIZE")),n.Templates.minimizeChatbar(),!1}),r("#idz_chatbar_mini, .idz_chatbar_mini").click(function(){return n.chat.sendAlert("!chatmaxi",n.T("VISITEUR_CHATBAR_OPEN")),n.Templates.maximizeChatbar(),n.Visio&&(n.Visio.reLaunchVideo=!0),r(this).hide(),!1}),r("#idz_chatbar").on("click",".idz_upload_trigger",function(t){t.stopPropagation(),t.preventDefault(),r(this).find("input").click()}),r("#idz_chatbar").on("change",".idz_upload_trigger input",function(t){b.emit(y.OnConversationChatFileSelected,t),t.preventDefault(),t.stopPropagation(),r(this).val("")}).on("click",".idz_upload_trigger input",function(t){t.stopPropagation()}),r("#idz_dialogbox").on("click",".idz_upload_abort",function(t){b.emit(y.OnConversationChatUploadAborted,r(this).parents(".idz_upload").data("id")),t.preventDefault(),t.stopPropagation()})},outframeChat:function(){r("body").append("<style>#idz_chatglobal, #idz_chatbar_mini {visibility:hidden;left:-9999px}</style>")},loadInvitation:function(t){n.invitLoaded||(n.Templates.loadChatCss(),n.invitLoaded=!0,1!==n.chat.composing&&(n.callbacks.onInvitationDisplayed({id:t}),n.Templates.hideDialog(),(iAdvize.$LAB||window.$LAB).script(n.chaturl+"invitation.php?id="+t+"&t="+n.customize.layout+"&sid="+n.website_id+"&lang="+n.curlang).wait(function(){})))},butMessage:!1,onClickChatWidget:function(){this.butMessage||(2!=n.chat.status&&n.chat.putOpAlert(n.T("SAISIR_UN_MESSAGE")),this.butMessage=!0),n.Templates.showDialog()},onClickC2cWidget:function(){n.chat.showC2cPopin()},bindWidgetEvents:function(){try{r(".idz_widget")&&r(".idz_widget").length&&r("#operator_status_textarea")&&r("#operator_status_textarea").length&&(r(".idz_widget").click(function(){return 0==n.opOffline&&""!==r("#operator_status_textarea").val()&&(r("#idz_msgmsg").val(r("#operator_status_textarea").val()),r("#operator_status_textarea").val(""),r("#idz_postmsg").click()),!1}),r("#operator_status_textarea").focus(function(){r("#operator_status_textarea").val()==n.T("POSER_VOTRE_QUESTION_ICI_UN_CONSEILLER_VOUS_REPONDRA")&&(r("#operator_status_textarea").val(""),r("#operator_status_textarea").removeAttr("style"))}))}catch(t){}try{r("#operator_status_textarea")&&r("#operator_status_textarea").length&&r("#operator_status_textarea").keyup(function(t){13==t.which&&(r("#idz_msgmsg").val(r("#operator_status_textarea").val()),r("#operator_status_textarea").val(""),r("#idz_postmsg").click())})}catch(t){}r(".idz_c2vwidget").length&&r(".idz_c2vwidget").click(function(){return b.emit(y.OnConversationVisioRequested),!1})},showC2cPopin:function(){b.emit("call.popin.open")},showC2cBusyMessage:function(t){C&&C.View.showC2cBusyMessage(t)},showC2cError:function(t){C&&C.View.showC2cError(t)},closeC2cPopin:function(){C&&C.View.closeC2cPopin()},resetC2cPopin:function(){C&&C.View.resetC2cPopin()},bindChatStatesEvents:function(){var t=function(t){n.operator.barejid&&(v.sendChatState(t),"composing"===t?(n.chat.composing=1,n.callbacks.onVisitorWriting()):(n.chat.composing=0,n.callbacks.onVisitorStopWriting()))};r("#idz_msgmsg").focusout(function(){t("paused")}).focusin(function(){t("active")}).keydown(function(e){13===e.which?t("active"):0===n.chat.composing&&t("composing")}).keyup(function(){!r(this).val().trim()&&n.chat.composing&&t("active")}),r("#idz_msgmsg").keydown(function(t){if(!t.ctrlKey||13!==t.keyCode&&10!==t.keyCode){if(13===t.which)return t.preventDefault(),void r("#idz_postmsg").click()}else{var e=r(this).val()+" \n";r(this).val(e)}})},handleSatisfactionSurvey:function(t){var e=parseInt(r("#idzq1").attr("rel"),10)+1+"|";e=(e=e+(parseInt(r("#idzq2").attr("rel"),10)+1)+"|")+(parseInt(r("#idzq3").attr("rel"),10)+1)+"|",t===n.T("VOTRE_COMMENTAIRE_LIBRE")&&(t=""),e+=t;var i=n.chat.history_id||n.chat.prev_history;n.util.addScript("satisfaction",n.chaturl+"rpc/satisfaction.php?save="+n.website_id+"&u="+n.vuid+"&hid="+i+"&data="+encodeURIComponent(e)),n.chat.sendAlert("!satisfaction completed",n.T("SATISFACTION_REPONDU")),n.Templates.removeSatisfaction(),r("#idz_msgmsg").val("").change(),n.chat.composing=0,n.callbacks.onSatisfactionAnswered()},sendMessage:function(t){if(!r(this).prop("disabled")){try{var e=r("#idz_msgmsg").css("left"),i=r("#idz_msgmsg").css("top");if(1===n.chat.satisfaction)return void this.handleSatisfactionSurvey(t);if(""===t||t===n.T("POSER_VOTRE_QUESTION_ICI")||t===n.T("POSER_VOTRE_QUESTION_ICI_UN_CONSEILLER_VOUS_REPONDRA")||t===n.customize["chatbar_txt2_"+n.curlang])return void setTimeout(function(){r("#idz_msgmsg").css({left:parseInt(e,10)+"px",top:parseInt(i,10)+"px"})},1030);if(r("#idz_msgmsg").val("").change(),n.operator.barejid&&(1!==n.on_call||n.blocked)&&2!==n.chat.status){var o=n.chat.getVmsg(t);return n.Templates.showDialog(),n.chat.put_dialog(o),n.chat.disableLoading(),void setTimeout(function(){n.chat.putOpMsg(null,n.autoAnswer,0,1),n.triggerOCallback()},300)}if(n.blocked||!t)return;var a=v.connect().fail(n.chat.showConnectionError);if(n.operator.barejid||1===n.chat.satisfaction)a.done(function(){n.chat.onSendMessage(t)});else{var s=function t(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,t)}(),c=v.getConnection().getUniqueId();n.chat.enableLoading(),a.then(function(){return n.createConversation("chat",t,s,null,c)}).then(function(){if(n.routing.enabled){var e=n.$.Deferred();return n.operator.barejid||(n.operator.barejid="i_will_be_back"),e.resolve(c),e.promise()}return v.room.groupchat(t,c),n.util.retry(4,n.chat.onSendFirstMessage,n.chat,[t,c])}).done(function(e){d(),n.chat.putVmsg(t,e,s),!0===n.operator.isExpert&&n.chat.putOpAlert(n.chat.getExpertDisclaimer())}).fail(function(){n.chat.put_dialog(n.chat.getVmsg(n.util.nl2br(n.util.htmlspecialchars(t)))),n.chat.showUnavailableMessage(),n.chat.disableLoading()})}}catch(t){n.errorMailer("bindSendMessage: ",t,"")}return!1}},bindSendMessage:function(){var t=this;r("#idz_postmsg").on("click",function(){var e=r("#idz_msgmsg").get(0).value;t.sendMessage(e)})},enableLoading:function(){r("#idz_msgmsg").attr("disabled","disabled"),r(".idz_loading").show()},disableLoading:function(){r("#idz_msgmsg").attr("disabled",!1),r(".idz_loading").hide()},showUnavailableMessage:function(){n.chat.putOpMsg(null,n.autoAnswer,0,1),n.chat.status=1,n.operator={}},sendProactifAlert:function(){b.emit(y.OnEventEngagementRuleTriggered)},onSendFirstMessage:function(t,e){var i=r.Deferred();return n.chat.dialogCount(),n.Templates.showDialog(),h(),v.invitation.sendEngage(e,t,n.conversationJid,n.operator.barejid,n.website_id,n.chat.history_id).then(function(t){n.chat.sendProactifAlert(),b.emit(y.OnEventVisitorProfileRequested,{from:n.operator.barejid}),i.resolve(t)},i.reject),setTimeout(i.reject,4e3),n.proactif_now=0,i.promise()},onSendMessage:function(t){if("1"===n.preferences.bankcard_number_hidden&&(t=o(t)),t){n.Templates.showDialog();var e=v.getConnection().getUniqueId();n.chat.sendXmppMessage(t,e).fail(function(){}),n.chat.putVmsg(t,e),n.proactif_now=0}},dialogCount:function(){n.flags.proactif_activatedId&&!n.flags.proactif_dialogIsCounted&&(n.flags.proactif_dialogIsCounted=!0,setTimeout(function(){n.util.addScript("proactifDialogcount",n.chaturl+"rpc/proactif_dialogCount.php?inc="+n.flags.proactif_activatedId+"&sid="+n.website_id+"&u="+n.vuid+"&hid="+n.chat.history_id)},1650))},updateHistory:function(t,e,r,i){if(e){r=r||0;var o=n&&n.vStats?n.vStats.browserInfo+" | "+n.vStats.country:"";i||(i=""),n.util.addScript("IDZhistory",n.chaturl+"rpc/chat_history.php?sid="+n.website_id+"&update="+n.chat.history_id+"&u="+n.vuid+"&oid="+n.operator.id+"&data="+encodeURIComponent(e)+"&type="+t+"&id="+r+"&nick="+Strophe.getNodeFromJid(v.getConnection().jid)+"&userData="+o+"&log_uuid="+i)}},reloadHistory:function(){n.chat.buildChat(),setTimeout(function(){var t=n.chat.history_id||n.chat.prev_history,e=p();n.util.addScript("IDZRhistory",n.chaturl+"rpc/chat_history.php?reload="+t+"&u="+n.vuid),r("#idz_button_print").attr("href",n.chaturl+"gethistory.php?id="+t+"&u="+n.vuid),r("#idz_button_mail").attr("href",n.chaturl+"gethistory_mail.php?id="+t+"&u="+n.vuid+"&timezoneAbbr="+e)},400)},convertLinks:function(t,e){var n="";return e&&(n="target=_blank "),t.replace(/((ftp|https?):\/\/([-\w\.]+)+(:\d+)?(\/([\w/_\.\(\)\-,\#\~\%\=\+&;:]*(\?\S+)?)?)?)/gm,"<a "+n+'rel="nofollow" href="$1">$1</a>')},getVmsg:function(e,r){var i=r!=t?r:n.chat.getMsgTime();return e=n.chat.convertLinks(e,!0),e=w.replaceAliasesToShortname(e),e=w.replaceUtf8ToShortname("apple",e),e=w.replaceShortnameToImage("apple",e),n.Templates.vMsg.replace(/\{MSG\}/g,e).replace(/\{TIME\}/g,i)},putVmsg:function(t,e,r){e=e||0;var i=n.util.nl2br(n.util.htmlspecialchars(t));n.chat.put_dialog(n.chat.getVmsg(i),e),t=w.replaceShortnameToUtf8("apple",t),n.chat.updateHistory(n.chat.MESSAGE_TYPES.VISITOR,t,e,r),n.chat.disableLoading(),n.Templates.showDialog(),n.Templates.maximizeChatbar(),n.callbacks.onVisitorStopWriting(),n.callbacks.onMessageSent({time:n.chat.getMsgTime(),msg:i})},getOpAlert:function(e,r){var i=r!=t?r:n.chat.getMsgTime();return e=n.util.nl2br(n.util.htmlspecialchars(e)),e=e.replace(/&lt;br \/&gt;/gi,"<br/>").replace(/&lt;br\/&gt;/gi,"<br/>").replace(/&lt;br&gt;/gi,"<br/>"),n.Templates.opAlert.replace(/\{MSG\}/g,e).replace(/\{TIME\}/g,i)},putOpAlert:function(t,e){n.Templates.showDialog(),n.Templates.maximizeChatbar(),n.chat.put_dialog(n.chat.getOpAlert(t)),e&&1===e&&n.chat.updateHistory(n.chat.MESSAGE_TYPES.OPERATOR_ALERT,t),n.callbacks.onAlertReceived({time:n.chat.getMsgTime(),msg:t})},getOperatorAvatarUrl:function(){var t=n.static_url+"images/livechat/blank.gif";return n.operator.avatar&&(t=n.operator.avatar),t},getOpMsg:function(e,i){var o=i!=t?i:n.chat.getMsgTime(),a=n.chat.getOperatorAvatarUrl(),s="",c="";if(n.operator.pseudo){c=n.operator.pseudo,s=n.util.htmlspecialchars(n.operator.pseudo);var u="";n.operator.isExpert&&(u=" "+iAdvize.T("SEE_MORE")),s=s+'<span class="idz_colonspace">'+u+"</span> : "}-1===e.indexOf(n.autoAnswer)&&(e=-1===e.indexOf(n.website_url)?n.chat.convertLinks(e,!0):n.chat.convertLinks(e,!1)),e=e.replace(/&lt;br \/&gt;/gi,"<br/>").replace(/&lt;br\/&gt;/gi,"<br/>").replace(/&lt;br&gt;/gi,"<br/>"),e=w.replaceUtf8ToImage("apple",e);var l=n.Templates.opMsg.replace(/\{PSEUDO\}/g,s).replace(/\{PSEUDO_RAW\}/g,c).replace(/\{AVATAR\}/g,a).replace(/\{MSG\}/g,e).replace(/\{TIME\}/g,o);if(n.operator.direct_phone&&""!=n.operator.direct_phone&&0===n.phoneDisplayed){n.phoneDisplayed=1;var d=n.Templates.opMsgFooter.replace(/\{PHONE_PRICE\}/g,n.operator.phone_facturation).replace(/\{PHONE_NUMBER\}/g,n.operator.direct_phone);l=l.replace(/\{FOOTER\}/g,d)}else l=l.replace(/\{FOOTER\}/g,"");return n.operator.id&&(b.emit("events.operatorMessageSent",n.operator),l=r(l).attr("data-operatorid",n.operator.id)[0].outerHTML),l},tagAutomatedMessages:function(t,e){e==n.chat.automatedStartMessageId&&t.find(".idz_msgtext:last, .idz_msgtime:last").addClass("idz_automatedMessage idz_automatedStartMessage"),e==n.chat.automatedEndMessageId&&t.find(".idz_msgtext:last, .idz_msgtime:last").addClass("idz_automatedMessage idz_automatedEndMessage")},putOpFile:function(t,e){r('.idz_upload[data-id="'+t+'"]').remove(),e.find("img").on("load",function(){n.Templates.scrollChatBoxDialog()}),n.Templates.showDialog(),n.Templates.maximizeChatbar(),n.chat.put_dialog(e),n.Templates.scrollChatBoxDialog()},putOpProduct:function(t,e){e.find("img").on("load",function(){n.Templates.scrollChatBoxDialog()}),n.Templates.showDialog(),n.Templates.maximizeChatbar(),n.chat.put_dialog(e),n.Templates.scrollChatBoxDialog()},putOpMessageWithMultipleChoices:function(t,e,i,o){var a=function(t){for(var e=t,n=e.parentNode.children,r=n.length-1;r>=0;r--)if(e===n[r])return r};o?o.append(e):(n.Templates.showDialog(),n.Templates.maximizeChatbar(),r("#idz_dialogbox #idz_dialogbox_bottom").before(e),n.Templates.scrollChatBoxDialog()),e.find(".idz_choice_button").on("click",function(t){t.preventDefault();var e=r(this),o=e.parents("#hist_container").length>0,s=o&&r("#hist_container").is(":nth-last-child(2)"),c=e.parents(".idz_msg_operator").is(":nth-last-child(2)");if(s||!o&&c){if(i){var u=a(t.target);i[u](t.target.innerText)}else n.chat.onSendMessage(t.target.innerText);r(t.target).addClass("idz_choice_button_selected")}else e.off(t)})},putOpMsg:function(t,e,i,o){var a="";if(a=o?n.util.nl2br(e):n.util.nl2br(n.util.htmlspecialchars(e)),!f(t)){iAdvize.Templates.shouldNotOpenChatboxOnNewMessage||(n.Templates.showDialog(),n.Templates.maximizeChatbar());var s=n.chat.getOpMsg(a);n.chat.put_dialog(s),b.emit("events.operatorMessageAppended",n.operator),null!=t&&r("#idz_dialogbox").find(".idz_msgtext:last").attr({id:t}),n.chat.tagAutomatedMessages(r("#idz_dialogbox"),t),1===i?n.chat.updateHistory(n.chat.MESSAGE_TYPES.OPERATOR,e,t):2===i&&setTimeout(function(){n.chat.updateHistory(n.chat.MESSAGE_TYPES.OPERATOR,e,t)},2200),n.callbacks.onMessageReceived({time:n.chat.getMsgTime(),msg:e})}},onCommand:function(e){var o=e.body,a=e.from,s=e.barejid,c=e.getCommand(),u=function(){var t=n.operator.barejid;return null===t||S(t,s)},l=c.name,d=c.param1;c.param2;if(""===n.iframeID){if("routing_operator_found"===l){var f=function(){if(!n.operator.id){if(n.routing.enabled&&!n.activeCall&&(0===n.chat.history_id||0===n.vStats.history_id||!n.conversationJid))return n.errorMailer("Routing operator found with invalid states",new Error("invalid routing states"),"",{historyId:n.chat.history_id,vStatsHistoryId:n.vStats.history_id,jid:n.conversationJid,profile:e,operator:n.operator}),n.chat.putOpMsg(null,n.T("AN_ERROR_OCCURED_PLEASE_RETRY"),0,1),void n.chat.disableLoading();var t=o.substr(o.indexOf(" ")+1),e=JSON.parse(t);n.operator=e,!0===n.operator.isExpert&&n.chat.putOpAlert(n.chat.getExpertDisclaimer()),n.activeCall?C&&C.Service.onCallOperator(e.barejid):(n.logMailer("conversations.routing.operator.found","Routing operator found",{vuid:iAdvize.vuid,barejid:e.barejid}),h(),v.invitation.sendEngage(null,e.message,n.conversationJid,n.operator.barejid,n.website_id,n.chat.history_id).then(n.chat.sendProactifAlert),b.emit(y.OnEventVisitorProfileRequested,{from:e.barejid}),b.emit("events.chatBuilt",null))}};switch(!0){case n.activeCall!==t:f();break;case"1"==n.flags.visio_status:var p=o.substr(o.indexOf(" ")+1),g=JSON.parse(p);b.emit(y.OnConversationVisioRoutingDone,g);break;default:m.then(f)}}"windowsize"===l&&n.chat.sendCommand(a,"!windowsize "+r(window).width()+"|"+r(window).height()),"getcook"===l&&n.chat.sendCookie(a);var _=null;switch(l){case"vprofile":_=y.OnEventVisitorProfileRequested;break;case"customdata":_=y.OnEventCustomDataRequested;break;case"visio":"refused"===d?_=y.OnConversationVisioRefused:"timeout"===d?_=y.OnConversationVisioTimeout:"close"===d&&(_=y.OnConversationVisioClose);break;case"push":case"links":u()&&(_=y.OnEventLinkSent);break;case"offers":case"pushoffer":u()&&(_=y.OnEventOfferSent);break;case"blockme":_=y.OnEventVisitorBlocked;break;case"closedialog":u()&&(_=y.OnEventConversationClosed);break;case"ackEngage":_=y.OnEventEngageReceived;break;case"c2c":_=y.OnEventDeprecatedC2c}if(_&&b.emit(_,e),"nomoreslot"===l||"routing_operator_not_found"===l){if(n.routing.enabled&&!n.operator.barejid)return;n.routing.enabled&&n.logMailer("conversations.routing.operator.nomoreslot","Routing operator unavailable",{vuid:iAdvize.vuid,barejid:n.operator.id,history_id:n.chat.history_id}),n.chat.putOpMsg(null,n.T("BONJOUR_NOTRE_SERVICE_CLIENT_EST_ACTUELLEMENT_FERME"),0,1),n.util.addScript("IDZhistory",n.chaturl+"rpc/chat_history.php?sid="+n.website_id+"&missed="+n.chat.history_id+"&oid="+n.operator.id+"&u="+n.vuid),n.opOffline=1,n.chat.status=1,n.operator={}}if("showinvit"===l&&n.chat.loadInvitation(d),"init_cobro"===l&&x){if(!x.init)return!0;x.init().done(function(){n.operator.barejid&&n.chat.sendCommand(n.operator.barejid,"!cobro_init")})}}if("magic_event"===l){if(!x)return!0;if(!x.isReceiver||!x.changeState)return n.errorMailer("Mirroring magic_event error: Defined Mirror but undefined methods",{object:x,type:void 0===x?"undefined":i(x),browser:window.navigator.userAgent,url:window.location.href},""),!0;"sender"==d||"disabled"==d||"receiver"==d?("sender"==d&&x.isReceiver()&&(r("#op_cursor").animate({top:"-3000px",left:"-3000px"},150),""==n.iframeID&&(n.Templates.showDialog(),n.chat.cobrowsing=0,n.JSONStore.saveData({chat_cobrowsing:n.chat.cobrowsing}),n.chat.putOpAlert(n.T("COBROWSING_STOP")),n.chat.updateHistory(n.chat.MESSAGE_TYPES.OPERATOR_ALERT,"COBROWSING_STOP"),n.callbacks.onCobrowsingStopped())),"sender"!=d||n.operator.barejid||(n.monitor_jid=s),"disabled"==d&&2!=n.chat.status&&delete n.monitor_jid,x.changeState(d)):"receiver_request"==d&&""==n.iframeID&&(n.chat.buildChat(),n.Templates.showDialog(),n.Templates.maximizeChatbar(),n.chat.put_dialog(n.Templates.askCobrowsing.replace(/\{TIME\}/g,n.chat.getMsgTime())),n.chat.updateHistory(n.chat.MESSAGE_TYPES.OPERATOR_ALERT,"COBROWSING_ASK"),r('[id="idz_cobrowsing_accept"]').bind("click",function(t){return n.chat.addCobrowsingImg(),r(t.target).closest(".idz_msg_alert_op").remove(),n.chat.put_dialog(n.Templates.opAlert.replace(/\{MSG\}/g,n.T("COBROWSING_ACCEPT")).replace(/\{TIME\}/g,n.chat.getMsgTime())),x.state("receiver"),n.chat.sendCommand(n.operator.barejid,"!magic_event receiver_accept"),"numericable"==n.customize.layout||n.flags.streamId||(n.Templates.hideDialog(),n.chatbar_state=1,n.JSONStore.saveData({chatbar_state:n.chatbar_state})),n.chat.cobrowsing=1,n.JSONStore.saveData({chat_cobrowsing:n.chat.cobrowsing}),n.callbacks.onCobrowsingAccepted(),!1}),r('[id="idz_cobrowsing_refuse"]').bind("click",function(t){return r(t.target).closest(".idz_msg_alert_op").remove(),n.chat.put_dialog(n.Templates.opAlert.replace(/\{MSG\}/g,n.T("COBROWSING_REFUSE")).replace(/\{TIME\}/g,n.chat.getMsgTime())),n.chat.sendCommand(n.operator.barejid,"!magic_event receiver_refuse"),n.callbacks.onCobrowsingRefused(),!1}),n.callbacks.onCobrowsingRequested())}"change_page"===l&&(document.location.href=decodeURIComponent(d))},onChatStates:function(t,e){try{S(n.operator.pseudo,t)&&""===n.iframeID&&("composing"===e?(r(".idz_writting").html(n.T("OPERATEUR_COMPOSING")),n.callbacks.onOperatorWriting()):(r(".idz_writting").html(" "),n.callbacks.onOperatorStopWriting()))}catch(t){n.PROD?n.errorMailer("onChatState: ",t,e):console&&console.debug&&console.debug("[Erreur][onChatStates]",t.message,e)}},onMessage:function(t){var e=t.body,i=t.id,o=t.from,a=t.barejid;if(!function(t){return Strophe.getResourceFromJid(t)===n.vuid}(o)&&""==n.iframeID){if(n.opBusy=0,!function(){var t=n.conversationJid;return null===t||S(t,a)}())return n.chat.sendCommand(a,"!chatting"),r(".idz_writting").html(" "),!0;if(n.operator.barejid||(n.operator.barejid=a),n.chat.putOpMsg(i,e,1),setTimeout(function(){r(".idz_writting").html(" ")},350),n.chat.status=2,n.chatbox_state=n.chat.OPENED,n.virtualOP=0,n.blink_title(),"1"==n.customize.sound_alert){n.playSound("message")}}},onMessageReceipt:function(t){try{if(t.isCommand()){var e=t.getCommand();"transfer"===e.name&&n.transfer(e.param1)}}catch(e){n.PROD?n.errorMailer("onReceipt: ",e,t):console&&console.debug&&console.debug("[Erreur][onMessageReceipt]",e.message,t)}return!0},EndOfChat:function(){n.chat.status=3,(0==n.chat.prev_history||isNaN(n.chat.prev_history)||n.chat.history_id>n.chat.prev_history)&&(n.chat.prev_history=n.chat.history_id),n.chat.history_id=0,n.chatbox_state=n.chat.CHATBOX_STATES.CHATBAR_HIDDEN,n.JSONStore.save({chat_status:n.chat.status,chatbox_state:n.chatbox_state,chatbar_state:n.chatbar_state}),n.operator={},v.getConnection().connected&&(v.room.leave(n.conversationJid,n.vuid),n.chat.sendPresence("available"))},showConnectionError:function(){(r("#idz_chatglobal").is(":visible")||2==n.chat.status)&&(r(".idz_writting").html(""),n.chat.putOpAlert(n.T("CONNECTION_ERREUR")),n.chat.disableLoading(),r("#idz_msgmsg, #idz_postmsg").prop("disabled",!0))},sendXmppMessage:function(t,e){var i=r.Deferred();try{if(!t||""===t)return i.reject("desk.publish.error.empty"),i.promise();if(n.blocked)return i.reject("desk.publish.error.blocked"),i.promise();3==n.chat.status&&n.chat.history_id>0&&n.chat.sendPresence("dnd"),n.chat.status=2,n.chatbox_state=n.chat.CHATBOX_STATES.OPENED,n.chatbar_state=0,v.room.groupchat(t,e).done(function(t){i.resolve(t)}).fail(n.chat.onRetrySendMessage)}catch(t){return i.reject("desk.publish.error.unknown",t)}return i.promise()},onRetrySendMessage:function(t,e,r){r&&r.done(function(t){}).fail(n.chat.onRetrySendMessage)},sendChatClose:function(){b.emit(y.OnEventConversationClosed)},sendAlert:function(t,e,r){try{if(1==n.virtualOP)return;var i=(new Date).getTime();if(2==n.chat.status||r){var o=$msg({to:n.operator.barejid,from:v.getConnection().jid,type:"chat",id:i,website:n.website_id}).c("body").t(t);return v.getConnection().send(o),i}}catch(r){n.errorMailer("sendAlert: ",r,t+"\n\n"+e)}},sendPresence:function(t){var e={site:n.website_id,opid:n.operator.id,frameid:n.iframeID};n.chat.history_id&&(e.history=n.chat.history_id),"unavailable"==t?v.getConnection().send($pres({type:"unavailable"})):"available"==t?v.getConnection().send($pres(e).c("status").t(location.href)):"away"!=t&&"dnd"!=t||v.getConnection().send($pres(e).c("show").t(t).up().c("status").t(location.href))},sendCommand:function(t,e){if(v.isOnline(t)){var r=(new Date).getTime();v.getConnection().send($msg({id:r,to:t+"/operators",from:v.getConnection().jid,type:"command",website:n.website_id}).c("body").t(e))}},sendCookie:n.util.runOnce(1500,function(t){var e="!getcook "+n.chat.cCook;v.getConnection().send($msg({to:t[0],from:v.getConnection().jid,type:"command",website:n.website_id}).c("body").t(e))}),getMsgTime:function(){var t=new Date,e=t.getHours(),n=t.getMinutes();return n<10&&(n="0"+n),e+":"+n},put_dialog:function(t,e){var i=r(t);i.find(".idz_msgtext").attr("data-id",e);var o=i.attr("class"),a=r("#idz_dialogbox_bottom"),s=a.prev("div").attr("class"),c=a.prev("div").find(".idz_msgtime:last").html();if(n.Templates.hasGroupingMessagesDisabled||"idz_msg_operator"!=o&&"idz_msg_visitor"!=o||o!=s)r("#idz_dialogbox #idz_dialogbox_bottom").before(t);else{var u=i.find(".idz_msgtext"),l=i.find(".idz_msgtime");c==l.html()&&(l=""),a.prev("div").find(".idz_msgtext:last").after(u).after(l),"idz_msg_operator"==o&&r(".idz_opename:last").remove()}n.Templates.scrollChatBoxDialog()},getLocalTime:function(t){var e=6e4*(new Date).getTimezoneOffset(),n=new Date,r=new Date(n.getTime()+e);r.setHours(t.split(":")[0]),r.setMinutes(t.split(":")[1]);var i=new Date(r.getTime()-e),o=i.getHours(),a=i.getMinutes();return a<10&&(a="0"+a),o+":"+a},prepare_history:function(t){try{t=JSON.parse("["+t+"]")}catch(e){return void n.errorMailer("prepare_history JSON.parse: ",e,t)}var e=r("<div id='hist_container'></div>"),i="",o="",a="",s="",c="",u=!0,l=!1,d="",h="",p="",m=0;g.forEach(t,function(t){var r={type:t[0],time:n.chat.getLocalTime(t[1]),content:t[2],id:t[3]};if(f(r.id))return!0;if(h=n.util.htmlSimpleEscape(r.content),h=h.replace(/&lt;br \/&gt;/gi,"<br/>").replace(/&lt;br\/&gt;/gi,"<br/>").replace(/&lt;br&gt;/gi,"<br/>"),n.Templates.hasGroupingMessagesDisabled||m!=r.type||r.type!=n.chat.MESSAGE_TYPES.OPERATOR&&r.type!=n.chat.MESSAGE_TYPES.VISITOR?r.type==n.chat.MESSAGE_TYPES.OPERATOR?e.append(n.chat.getOpMsg(h,r.time)):r.type==n.chat.MESSAGE_TYPES.VISITOR&&e.append(n.chat.getVmsg(h,r.time)):(d=p==r.time?"":"<div class='idz_msgtime'>"+r.time+"</div>",h=n.chat.convertLinks(h,!0),h=w.replaceUtf8ToImage("apple",h),e.find(".idz_msgtext:last").after("<div class='idz_msgtext'>"+h+"</div>").after(d)),n.chat.tagAutomatedMessages(e,r.id),m=r.type,p=r.time,r.type==n.chat.MESSAGE_TYPES.VISITOR&&u&&(u=!1,!0===n.operator.isExpert&&(e.append(n.chat.getOpAlert(n.chat.getExpertDisclaimer(),p)),m=n.chat.MESSAGE_TYPES.OPERATOR_ALERT,l=!0)),r.type==n.chat.MESSAGE_TYPES.OPERATOR_ALERT){if(i=r.content,"LINKS"===(o=i.split(" ")[0])||"PUSH"===o){a=i.split(" ")[1],s=i.substr(a.length+o.length+2),-1==a.indexOf(n.website_url,0)&&(c=" target='_blank'");var g=n.Templates.putLinkItem(a,s,c);O()?e.append(g):("LINKS"===o&&e.append(n.chat.getOpAlert(n.T("OPERATEUR_SENDLINK"),r.time)),"PUSH"===o&&e.append(n.chat.getOpAlert(n.T("OPERATEUR_PUSHLINK"),r.time)))}if("OFFERS"===o){a=i.split(" ")[1],s=i.substr(a.length+o.length+2),-1===a.indexOf(n.website_url)&&(c=" target='_blank'");var v=n.Templates.putOfferItem(a,s,c);O()?e.append(v):e.append(n.chat.getOpAlert(n.T("OPERATEUR_SENDOFFER"),r.time))}"VISIOCONF_ACCEPT"===o&&e.append(n.chat.getOpAlert(n.T("VISIOCONF_ACCEPT"),r.time)),"COBROWSING_ASK"===o&&e.append(n.chat.getOpAlert(n.T("COBROWSING_ASK_SHORT"),r.time)),"COBROWSING_ACCEPT"===o&&e.append(n.chat.getOpAlert(n.T("COBROWSING_ACCEPT"),r.time)),"COBROWSING_REFUSE"===o&&e.append(n.chat.getOpAlert(n.T("COBROWSING_REFUSE"),r.time)),"COBROWSING_STOP"===o&&e.append(n.chat.getOpAlert(n.T("COBROWSING_STOP"),r.time)),"CHAT_CLOSE"!==o&&"VISITOR_CHAT_CLOSE"!==o&&"OPERATOR_CHAT_CLOSE"!==o||e.append(n.chat.getOpAlert(n.T("FIN_DISCUSSION_SHORT"),r.time))}if(r.type==n.chat.MESSAGE_TYPES.OPERATOR&&E.push(r.id),r.type===n.chat.MESSAGE_TYPES.OPERATOR_RICH_CONTENT||r.type===n.chat.MESSAGE_TYPES.VISITOR_RICH_CONTENT)try{var _=JSON.parse(r.content),C=r.type===n.chat.MESSAGE_TYPES.OPERATOR_RICH_CONTENT?"operator":"visitor";b.emit(y.OnXmppOOBReceived,r.id,C,r.time,_.type,_.data.url,_.data,e)}catch(t){console.error(t)}}),!1===l&&!0===n.operator.isExpert&&e.append(n.chat.getOpAlert(n.chat.getExpertDisclaimer())),r("#idz_dialogbox #idz_dialogbox_bottom").before(e),b.emit("events.operatorMessageAppended",n.operator),n.chatbox_state==n.chat.CHATBOX_STATES.OPENED&&n.chat.offercount>1&&(O()||n.Templates.showOfferPanel()),n.Templates.scrollChatBoxDialog(),n.Templates.scrollLinkDialog()},getExpertDisclaimer:function(){return n.T("chatbox.operatorAlert.expertDisclaimer").replace(/\{\{ company }}/g,n.website_label)}},n.blink_title=function(){1!==n.hasFocus&&(null!==n.blinktm&&(clearInterval(n.blinktm),n.blinktm=null),n.blinktm=setInterval(function(){r("title").html()===n.oTitle?document.title=n.T("NOUVEAU_MESSAGE"):document.title=n.oTitle},1500))},n.findOPDelayed=function(){return n.routing.enabled?0:setTimeout(function(){n.AvailableOp.find()},1500)},n.findOpCallback=function(t){var e=n.preferences.priority_channel;if("all"!=e&&0==t.opOffline&&0==t.c2cOffline&&("chat"==e&&(t.c2cOffline=1),"call"==e&&(t.opOffline=1)),n.opOffline=t.opOffline,n.c2cOffline=t.c2cOffline,n.callMeeting.available=!!t.callMeeting&&t.callMeeting.available,n.callMeeting.enabled=!!t.callMeeting&&t.callMeeting.enabled,n.callInstant.available=!!t.callInstant&&t.callInstant.available,n.callInstant.enabled=!!t.callInstant&&t.callInstant.enabled,n.callOffline.available=!!t.callOffline&&t.callOffline.available,n.callOffline.enabled=!!t.callOffline&&t.callOffline.enabled,n.c2vOffline=t.c2vOffline,void 0!==t.opBusy&&(n.opBusy=t.opBusy),setTimeout(function(){2!=n.chat.status&&(n.callbacks.onStatusChanged({offline:t.opOffline,busy:t.opBusy,c2cOffline:t.c2cOffline}),n.callbacks.onCallStatusChanged({offline:t.c2cOffline,chatOffline:t.opOffline}))},450),1==t.opOffline&&1==n.c2cOffline&&1==n.c2vOffline){try{n.triggerOCallback(),!0===n.chat.connected&&x&&x.disable&&x.disable()}catch(t){}try{n.chat.status<2&&n.Templates.hideUI()}catch(t){}}else if(setTimeout(n.triggerOCallback,300),1==t.opOffline)try{n.chat.status<2&&n.Templates.hideUI()}catch(t){}b.emit("targeting.poll.callback",t)},n.onActivity=function(){n.vStats.lastMove=(new Date).getTime(),null==n.vStats.activeSince&&(n.vStats.activeSince=(new Date).getTime())},n.triggerOCallback=function(){n.OCallBack&&(1==n.opOffline&&1==n.c2cOffline||1==n.on_call?n.OCallBack.onOffline():n.OCallBack.onOnline())},n.onChatButtonDisplay=function(){b.emit(y.chatButtonDisplayed),n.callButCB||(n.callbacks.onChatButtonDisplayed(),n.callButCB=!0)},n.onCallButtonDisplay=function(){b.emit(y.callButtonDisplayed),n.chatButCB||(n.callbacks.onCallButtonDisplayed(),n.chatButCB=!0)},n.onVisioButtonDisplay=function(){b.emit(y.videoButtonDisplayed),n.visioButCB||(n.callbacks.onVideoButtonDisplayed(),n.visioButCB=!0)},n.logMailer=_.info,n.errorMailer=_.error,void 0===n.Utils&&(n.Utils={}),n.Utils.errorMailer=n.errorMailer}}(iAdvize,iAdvize.$)},{lodash:30}],44:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(t){return{hasContactOngoing:function(){return t.chat&&(2==t.chat.status||3==t.chat.status&&t.chat.history_id>0)}}}},{}],45:[function(e,n,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.default=function(e,n,r,i){var o=null,a=!!r.get("isMessengerChatboxOpen"),s={create:function(t){var e=!1;this.observer=new MutationObserver(function(t){t.forEach(function(t){e?"IFRAME"===t.target.tagName&&"style"===t.attributeName&&(a="inline"===t.target.style.display&&"360pt"===t.target.style.height,r.set("isMessengerChatboxOpen",a)):"fb-xfbml-state"===t.attributeName&&"rendered"===t.target.getAttribute("fb-xfbml-state")&&(e=!0)})}),this.observer.observe(t,{subtree:!0,attributes:!0})},destroy:function(){this.observer.disconnect()}},c={chatbox:{render:function(a){var c=arguments.length>1&&arguments[1]!==t?arguments[1]:"";if(o)throw new Error("A messenger chatbox is already rendered");r.set("messengerChatboxPageId",a),o=n('<div class="fb-customerchat" page_id="'+a+'" ref="'+c+'"></div>').appendTo(e),s.create(o.get(0)),i.renderTagElement(o.get(0))},destroy:function(){n("#fb-root .fb_dialog").remove(),o.remove(),s.destroy(),o=null}},hasContactOngoing:function(){return a}};return a&&c.chatbox.render(r.get("messengerChatboxPageId")),c}},{}],46:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(t,e,n,r,c,u){var l=(0,o.default)(c,r),d={legacy:(0,a.default)(n),messenger:(0,s.default)(t,e,l,u)};return{hasContactOngoing:function(){return(0,i.some)((0,i.values)(d),function(t){return t.hasContactOngoing()})},getEngine:function(t){return(0,i.omit)(d,"legacy")[t]}}};var i=t("lodash"),o=r(t("./stateStore")),a=r(t("./channels/legacy")),s=r(t("./channels/messenger"))},{"./channels/legacy":44,"./channels/messenger":45,"./stateStore":47,lodash:30}],47:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t("lodash");n.default=function(t,e){var n=(0,r.clone)(e);return{get:function(t){return(0,r.get)(n,t)},set:function(e,i){n[e]=i,t.saveData((0,r.pick)(n,e))}}}},{lodash:30}],48:[function(t,e,n){"use strict";e.exports=function(t,e){var n=iAdvize,r=!1,i=function(){return!!(window.File&&window.FileList&&window.FileReader)&&void 0!==window.FormData};t.on(e.OnConversationChatFileSelected,function(n){for(var r=n.target.files,i=0;i<r.length;i++){var o=r[i];o.size>3e7?t.emit(e.OnConversationChatUploadMaxSizeReached,3e7,o):/image\//.test(o.type)||/application\/pdf/.test(o.type)?t.emit(e.OnConversationChatUploadFilesChecked,o):t.emit(e.OnConversationChatUploadBadMimeType,o)}}),t.on(e.OnXmppConnectionConnected,function(){i()&&n.Templates.upload&&!r&&(n.Templates.upload.initialize(),r=!0,t.emit(e.OnConversationChatUploadInitialized))})}},{}],49:[function(t,e,n){"use strict";e.exports=function(t,e,n){var r=function(e){var n=t.$("#idz_msgmsg").get(0),r=n.selectionStart,i=[n.value.substr(0,n.selectionStart),e,n.value.substr(n.selectionStart,n.value.length-1)].join("");t.$(n).val(i).focus().trigger("change"),n.setSelectionRange(r+e.length,r+e.length)};e.on(n.OnConversationChatEmojiSelected,function(t,e){r(":"+t.shortname+":")})}},{}],50:[function(t,e,n){"use strict";var r=t("lodash");e.exports=function(t,e,n,i){var o=t.$,a=null,s=0,c=!1;1===t.preferences.mirroring_enabled&&(a=t.require("mirror"));var u=function(e){return t.operator.barejid===e&&2===t.chat.status},l=function(e,n){t.operator.nick+"@"+t.bosh_host===n&&(t.operator.is_online=e,t.operator.barejid=n,0===e&&a&&a.disable&&a.disable())};e.on(n.OnXmppRosterUserAvailable,function(e){if(u(e))return s>0?(clearTimeout(s),void(s=0)):void(c&&(t.chat.put_dialog(t.Templates.opAlert.replace(/\{MSG\}/g,t.T("OPERATEUR_RECONNECTION")).replace(/\{TIME\}/g,t.chat.getMsgTime())),c=!1))}),e.on(n.OnXmppRosterUserUnavailable,function(e){u(e)&&(s=r.delay(function(e){s=0,i.isOnline(e)||(t.chat.put_dialog(t.Templates.opAlert.replace(/\{MSG\}/g,t.T("OPERATEUR_DECONNECTION")).replace(/\{TIME\}/g,t.chat.getMsgTime())),o(".idz_writting").html(" "),c=!0)},1e4,e))}),e.on(n.OnXmppRosterUserUnavailable,r.partial(l,0)),e.on(n.OnXmppRosterUserAvailable,r.partial(l,1))}},{lodash:30}],51:[function(t,e,n){Object.defineProperty(n,"__esModule",{value:!0});n.OnEventCallErrored="events.call.errored",n.OnEventCallOperatorAnswered="events.call.operator_answered",n.OnEventCallRedialed="events.call.redialed",n.OnEventCallStarted="events.call.started",n.OnEventCallStopped="events.call.stopped",n.OnEventConversationClosed="event.conversation.closed",n.OnEventCustomDataRequested="event.custom_data.requested",n.OnEventDeprecatedC2c="event.deprecated.c2c",n.OnEventEngageReceived="event.engage.received",n.OnEventEngagementRuleTriggered="event.engagement.rule.triggered",n.OnEventLinkSent="event.link.sent",n.OnEventOfferSent="event.offer.sent",n.OnEventVisitorBlocked="event.visitor.blocked",n.OnEventVisitorProfileRequested="event.visitor.profile.requested"},{}],52:[function(e,n,r){n.exports=function(e,n,r,i,o){var a=arguments.length>5&&arguments[5]!==t?arguments[5]:4e3,s=function(){2===e.chat.status&&(e.$("#idz_msgmsg, #idz_postmsg").prop("disabled",!0),e.flags.visio_status&&n.emit(r.OnConversationVisioClosed),e.chat.putOpAlert(e.T("FIN_DISCUSSION")),e.callbacks.onChatEnded({id:e.chat.history_id,endedBy:"operator"}),delete e.operator.barejid,setTimeout(function(){e.$("#idz_msgmsg, #idz_postmsg").prop("disabled",!1),-1===e.operator.id||1===e.virtualOP||"1"!=e.preferences.param_satisfaction||0!==e.chat.satisfaction||e.blocked?e.Templates.hideDialog():(e.chat.satisfaction=1,e.Templates.displaySatisfaction(),e.callbacks.onSatisfactionDisplayed())},a)),e.flags.popup_mode&&delete e.flags.popup_mode,e.chat.EndOfChat()},c=function(){i.connection.getConnection().send(new i.stanzaBuilder("message",{to:e.operator.barejid,from:i.connection.getConnection().jid,type:"command",id:(new Date).getTime(),website:e.website_id}).c("body").t("!chatclose"))};n.on(r.OnEventConversationClosed,function(){if((arguments.length>0&&arguments[0]!==t?arguments[0]:{from:""}).from)s();else{var n=new o,r=new i.stanzaBuilder("message",{to:e.conversationJid,type:"groupchat"});r.cnode(n.build(i.stanzaBuilder,i.namespaces).tree()),i.connection.getConnection().send(r),c();var a=n.id;1!=e.chat.status&&(e.chat.status=3,e.chat.sendPresence("available"),e.JSONStore.saveData({chat_status:e.chat.status,visitor_closed:1}),e.chat.updateHistory(e.chat.MESSAGE_TYPES.OPERATOR_ALERT,"VISITOR_CHAT_CLOSE",a))}})}},{}],53:[function(t,e,n){e.exports=function(t,e,n,r,i){var o=function(e,n){r.connection.getConnection().send(new r.stanzaBuilder("message",{to:e,from:r.connection.getConnection().jid,type:"command",website:t.website_id}).c("body").t("!customdata "+n))};e.on(n.OnEventCustomDataRequested,function(e){var n=e.from,a=t.vStats.customData(),s=new i(a),c=new r.stanzaBuilder("message",{to:t.conversationJid,type:"groupchat"});c.cnode(s.build(r.stanzaBuilder,r.namespaces).tree()),r.connection.getConnection().send(c),o(n,a)})}},{}],54:[function(e,n,r){n.exports=function(e,n,r,i){var o=arguments.length>4&&arguments[4]!==t?arguments[4]:1,a=function(){e.JSONStore.saveData({on_call:e.on_call,chat_status:e.chat.status,history_id:e.chat.history_id,chatbox_state:e.chatbox_state})};n.on(r.OnEventDeprecatedC2c,function(t){var i=t.getCommand().param1;switch(clearTimeout(e.c2cTimeout),i){case"opanswered":n.emit(r.OnEventCallOperatorAnswered,t);break;case"start":n.emit(r.OnEventCallStarted,t);break;case"stop":n.emit(r.OnEventCallStopped,t);break;case"error":n.emit(r.OnEventCallErrored,t);break;default:a()}}),n.on(r.OnEventCallOperatorAnswered,function(t){var n=t.raw.context.getAttribute("conversationJid");i.connection.room.join(n,e.vuid),e.conversationJid=n;var r=t.getCommand().param2,s=t.barejid;e.callbacks.onCallStarted(),1===e.preferences.c2c_callvisitorfirst?document.querySelector(".c2cpopin_label").innerHTML='<div class="c2cpopin_label_phone"></div>'+e.T("NOUS_VOUS_RAPPELLONS_GRATUITEMENT_TXT2"):document.querySelector(".c2cpopin_label").innerHTML='<div class="c2cpopin_label_phone"></div>'+e.T("NOUS_VOUS_RAPPELLONS_GRATUITEMENT_TXT3"),1!==e.preferences.call_offline_enabled&&(e.on_call=1),e.opOffline=0,e.chat.status=2,e.chat.history_id=parseInt(r,10),e.vStats.history_id=parseInt(r,10),e.chat.dialogCount(),e.triggerOCallback(),e.operator=e.c2coperator,e.c2coperator.barejid&&e.c2coperator.barejid.toLowerCase()===s.toLowerCase()||(e.c2coperator.barejid=s.toLowerCase(),e.operator.barejid=s.toLowerCase(),e.util.addScript("getop",e.chaturl+"rpc/getop.php?sid="+e.website_id+"&u="+e.vuid+"&getop="+s)),e.flags.proactif_alert&&""!=e.flags.proactif_alert&&e.chat.sendAlert(e.flags.proactif_alert,e.flags.message,!0),e.c2cTimeout=setTimeout(function(){document.querySelector("#c2cpopin_step2").style.display="none",document.querySelector("#c2cpopin_step1").style.display="",e.chat.closeC2cPopin()},1e4*o),a()}),n.on(r.OnEventCallStarted,function(t){document.querySelector(".c2cpopin_label").innerHTML='<div class="c2cpopin_label_phone"></div>'+e.T("NOUS_VOUS_RAPPELLONS_GRATUITEMENT_TXT3"),e.chat.dialogCount(),1!==e.preferences.call_offline_enabled&&(e.on_call=1);var n=t.getCommand().param2;e.opOffline=0,e.chat.status=2,e.chat.history_id=parseInt(n,10),setTimeout(function(){document.querySelector("#c2cpopin_step2").style.display="none",document.querySelector("#c2cpopin_step1").style.display="",e.chat.closeC2cPopin()},7e3*o),a()}),n.on(r.OnEventCallStopped,function(t){i.connection.room.leave(e.conversationJid,e.vuid),e.callbacks.onCallEnded();var n=document.querySelector(".c2cpopin_label");n&&(n.innerHTML='<div class="c2cpopin_label_phone"></div>'+e.T("NOUS_VOUS_RAPPELLONS_GRATUITEMENT_TXT1")),e.on_call=0,e.chat.status=3,e.chat.history_id=0,e.chatbox_state=e.chat.CHATBAR_HIDDEN,e.activeCall=null,setTimeout(function(){document.querySelector("#c2cpopin_step2").style.display="none",document.querySelector("#c2cpopin_step1").style.display="",e.chat.closeC2cPopin()},7e3*o),"1"==e.preferences.param_satisfaction&&0==e.chat.satisfaction&&(e.chat.buildChat(),e.chat.satisfaction=1,e.Templates.displaySatisfaction(),e.callbacks.onSatisfactionDisplayed()),a()}),n.on(r.OnEventCallErrored,function(t){e.chat.showC2cError(e.T(t.getCommand().param2.trim())),e.on_call=0,e.chat.status=1,a()})}},{}],55:[function(t,e,n){e.exports=function(t,e,n){e.on(n.OnEventEngageReceived,function(){if(t.routing.enabled&&t.logMailer("conversations.routing.operator.engage.acknowledge","Routing acknowledge received",{vuid:t.vuid,barejid:t.operator.barejid,historyId:t.chat.history_id}),2!==t.chat.status){var e="visitor";(t.flags.proactif_alert||t.flags.proactif_invit)&&(e="proactif"),t.callbacks.onChatStarted({id:t.chat.history_id,startedBy:e})}t.chat.status=2,t.operator.barejid=t.operator.barejid})}},{}],56:[function(t,e,n){e.exports=function(t,e,n,r,i){var o=function(){r.connection.getConnection().send(new r.stanzaBuilder("message",{to:t.operator.barejid,from:r.connection.getConnection().jid,type:"command",id:(new Date).getTime(),website:t.website_id}).c("body").t(t.flags.proactif_alert))};e.on(n.OnEventEngagementRuleTriggered,function(){if(t.flags.proactif_alert&&""!=t.flags.proactif_alert){var e=t.ProActif._datas.filter(function(e){return e.id===t.flags.proactif_activatedId});if(!e.length)return;var n=new i(e[0]),a=new r.stanzaBuilder("message",{to:t.conversationJid,from:r.connection.getConnection().jid,type:"groupchat"});a.cnode(n.build(r.stanzaBuilder,r.namespaces).tree()),r.connection.getConnection().send(a),o()}})}},{}],57:[function(e,n,r){n.exports=function(e,n,r,i){var o=arguments.length>4&&arguments[4]!==t?arguments[4]:800,a=function(t){var n={url:"",name:"",pushed:!1},r=n;return t.getCommand().param1&&(r.url=e.util.nl2br(e.util.htmlspecialchars(decodeURIComponent(t.getCommand().param1)))),t.getCommand().param2&&(r.name=t.getCommand().param2,r.pushed="push"===t.getCommand().name),Array.prototype.slice.call(t.raw.context.childNodes).filter(function(t){return t.namespaceURI===i.namespaces.event_link_sent}).reduce(function(t,n){t.name,t.description,t.image,t.pushed;return{name:n.querySelector("name").innerHTML,url:e.util.nl2br(e.util.htmlspecialchars(decodeURIComponent(n.querySelector("url").innerHTML))),pushed:!!JSON.parse(n.getAttribute("pushed"))}},n)},s=function(){if(e.Templates.newTemplates)e.noOfferPanelTemplate=e.Templates.isResponsive;else{var t=e.require("template").customizer;e.noOfferPanelTemplate=t.noOfferPanelTemplate(e.customize.layout)}return e.noOfferPanelTemplate};n.on(r.OnEventLinkSent,function(t){var n="",r=a(t),i=r.pushed?"PUSH":"LINKS";e.chat.updateHistory(e.chat.MESSAGE_TYPES.OPERATOR_ALERT,i+" "+r.url+" "+r.name),e.callbacks.onLinkReceived({name:r.name,url:r.url,push:r.pushed}),-1===r.url.indexOf(e.website_url)?n=" target='_blank'":r.pushed&&setTimeout(function(){window.parent.location.assign(r.url)},o);var c=e.Templates.putLinkItem(r.url,r.name,n);s()?e.chat.put_dialog(c):e.chat.putOpAlert(e.T(r.pushed?"OPERATEUR_PUSHLINK":"OPERATEUR_SENDLINK"))})}},{}],58:[function(e,n,r){n.exports=function(e,n,r,i){arguments.length>4&&arguments[4]!==t&&arguments[4];var o=function(t){var e={url:"",name:"",descrption:"",image:""},n=t.getCommand().param2;if(n){var r=["url","name","descrption","image"];return(t.getCommand().param1+"|"+n).split("|").reduce(function(t,e,n){return t[r[n]]=e,t},e)}return Array.prototype.slice.call(t.raw.context.children).filter(function(t){return t.namespaceURI===i.namespaces.event_offer_sent}).reduce(function(t,e){return{name:e.querySelector("name").innerHTML,description:e.querySelector("description").innerHTML,image:e.querySelector("image").innerHTML,url:e.querySelector("url").innerHTML}},e)},a=function(){if(e.Templates.newTemplates)e.noOfferPanelTemplate=e.Templates.isResponsive;else{var t=e.require("template").customizer;e.noOfferPanelTemplate=t.noOfferPanelTemplate(e.customize.layout)}return e.noOfferPanelTemplate};n.on(r.OnEventOfferSent,function(t){var n="",r=o(t);e.chat.updateHistory(e.chat.MESSAGE_TYPES.OPERATOR_ALERT,"OFFERS "+e.util.htmlspecialchars(r.url)+" "+e.util.htmlspecialchars([r.name,r.descrption,r.image].join("|"))),-1===r.url.indexOf(e.website_url)&&(n=" target='_blank'");var i=e.Templates.putOfferItem(e.util.htmlspecialchars(r.url),e.util.htmlspecialchars([r.name,r.descrption,r.image].join("|")),n);a()?e.chat.put_dialog(i):e.chat.putOpAlert(e.T("OPERATEUR_SENDOFFER")),e.callbacks.onOfferReceived({name:r.name,url:r.url})})}},{}],59:[function(t,e,n){e.exports=function(t,e,n){e.on(n.OnEventVisitorBlocked,function(){2===t.chat.status?(t.chat.put_dialog(t.Templates.opAlert.replace(/\{MSG\}/g,t.T("OPERATEUR_DECONNECTION")).replace(/\{TIME\}/g,t.chat.getMsgTime())),t.blocked=!0):t.Templates.hideUI()})}},{}],60:[function(t,e,n){e.exports=function(t,e,n,r,i){var o=function(e,n){r.connection.getConnection().send(new r.stanzaBuilder("message",{to:e,from:r.connection.getConnection().jid,type:"command",website:t.website_id}).c("body").t("!vprofile "+n))};e.on(n.OnEventVisitorProfileRequested,function(e){var n=e.from,a=t.vStats.getProfile(),s=JSON.parse(a),c=new i(s),u=new r.stanzaBuilder("message",{to:t.conversationJid,type:"groupchat"});u.cnode(c.build(r.stanzaBuilder,r.namespaces).tree()),r.connection.getConnection().send(u),o(n,a)})}},{}],61:[function(t,e,n){function r(t){return t&&t.__esModule?t:{default:t}}var i=r(t("./models/ConversationClosed")),o=r(t("./models/CustomDataSent")),a=r(t("./models/EngagementRuleTriggered")),s=r(t("./models/VisitorProfileSent"));e.exports=function(e,n,r,c){t("./handlers/ConversationClosedHandler")(e,n,r,c,i.default),t("./handlers/CustomDataRequestedHandler")(e,n,r,c,o.default),t("./handlers/DeprecatedC2cHandler")(e,n,r,c),t("./handlers/EngageReceivedHandler")(e,n,r),t("./handlers/EngagementRuleTriggeredHandler")(e,n,r,c,a.default),t("./handlers/LinkSentHandler")(e,n,r,c),t("./handlers/OfferSentHandler")(e,n,r,c),t("./handlers/VisitorBlockedHandler")(e,n,r),t("./handlers/VisitorProfileRequestedHandler")(e,n,r,c,s.default)}},{"./handlers/ConversationClosedHandler":52,"./handlers/CustomDataRequestedHandler":53,"./handlers/DeprecatedC2cHandler":54,"./handlers/EngageReceivedHandler":55,"./handlers/EngagementRuleTriggeredHandler":56,"./handlers/LinkSentHandler":57,"./handlers/OfferSentHandler":58,"./handlers/VisitorBlockedHandler":59,"./handlers/VisitorProfileRequestedHandler":60,"./models/ConversationClosed":62,"./models/CustomDataSent":63,"./models/EngagementRuleTriggered":64,"./models/VisitorProfileSent":65}],62:[function(e,n,r){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function(){function e(){var n=arguments.length>0&&arguments[0]!==t?arguments[0]:(new Date).getTime();i(this,e),this.id=n}return o(e,[{key:"build",value:function(t,e){return new t("event",{xmlns:e.event_conversation_closed})}}]),e}();r.default=a},{}],63:[function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=function(){function t(e){r(this,t),this.customData=e}return i(t,[{key:"build",value:function(t,e){var n=new t("event",{xmlns:e.event_custom_data_sent});return n.c("custom-data",{},this.customData),n}}]),t}();n.default=o},{}],64:[function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=function(){function t(e){r(this,t),this.rule=e}return i(t,[{key:"build",value:function(t,e){return new t("event",{xmlns:e.event_engagement_rule_triggered,name:this.rule.label})}}]),t}();n.default=o},{}],65:[function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=t("lodash"),a=function(){function t(e){r(this,t),this.lang=e.lang||"",this.name=e.name||"",this.vuid=e.vuid||"",this.browser=this._default(this.buildBrowser(e)),this.geoloc=this._default(this.buildGeoLoc(e)),this.activity=this._default(this.buildActivity(e)),this.profile=e}return i(t,[{key:"_default",value:function(t){return(0,o.mapValues)(t,function(t){return isNaN(parseInt(t,10))?t||"":parseInt(t,10)})}},{key:"buildBrowser",value:function(t){return{actualURI:t.actualURI,referrerLastPage:t.referrerLastPage,actualScreen:t.actualScreen,winWidth:t.winWidth,winHeight:t.winHeight,browserInfo:t.browserInfo,deviceInfo:t.deviceInfo,userAgent:t.userAgent,ip:t.ip,deviceType:t.deviceType,originSite:t.originSite,origin:t.origin,refEngine:t.refEngine,refKeyword:t.refKeyword,sessionId:t.sessionId,pageView:t.pageView}}},{key:"buildGeoLoc",value:function(t){return{country:t.country_name,lat:t.lat,locality:t.city,lon:t.long}}},{key:"buildActivity",value:function(t){return{chatcount:t.chatcount,connectionTime:t.connectionTime,day:t.day,hour:t.hour,lastMove:t.lastMove,navTime:t.navTime,nbrVisite:t.nbrVisite,timeElapsed:t.timeElapsed}}},{key:"build",value:function(t,e){var n=new t("event",{xmlns:e.event_visitor_profile_sent}),r=n.c("visitor-profile",{},null),i=new t("geoloc",{xmlns:"http://jabber.org/protocol/geoloc"});i.c("country",{},this.geoloc.country).c("lat",{},this.geoloc.lat).c("locality",{},this.geoloc.locality).c("lon",{},this.geoloc.lon);var o=new t("browser",this.browser),a=new t("activity",this.activity);return r.c("lang",{},this.lang).c("name",{},this.name).c("vuid",{},this.vuid).cnode(i.tree()).up().cnode(o.tree()).up().cnode(a.tree()),n}}]),t}();n.default=a},{lodash:30}],66:[function(t,e,n){"use strict";e.exports={OnUploadMessage:"conversations.message.upload.received",OnProductMessage:"conversations.message.product.received",OnMessageWithMultipleChoicesMessage:"conversations.message.multiple-choices.received",OnTextMessage:"conversations.message.text.received",OnConversationChatFileSelected:"conversation.chat.file.selected",OnConversationChatUploadFilesChecked:"conversation.chat.files.checked",OnConversationChatUploadMaxSizeReached:"conversation.chat.file.maxSizeReached",OnConversationChatUploadBadMimeType:"conversation.chat.file.badMimeType",OnConversationChatUploadStarted:"conversation.chat.upload.started",OnConversationChatUploadProgress:"conversation.chat.upload.progress",OnConversationChatUploadCompleted:"conversation.chat.upload.completed",OnConversationChatUploadFailed:"conversation.chat.upload.failed",OnConversationChatUploadAborted:"conversation.chat.upload.aborted",OnConversationChatUploadInitialized:"conversation.chat.upload.initialized",OnConversationChatEmojiSelected:"conversation.chat.emoji.selected",OnConversationEmojisLoaded:"conversation.emojis.loaded"}},{}],67:[function(t,e,n){"use strict";e.exports=function(e,n,r,i){t("./richContentHandler")(n,r),t("./FileUploadHandler")(n,r),t("./InputsHandler")(e,n,r),t("./OperatorPresenceHandler")(e,n,r,i.roster),t("./conversations-events")(e,n,r,i)}},{"./FileUploadHandler":48,"./InputsHandler":49,"./OperatorPresenceHandler":50,"./conversations-events":61,"./richContentHandler":70}],68:[function(t,e,n){"use strict";var r=function(t,e){this.url=t||"",this.name=e.name||"unknown",this.mimeType=e.type||"unknown"};r.prototype.getUrl=function(){return this.url},r.prototype.getName=function(){return this.name},r.prototype.getMimeType=function(){return this.mimeType},e.exports=r},{}],69:[function(t,e,n){"use strict";var r=function(t,e){this.url=e.productUrl||"",this.title=e.title||"",this.imageUrl=e.imageUrl||"",this.priceCatalog=e.priceCatalog||"",this.pricePromotion=e.pricePromotion||"",this.isAvailable=!!e.available};r.prototype.getUrl=function(){return this.url},r.prototype.getTitle=function(){return this.title},r.prototype.getPrice=function(){return""!==this.pricePromotion?this.pricePromotion:this.priceCatalog},r.prototype.getImage=function(){return this.imageUrl},r.prototype.getPriceOriginal=function(){return""!==this.pricePromotion?this.priceCatalog:""},r.prototype.getIsAvailable=function(){return this.isAvailable},e.exports=r},{}],70:[function(t,e,n){"use strict";var r=t("./models/file"),i=t("./models/product");e.exports=function(t,e){t.on(e.OnXmppOOBReceived,function(n,o,a,s,c,u,l){switch(s){case"upload":var d=new r(c,u);t.emit(e.OnUploadMessage,n,o,a,d,l);break;case"product":var f=new i(c,u);t.emit(e.OnProductMessage,n,o,a,f,l);break;case"message-with-multiple-choices":t.emit(e.OnMessageWithMultipleChoicesMessage,n,o,a,u,l)}})}},{"./models/file":68,"./models/product":69}],71:[function(t,e,n){"use strict";e.exports=function(e,n,r){var i=t("@iadvize/front-emojis-service")({baseUrl:e.static_url+"images/emojis",blackList:["reversed-hand-with-middle-finger-extended","registered-sign","copyright-sign","trade-mark-sign"]});return e.$.get(i.getJSONUrl("apple"),function(t){i.setEmojis("apple",t),n.emit(r.OnConversationEmojisLoaded)}),e.define("emojis-service",function(){return i}),i}},{"@iadvize/front-emojis-service":1}],72:[function(t,e,n){e.exports={chatButtonDisplayed:"ChatButtonDisplayed",callButtonDisplayed:"CallButtonDisplayed",callMeetingConfirmed:"CallMeetingConfirmed"}},{}],73:[function(t,e,n){"use strict";var r=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},i=new(0,t("events").EventEmitter),o=t("./events.enum");e.exports=function(t,e){return i.events=r({},e,o),t.define("eventManager",function(){return i}),i}},{"./events.enum":72,events:15}],74:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t("../../visio/src/events");Object.keys(r).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(n,t,{enumerable:!0,get:function(){return r[t]}})});var i=t("./xmpp/events");Object.keys(i).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(n,t,{enumerable:!0,get:function(){return i[t]}})});var o=t("./conversations/events");Object.keys(o).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(n,t,{enumerable:!0,get:function(){return o[t]}})});var a=t("./conversations/conversations-events/events");Object.keys(a).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(n,t,{enumerable:!0,get:function(){return a[t]}})})},{"../../visio/src/events":147,"./conversations/conversations-events/events":51,"./conversations/events":66,"./xmpp/events":93}],75:[function(t,e,n){"use strict";function r(t,e){this.stack=(new Error).stack,this.message=t||"An error as occured",this.name="UploadError",this.statusCode=e}function i(t){this.stack=(new Error).stack,this.message=t||"Upload aborted",this.name="AbortUploadError"}function o(t,e){this.stack=(new Error).stack,this.message=t||"An error as occured",this.name="HttpError",this.statusCode=e}function a(t){this.stack=(new Error).stack,this.message=t||"Request aborted",this.name="AbortedRequestError"}(r.prototype=Object.create(Error.prototype)).constructor=r,(i.prototype=Object.create(Error.prototype)).constructor=i,(o.prototype=Object.create(Error.prototype)).constructor=o,(a.prototype=Object.create(Error.prototype)).constructor=a,e.exports={HttpError:o,AbortedRequestError:a,UploadError:r,AbortUploadError:i}},{}],76:[function(t,e,n){"use strict";var r=t("lodash");e.exports=function(e){var n={},i=t("./errors"),o=function(t,n,o,a){function s(t,e){return t.abort=e,t.then=r.wrap(t.then.bind(t),function(t,n,r){return s(t(n,r),e)}),t}var c=e.Deferred(),u=!1,l=r.noop;return a=a||{},o=r.assign({dataType:"json",contentType:"application/json",data:a,type:n,url:t,beforeSend:function(t,e){return l=t.abort,!u}},o),e.ajax(o).then(function(t){c.resolve(t)},function(t){var e=new i.HttpError(""+t.statusText,t.status||0);0===t.status&&"abort"===t.statusText&&(e=new i.AbortedRequestError("Aborted")),c.reject(e)}),s(c.promise(),function(){u=!0,l()})};return r.forEach(["get","post","put","delete"],function(t){n[t]=function(e,n,r){return o(e,t.toUpperCase(),n,r)}}),n}},{"./errors":75,lodash:30}],77:[function(t,e,n){"use strict";e.exports=function(e){var n=e.$,r=t("./httpService")(n);return{httpService:r,uploadService:t("./uploadService")(n,r)}}},{"./httpService":76,"./uploadService":78}],78:[function(t,e,n){"use strict";var r=t("lodash").assign;e.exports=function(e,n){var i={},o=t("./errors"),a=function(t){throw"AbortedRequestError"===t.name?new o.AbortUploadError(t.message):new o.UploadError(t.message,t.statusCode)};return i.upload=function(t,i,o,s){s=s||{};var c=r({data:t,processData:!1,contentType:t.type,cache:!1,dataType:"xml",xhr:function(){var t=e.ajaxSettings.xhr();return t.upload&&t.upload.addEventListener("progress",function(t){if(o){var e=parseInt(t.loaded/t.total*100,10);o(e)}},!1),t}},s);return n.put(i,c).fail(a)},i}},{"./errors":75,lodash:30}],79:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}var i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},o=r(t("./messenger-tag")),a=r(t("./conversation"));!function(e){var n=t("./events.js"),r=t("./event-manager")(e,n);t("./Callbacks");var s=iAdvize.$,c="undefined"!=typeof idzCustomData?idzCustomData:{};e.Store=t("./Store")(),e.JSONStore=t("./JSONStore")(e.$,e);var u=s('<div id="idz-root"></div>').appendTo("body").get(0),l=(0,o.default)(s,iAdvize,c),d=(0,a.default)(u,s,iAdvize,iAdvize.flags,iAdvize.JSONStore,l),f=t("../../targeting/src")(s,iAdvize,d,l).events,h=t("./http")(e),p=t("./logmatic")(e),m=t("./xmpp")(r,n,p,e,h.uploadService),g=t("./emojis")(e,r,n);t("./conversations")(e,r,n,m),t("./templates")(r,i({},n,f),e,g),t("./Util")(window,e),t("./javascript-api")(r),t("./call")(e,r,m),t("./chat_core_v2")}(iAdvize)},{"../../targeting/src":117,"./Callbacks":35,"./JSONStore":36,"./Store":37,"./Util":38,"./call":42,"./chat_core_v2":43,"./conversation":46,"./conversations":67,"./emojis":71,"./event-manager":73,"./events.js":74,"./http":77,"./javascript-api":80,"./logmatic":81,"./messenger-tag":82,"./templates":86,"./xmpp":101}],80:[function(t,e,n){"use strict";e.exports=function(t){t.on("targeting.rule.presence.updated",function(t){iAdvize.callbacks.onTargetingRuleTriggered(t)}),t.on("call.popin.open",function(){iAdvize.callbacks.onVisitorCallboxDisplayed()})}},{}],81:[function(t,e,n){"use strict";var r=t("lodash");e.exports=function(t){function e(e,n,r,a){if(!t.PROD)return console.error(n,e,r,a);i.push({desc:e,err:JSON.stringify(n),msg:r,extras:JSON.stringify(a)}),o()}function n(e,n,r){if(!t.PROD)return console.log(e,n,r);i.push({desc:e,msg:n,extras:JSON.stringify(r)}),o()}var i=[],o=r.debounce(function(){t.$.ajax({type:"POST",contentType:"application/json; charset=UTF-8",url:t.chaturl+"rpc/mail_error.php",data:JSON.stringify(i),processData:!1,complete:function(){}}),i=[]},15e3,{leading:!1,trailing:!0});return t.define("logger",function(){return{error:e,info:n}}),{error:e,info:n}}},{lodash:30}],82:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(t){return t&&t.__esModule?t:{default:t}}(t("./messengerTagService"));n.default=function(t,e,n){var i=n.social_notification_customer_id||n.extID||n.ExtID,o=(0,r.default)(t,e.visitor.locale,e.social.url,e.social.facebook.messenger.appId,i);return e.social.facebook.messenger.renderButton=o.renderButton,o}},{"./messengerTagService":83}],83:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};n.default=function(t,e,n,s,c){function u(t){FB.init({appId:t||s,xfbml:!0,version:"v2.10"}),m.resolve()}function l(t){if("undefined"!=typeof FB)u(t);else if(!p){var n=e.replace("-","_"),r=void 0;(r=n.match(/([a-z]{2}$)/))&&(n=n.replace(/([a-z]{2}$)/,r[0].toUpperCase()));var o=window.fbAsyncInit||i.noop;window.fbAsyncInit=function(){o.call(this,arguments),u(t)},function(t,e,r){var i=t.getElementsByTagName(e)[0];if(!t.getElementById(r)){p=!0;var o=t.createElement(e);o.id=r,o.src="//connect.facebook.net/"+n+"/sdk/xfbml.customerchat.js",i.parentNode.insertBefore(o,i)}}(document,"script","idz-facebook-jssdk")}}function d(t){if(!(t&&t instanceof Element))throw new Error("Facebook element is not defined or invalid");m.isResolved()?FB.XFBML.parse(t):l()}function f(e,n,r){if(0===t(e).children(".idz_social_facebook_messenger_button").length){var i=t(n);i.attr(r),t(e).each(function(e,n){var r=t(n),o=i.clone();o.attr("user_ref")&&(o.attr("user_ref",o.attr("user_ref")+e),r.parents().andSelf().filter("form").each(function(e,n){t(n).one("submit",function(){return o.get(0).onsubmit()})})),r.append(o),d(o.get(0))})}}function h(e,r,i){if(!e)return t.Deferred().reject(new Error("Page id isn't defined"));if(!r)return t.Deferred().reject(new Error("Customer id isn't defined"));var o=a[i];if(!o)return t.Deferred().reject(new Error("Unsupported request for button type"));var s=n+"/facebook/messenger/pages/%PAGE_ID%/customers/%CUSTOMER_ID%/buttons/%BUTTON_URI%".replace("%PAGE_ID%",e).replace("%CUSTOMER_ID%",r).replace("%BUTTON_URI%",o);return t.ajax({url:s,type:"GET",crossDomain:!0})}var p=!1,m=new t.Deferred;return m.isResolved=function(){return"resolved"===this.state},{renderButton:function(e,n,a,u,l,d,p){u=!u||u instanceof Object?c:u;var m=Array.prototype.slice.call(arguments);p=m[m.length-1]instanceof Function?m.pop():function(){};var g=t.extend({color:"string"==typeof l?l:"blue",size:"string"==typeof d?d:"large"},"object"===r(m[m.length-1])?m.pop():{});if(o[n]){var v=o[n].replace(/%APP_ID%/g,s).replace(/%PAGE_ID%/g,a).replace(/%ORIGIN%/g,window.location.origin);-1!==v.indexOf("%STATE_VALUE%")?h(a,u,n).done(function(t){"object"===(void 0===t?"undefined":r(t))&&t.state&&t.userRef?(v=v.replace(/%STATE_VALUE%/g,t.state).replace(/%USER_REF%/g,t.userRef),f(e,v,g),p(null,t.alreadyOptin)):p(new Error("Error while getting messenger button state"))}).fail(function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=(0,i.find)(e,function(t){return t instanceof Error});p(r||new Error("An error occured while building messenger button"))}):(f(e,v,g),p())}else p(new Error("The messenger button type does not exist"))},renderTagElement:d}};var i=t("lodash"),o={"fb-send-to-messenger":'<div class="fb-send-to-messenger idz_social_facebook_messenger_button" messenger_app_id="%APP_ID%" page_id="%PAGE_ID%" data-ref="%STATE_VALUE%"></div>',"fb-messenger-checkbox":"<div class=\"fb-messenger-checkbox idz_social_facebook_messenger_button\" origin=\"%ORIGIN%\" page_id=\"%PAGE_ID%\" messenger_app_id=\"%APP_ID%\" data-ref=\"%STATE_VALUE%\" user_ref=\"%USER_REF%\" prechecked=\"false\" allow_login=\"true\" onsubmit=\"FB.AppEvents.logEvent('MessengerCheckboxUserConfirmation', null, {'app_id':'%APP_ID%', 'page_id':'%PAGE_ID%', 'ref':'%STATE_VALUE%', 'user_ref':iAdvize.$(this).attr('user_ref')})\"></div>","fb-messengermessageus":'<div class="fb-messengermessageus idz_social_facebook_messenger_button" messenger_app_id="%APP_ID%" page_id="%PAGE_ID%"></div>'},a={"fb-send-to-messenger":"sendToMessenger","fb-messenger-checkbox":"checkbox"}},{lodash:30}],84:[function(t,e,n){var r={},i=iAdvize,o=i.$;n.setParam=function(t,e){r[t]=e},n.find=function(t,e){t=t||{};var a={findop:i.website_id,u:i.vuid,dep:i.forceDep,s:i.chat.status,o:i.forceAgent||0};o.extend(a,t,r);var s=e||o.Deferred();return document.visibilityState&&"hidden"===document.visibilityState?(setTimeout(function(){n.find(t,s)},1e3),s.promise()):(o.getJSON(i.chaturl+"rpc/"+iAdvize.pollingEndPoint+"?callback=?",a).done(i.findOpCallback).done(s.resolve).fail(function(){setTimeout(function(){n.find(t,s)},1e4)}),s.promise())};var a=0;n.oldPolling=function(){return n.find().done(function(){clearTimeout(a),a=setTimeout(function(){n.oldPolling()},3e4)})},i.AvailableOp=n},{}],85:[function(e,n,r){n.exports=function(e,n,r){var i=!0;e.on(n.showChatbox,function(){i&&2!==r.chat.status&&r.chat.putOpAlert(r.T("SAISIR_UN_MESSAGE")),i=!1,r.Templates.showDialog()});var o=function(){return{button:r.$("#idz_postmsg"),textarea:r.$("#idz_msgmsg")}},a=function(){var t=o(),e=t.button,n=t.textarea;e.prop("disabled",!0),n.prop("disabled",!0),n.prop("valueBackup",n.val()),n.val("")},s=function(t){var e=o(),n=e.button,r=e.textarea;r.val(r.prop("valueBackup")),r.prop("disabled",!1),n.prop("disabled",!1),t&&r.focus()},c=function(){r.$("#idz_dialogbox > *:not(#idz_dialogbox_bottom)").remove()},u=function(){return""+(arguments.length>0&&arguments[0]!==t?arguments[0]:"")+ +new Date};e.on(n.showChatboxWithGDPRWorkflow,function(){r.Templates.showDialog(),a();var t=r.T("livechat.gdpr.consentMessage1")+'<div><a href="javascript:void(0);" class="idz_gdpr_moreinfo">'+r.T("livechat.gdpr.consentMessage2")+"</a></div>",i=[r.T("livechat.gdpr.accept"),r.T("livechat.gdpr.refuse")],o=[function(){return e.emit(n.GDPRAccepted)},function(){return e.emit(n.GDPRRefused)}];if(r.Templates.messageWithMultipleChoices&&r.Templates.messageWithMultipleChoices.getDOM){var s=r.Templates.messageWithMultipleChoices.getDOM(t,i,"","","");r.chat.putOpMessageWithMultipleChoices(u(),s,o)}});e.on(n.showChatboxWithAcceptedGDPRWorkflow,function(){s(!0);var t=u("visitor"),e=r.T("livechat.gdpr.accept");r.chat.putVmsg(e,t),setTimeout(function(){return r.T("SAISIR_UN_MESSAGE")},500)});e.on(n.showChatboxWithRefusedGDPRWorkflow,function(){var t=u("visitor"),e=u("operator"),n=r.T("livechat.gdpr.refuse"),i=r.T("livechat.gdpr.chatboxWillClose");r.chat.putVmsg(n,t),setTimeout(function(){return r.chat.putOpMsg(e,i,0)},500),setTimeout(function(){return s(!1)},2e3),setTimeout(function(){return c()},2050),setTimeout(function(){return r.Templates.hideUI()},2100)})}},{}],86:[function(t,e,n){"use strict";e.exports=function(e,n,r,i){return{renderingController:t("./renderingController.js")(e,n,r,i),gdpr:t("./gdpr")(e,n,r)}}},{"./gdpr":85,"./renderingController.js":87}],87:[function(t,e,n){"use strict";var r=t("filesize");e.exports=function(t,e,n,i){var o=function(t){return t.length>29&&(t=t.substring(0,18-"...".length)+"..."+t.substring(t.length-11,t.length)),t},a=function(){if(n.Templates&&n.Templates.emojis){if(0!==n.$(".idzEmojisPopupToggler").length||0===Object.keys(i.getEmojis("apple",!1)).length)return;if(!n.$("#idz_msgmsg").length)return;var r=!1,o=i.getEmojis("apple",!0),a=i.getIcons(),s=n.$("#idz_chatglobal"),c=n.Templates.emojis.getEmojisPopupDOM(),u=c.find(".idzFloatingPopupArrow"),l=c.find(".idzEmojisList"),d=c.find(".idzEmojisCategories"),f=n.Templates.emojis.getTogglerDOM();for(var h in a){var p=o[h].fullName,m=o[h].emojis,g=n.Templates.emojis.getEmojisCategoryDOM(p,h),v=n.Templates.emojis.getCategoryTabDOM(h,a[h]);for(var _ in m){var b=n.Templates.emojis.getEmojiDOM(m[_].shortname);g.find(".idzEmojisCategoryEmojis").append(b),"noRecent"!==m[_].shortname&&b.on("click",function(r){var i=n.$(this).data("emoji");t.emit(e.OnConversationChatEmojiSelected,i,r),f.click()}).data("emoji",m[_])}v.on("click",function(t){var e=n.$(this).data("category");l.animate({scrollTop:n.$('.idzEmojisCategory[data-category="'+e+'"]').get(0).offsetTop},500),t.preventDefault()}),c.find(".idzEmojisList").append(g),d.append(v)}var y=d.find(".idzEmojiCategoryChar"),w=l.find(".idzEmojisCategory");y.first().addClass("selected"),l.on("scroll",function(t){var e=parseInt(l.css("padding-top"),10),r=l.get(0).scrollTop+e+1;n.$(".idzEmojiCategoryChar").removeClass("selected");for(var i=0;i<w.length;i++){var o=w[i],a={top:o.offsetTop,bottom:o.offsetTop+o.offsetHeight};r>a.top&&r<a.bottom&&n.$(y[i]).addClass("selected")}t.stopPropagation()});var C=n.$("#idz_chat_actions"),x=n.$("#idz_msgmsg");f.on("click",function(t){r=!r;var e=s.get(0).getBoundingClientRect(),i=n.$(this).get(0).getBoundingClientRect(),o=Math.abs(e.top-i.top),a=Math.abs(e.left-i.left),l=o-c.height()-10,d=e.width-c.width();c.css({bottom:"auto",right:"auto",left:d,top:l}).toggleClass("opened"),u.css({left:a-d+2}),f.toggleClass("active"),t.stopPropagation()}),s.append(c),C.prepend(f);var O=C.width();x.css({paddingRight:O,width:x.get(0).offsetWidth-O}),c.find(".idzEmojiChar").css("background-image","url("+i.getSpriteUrl("apple")+")"),n.$(document).on("click.emojis",function(t){var e=c.get(0);e&&e.contains(t.target)||!r||(t.stopPropagation(),t.preventDefault(),f.click())})}};t.on(e.OnUploadMessage,function(t,e,r,i,o){if(n.Templates.upload&&n.Templates.upload.getUploadedFileDOM){var a="",s=r||n.chat.getMsgTime();switch(e){case"operator":n.operator&&n.operator.pseudo&&(a=n.operator.pseudo);break;case"visitor":a=n.T("VOUS")}var c=n.Templates.upload.getUploadedFileDOM(a,e,s,i.getName(),i.getMimeType(),i.getUrl());c.attr("data-id",t),o?o.append(c):n.chat.putOpFile(t,c)}else n.chat.putOpMsg(t,i.getUrl(),0)}),t.on(e.OnTextMessage,function(t,e,r,i,o){switch(e){case"operator":n.chat.putOpMsg(t,i,0)}}),t.on(e.OnProductMessage,function(t,e,r,i,o){var a=r||n.chat.getMsgTime(),s="";switch(e){case"operator":n.operator&&n.operator.pseudo&&(s=n.operator.pseudo)}if(n.Templates.products&&n.Templates.products.getProductDOM){var c=n.Templates.products.getProductDOM(i.getImage(),i.getTitle(),i.getPrice(),i.getPriceOriginal(),i.getIsAvailable(),i.getUrl(),s,a,n.T("chatbox.products.link_label"));o?o.append(c):n.chat.putOpProduct(t,c)}else""!=i.getUrl()&&n.chat.putOpMsg(t,i.getUrl(),0)}),t.on(e.OnMessageWithMultipleChoicesMessage,function(t,e,r,i,o){var a=r||n.chat.getMsgTime(),s=n.operator.pseudo?n.operator.pseudo+" : ":"";if(n.Templates.messageWithMultipleChoices&&n.Templates.messageWithMultipleChoices.getDOM){var c=n.Templates.messageWithMultipleChoices.getDOM(i.message,i.choices,a,s,n.chat.getOperatorAvatarUrl());n.chat.putOpMessageWithMultipleChoices(t,c,null,o)}}),t.on(e.OnConversationChatUploadMaxSizeReached,function(t,e){var i=n.T("livechat.conversations.upload.fileTooBig").replace("%maxSize%",r(t)).replace("%fileName%",e.name),o=n.Templates.upload.getUploadErrorMessageDOM(i);n.chat.putOpFile("error",o)}),t.on(e.OnConversationChatUploadBadMimeType,function(t){var e=t.name+": "+n.T("livechat.conversations.upload.badType"),r=n.Templates.upload.getUploadErrorMessageDOM(e);n.chat.putOpFile("error",r)}),t.on(e.OnConversationChatUploadStarted,function(t,e){var r=n.Templates.upload.getUploadProgressDOM(o(t.name),e);n.chat.putOpFile(e,r)}),t.on(e.OnConversationChatUploadProgress,function(t,e){n.$('.idz_upload[data-id="'+e+'"]').find(".idz_progress").css("width",t+"%")}),t.on(e.OnConversationChatUploadCompleted,function(t){n.$('.idz_upload[data-id="'+t+'"]').remove()}),t.on(e.OnConversationChatUploadFailed,function(t,e){n.$('.idz_upload[data-id="'+t+'"]').addClass("idz_upload_error").html(e)}),t.on(e.OnConversationChatUploadInitialized,function(){if(n.Templates.hasUpload&&n.Templates.upload&&n.Templates.dragNDrop){var r=n.$("#idz_chatbox").find(".chatboxDropZoneContainer"),i=function(){n.$(window).focus(),r.removeClass("displayed"),r.find(".chatboxDropZone").removeClass("active")},o=n.Templates.dragNDrop.getDropZone();o.on("dragenter dragover",function(){var t=n.$(this).addClass("active").find("img");t.attr("src",t.data("src-on"))}).on("dragleave",function(){var t=n.$(this).removeClass("active").find("img");t.attr("src",t.data("src-off"))}),o.find("input").on("change",function(r){t.emit(e.OnConversationChatFileSelected,r),n.$(this).val(""),i()}),o.find(".chatFileUploader").on("click",function(t){n.$(t.target).find("input").click()});var a=o.find("img");a.attr("src",a.data("src-off")),n.$(window).on("dragenter",function(){n.$(window).focus(),r.addClass("displayed")}),n.$(window).on("mouseleave",i),r.append(o)}}),t.on(e.OnXmppConnectionConnected,a),t.on(e.OnConversationEmojisLoaded,a)}},{filesize:16}],88:[function(t,e,n){"use strict";e.exports=function(t){var e=[];return{get:function(){var n=t.Deferred();return e.push(n),n.promise()},reject:function(t){e.map(function(e){e.reject(t)}),e=[]},resolve:function(){var t=arguments;e.map(function(e){e.resolve.apply(e,t)}),e=[]}}}},{}],89:[function(t,e,n){e.exports=function(t){var e=t.split(" ");this.name=e.shift().substr(1),this.param1=e.shift()||"",this.param2=e.join(" ")}},{}],90:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=t("lodash");e.exports=function t(e){r(this,t),this.name="",this.barejid="",this.resources=[],i.assign(this,e)}},{lodash:30}],91:[function(t,e,n){function r(t){i.call(this,t);var e=this,n=o(t),r=n.find("error");this.text=r.length?r.find("text").text():[],this.fromUsername=(n.attr("from")||"").split("@")[0],this.code=parseInt(r.attr("code"),10),this.retry=0,o.each(n.find("x"),function(t,n){"https://iadvize.com/schemas/retry"===n.getAttribute("xmlns")&&(e.retry=parseInt(n.getAttribute("retry"),10))})}var i=t("./Message"),o=iAdvize.$;r.prototype=i.prototype,r.constructor=r,r.prototype.canRetry=function(){return this.retry<3},e.exports=r},{"./Message":92}],92:[function(t,e,n){function r(t){var e=o(t);this.raw=e,this.id=e.attr("id")||null,this.to=e.attr("to"),this.from=e.attr("from").toLowerCase(),this.barejid=Strophe.getBareJidFromJid(this.from),this.type=e.attr("type"),this.bodies=e.find("body"),this.body=this.bodies.length?Strophe.xmlunescape(Strophe.getText(this.bodies[0])):"",this.x=e.find("x")}var i=t("./Command"),o=iAdvize.$;r.prototype={isChat:function(){return("chat"===this.type||"groupchat"===this.type)&&this.bodies.length>0&&!this.isCommand()},isCommand:function(){return 0===this.body.indexOf("!")},getCommand:function(){return this.command||(this.command=new i(this.body))}},e.exports=r},{"./Command":89}],93:[function(t,e,n){"use strict";e.exports={OnXmppConnectionConnected:"xmpp.connection.connected",OnXmppConnectionDisconnected:"xmpp.connection.disconnected",OnXmppReconnectionFailed:"xmpp.reconnection.failed",OnXmppRoomInvitation:"xmpp.room.invited",OnXmppRoomJoined:"xmpp.room.joined",OnXmppOOBReceived:"xmpp.message.oob.received",OnXmppRosterUserAvailable:"xmpp.roster.user.available",OnXmppRosterUserUnavailable:"xmpp.roster.user.unavailable"}},{}],94:[function(t,e,n){"use strict";var r=t("lodash");e.exports=function(t,e,n,i,o,a,s,c,u,l){var d=o.$,f=0,h=0,p=!1,g=!1,v=function(){return r.isObject(window.WebSocket)&&o.ws_enabled},_=function(){return v()&&!p?o.ws_url:o.bosh_url},b=new t.Connection(_());window.traceXMPP&&window.localStorage&&window.localStorage.getItem("traceXMPP")&&(b.xmlInput=function(t){window.traceXMPP(t,!0)},b.xmlOutput=function(t){window.traceXMPP(t,!1)});var y=!1,w=null,C=null,x={},O={jid:null,nick:null},S=function(r){if(b.connected||y)return w.promise();w=w&&"pending"===w.state()?w:d.Deferred(),y=!0;var i={website_id:iAdvize.website_id,vuid:iAdvize.vuid};return o.popout&&(i.pop=1),d.ajax(o.chaturl+"api/connect?callback=?",{data:i,dataType:"json",timeout:5e3}).done(function(r){var i=r.nick,o=r.pass,a=r.vhost;if(""===i||""===o||""===a)return w.reject("Unable to retrieve valid credentials");b.connect(i+"@"+a+"/"+ +new Date,o,function(r){return r===t.Status.ATTACHED||r===t.Status.CONNECTED?(!v()||g||p||(g=!0),e.emit(n.OnXmppConnectionConnected)):r===t.Status.DISCONNECTED&&e.emit(n.OnXmppConnectionDisconnected),!0})}).fail(function(){r?e.emit(n.OnXmppConnectionDisconnected):w.reject("Error while retrieving credentials")}),w.promise()},T=function(e){return function(n){var r=new c(n);return u.error("livechat.xmpp.stanza.error".replace("stanza",e),t.serialize(n),r.text,{id:n.id,code:parseInt(r.code,10),rooms:b.muc.roomNames,conversationId:r.fromUsername}),!0}},E=function(t){var e=new c(t);return e.from!==o.conversationJid||406!==e.code&&404!==e.code||z(e),!0},A=function(t){var e=new c(t);return i.reject(e),e.from!==o.conversationJid||406!=e.code&&404!=e.code||!O.jid||R(O.jid,O.nick,0).catch(function(){}),!0},I=function(r){var i=new a(r);if(t.getResourceFromJid(i.from)!==o.vuid&&Array.prototype.slice.call(i.raw.context.childNodes).forEach(function(t){try{var r=l(t.namespaceURI);e.emit(n[r],i)}catch(t){}}),i.x.length>0&&"jabber:x:delay"===i.x[0].getAttribute("xmlns"))return!0;try{i.isChat()?o.chat.onMessage(i):i.isCommand()&&o.chat.onCommand(i)}catch(t){u.error("livechat.xmpp.handler.onMessage",t,i)}return!0},k=function(e){var n=d(e).attr("from").toLowerCase(),r=t.getResourceFromJid(n),i=e.childNodes[0].localName;return o.chat.onChatStates(r,i),!0},R=function(t,r,o){var a=i.get(),s={seconds:o||0};O.jid=t,O.nick=r;return b.muc.join(t,r,null,null,null,null,s),b.muc.rooms[t].addHandler("presence",function(r){if(!r)return!0;var o=d(r).find("status"),a=d.map(o,function(t){return parseInt(d(t).attr("code"),10)});return!(-1!==d.inArray(110,a))||(e.emit(n.OnXmppRoomJoined),i.resolve(t),L(t),!1)}),a},j=function(t){B();var e=b.muc.roomNames.indexOf(t);delete b.muc[t],e>=0&&(b.muc.roomNames.splice(e,1),0===b.muc.roomNames.length&&(b.deleteHandler(b.muc._muc_handler),b.muc._muc_handler=null))},N=function(t){var e=d.Deferred();if(x[t.id]&&x[t.id].reject("desk.publish.error.outside",t,e.promise()),!t.canRetry())return u.error("livechat.xmpp.retry.error",t,"Max retry reached",{code:parseInt(t.code,10),rooms:b.muc.roomNames,conversationId:t.fromUsername}),e.reject("desk.publish.error.retry.max",t);var n=$msg({to:t.from,from:b.jid,type:"groupchat",id:t.id}).c("body").t(t.body).up();n.c("x",{xmlns:"https://iadvize.com/schemas/retry",retry:t.retry+1});var r=+new Date;return b.muc.rooms[t.from].addHandler("message",M(e,t.id,r,t)),b.send(n),x[t.id]=e,e.promise()},M=function(t,e,n,i){return function(o){var a=d(o).attr("id"),s=+new Date;if(a===e){i&&u.info("livechat.xmpp.retry.success","Successfully retried "+i.id,r.merge(i,{conversationId:i.fromUsername}));var c=s-n;return u.info("livechat.xmpp.message.latency","Successfully delivered in "+c+" ms",{id:e,latency:c}),t.resolve(e),!1}return!0}},z=function t(e){if(O.jid){j(e.from);var n=R(O.jid,O.nick,0);e.body&&n.done(function(){if(e.body)return N(e)}).fail(function(){t(e)})}},D=function(t){var e=new a(t);return o.chat.onMessageReceipt(e),!0},P=function(t){var e=b.getUniqueId(),n=$msg({to:t,from:b.jid,type:"groupchat",id:e}).c("ping",{xmlns:"urn:xmpp:ping"});n.up(),b.send(n)},B=function(){clearInterval(C)},L=function(t){B(),C=setInterval(function(){P(t)},6e4)};return e.on(n.OnXmppConnectionDisconnected,function(){if(y=!1,o.chat.connected=!1,++f>=5){if(v()&&(p||g)||!v())return e.emit(n.OnXmppReconnectionFailed),w.reject();p=!0,f=1,b.reset(),b=new t.Connection(_()),window.traceXMPP&&window.localStorage&&window.localStorage.getItem("traceXMPP")&&(b.xmlInput=function(t){traceXMPP(m,!0)},b.xmlOutput=function(t){traceXMPP(m,!1)})}clearTimeout(h),h=setTimeout(function(){S(!0)},f>1?3e3:2300)}),e.on(n.OnXmppConnectionConnected,function(){y=!1,w.resolve(),o.chat.connected=!0,b.addHandler(I,null,"message","chat"),b.addHandler(I,null,"message","groupchat"),b.addHandler(I,null,"message","command"),b.addHandler(T("presence"),null,"presence","error"),b.addHandler(T("message"),null,"message","error"),b.addHandler(E,null,"message","error"),b.addHandler(A,null,"presence","error"),b.addHandler(k,"http://jabber.org/protocol/chatstates","message","groupchat"),b.receipts.addReceiptHandler(D),f=0}),{sendChatState:function(t){b.connected&&b.send&&b.send($msg({to:o.conversationJid,from:b.jid,type:"groupchat",website:o.website_id}).c(t).attrs({xmlns:"http://jabber.org/protocol/chatstates"}))},getConnection:function(){return b},connect:S,room:{groupchat:function(t,e){var n=d.Deferred(),r=e||b.getUniqueId(),i=function(){var e=+new Date;b.muc.rooms[O.jid].addHandler("message",M(n,r,e)),b.muc.groupchat(O.jid,t,null,r)};return x[r]=n,b.muc.rooms[O.jid]?i():R(O.jid,O.nick,0).always(i),n.promise()},leave:function(t,e){B(),b.muc.leave(t,e),O.jid=O.nick=null},join:R}}}},{lodash:30}],95:[function(t,e,n){"use strict";var r=t("lodash");e.exports=function(t,e,n,i){var o=n.$,a=0;return i().addHandler(function(t){return!0},Strophe.NS.MUC_USER,"message",null),{sendEngage:function(t,e,n,s,c,u,l){var d=o.Deferred(),f="!visitor_engage "+(e||""),h={id:t||a||i().getUniqueId(),to:s+"/operators",from:i().jid,type:"chat",website:c,history:u,channel:l||"chat",conversationJid:n},p=$msg(h).c("body").t(f).up().c("active",{xmlns:"http://jabber.org/protocol/chatstates"}),m=$msg({from:i().jid,to:s+"/operators",type:"chat"});m.c("event",{xmlns:"http://iadvize.com/protocol/events#visitor_engaged",room:n,websiteId:c,historyId:u,channel:l||"chat"});var g=o.Deferred(),v=o.Deferred();return i().receipts.sendMessage(p,(0,r.partial)(g.resolve,t),g.reject),i().receipts.sendMessage(m,(0,r.partial)(v.resolve,t),v.reject),o.when(g,v).then(d.resolve).fail(d.reject),d.promise()},setFirstMessageId:function(t){a=t}}}},{lodash:30}],96:[function(t,e,n){"use strict";e.exports=function(e,n,r,i,o){function a(t){try{var e={},n=t.childNodes[0].childNodes;return e[n[0].tagName]=n[0].textContent,e[n[1].tagName]=n[1].textContent,e.id=c(t).attr("id"),e}catch(t){throw new u(t.message)}}var s=iAdvize,c=s.$,u=t("./XmppSlotParseError"),l=t("./XmppUploadError"),d={};r().outofband.addOutOfBandHandler(function(t){var i=c(t),o=i.attr("id"),a=i.attr("from"),s=i.find("url").text(),u=i.find("desc").text();try{var l=JSON.parse(u),d=l.type,f=l.data;e.emit(n.OnXmppOOBReceived,o,"operator",null,d,s,f),r().send($iq({type:"result",id:o,to:a}).c("query",{xmlns:Strophe.NS.OUTOFBAND}))}catch(t){e.emit(n.OnTextMessage,o,"operator",s),r().send($iq({type:"error",id:o,to:a}).c("query",{xmlns:Strophe.NS.OUTOFBAND})),console.error(t)}return!0},"set"),e.on(n.OnConversationChatUploadFilesChecked,function(t){var c=t.name+0;e.emit(n.OnConversationChatUploadStarted,t,c),r().fileupload.requestSlot({name:o+"/"+t.name,size:t.size,contentType:t.type},function(o){var u=a(o);d[c]=i.upload(t,u.put,function(t){e.emit(n.OnConversationChatUploadProgress,t,c)}).then(function(){var i={type:"upload",data:{url:u.get,type:t.type,name:t.name}},o=JSON.stringify(i);e.emit(n.OnConversationChatUploadCompleted,c),e.emit(n.OnXmppOOBReceived,u.id,"visitor",null,"upload",u.get,i.data),r().outofband.sendUrl(iAdvize.operator.barejid+"/operators",u.get,o),s.chat.updateHistory(s.chat.MESSAGE_TYPES.VISITOR_RICH_CONTENT,JSON.stringify(i),u.id)}).catch(function(t){var r=s.T("livechat.conversations.upload.error");"AbortUploadError"===t.name&&(r=s.T("livechat.conversations.upload.abort")),e.emit(n.OnConversationChatUploadFailed,c,r)})},function(t){throw e.emit(n.OnConversationChatUploadFailed,c,s.T("livechat.conversations.upload.error")),new l(t.message)},1e4)}),e.on(n.OnConversationChatUploadAborted,function(t){d[t]&&d[t].abort()})}},{"./XmppSlotParseError":99,"./XmppUploadError":100}],97:[function(t,e,n){"use strict";e.exports=function(t,e,n,r){var i=n.$;r().addHandler(function(t){var e=i(t).attr("from"),n=Strophe.getBareJidFromJid(e);return r().send($pres({to:n,type:"subscribed"})),r().send($pres({to:n,type:"subscribe"})),!0},Strophe.NS.CLIENT,"presence","subscribe",null,null),r().addHandler(function(t){var e=i(t).attr("from"),n=Strophe.getBareJidFromJid(e);return r().send($pres({to:n,type:"unsubscribed"})),r().send($pres({to:n,type:"unsubscribe"})),!0},Strophe.NS.CLIENT,"presence","unsubscribe",null,null)}},{}],98:[function(t,e,n){"use strict";var r=t("lodash");e.exports=function(t,e,n,i,o){var a=n.$,s=[],c=function(t){return r.find(s,function(e){return e.barejid===t})};return i().addHandler(function(t){var e=a(t).find("item");return r.forEach(e,function(t){var e=a(t).attr("jid"),n=Strophe.getBareJidFromJid(e);"from"===a(t).attr("subscription")&&s.push(new o({barejid:n}))}),i().send($iq({type:"result",id:a(t).attr("id")})),!0},Strophe.NS.ROSTER,"iq","set"),i().addHandler(function(t){var e=a(t).attr("from"),n=Strophe.getBareJidFromJid(e);return r.remove(s,function(t){return t.barejid===n}),!0},Strophe.NS.CLIENT,"presence","unsubscribe",null,null),i().addHandler(function(n){var i=a(n).attr("type");if(r.includes.unsubscribe,i)return!0;var o=a(n).attr("from"),s=Strophe.getBareJidFromJid(o),u=Strophe.getResourceFromJid(o),l=c(s);return!l||(0===l.resources.length&&t.emit(e.OnXmppRosterUserAvailable,s),l.resources.push(u),!0)},Strophe.NS.CLIENT,"presence",null,null,null),i().addHandler(function(n){var i=a(n).attr("from"),o=Strophe.getBareJidFromJid(i),s=Strophe.getResourceFromJid(i),u=c(o);return!u||(r.remove(u.resources,function(t){return s===t}),0===u.resources.length&&t.emit(e.OnXmppRosterUserUnavailable,o),!0)},Strophe.NS.CLIENT,"presence","unavailable",null,null),t.on(e.OnXmppConnectionConnected,function(){i().sendIQ($iq({type:"get"}).c("query",{xmlns:Strophe.NS.ROSTER}),function(t){var e=a(t).find("item");s=r.filter(e,function(t){return"both"===a(t).attr("subscription")}).map(function(t){var e=a(t).attr("jid"),n=Strophe.getBareJidFromJid(e);return new o({barejid:n})}),r.filter(e,function(t){return"from"===a(t).attr("subscription")&&"subscribe"!==a(t).attr("ask")}).forEach(function(t){var e=a(t).attr("jid");i().send($pres({to:e,type:"subscribe"}))}),n.doInit()})}),{isOnline:function(t){var e=c(t);return!!e&&e.resources.length>0}}}},{lodash:30}],99:[function(t,e,n){"use strict";function r(t){this.stack=(new Error).stack,this.message=t||"Failed to get an upload slot from Xmpp server",this.name="XmppSlotParseError"}(r.prototype=Object.create(Error.prototype)).constructor=r,e.exports=r},{}],100:[function(t,e,n){"use strict";function r(t){this.stack=(new Error).stack,this.message=t||"Failed to upload file",this.name="XmppUploadError"}(r.prototype=Object.create(Error.prototype)).constructor=r,e.exports=r},{}],101:[function(t,e,n){"use strict";var r=t("./namespaces"),i=t("@iadvize/strophe.js");window.Strophe=i.Strophe,window.$build=i.$build,window.$iq=i.$iq,window.$msg=i.$msg,window.$pres=i.$pres,t("@iadvize/strophe-muc"),t("@iadvize/strophe-receipts"),t("@iadvize/strophe-http-file-upload")(window.Strophe),t("@iadvize/strophe-outofband")(window.Strophe),e.exports=function(e,n,i,o,a){var s=t("./domain/Contact"),c=t("./domain/Command"),u=t("./domain/Message"),l=t("./domain/Error"),d=new(t("./DeferredManager"))(o.$),f=t("./handlers/ConnectionHandler")(Strophe,e,n,d,o,u,c,l,i,r.namespaceToEvent);t("./handlers/OutOfBandHandler")(e,n,f.getConnection,a,o.website_id),t("./handlers/PresenceHandler")(e,n,o,f.getConnection);var h=t("./handlers/RosterHandler")(e,n,o,f.getConnection,s),p=t("./handlers/InvitationHandler")(e,n,o,f.getConnection);return o.define("xmpp",function(){return{invitation:p,connect:f.connect,getConnection:f.getConnection,sendChatState:f.sendChatState,room:f.room,isOnline:h.isOnline}}),{namespaces:r.namespaces,invitation:p,connection:f,roster:h,stanzaBuilder:Strophe.Builder}}},{"./DeferredManager":88,"./domain/Command":89,"./domain/Contact":90,"./domain/Error":91,"./domain/Message":92,"./handlers/ConnectionHandler":94,"./handlers/InvitationHandler":95,"./handlers/OutOfBandHandler":96,"./handlers/PresenceHandler":97,"./handlers/RosterHandler":98,"./namespaces":102,"@iadvize/strophe-http-file-upload":4,"@iadvize/strophe-muc":5,"@iadvize/strophe-outofband":6,"@iadvize/strophe-receipts":7,"@iadvize/strophe.js":8}],102:[function(e,n,r){Object.defineProperty(r,"__esModule",{value:!0}),r.namespaceToEvent=r.keyToEvent=r.namespaces=r.baseNamespaceUri=t;var i=e("lodash"),o=r.baseNamespaceUri="http://iadvize.com/protocol/",a=["conversation_closed","custom_data_requested","custom_data_sent","engagement_rule_triggered","offer_sent","link_sent","visitor_blocked","visitor_profile_sent","visitor_profile_requested","call_started","call_stopped","call_operator_answered","call_errored"],s=r.namespaces=(0,i.merge)((0,i.mapValues)((0,i.keyBy)(a,function(t){return"event_"+t}),function(t){return o+"events#"+t})),c=(0,i.invert)(s),u=r.keyToEvent=(0,i.merge)((0,i.mapValues)((0,i.keyBy)(a,function(t){return"event_"+t}),function(t){return"OnEvent"+(0,i.upperFirst)((0,i.camelCase)(t))}));r.namespaceToEvent=function(t){if(c.hasOwnProperty(t)&&u[c[t]])return u[c[t]];throw new Error("Unknown namespace")}},{lodash:30}],103:[function(t,e,n){Object.defineProperty(n,"__esModule",{value:!0});var r=t("lodash"),i=t("ua-parser-js"),o=(new i).getResult(),a={MOBILE:"mobile",TABLET:"tablet",DESKTOP:"desktop"},s=function(t){return t===i.DEVICE.MOBILE?a.MOBILE:t===i.DEVICE.TABLET?a.TABLET:a.DESKTOP};n.default=function(){return{browser:(0,r.get)(o,"browser.name")||"unknown",version:parseInt((0,r.get)(o,"browser.major"),10)||"unknown",OS:(0,r.get)(o,"os.name")||"unknown",deviceType:s((0,r.get)(o,"device.type"))}}},{lodash:30,"ua-parser-js":33}],104:[function(e,n,r){!function(e){var n=[],r=!1,i=!1,o=function(){!function(){for(var t=n.length,e=0;e<t;e++){var o=n[e][1]();n[e][0]!==o&&(n[e][0]=o,n[e][2](o))}i?r=!1:setTimeout(arguments.callee,850)}(),r=!0},a={add:function(e,a,s){for(var c in n)if(n[c][3]==s)return;var u=[t,e,a,s];n.push(u),!1===r&&(i=!1,o())},start:function(){i=!1,!1===r&&o()},clear:function(){n=[],i=!0},stop:function(){i=!0}};e.Watcher=a}(iAdvize)},{}],105:[function(t,e,n){function r(t){return o[t]instanceof i||(o[t]=new i(t)),o[t]}var i=t("./model/channel"),o={};n.chat=r("chat"),n.call=r("call"),n.visio=r("visio"),n.all=r("all"),n.getChannel=r},{"./model/channel":118}],106:[function(t,e,n){Object.defineProperty(n,"__esModule",{value:!0});n.TargetingRuleTriggered="targeting.rule.triggered",n.TargetingRulePresenceUpdated="targeting.rule.presence.updated",n.TargetingEngineRan="targeting.engine.ran",n.UserNavigated="used.navigated",n.TargetingEngineCheckAvailability="targeting.engine.checkAvailability",n.EngagementNotificationDisplayed="EngagementNotificationDisplayed"},{}],107:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(t){return t&&t.__esModule?t:{default:t}}(t("lodash")),i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(t("./events")),o=r.default.merge;n.default=function(t,e,n,a,s,c,u,l){function d(t){p.setRule(t.id,t),p.setStatus(t.id,"pending"),g()}function f(t){if(t)return t.executed=!1,t.displayed=!1,m=m.filter(function(e){return e.id!==t.id}),r.default.forEach(t.actions,function(t){t.cancel()}),t}function h(n){var r=t.Deferred();return e.emit(i.TargetingRuleTriggered,n),r.resolve(n),r.promise()}var p={data:{rules:{},status:{}},setStatus:function(t,e){this.data.status[t]=e},getFiredRules:function(){var t=this.data;return r.default.chain(this.data.status).pickBy(function(t){return"pending"===t}).forEach(function(e,n){t.status[n]="done"}).keys().map(function(e){return t.rules[e]}).value()},setRule:function(t,e){this.data.rules[t]=e},clean:function(){this.data.rules={},this.data.status={}}},m=[],g=r.default.debounce(function(){var t=m.filter(function(t){return t.displayed}).concat(p.getFiredRules());0!==t.length&&s.getRulesAvailabilities(t).then(c.getRulesOpportunities).then(u.sendProactifCount).then(l.executeInteractionRules).then(function(t){r.default.some(t,"displayed")&&e.emit(i.TargetingEngineCheckAvailability),m=o(m,t),r.default.forEach(t,h)})},n);return{fireRule:function(e){return!e||!t("#idzc2c").is(":visible")&&(e.executed=!0,void("qualification"===e.type?(l.executeQualificationRule(e,{}),d(e)):a(e).then(d)))},untriggerRule:f,fireReRun:function(){r.default.isEmpty(m)||s.getRulesAvailabilities(m).then(l.executeInteractionRules).then(function(){return e.emit(i.TargetingEngineCheckAvailability)})},reactToNavigate:function(){p.clean(),m.filter(function(t){return"qualification"===t.type}).forEach(f)}}}},{"./events":106,lodash:30}],108:[function(t,e,n){Object.defineProperty(n,"__esModule",{value:!0});n.CONSENTED="CONSENTED",n.DID_NOT_CONSENT="DID_NOT_CONSENT",n.CONSENT_NOT_AVAILABLE="CONSENT_NOT_AVAILABLE"},{}],109:[function(t,e,n){Object.defineProperty(n,"__esModule",{value:!0});n.showChatboxButtonClicked="showChatboxButtonClicked",n.showCallInvitationButtonClicked="showCallInvitationButtonClicked",n.showChatboxWithGDPRWorkflow="showChatboxWithGDPRWorkflow",n.showChatbox="showChatbox",n.showChatboxWithAcceptedGDPRWorkflow="showChatboxWithAcceptedGDPRWorkflow",n.showChatboxWithRefusedGDPRWorkflow="showChatboxWithRefusedGDPRWorkflow",n.showChatboxWithAcceptedGDPRFailedWorkflow="showChatboxWithAcceptedGDPRFailedWorkflow",n.showChatboxWithRefusedGDPRFailedWorkflow="showChatboxWithRefusedGDPRFailedWorkflow",n.showChatboxWithGDPRRetrievingFailedWorkflow="showChatboxWithGDPRRetrievingFailedWorkflow",n.GDPRAccepted="GDPRAccepted",n.GDPRRefused="GDPRRefused"},{}],110:[function(t,e,n){Object.defineProperty(n,"__esModule",{value:!0});var r=t("./service"),i=t("./events"),o=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(t("./constants")),a=function(t,e){return function(n,a){(0,r.getConsentForVuid)(e,n,a).then(function(e){e!==o.CONSENTED?t.emit(i.showChatboxWithGDPRWorkflow,e):t.emit(i.showChatbox,e)}).fail(function(){t.emit(i.showChatboxWithGDPRRetrievingFailedWorkflow)})}},s=function(t,e){return function(t,e){}},c=function(t,e){return function(n){(0,r.setConsentForVuid)(e,n,o.CONSENTED).then(function(){t.emit(i.showChatboxWithAcceptedGDPRWorkflow)}).fail(function(){t.emit(i.showChatboxWithAcceptedGDPRFailedWorkflow)})}},u=function(t,e){return function(n){(0,r.setConsentForVuid)(e,n,o.DID_NOT_CONSENT).then(function(){t.emit(i.showChatboxWithRefusedGDPRWorkflow)}).fail(function(){t.emit(i.showChatboxWithRefusedGDPRFailedWorkflow)})}};n.default={register:function(t,e){var n=a(t,e),r=s(),o=c(t,e),l=u(t,e);return t.on(i.showChatboxButtonClicked,n),t.on(i.showCallInvitationButtonClicked,r),t.on(i.GDPRAccepted,o),t.on(i.GDPRRefused,l),function(){t.off(i.showChatboxButtonClicked,n),t.off(i.showCallInvitationButtonClicked,r),t.off(i.GDPRAccepted,o),t.off(i.GDPRRefused,l)}}}},{"./constants":108,"./events":109,"./service":111}],111:[function(e,n,r){Object.defineProperty(r,"__esModule",{value:!0}),r.setConsentForVuid=r.getConsentForVuid=t;var i=e("./constants"),o=i.CONSENTED,a=!1;r.getConsentForVuid=function(t,e,n){var r=t.Deferred();return a||-1===document.location.href.indexOf("&darkLaunchFeature=GdprConsent")||(o=i.DID_NOT_CONSENT,a=!0),r.resolve(o),r.promise()},r.setConsentForVuid=function(t,e,n){var r=t.Deferred();return o=n,r.resolve(),r.promise()}},{"./constants":108}],112:[function(t,e,n){"use strict";var r=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},i=t("lodash");e.exports=function(t,e){function n(e,n,o){var a={rule:o},s=i.find(e,{id:o.id+""});return"interaction"===o.type&&s?(a.availability=r({},s.availability,{callInstant:t.callInstant,callMeeting:t.callMeeting}),"call"!==o.channel.type&&"all"!==o.channel.type||(a.availability.call.available=a.availability.call.available||t.callOffline.enabled&&t.callOffline.available),n.push(a)):"qualification"===o.type&&n.push(a),n}function o(t,e){return i.reduce(t,i.partial(n,e),[])}return{getRulesAvailabilities:function(t){var n=i.filter(t,{type:"interaction"});return e.checkRulesAvailability(n).then(i.partial(o,t))},reduceRulesToAvailabilities:o}}},{lodash:30}],113:[function(e,n,r){"use strict";var i=function(){function e(e,n){var r=[],i=!0,o=!1,a=t;try{for(var s,c=e[Symbol.iterator]();!(i=(s=c.next()).done)&&(r.push(s.value),!n||r.length!==n);i=!0);}catch(t){o=!0,a=t}finally{try{!i&&c.return&&c.return()}finally{if(o)throw a}}return r}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=e("lodash");n.exports=function(e,n,r,a,s){function c(t){e.opOffline=t.chat.available?0:1,e.c2cOffline=t.call.available||e.callMeeting.available&&e.callMeeting.enabled?0:1,e.c2vOffline=t.video.available?0:1,e.callInstant&&(e.callInstant.available=t.call.available),e.opBusy=t.chat.busy?1:0}function u(t){e.callbacks.onRuleStarted({id:t.id,label:t.label}),e.flags.message=e.T("LA_REGLE")+" "+t.label+" "+e.T("VIENT_ETRE_EXECUTEE"),e.flags.proactif_alert="!proactif "+t.label,e.proactif_now=1,e.flags.proactif_activatedId=t.id,t.displayed=!0,e.ProActif.saveData()}function l(t){return(0,o.values)((0,o.groupBy)(t,function(t){var e=t.action;return t.rule.id+"-"+e.type})).map(function(t){return(0,o.find)(t,function(t){var e=t.action,n=t.availability;return e.isExecuted()&&!e.shouldCancel(n)||e.shouldExecute(n)})}).filter(function(t){return!(0,o.isUndefined)(t)})}function d(t){var e=(0,o.partition)(t,function(t){return null===t.action.getContainerId()}),n=i(e,2),r=n[0],a=n[1],s=(0,o.values)((0,o.groupBy)(a,function(t){return t.action.getContainerId()})).map(function(t){return t[t.length-1]});return(0,o.union)(r,s)}return{executeInteractionRules:function(){var e=arguments.length>0&&arguments[0]!==t?arguments[0]:[],f=n.Deferred(),h=e.filter(function(t){return"interaction"===t.rule.type}),p=(0,o.flatten)(h.map(function(t){var e=t.rule,n=t.availability;return(e.actions||[]).map(function(t){return{action:t,availability:n,rule:e}})})),m=(0,o.partition)(p,function(t){return t.action.isVisible()}),g=i(m,2),v=g[0];g[1].filter(function(t){var e=t.action,n=t.availability;return e.shouldExecute(n)}).forEach(function(t){var e=t.action,n=t.availability;return e.execute(n)});var _=v.filter(function(t){return t.action.isExecuted()}),b=l(v),y=b.filter(function(t){var e=t.action,n=t.availability;return e.shouldExecute(n)}),w=d(b);return(0,o.difference)(_,w).forEach(function(t){return t.action.cancel()}),w.filter(function(t){var e=t.action,n=t.availability;return e.shouldExecute(n)}).forEach(function(t){var e=t.action,n=t.availability,i=t.rule;s&&c(n),e.execute(n);var u=(0,o.get)(e,"channel.type","tag"),l=(0,o.get)(e,"id",(0,o.get)(e,"data.id")),d="both"===u?["chat","call"]:[u];r.emit(a.EngagementNotificationDisplayed,{channels:d,id:""+l,type:e.type,engagementRuleId:""+i.id})}),(0,o.values)((0,o.groupBy)(y,"rule.id")).forEach(function(t){return u(i(t,1)[0].rule)}),f.resolve(e.map(function(t){return t.rule})),f.promise()},executeQualificationRule:function(t,e){(t.actions||[]).filter(function(t){return t.shouldExecute(e)}).forEach(function(t){return t.execute(e)})}}}},{lodash:30}],114:[function(t,e,n){"use strict";var r=t("lodash");e.exports=function(t,e){function n(t){var e=t.rule,n=t.availability,r={id:e.id,type:e.type,exec:e.shouldIncrementExecutionCount()?1:0,dis:e.shouldIncrementDisplayCount(n)?1:0};return n&&(r.chatoff=n.chat.available?0:1,r.calloff=n.call.available?0:1,r.busy=n.chat.busy?1:0),r}function i(e){return{s:t.website_id,u:t.vuid,rules:r.map(e,n)}}function o(){return"ha"===t.platform&&"833"===t.website_id}function a(){return"ha"===t.platform&&155===t.client_id||"sd"===t.platform&&8925===t.client_id}var s=t.chaturl+"rpc/proactif_count.php";return{sendProactifCount:function(n){var r=e.Deferred();if(2===t.chat.status||!o()&&!a())return r.resolve(n),r.promise();var c={url:s,data:i(n),type:"post"};return e.ajax(c),r.resolve(n),r.promise()}}}},{lodash:30}],115:[function(t,e,n){"use strict";var r=t("lodash");e.exports=function(t,e,n,i){function o(){return{chat:{available:!t.opOffline,busy:!!t.opBusy},call:{available:!t.c2cOffline},video:{available:!t.c2vOffline},callMeeting:t.callMeeting,callInstant:t.callInstant}}function a(r){var o=e.Deferred();return 2!=t.chat.status&&(i||r)?(t.forceDep=r,n.find({forceDep:r}).done(function(){o.resolve()})):o.resolve(),o.promise()}function s(t){return r.map(t,function(t){var e={rule:t};return"interaction"===t.type&&(e.availability=o()),e})}function c(t){var e=r.slice(t);return r.get(r.chain(e).reverse().find(function(t){return"interaction"===t.type&&t.skill}).value(),"skill.id")}return{getRulesAvailabilities:function(t){var n=e.Deferred();return r.some(t,{type:"interaction"})?a(c(t)).then(function(){n.resolve(s(t))}):n.resolve(s(t)),n.promise()},getFirstEligibleSkillIdForRules:c}}},{lodash:30}],116:[function(e,n,r){"use strict";var i=function(){function e(e,n){var r=[],i=!0,o=!1,a=t;try{for(var s,c=e[Symbol.iterator]();!(i=(s=c.next()).done)&&(r.push(s.value),!n||r.length!==n);i=!0);}catch(t){o=!0,a=t}finally{try{!i&&c.return&&c.return()}finally{if(o)throw a}}return r}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=e("lodash"),a=o.partition;n.exports=function(t,e,n,r){function s(t){var e=t.rule,n=t.availability;return{id:e.id,isVisibleAndAvailable:e.hasActionRequiringDisplay(n),canBeDisplayed:e.hasActionRequiringDisplay(n),shouldIncrementDisplayCount:e.shouldIncrementDisplayCount(n),shouldIncrementMissedDisplayCount:e.shouldIncrementMissedDisplayCount(n),availability:n}}function c(t,e){var n=e.rule;return"qualification"===n.type?(t.qualificationRules.push(n.id),t):(n.shouldIncrementExecutionCount()&&t.interactionRules.push(s(e)),t)}function u(e){var n=o.reduce(e,c,{qualificationRules:[],interactionRules:[]});return{visitor:{id:t.vuid,websiteId:+t.website_id,sessionId:t.vStats.sessionId},qualificationRules:n.qualificationRules,interactionRules:n.interactionRules}}function l(n){var r=e.Deferred();if(!t.targetedVisitors||!t.targetedVisitors.enabled)return r.resolve([]),r.promise();var i=u(n);if(0===i.interactionRules.length&&0===i.qualificationRules.length)return r.resolve([]),r.promise();var a={url:d,data:t.util.JSONStringify(i),contentType:"application/json",processData:!1,type:"post",success:function(t){r.resolve(o.map(t.authorizedRules))},error:function(){r.resolve([])}};return e.ajax(a),r.promise()}var d=t.targetedVisitors.url+"triggered-rules?platform="+t.platform;return{getRulesOpportunities:function(s){var c=e.Deferred(),u=a(s,"rule.displayed"),d=i(u,2),f=d[0],h=d[1];return 2===t.chat.status?(c.resolve(s),c.promise()):(l(h).then(function(t){var e=o.reject(h,function(e){var i=e.rule,a=e.availability,s=o.includes(t,i.id),c=i.hasActionRequiringDisplay(a);return"interaction"!==i.type||!s&&c||n.emit(r.TargetingRulePresenceUpdated,i,a),c&&!s});c.resolve(f.concat(e))}),c.promise())}}}},{lodash:30}],117:[function(t,e,n){function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function i(t){return t&&t.__esModule?t:{default:t}}var o=i(t("./gdpr/middleware")),a=r(t("./gdpr/events")),s=r(t("./gdpr/constants")),c=i(t("./fireRuleFlow")),u=r(t("./events")),l=t("lodash"),d=t("lodash.clonedeep");e.exports=function(e,n,r){function i(){return!/(ip-label|WatchMouse)/.test(navigator.userAgent)}function f(t){var e=0;return"qualification"===t.type&&--e,t.channel&&"all"===t.channel.type&&++e,e}var h=t("./vStats")(n,e),p=t("../../livechat/src/polling"),m=t("./channels");t("./Watcher");var g={},v=t("./model/rule/condition")(n.vStats,g,n),_=window.iAdvizeCallbacks&&(window.iAdvizeCallbacks.onStatusChanged||window.iAdvizeCallbacks.onCallStatusChanged||window.iAdvizeCallbacks.onTargetingRuleTriggered),b=n.routing&&n.routing.enabled||!_,y=n.require("eventManager");o.default.register(y,e);var w=t("./visitor")(n.vStats,n.JSONStore),C=t("./model/rule")(n,y,m,w,r),x=t("./handlers/OldAvailabilityHandler")(n,n.$,p,b),O=!1;if(!n.vStats.merpHash&&n.routing&&n.routing.enabled){var S=t("./routingService")(n,n.$,p,x.getFirstEligibleSkillIdForRules);x=t("./handlers/AvailabilityHandler")(n,S),O=!0}var T=t("./handlers/OpportunityHandler")(n,n.$,y,u),E=t("./handlers/GeniusTargetingHandler")(n,n.$),A=t("./handlers/ExecutionHandler")(n,n.$,y,u,O),I=(0,c.default)(e,y,2e3,function(t){var i=e.Deferred();return!r.hasContactOngoing()&&t.checkHash&&n.vStats.merpHash?p.find({h:n.vStats.merpHash}).done(function(e){e.merpData?(n.forceAgent=e.merpData.operatorId,0==e.opOffline?i.resolve(t):i.reject(t)):i.reject(t)}).fail(function(){i.reject(t)}):i.resolve(t),i.promise()},x,T,E,A),k=n.ProActif={_datas:[],vStatsI:g,run:function(t){if(!i())return!0;if(void 0!==window.idzCustomData)for(var e in idzCustomData)idzCustomData.hasOwnProperty(e)&&void 0!==idzCustomData[e]&&null!==idzCustomData[e]&&n.vStats.val(e,idzCustomData[e]);if(r.hasContactOngoing())return!0;var o=this._datas;o=t?l.filter(o,function(e){return e.id==t}):l.sortBy(o,f);for(var a=0;a<o.length;a++){var s=o[a];this.areRuleConditionsMet(s)?I.fireRule(s):s.executed&&(s=I.untriggerRule(s))}return o},reRun:function(){r.hasContactOngoing()||I.fireReRun()},areRuleConditionsMet:function(t){var e=l.chain(t.conditions).filter("criteria").forEach(function(e){var n=e.criteria;void 0!==e.getValue()&&"merpLink"===n.field&&(t.checkHash=!0)}).map(l.partial(this.isRuleConditionMet,l,t.id)).value();return l.every(e)},isRuleConditionMet:function(t,e){if(void 0!==t.getValue()){if(t.tRefreshData instanceof Function&&t.tRefreshData(),t.isMet())return!0;t.tIsFalse instanceof Function&&t.tIsFalse(e)}return!1},fireRule:I.fireRule,saveData:function(){i()&&setTimeout(function(){n.JSONStore.saveData({proactif_activated:n.flags.proactif_activated,proactif_showchatbar:n.flags.proactif_showchatbar,proactif_message:n.util.htmlspecialchars(n.flags.proactif_message),message:n.util.htmlspecialchars(n.flags.message),proactif_invit:n.flags.proactif_invit,proactif_activatedId:n.flags.proactif_activatedId,proactif_alert:n.flags.proactif_alert,phoneDisplayed:n.flags.phoneDisplayed})},400)},watchCustomData:function(t,r,i,o,a){n.Watcher.add(function(){var n=e(t).text()||e(t).val();return n&&"INTEGER"==i&&"count"!==o&&(n=parseInt(n.replace(/,/g,".").replace(/[^\d.]+/g,""),10)),n&&"FLOAT"==i&&"count"!==o&&(n=parseFloat(n.replace(/,/g,".").replace(/[^\d.]+/g,""),10)),n},function(t){var e=n.vStats[r],s=n.Store.get(r);if("count"!=o&&void 0===s&&(s=t),"current"==o)void 0!==t?n.vStats[r]=t:delete n.vStats[r];else if("max"==o)void 0!==t&&t>=s&&(s=t,n.Store.set(r,s)),void 0!==s&&(n.vStats[r]=s);else if(void 0!==t&&"min"==o)void 0!==t&&t<=s&&(s=t,n.Store.set(r,s)),void 0!==s&&(n.vStats[r]=s);else if("count"==o){if(a){var c=!1;"STRING"!=i&&t==a?c=!0:"STRING"==i&&void 0!==t&&-1!=t.indexOf(a)&&(c=!0),c&&(s=s||0,s++,n.Store.set(r,s))}n.vStats[r]=s||0}n.vStats[r]!=e&&setTimeout(function(){n.ProActif.run()},200)},r)},setData:function(t){t&&(this._datas=l.map(t,function(t){var e=new C(t);return e.conditions=l.map(e.targetingConditions,function(t){var e=t.targetingConditionCriteria||t.visitorAttribute;if(t.criteria=e,e&&t.visitorAttribute&&(e.field="ext_"+e.field),l.isString(t.value)&&-1!==t.value.indexOf("IDZ_CDATA_")){t.isValCustom=!0;var n=JSON.parse(t.value.substr(10));t.valField="ext_"+n.field,t.valPath=n.path,t.valBaseType=n.basetype,t.valValType=n.valtype,""!=t.valPath&&k.watchCustomData(t.valPath,t.valField,t.valBaseType,t.valValType)}return t=v(t),e&&e.path&&""!=e.path&&k.watchCustomData(e.path,e.field,t.getBaseType(),e.valueType,e.value),t}),e}))},match:function(t){y.on(u.TargetingRuleTriggered,t)}};k.setData(n.proactifData),y.emit(u.TargetingLoaded,d({list:k._datas}));var R=t("./replayTargeting")(n,y,u,function(){I.reactToNavigate();var t=n.ProActif.run();t instanceof Array&&y.emit(u.TargetingEngineRan,t)},h);return R.launch(),n.navigate=R.navigate,y.on(u.TargetingEngineCheckAvailability,l.debounce(k.reRun,3e4)),{events:a,constants:s}}},{"../../livechat/src/polling":84,"./Watcher":104,"./channels":105,"./events":106,"./fireRuleFlow":107,"./gdpr/constants":108,"./gdpr/events":109,"./gdpr/middleware":110,"./handlers/AvailabilityHandler":112,"./handlers/ExecutionHandler":113,"./handlers/GeniusTargetingHandler":114,"./handlers/OldAvailabilityHandler":115,"./handlers/OpportunityHandler":116,"./model/rule":142,"./model/rule/condition":139,"./replayTargeting":143,"./routingService":144,"./vStats":145,"./visitor":146,lodash:30,"lodash.clonedeep":25}],118:[function(t,e,n){"use strict";function r(t){"both"===t&&(t="all"),this.type=t}var i={chat:function(t){return t.chat.available},call:function(t){return t.call.available||t.callMeeting.available&&t.callMeeting.enabled},visio:function(t){return t.video.available},all:function(t){return i.chat(t)||i.call(t)},"social-facebook-messenger-messageUs":function(){return!0},"social-facebook-messenger-sendToMessenger":function(){return!0},"social-facebook-messenger-chatbox":function(){return!0},"social-sms-desktop":function(){return!0},"social-sms-mobile":function(){return!0},"social-whatsapp-desktop":function(){return!0},"social-whatsapp-mobile":function(){return!0},none:function(){return!1}},o={chat:function(t){return t.chat.busy},call:function(t){return t.call.busy},visio:function(t){return t.video.busy},all:function(t){return o.chat(t)||o.call(t)},none:function(){return!1}},a=r.prototype;a.isAvailable=function(t){return!!(i[this.type]||i.none)(t)},a.isBusy=function(t){return!!(o[this.type]||o.none)(t)},e.exports=r},{}],119:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={BOTTOM_CORNER:"bottomCorner",MODAL:"modal"};n.default=r},{}],120:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=t("lodash"),a=function(){function t(e){r(this,t),this.executed=!1,(0,o.assign)(this,e)}return i(t,[{key:"getContainerId",value:function(){return null}},{key:"execute",value:function(){this.executed=!0,this.recordExecution()}},{key:"recordExecution",value:function(){}},{key:"cancel",value:function(){this.executed=!1}},{key:"isAvailable",value:function(){return!0}},{key:"isExecuted",value:function(){return this.executed}},{key:"isVisible",value:function(){return this.visible}},{key:"shouldIncrementExecutionCount",value:function(){return!0}},{key:"canBeDisplayed",value:function(t){return this.isAvailable(t)&&this.isVisible()}},{key:"shouldExecute",value:function(t){return!this.isExecuted()&&this.isAvailable(t)}},{key:"shouldCancel",value:function(t){return this.isExecuted()&&!this.isAvailable(t)}}],[{key:"canHandle",value:function(t){return!1}}]),t}();a.prototype.visible=!1,n.default=a},{lodash:30}],121:[function(e,n,r){function i(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(r,"__esModule",{value:!0});var c=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=function e(n,r,i){null===n&&(n=Function.prototype);var o=Object.getOwnPropertyDescriptor(n,r);if(o===t){var a=Object.getPrototypeOf(n);return null===a?t:e(a,r,i)}if("value"in o)return o.value;var s=o.get;return s===t?t:s.call(i)},l=e("../../../../../../../../sreact"),d=i(e("../AbstractAction")),f=e("./ButtonComponent"),h=i(e("../../ActionContainers")),p=e("./dirty"),m=e("../../../../../gdpr/events"),g=e("./ButtonHelpers");r.default=function(t,e,n){var r=t.vuid,i=t.chaturl,v=t.curlang,_=t.website_id,b=t.static_url,y=t.client_id,w=t.T("REDUIRE"),C=e.events,x=function(d){function x(t){o(this,x);var e=a(this,(x.__proto__||Object.getPrototypeOf(x)).call(this,t));return e.channel=n.getChannel(e.data.button.type),e}return s(x,d),c(x,[{key:"getContainerId",value:function(){return h.default.BOTTOM_CORNER}},{key:"isAvailable",value:function(t){return this.channel.isAvailable(t)}},{key:"execute",value:function(t){u(x.prototype.__proto__||Object.getPrototypeOf(x.prototype),"execute",this).call(this),(0,p.addCustomizedTemplateStyleElementToDOM)(y,_,b),(0,g.isSocial)(this.data.button.type)?this.renderOffsiteButton(this.data.button.type):this.renderOnsiteButton(t),e.emit("rule.action.executed.button",this.channel)}},{key:"cancel",value:function(){u(x.prototype.__proto__||Object.getPrototypeOf(x.prototype),"cancel",this).call(this);var t=document.getElementById("idz_btn"),e=document.getElementById("idz_btn_style");t&&t.remove(),e&&e.remove()}},{key:"renderOffsiteButton",value:function(e){var n=this,r=(0,f.getOffsiteButton)(this.data.button,_,y,b,i,v,w,t.widgetMinified,function(e){return t.JSONStore.save({widgetMinified:e?1:0})}),o=r.button,a=r.style,s=r.showButton,c=r.configuration,u=c.btnPageId,d=c.btnColor,h=c.btnSize,p=t.util.get_head(),m=t.util.get_body();if((0,l.render)(a,p),(0,l.render)(o,m),(0,g.isSocialFacebookMessenger)(e)){var C=null;switch(e){case"social-facebook-messenger-messageUs":C="fb-messengermessageus";break;case"social-facebook-messenger-sendToMessenger":C="fb-send-to-messenger"}t.social.facebook.messenger.renderButton("#idz_btn > #idz_foffline",C,u,null,d,h,function(t){if(t)throw n.cancel(),t;s()})}else t.$(".idz_social_facebook_messenger_button").remove();(0,g.isSocial)(e)&&!(0,g.isSocialFacebookMessenger)(e)&&s()}},{key:"renderOnsiteButton",value:function(o){var a={chatIsAvailable:n.getChannel("chat").isAvailable(o),callIsAvailable:n.getChannel("call").isAvailable(o),videoIsAvailable:n.getChannel("visio").isAvailable(o)};a.chatIsAvailable&&t.onChatButtonDisplay(),a.callIsAvailable&&t.onCallButtonDisplay(),a.videoIsAvailable&&t.onVisioButtonDisplay();var s=this.data.button.id,c=(0,f.getOnsiteComponent)(this.data.button,i,v,_,y,b,w,t.widgetMinified,function(e){return t.JSONStore.save({widgetMinified:e?1:0})},a,function(){e.emit(m.showChatboxButtonClicked,r,s)},function(){t.chat.onClickC2cWidget()},function(){e.emit(C.OnConversationVisioRequested)}),u=c.button,d=c.style,h=t.util.get_head(),p=t.util.get_body();(0,l.render)(d,h),(0,l.render)(u,p)}}],[{key:"canHandle",value:function(t){return"button"===t.type}}]),x}(d.default);return x.prototype.visible=!0,x}},{"../../../../../../../../sreact":148,"../../../../../gdpr/events":109,"../../ActionContainers":119,"../AbstractAction":120,"./ButtonComponent":122,"./ButtonHelpers":124,"./dirty":126}],122:[function(e,n,r){Object.defineProperty(r,"__esModule",{value:!0}),r.getOnsiteComponent=r.getOffsiteButton=t;var i=function(t){return t&&t.__esModule?t:{default:t}}(e("classnames")),o=e("../../../../../../../../sreact"),a=e("./ButtonStyles"),s=e("./ButtonConfiguration"),c=e("./ButtonHelpers"),u=function(t){var e=t.text1,n=t.closeButtonStyle,r=t.onCloseButtonCallback;return(0,o.html)("div",{class:"idz_t_close",title:e,style:n,onClick:r})};r.getOffsiteButton=function(e,n,r,l,d,f,h,p,m){var g=(0,s.createButtonOffsiteConfig)(e,l,d,f,n,h),v=g.ID,_=g.isCustom,b=g.btntype,y=g.offImg,w=g.contactUrl,C=g.text,x=g.position,O=g.btnPageId,S=g.btnColor,T=g.btnSize,E=g.startMinified,A=g.isMinified,I=g.maxiButImg,k=g.miniButImg,R=g.miniOn,j=g.onImg,N=g.text1,M=1==p||E||A,z=l+"images/livechat/blank.gif",D=(0,i.default)("type_"+b,{type_custom:_,type_mini:M}),P=(0,o.html)("img",{class:"idz_btnimg",src:y,style:{border:"none"},id:"idz_btnimgoff",name:"offline",border:"0",alt:""}),B=(0,o.html)("img",{class:"idz_blankimg",name:"offline_ie",border:"0",alt:"",src:z,style:{border:"none"}}),L=void 0;(0,c.shouldDisplayTextZone)(b)&&(L=(0,o.html)("div",{class:"idz_text_zone"},C));var U=M,H=void 0,F=void 0,q=void 0,V=function(t){m(t),U=t;var e=t?I:k,n=t?R:j,r=F.render();r.style.display="block",r.style.background="transparent url('"+e+"') center center no-repeat";var i=q.render(),o=H.render();P.render().src=n,t?(i.className=i.className+" idz_mini",o.className=o.className+" type_mini"):(i.className=i.className.replace("idz_mini",""),o.className=o.className.replace("type_mini",""))},$=M?I:k;F=u({text1:N,closeButtonStyle:{display:!_||_&&R!==j&&""!==R&&R!==t?"block":"",background:"transparent url('"+$+"') center center no-repeat"},onCloseButtonCallback:function(t){V(!U),t.stopPropagation()}}),H=(0,o.html)("div",{id:"idz_foffline",class:D,style:{display:"none"}},(0,c.isSocialWhatsapp)(b)?(0,o.html)("a",{href:w,target:"_blank"},P,L):w?(0,o.html)("a",{href:"javascript:void(0);",onclick:"window.location.href='"+w+"'"},P,B,L):(0,o.html)("a",{href:"javascript:void(0);"},P,B,L)),q=(0,o.html)("div",{id:"idz_btn",class:(0,i.default)("client_"+r+" site_"+n+" btn_"+v,{idz_mini:M})},F,H);var G=(0,a.createCssForOthersBtnTypes)(x,!0,0,y),W=(0,o.html)("style",{id:"idz_btn_style",type:"text/css"},G);return{configuration:{btnPageId:O,btnColor:S,btnSize:T},button:q,style:W,showButton:function(){return H.render().style.display=""}}},r.getOnsiteComponent=function(e,n,r,l,d,f,h,p,m,g,v,_,b){var y=(0,s.createButtonOnsiteConfig)(e,n,r,l,f,h),w=y.ID,C=y.text1,x=y.btntype,O=y.btnwidth,S=y.onImg,T=y.contactUrl,E=y.offImg,A=y.isCustom,I=y.textColor,k=y.fs1,R=y.fs2,j=y.ff1,N=y.ff2,M=y.textCall,z=y.textChat,D=y.callImg,P=y.chatImg,B=y.miniOn,L=y.isMinified,U=y.miniButImg,H=y.maxiButImg,F=y.startMinified,q=y.position,V=y.isCustomDisplay,$=y.btnBgColor,G=g.chatIsAvailable,W=g.callIsAvailable,J=g.videoIsAvailable,X=G||W||J,Q="both"===x?(0,a.createCssForBtnTypeBoth)(q,V,O,S,E,$):(0,a.createCssForOthersBtnTypes)(q,V,O,S,E),Y=(0,o.html)("style",{id:"idz_btn_style",type:"text/css"},Q),Z=f+"images/livechat/blank.gif",K=function(){v()},tt=function(){_()},et=1==p||F||L,nt=(0,o.html)("img",{class:"idz_btnimg",src:E,style:{border:"none"},id:"idz_btnimgoff",name:"offline",border:"0",alt:""}),rt=(0,o.html)("img",{class:"idz_blankimg",name:"offline_ie",border:"0",alt:"",src:Z,style:{border:"none"}}),it=(0,o.html)("img",{class:"idz_btnimg",id:"idz_btnimgon",name:"online",border:"0",alt:"",src:et?B:S,style:{border:"none"}}),ot=(0,i.default)("type_"+x,{type_avatar:252===O}),at=(0,i.default)(ot,{type_custom:A,type_mini:et}),st=void 0,ct=void 0,ut=void 0,lt=et,dt=function(t){m(t),lt=t;var e=t?H:U,n=t?B:S,r=ut.render();r.style.display="block",r.style.background="transparent url('"+e+"') center center no-repeat";var i=st.render(),o=ct.render();it.render().src=n,t?(i.className=i.className+" idz_mini",o.className=o.className+" type_mini"):(i.className=i.className.replace("idz_mini",""),o.className=o.className.replace("type_mini",""))},ft=et?H:U;if(ut=u({text1:C,closeButtonStyle:{display:!A||A&&B!==S&&""!==B&&B!==t?"block":"",background:"transparent url('"+ft+"') center center no-repeat"},onCloseButtonCallback:function(t){dt(!lt),t.stopPropagation()}}),"both"===x){var ht=(0,i.default)(at,{single_chan:W^G});ct=(0,o.html)("div",{id:"idz_fonline",class:ht,style:{display:G||W?t:"none"}},(0,o.html)("div",{class:"idz_t_btn"},A?(0,o.html)(o.Fragment,null,(0,o.html)("a",{href:"javascript:void(0)",class:"idz_btn_on_call",onClick:tt,style:{display:W?t:"none"}},(0,o.html)("img",{border:"0",alt:"",src:D})),(0,o.html)("a",{href:"javascript:void(0)",class:"idz_btn_on_chat",onClick:K,style:{display:G?t:"none"}},(0,o.html)("img",{border:"0",alt:"",src:P})),(0,o.html)("br",null)):(0,o.html)(o.Fragment,null,(0,o.html)("a",{href:"javascript:void(0)",class:"idz_btn_on idz_btn_on_call",onClick:tt,style:{display:W?t:"none",color:I,"font-size":R+"px","font-family":N+", sans-serif"}},M),(0,o.html)("a",{href:"javascript:void(0)",class:"idz_btn_on idz_btn_on_chat",onClick:K,style:{display:G?t:"none",color:I,"font-size":k+"px","font-family":j+", sans-serif"}},z))),it,(0,o.html)("img",{class:"idz_blankimg",name:"online_ie",border:"0",alt:"",src:Z,style:{border:"none"}})),st=(0,o.html)("div",{id:"idz_btn",onClick:function(){return dt(!1)},class:"client_"+d+" site_"+l+" btn_"+w},ut,ct,(0,o.html)("div",{id:"idz_foffline",class:ot,style:{display:G||W?"none":t}},T?(0,o.html)("a",{href:"javascript:void(0);",onclick:"window.location.href='"+T+"'"},nt,rt):(0,o.html)("a",{href:"javascript:void(0);"},nt,rt)))}else{var pt=K;"call"===x?pt=tt:"visio"===x&&(pt=function(){b()}),ct=(0,o.html)("div",{id:"idz_fonline",onClick:pt,class:at,style:{display:X?t:"none"}},(0,o.html)("a",{href:"javascript:void(0);"},it,(0,o.html)("img",{class:"idz_blankimg",name:"online_ie",border:"0",alt:"",src:Z,style:{border:"none"}}))),st=(0,o.html)("div",{id:"idz_btn",onClick:function(){return dt(!1)},class:(0,i.default)("client_"+d+" site_"+l+" btn_"+w,{idz_mini:et})},ut,ct,(0,o.html)("div",{id:"idz_foffline",class:ot,style:{display:X?"none":t}},(0,c.isSocialWhatsapp)(x)?(0,o.html)("a",{href:T,target:"_blank"},nt):T?(0,o.html)("a",{href:"javascript:void(0);",onclick:"window.location.href='"+T+"'"},nt,rt):(0,o.html)("a",{href:"javascript:void(0);"},nt,rt)))}return{button:st,style:Y}}},{"../../../../../../../../sreact":148,"./ButtonConfiguration":123,"./ButtonHelpers":124,"./ButtonStyles":125,classnames:9}],123:[function(e,n,r){Object.defineProperty(r,"__esModule",{value:!0}),r.createButtonOnsiteConfig=r.createButtonOffsiteConfig=r.createBothButtonConfig=r.createImagesButtonConfig=t;var i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},o=e("./ButtonHelpers"),a=function(t){return t&&""!==t},s=r.createImagesButtonConfig=function(t,e,n){var r={};return a(t.on)?(r=i({},r,{onImg:t.on,isCustom:!0}),a(t.off)&&(r=i({},r,{offImg:t.off})),a(t.chat)&&(r=i({},r,{chatImg:t.chat})),a(t.call)&&(r=i({},r,{callImg:t.call})),i({},r,{miniOn:a(t.mini)?t.mini:t.onImg,miniOff:a(t.mini)?t.mini:t.onImg})):{isCustom:!1,onImg:e+"&id="+t.id,miniOn:n+"&id="+t.id}},c=r.createBothButtonConfig=function(t){return{btnBgColor:t.btnbgcolor,btnColor:t.btncolor,textColor:t.textcolor,fs1:t.fs1,fs2:t.fs2,ff1:t.ff1,ff2:t.ff2,textChat:t.textchat,textCall:t.textcall}},u=function(t){return{btnPageId:t.btnpageid,btnColor:t.btncolor||"blue",btnSize:t.btnsize||"xlarge"}},l=function(t){return{text:t.text}};r.createButtonOffsiteConfig=function(e,n,r,a,c,d){var f=r+"floating_button/png.php?lang="+a+"&sid="+c,h=n+"images/livechat/blank.gif",p=e.type,m=e.text1===t?d:e.text1,g={isCustomDisplay:"visibility:hidden",btnwidth:e.btnwidth,ID:e.id,position:e.pos,startMinified:"1"===e.reduce||1===e.reduce,contactUrl:"javascript:void(0);",offImg:h,onImg:f,isMinified:!1,btntype:e.type,btnBgColor:"#409808",textChat:"",textCall:"",textColor:"#FFFFFF",btnPageId:null,btnSize:"xlarge",text:"",text1:m,miniButImg:n+"images/widget/floating/icon_close.png",maxiButImg:n+"images/widget/floating/icon_plus.png"};return(0,o.isSocialFacebookMessenger)(p)?g=i({},g,u(e)):(0,o.shouldDisplayTextZone)(p)&&(g=i({},g,l(e))),""===e.contact&&e.contact===t||(g=i({},g,{contactUrl:e.contact})),i({},g,s(e,g.onImg,g.miniOn))},r.createButtonOnsiteConfig=function(e,n,r,o,a,u){var l=n+"floating_button/png.php?lang="+r+"&sid="+o,d=a+"images/livechat/blank.gif",f=e.text1===t?u:e.text1,h=e.type||"chat",p={isCustomDisplay:"visibility:hidden",btnwidth:e.btnwidth,ID:e.id,position:e.pos,startMinified:"1"===e.reduce||1===e.reduce,contactUrl:"javascript:void(0);",onImg:l,miniOn:l+"&mode=mini",offImg:d,miniOff:d,miniButImg:a+"images/widget/floating/icon_close.png",maxiButImg:a+"images/widget/floating/icon_plus.png",isMinified:!1,btntype:h,btnBgColor:"#409808",btnColor:"#FFFFFF",fs1:"12",fs2:"12",ff1:"Arial, sans serif",ff2:"Arial, sans serif",textChat:"",textCall:"",textColor:"#FFFFFF",text1:f,closeButton:t,isOnline:t,btnSize:"xlarge",text:""};return"both"===h&&(p=i({},p,c(e))),e.on&&""!==e.on&&(p=i({},p,{isCustomDisplay:""})),""===e.contact&&e.contact===t||(p=i({},p,{contactUrl:e.contact})),i({},p,s(e,p.onImg,p.miniOn))}},{"./ButtonHelpers":124}],124:[function(t,e,n){Object.defineProperty(n,"__esModule",{value:!0});n.isSocial=function(t){return t&&0===t.indexOf("social-")},n.isSocialFacebookMessenger=function(t){return t&&0===t.indexOf("social-facebook-messenger")},n.isSocialWhatsapp=function(t){return t&&/^social\-whatsapp\-(desktop|mobile)$/.test(t)},n.shouldDisplayTextZone=function(t){return t&&/^social\-(sms|whatsapp)\-desktop$/.test(t)}},{}],125:[function(t,e,n){Object.defineProperty(n,"__esModule",{value:!0});var r=function(t){return"left"===t?"left: 15px;right :auto;":"right: 15px;left :auto;"};n.createCssForBtnTypeBoth=function(t,e,n,i,o,a){return"\n      #idz_btn {\n        position:absolute;\n        bottom: 0px;\n        "+r(t)+"\n        z-index: 1000000000;\n        line-height:0;\n      }\n      \n      body > div#idz_btn {\n        position: fixed;\n      }\n      \n      * html #idz_btn {\n        bottom: auto;\n        top: expression( ( 0 - idz_btn.offsetHeight + ( document.documentElement.clientHeight ? document.documentElement.clientHeight : document.body.clientHeight ) + ( ignoreMe = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop ) ) + 'px' );\n      }\n      \n      #idz_btn #button_online {\n        background:transparent;\n      }\n      \n      .idz_t_close {\n        display:none;\n        position:absolute;\n        top:2px;\n        right:2px;\n        height:20px;\n        width:20px;\n        z-index:2;\n        cursor:pointer;\n        background:transparent url('//static.iadvize.com/images/widget/floating/icon_close.png') center center no-repeat;\n      }\n      \n      * html .idz_btnimg {\n        "+e+";\n      }\n      \n      * html #idz_fonline {\n        position:relative;\n      }\n      \n      * html #idz_fonline .idz_blankimg {\n        position:absolute;\n        left:0;\n        width:"+n+"px;\n        height:expression(idz_btnimgon.offsetHeight + 'px');\n      }\n      \n      * html #idz_foffline .idz_blankimg {\n        position:absolute;\n        left:0;\n        width:"+n+"px;\n        height:expression(idz_btnimgoff.offsetHeight + 'px');\n      }\n      \n      #idz_fonline.type_mini {\n        cursor:pointer;\n      }\n      \n      #idz_fonline .idz_t_btn{\n        position:absolute;\n        bottom:0px;\n        right:10px;\n        z-index:2;\n      }\n      \n      #idz_fonline.type_avatar .idz_t_btn {\n        left:75px;\n      }\n      \n      .idz_mini #idz_fonline.single_chan .idz_t_btn {\n        bottom:-9999px !important;\n      }\n      \n      #idz_fonline.type_custom .idz_t_btn {\n        bottom:0;\n        right:5px;\n        text-align:right;\n      }\n      \n      #idz_fonline.type_custom .idz_t_btn img {\n        display:block;\n        margin:0 0 5px 0;\n      }\n      \n      #idz_fonline.type_mini .idz_t_btn {\n        position:absolute;\n        bottom:-9999px;\n      }\n      \n      .idz_btn_on {\n        position:relative;\n        display:block;\n        width:127px;\n        height:20px;\n        padding:0 10px 0 5px;\n        margin:0 0 8px 0;\n        line-height:20px;\n        font-weight:bold;\n        font-size:12px;\n        font-family:arial;\n        color:#000000;\n        background:"+a+" url('//static.iadvize.com/images/widget/floating/bg_float_b_btn.png') left top repeat-x;\n        box-shadow:1px 1px 0px #ccc;\n        -moz-box-shadow:1px 1px 0px #ccc;\n        -webkit-box-shadow:1px 1px 0px #ccc;\n        border-radius: 5px;\n        -moz-border-radius: 5px;\n        -webkit-border-radius: 5px;\n      }\n      \n      * html .idz_btn_on {\n        background-image:none;\n      }\n      \n      .idz_btn_on span {\n        position:absolute;\n        top:8px;\n        right:5px;\n        display:block;\n        height:5px;\n        width:5px;\n        background:transparent url('//static.iadvize.com/images/widget/floating/bg_btn_valid.png') left top no-repeat;\n      }\n"},n.createCssForOthersBtnTypes=function(t,e,n,i,o){return"\n      #idz_btn {\n        position: absolute;\n        bottom: 0px;\n        "+r(t)+"\n        z-index: 1000000000;\n        line-height: 0;\n      }\n      \n      body > div#idz_btn {\n        position: fixed;\n      }\n      \n      * html #idz_btn {\n        bottom: auto;\n        top: expression( ( 0 - idz_btn.offsetHeight + ( document.documentElement.clientHeight ? document.documentElement.clientHeight: document.body.clientHeight) + ( ignoreMe=document.documentElement.scrollTop ? document.documentElement.scrollTop: document.body.scrollTop)) + 'px');\n      }\n      \n      #idz_btn #button_online {\n        background: transparent;\n      }\n      \n      .idz_t_close {\n        display: none;\n        position: absolute;\n        top: 2px;\n        right: 2px;\n        height: 20px;\n        width: 20px;\n        z-index: 2;\n        cursor: pointer;\n        background: transparent url('//static.iadvize.com/images/widget/floating/icon_close.png') center center no-repeat;\n      }\n      \n      * html .idz_btnimg {\n        VAR_this_isCustomDisplay: 0;\n        "+e+"\n      }\n      \n      * html #idz_fonline .idz_blankimg {\n        position: absolute;\n        left: 0;\n        width: "+n+"px;\n        height: expression(idz_btnimgon.offsetHeight + 'px');\n      }\n      \n      * html #idz_foffline .idz_blankimg {\n        position: absolute;\n        left: 0;\n        width: "+n+"px;\n        height: expression(idz_btnimgoff.offsetHeight + 'px');\n      }\n"}},{}],126:[function(t,e,n){Object.defineProperty(n,"__esModule",{value:!0});n.addCustomizedTemplateStyleElementToDOM=function(t,e,n){var r=iAdvize.require("template").customizer.getWidgetFloatingCssUrl(t,e,n,iAdvize.customize.layout);if(r){var i=document.createElement("link");i.setAttribute("type","text/css"),i.setAttribute("rel","stylesheet"),i.setAttribute("href",r),iAdvize.util.get_head().appendChild(i)}}},{}],127:[function(t,e,n){var r=function(t){return t&&t.__esModule?t:{default:t}}(t("./ButtonAction"));e.exports=r.default},{"./ButtonAction":121}],128:[function(e,n,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(r,"__esModule",{value:!0});var c=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=function e(n,r,i){null===n&&(n=Function.prototype);var o=Object.getOwnPropertyDescriptor(n,r);if(o===t){var a=Object.getPrototypeOf(n);return null===a?t:e(a,r,i)}if("value"in o)return o.value;var s=o.get;return s===t?t:s.call(i)},l=i(e("./AbstractAction")),d=i(e("../ActionContainers"));r.default=function(t,e,n){var r=function(e){function r(){return o(this,r),a(this,(r.__proto__||Object.getPrototypeOf(r)).apply(this,arguments))}return s(r,e),c(r,[{key:"getContainerId",value:function(){return d.default.BOTTOM_CORNER}},{key:"isAvailable",value:function(t){return n.chat.isAvailable(t)}},{key:"execute",value:function(){u(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"execute",this).call(this),t.Templates.showUI()}}],[{key:"canHandle",value:function(t){return"chatbox"===t.type}}]),r}(l.default);return r.prototype.visible=!0,r}},{"../ActionContainers":119,"./AbstractAction":120}],129:[function(e,n,r){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),c=function e(n,r,i){null===n&&(n=Function.prototype);var o=Object.getOwnPropertyDescriptor(n,r);if(o===t){var a=Object.getPrototypeOf(n);return null===a?t:e(a,r,i)}if("value"in o)return o.value;var s=o.get;return s===t?t:s.call(i)},u=e("lodash"),l=function(t){return t&&t.__esModule?t:{default:t}}(e("./AbstractAction"));r.default=function(t,e,n,r){var d={chat:function(){return t.chat.onClickChatWidget()},call:function(){return t.chat.onClickC2cWidget()},video:function(){return n.emit(n.events.OnConversationVisioRequested)}},f=function(t){function l(t){i(this,l);var n=o(this,(l.__proto__||Object.getPrototypeOf(l)).call(this,t));return n.channel=r.getChannel(n.data.button.type),e(n.data.button.onlineCssSelector).click(function(){return(0,u.get)(d,n.channel.type,u.noop)(),!1}),n}return a(l,t),s(l,[{key:"isAvailable",value:function(t){return this.channel.isAvailable(t)}},{key:"shouldExecute",value:function(){return!0}},{key:"shouldCancel",value:function(){return!1}},{key:"execute",value:function(t){c(l.prototype.__proto__||Object.getPrototypeOf(l.prototype),"execute",this).call(this),n.emit("rule.action.executed.button",this.channel);var r=this.data.button;e(r.onlineCssSelector).hide(),e(r.busyCssSelector).hide(),e(r.offlineCssSelector).hide(),this.isAvailable(t)?e(r.onlineCssSelector).show():this.channel.isBusy(t)?e(r.busyCssSelector).show():e(r.offlineCssSelector).show()}}],[{key:"canHandle",value:function(t){return"fixed_buttons"===t.type}}]),l}(l.default);return f.prototype.visible=!0,f}},{"./AbstractAction":120,lodash:30}],130:[function(e,n,r){function i(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(r,"__esModule",{value:!0});var c=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=function e(n,r,i){null===n&&(n=Function.prototype);var o=Object.getOwnPropertyDescriptor(n,r);if(o===t){var a=Object.getPrototypeOf(n);return null===a?t:e(a,r,i)}if("value"in o)return o.value;var s=o.get;return s===t?t:s.call(i)},l=e("../../../../../../../../sreact"),d=i(e("../AbstractAction")),f=i(e("../../ActionContainers")),h=e("../../../../../gdpr/events"),p=e("./InvitationComponent"),m=!1;r.default=function(t,e,n){var r=function(r){function i(){return o(this,i),a(this,(i.__proto__||Object.getPrototypeOf(i)).apply(this,arguments))}return s(i,r),c(i,[{key:"isAvailable",value:function(e){var r=this.data.invitation,i=n.getChannel(r.type);return 2!==t.chat.status&&(null==t.flags.proactif_invit||-1===t.flags.proactif_invit.indexOf(r.id))&&i.isAvailable(e)}},{key:"getContainerId",value:function(){return f.default.MODAL}},{key:"execute",value:function(r){u(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"execute",this).call(this);var o=this.data.invitation.id;if(!m&&(t.Templates.loadChatCss(),1!==t.chat.composing)){t.callbacks.onInvitationDisplayed({id:o}),t.Templates.hideDialog();var a={chatIsAvailable:n.getChannel("chat").isAvailable(r),callIsAvailable:n.getChannel("call").isAvailable(r)},s=t.customize.layout,c=t.chaturl+"invitation.php?&id="+o+"&t="+s+"&sid="+t.website_id+"&lang="+t.curlang+"&callback=?";t.$.getJSON(c).then(function(n){var r=function(){m=!1;var t=document.getElementById("idzInvitation");t&&t.parentNode.removeChild(t)},i=(0,p.getComponent)(function(){e.emit(h.showChatboxButtonClicked,t.vuid,o),r()},function(){t.chat.onClickC2cWidget(),r()},r,a,n),s=t.util.get_body();(0,l.render)(i,s),m=!0})}}},{key:"recordExecution",value:function(){var e=this.data.invitation;t.flags.proactif_invit=t.flags.proactif_invit||"",t.flags.proactif_invit+=e.id+","}},{key:"shouldIncrementExecutionCount",value:function(){return null==t.flags.proactif_invit||-1===t.flags.proactif_invit.indexOf(this.data.invitation.id)}}],[{key:"canHandle",value:function(t){return"invitation"===t.type}}]),i}(d.default);return r.prototype.visible=!0,r}},{"../../../../../../../../sreact":148,"../../../../../gdpr/events":109,"../../ActionContainers":119,"../AbstractAction":120,"./InvitationComponent":131}],131:[function(e,n,r){function i(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}Object.defineProperty(r,"__esModule",{value:!0}),r.getComponent=t;var o=e("../../../../../../../../sreact");r.getComponent=function(e,n,r,a,s){var c=s.customEssaiLink,u=s.hasCustomCloseButton,l=s.invitationHref,d=s.websiteID,f=s.type,h=s.curlang,p=i(s,["customEssaiLink","hasCustomCloseButton","invitationHref","websiteID","type","curlang"]),m=a.chatIsAvailable,g=a.callIsAvailable;return(0,o.html)("div",{class:"invit invit_"+d+" invit_"+f+" idz_lang_"+h,id:"idzInvitation"},(0,o.html)("div",{id:"idzI_overlay",class:p.oclass,style:{height:"100%","background-color":"#"+p.couleur1}}),(0,o.html)("div",{id:"idzI",style:{top:p.posY+"%",left:p.posX+"%"},class:"idzI_"+p.wclass+" idzI_"+h},(0,o.html)("div",{id:"idzI_main",class:"idzI_ope_"+p.avatar,style:{"background-color":"#"+p.couleur2}},(0,o.html)("div",{id:"idzI_inner"},(0,o.html)("a",{id:"idzI_close",class:"idzI_btn_close",href:"javascript:void(0)",onClick:r}),(0,o.html)("div",{class:"idzI_title",style:{"font-size":p.tsize1+"px","font-family":p.ffamily1}},p["text1_"+h]),(0,o.html)("div",{class:"idzI_ctn"},(0,o.html)("div",{class:"idzI_ctn_inner"},(0,o.html)("div",{class:"idzI_step_1"},(0,o.html)("div",{class:"idzI_ope idzI_left"},(0,o.html)("div",{class:"idzI_ope_s"})),(0,o.html)("div",{class:"idzI_txt idzI_left"},(0,o.html)("div",{class:"idzI_label",style:{"font-size":p.tsize4+"px","font-family":p.ffamily4}},p["text4_"+h]),(0,o.html)("div",{class:"idzI_action"},"both"===f?(0,o.html)(o.Fragment,null,(0,o.html)("a",{href:"javascript:void(0)",class:"idzI_btn_on_chat idzI_btn_green idzI_btn_green_chat idzI_left",onClick:e,style:{"font-size":p.tsize5+"px","font-family":p.ffamily5,display:m?t:"none"}},(0,o.html)("span",null),(0,o.html)("strong",null,p["text5_"+h])),(0,o.html)("a",{href:"javascript:void(0)",class:"idzI_btn_on_call idzI_btn_green idzI_btn_green_call idzI_left",onClick:n,style:{"font-size":p.tsize6+"px","font-family":p.ffamily6,display:g?t:"none"}},(0,o.html)("span",null),(0,o.html)("strong",null,p["text6_"+h])),(0,o.html)("div",{class:"idzI_clearer"})):(0,o.html)(o.Fragment,null,(0,o.html)("a",{target:"_blank",href:l,onClick:function(){"chat"===f?e():"call"===f&&n()},class:"idzI_btn_on idzI_btn_green idzI_btn_green_bull idzI_left idzI_btn_green_"+f,style:{"font-size":p.tsize2+"px","font-family":p.ffamily2}},(0,o.html)("span",null),(0,o.html)("strong",null,p["text2_"+h])),(0,o.html)("a",{href:"javascript:void(0)",class:"idzI_btn_close idzI_btn_off idzI_btn_red idzI_left",onClick:r,style:{"font-size":p.tsize3+"px","font-family":p.ffamily3}},(0,o.html)("span",null),(0,o.html)("strong",null,p["text3_"+h])),(0,o.html)("div",{class:"idzI_clearer"})))),(0,o.html)("div",{class:"idzI_clearer"})))),(0,o.html)("div",{class:"idzI_more"},u?(0,o.html)("a",{href:"javascript:void(0)",class:"idzI_btn_close idzI_btn_off idzI_btn_red idzI_left",onClick:r,style:{"font-size":p.tsize3+"px","font-family":p.ffamily3}},(0,o.html)("strong",null,p["text3_"+h])):null,c.enabled?(0,o.html)("a",{href:c.href,target:"_blank",id:c.id},c.content):null)))))}},{"../../../../../../../../sreact":148}],132:[function(t,e,n){var r=function(t){return t&&t.__esModule?t:{default:t}}(t("./InvitationAction"));e.exports=r.default},{"./InvitationAction":130}],133:[function(e,n,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(r,"__esModule",{value:!0});var c=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=function e(n,r,i){null===n&&(n=Function.prototype);var o=Object.getOwnPropertyDescriptor(n,r);if(o===t){var a=Object.getPrototypeOf(n);return null===a?t:e(a,r,i)}if("value"in o)return o.value;var s=o.get;return s===t?t:s.call(i)},l=i(e("./AbstractAction")),d=i(e("../ActionContainers"));r.default=function(t,e,n){var r=function(e){function r(){return o(this,r),a(this,(r.__proto__||Object.getPrototypeOf(r)).apply(this,arguments))}return s(r,e),c(r,[{key:"isAvailable",value:function(e){return n.chat.isAvailable(e)&&2!=t.chat.status&&null==t.flags.proactif_message&&1!=t.opBusy}},{key:"getContainerId",value:function(){return d.default.BOTTOM_CORNER}},{key:"execute",value:function(){u(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"execute",this).call(this),t.chat.putOpMsg(null,this.data.text,0)}},{key:"recordExecution",value:function(){t.flags.proactif_message=t.flags.proactif_message||""}},{key:"shouldIncrementExecutionCount",value:function(){return null==t.flags.proactif_message}}],[{key:"canHandle",value:function(t){return"message"===t.type}}]),r}(l.default);return r.prototype.visible=!0,r}},{"../ActionContainers":119,"./AbstractAction":120}],134:[function(e,n,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(r,"__esModule",{value:!0});var c=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=function e(n,r,i){null===n&&(n=Function.prototype);var o=Object.getOwnPropertyDescriptor(n,r);if(o===t){var a=Object.getPrototypeOf(n);return null===a?t:e(a,r,i)}if("value"in o)return o.value;var s=o.get;return s===t?t:s.call(i)},l=i(e("./AbstractAction")),d=i(e("../ActionContainers"));r.default=function(t,e,n,r){var i=function(t){function i(t){o(this,i);var e=a(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.channel=n.getChannel(e.data.button.type),e}return s(i,t),c(i,[{key:"getContainerId",value:function(){return d.default.BOTTOM_CORNER}},{key:"isAvailable",value:function(t){return this.channel.isAvailable(t)}},{key:"execute",value:function(){u(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"execute",this).call(this),r.getEngine("messenger").chatbox.render(this.data.button.btnpageid),e.emit("rule.action.executed.button",this.channel)}},{key:"cancel",value:function(){u(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"cancel",this).call(this),r.getEngine("messenger").chatbox.destroy()}}],[{key:"canHandle",value:function(t){return"button"===t.type&&"social-facebook-messenger-chatbox"===t.data.button.type}}]),i}(l.default);return i.prototype.visible=!0,i}},{"../ActionContainers":119,"./AbstractAction":120}],135:[function(e,n,r){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),c=function e(n,r,i){null===n&&(n=Function.prototype);var o=Object.getOwnPropertyDescriptor(n,r);if(o===t){var a=Object.getPrototypeOf(n);return null===a?t:e(a,r,i)}if("value"in o)return o.value;var s=o.get;return s===t?t:s.call(i)},u=function(t){return t&&t.__esModule?t:{default:t}}(e("./AbstractAction"));r.default=function(t){var e=function(e){function n(){return i(this,n),o(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return a(n,e),s(n,[{key:"execute",value:function(){c(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"execute",this).call(this);var e=this.data.visitorAttribute;if(e){var r=e.field,i=+t.getAttribute(r,0),o=this.visitorAttributeModifier(i,this.data.value);t.setAttribute(r,o).persist()}}}]),n}(u.default);return{IncreaseVisitorAttributeAction:function(t){function e(){return i(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return a(e,t),s(e,[{key:"visitorAttributeModifier",value:function(t,e){return t+e}}],[{key:"canHandle",value:function(t){return"increase_visitor_attribute"===t.type}}]),e}(e),DecreaseVisitorAttributeAction:function(t){function e(){return i(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return a(e,t),s(e,[{key:"visitorAttributeModifier",value:function(t,e){return t-e}}],[{key:"canHandle",value:function(t){return"decrease_visitor_attribute"===t.type}}]),e}(e),ModifyVisitorAttributeAction:function(t){function e(){return i(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return a(e,t),s(e,[{key:"visitorAttributeModifier",value:function(t,e){return e}}],[{key:"canHandle",value:function(t){return"modify_visitor_attribute"===t.type}}]),e}(e)}}},{"./AbstractAction":120}],136:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(n,"__esModule",{value:!0});var i=r(t("./VisitorAttributeActions")),o=r(t("./MessengerChatboxButtonAction")),a=r(t("./ButtonAction")),s=r(t("./InvitationAction")),c=r(t("./ChatboxAction")),u=r(t("./MessageAction")),l=r(t("./FixedButtonAction"));n.default=function(t,e,n,r,d){var f=(0,i.default)(r);return{IncreaseVisitorAttributeAction:f.IncreaseVisitorAttributeAction,DecreaseVisitorAttributeAction:f.DecreaseVisitorAttributeAction,ModifyVisitorAttributeAction:f.ModifyVisitorAttributeAction,MessengerChatboxButtonAction:(0,o.default)(t,e,n,d),ButtonAction:(0,a.default)(t,e,n),InvitationAction:(0,s.default)(t,e,n),ChatboxAction:(0,c.default)(t,e,n),MessageAction:(0,u.default)(t,e,n),FixedButtonAction:(0,l.default)(t,t.$,e,n)}}},{"./ButtonAction":127,"./ChatboxAction":128,"./FixedButtonAction":129,"./InvitationAction":132,"./MessageAction":133,"./MessengerChatboxButtonAction":134,"./VisitorAttributeActions":135}],137:[function(t,e,n){"use strict";var r=t("lodash"),i=function(t){return t&&t.__esModule?t:{default:t}}(t("./actions"));e.exports=function(t,e,n,o,a){var s=(0,i.default)(t,e,n,o,a);return function(t){var e=(0,r.find)(s,function(e){return e.canHandle(t)});if(!e)throw new Error("Unknown targeting rule action type "+t.type);return new e(t)}}},{"./actions":136,lodash:30}],138:[function(t,e,n){"use strict";var r=t("lodash"),i=t("./operators");e.exports=function(t){function e(t){r.assign(this,t),this.types=[]}return e.prototype.super=function(){return Object.getPrototypeOf(this)},e.prototype.sanitizeValue=function(t){return null===t||void 0===t?t:(""+t).toLowerCase()},e.prototype.getValue=function(){return this.sanitizeValue(t[this.criteria.field])},e.prototype.getTestValue=function(){return this.sanitizeValue(this.isValCustom?t[this.valField]:this.value)},e.prototype.isMet=function(){var t=r.get(i,this.logicalOperator);if(!t)throw new Error("The operator "+this.logicalOperator+" isn't recognized");return t(this.getValue(),this.getTestValue())},e.prototype.getType=function(){return r.last(this.types)},e.prototype.getBaseType=function(){return r.head(this.types)},e}},{"./operators":140,lodash:30}],139:[function(t,e,n){"use strict";var r=t("lodash");e.exports=function(e,n,i){var o=t("./Condition")(e),a=t("./types")(o,e,n,i);return function(t){var e=t.criteria||{},n=e.type;return e.valueType&&"count"===e.valueType&&(n="INTEGER"),new(r.get(a,n,o))(t)}}},{"./Condition":138,"./types":141,lodash:30}],140:[function(t,e,n){"use strict";var r=t("lodash");e.exports=r.assign({is:function(t,e){return t==e},"is not":function(t,e){return t!=e},contains:function(t,e){return-1!==t.indexOf(e)},"not contains":function(t,e){return-1===t.indexOf(e)},"ends with":function(t,e){return r.endsWith(t,e)},"begins with":function(t,e){return r.startsWith(t,e)},regex:function(t,e){return new RegExp(e).test(t)},"not regex":function(t,e){return!new RegExp(e).test(t)},equal:function(t,e){return t==e},"less than":function(t,e){return t<e},"more than":function(t,e){return t>e},"less than or equal":function(t,e){return t<=e},"more than or equal":function(t,e){return t>=e}},{is:function(t,e){return t==e},notIs:function(t,e){return t!=e},contains:function(t,e){return-1!==t.indexOf(e)},notContains:function(t,e){return-1===t.indexOf(e)},endsWith:function(t,e){return r.endsWith(t,e)},beginsWith:function(t,e){return r.startsWith(t,e)},regex:function(t,e){return new RegExp(e).test(t)},notRegex:function(t,e){return!new RegExp(e).test(t)},equal:function(t,e){return t==e},lowerThan:function(t,e){return t<e},greaterThan:function(t,e){return t>e},lowerOrEqualThan:function(t,e){return t<=e},greaterOrEqualThan:function(t,e){return t>=e}})},{lodash:30}],141:[function(e,n,r){"use strict";var i=e("lodash");n.exports=function(e,n,r,o){function a(n){function r(t){c.call(this,t),this.types.push(n),r.prototype.tInit instanceof Function&&r.prototype.tInit.call(this)}var o=arguments.length>1&&arguments[1]!==t?arguments[1]:{},a=arguments.length>2&&arguments[2]!==t?arguments[2]:null,c=i.get(s,a,e);r.prototype=i.create(c.prototype,o),r.prototype.constructor=r,s[n]=r}var s={};return a("BOOL",{sanitizeValue:function(t){return i.isString(t)?"true"===t||"1"===t:!!t}}),a("INTEGER",{sanitizeValue:function(t){return null===t||void 0===t?t:parseInt(t,10)}}),a("FLOAT",{sanitizeValue:function(t){return null===t||void 0===t?t:parseFloat(t)}}),a("STRING"),a("TIME",{_tTimeBegin:0,_timeOut:null,tInit:function(){this.value*=60;var t=this.criteria.field;r[t]||(r[t]=!0,n[t]=60*n[t]||0),this._tTimeBegin=new Date},tRefreshData:function(){var t=new Date;this.value-=Math.ceil((t.getTime()-this._tTimeBegin.getTime())/1e3),this._tTimeBegin=t},tIsFalse:function(t){this.tRefreshData();var e=1e3+1e3*(this.value-n[this.criteria.field]);"equal"===this.logicalOperator&&(this.logicalOperator="more than or equal"),"less than"===this.logicalOperator&&(e-=2e3),clearTimeout(this._timeOut),this._timeOut=setTimeout(function(){o.ProActif.run(t)},Math.abs(e))}},"INTEGER"),a("ACTIVITY",{_timeOut:null,tInit:function(){var t=this.criteria.field;this.value*=60,n[t]=n[t]||0},tRefreshData:function(){var t=new Date,e=Math.ceil((t.getTime()-n.lastMove)/1e3);n.activeSince=e>5?n.activeSince:t.getTime(),n[this.criteria.field]=Math.ceil((t.getTime()-n.activeSince)/1e3)},tIsFalse:function(t){var e=1e3+1e3*(this.value-n[this.criteria.field]);"equal"===this.logicalOperator&&(this.logicalOperator="more than or equal"),"less than"===this.logicalOperator&&(e-=2e3),clearTimeout(this._timeOut),this._timeOut=setTimeout(function(){o.ProActif.run(t)},Math.abs(e))}},"FLOAT"),a("HTML",null,"STRING"),a("IHTML",null,"INTEGER"),a("FHTML",null,"FLOAT"),a("COUNTRY",null,"STRING"),a("TOWN",null,"STRING"),a("REFERRER",null,"STRING"),a("LANG",null,"STRING"),a("DAY",null,"INTEGER"),a("HOUR",null,"INTEGER"),a("DEVICE",null,"STRING"),s}},{lodash:30}],142:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=t("lodash");e.exports=function(e,n,a,s,c){var u=t("./action")(e,n,a,s,c);return function(){function t(e){r(this,t),o.assign(this,e),e.channel&&(this.channel=a.getChannel(e.channel)),e.targetingActions&&(this.actions=e.targetingActions.map(u))}return i(t,[{key:"hasButtonAction",value:function(){return o.some(this.actions,{type:"button"})}},{key:"hasActionRequiringDisplay",value:function(t){return o.some(this.actions,function(e){return e.canBeDisplayed(t)})}},{key:"shouldIncrementDisplayCount",value:function(t){return o.chain(this.actions).groupBy("type").map(function(t){return o.head(t)}).some(function(e){return e.canBeDisplayed(t)}).value()}},{key:"shouldIncrementMissedDisplayCount",value:function(t){return!this.hasActionRequiringDisplay(t)&&o.some(this.actions,function(t){return t.isVisible()})}},{key:"shouldIncrementExecutionCount",value:function(){return o.some(this.actions,function(t){return t.shouldIncrementExecutionCount()})}}]),t}()}},{"./action":137,lodash:30}],143:[function(t,e,n){var r=t("lodash").throttle,i=t("lodash");e.exports=function(t,e,n,o,a){function s(e){a.refresh(e),2==t.chat.status&&t.chat.sendPresence("dnd"),o()}function c(t){var e=document.location.href;f!==e&&(u(e),f=e),setTimeout(c,t)}function u(t){"string"==typeof t?l(function(){e.emit(h,t)}):console.warn("navigate first argument must be a string")}function l(e){var n=t.chaturl+"rpc/maintainVisitorState.php?s="+t.website_id+"&u="+t.vuid+"&lang="+t.curlang;t.$.ajax(n,{dataType:"jsonp",complete:function(){t.config&&(t.flags=t.config.flags,t.vProf=t.config.vProf,a.resetFlags(t.flags),a.resetProfile(t.vProf),delete t.config),e()}})}function d(e){2!=t.chat.status&&i.chain(e).filter({executed:!0}).isEmpty().value()&&t.Templates.hideUI()}var f=document.location.href,h=n.UserNavigated;return{launch:function(t){c(t||50),e.on(h,s),e.on(n.TargetingEngineRan,d)},stop:function(){e.off(h,s)},navigate:r(u,1e3,{trailing:!0,leading:!1})}}},{lodash:30}],144:[function(t,e,n){"use strict";var r=t("lodash");e.exports=function(t,e,n,i){function o(t){return{id:t.id,availability:t.attributes}}function a(t){return r.map(t,o)}function s(t,n){e.ajax({url:t,method:"GET",error:function(){return n.resolve([])},success:function(t){return n.resolve(a(t.data))}})}var c=!1,u=function(e){return t.routing.url+"targeting-rules/available?platform="+t.platform+"&lang="+t.curlang+"&ids[]="+e.join("&ids[]=")};return{checkRulesAvailability:function o(a,l){var d=l||e.Deferred();if(0===a.length)return d.resolve([]),d.promise();if(document.visibilityState&&"hidden"===document.visibilityState)return setTimeout(function(){o(a,d)},1e3),d.promise();var f=r.chain(a).filter({type:"interaction"}).map("id").value(),h=u(f);return c?s(h,d):(c=!0,t.forceDep=i(a),n.find().done(function(){s(h,d)})),d.promise()}}}},{lodash:30}],145:[function(e,n,r){var i=function(t){return t&&t.__esModule?t:{default:t}}(e("./DeviceInformationExtractor"));n.exports=function(e,n){var r=e.vStats={val:function(t,e){return this["ext_"+t]=e,this},getValue:function(t){return this["ext_"+t]},customData:function(){var t={};for(var e in this)null!==this[e]&&"function"!=typeof this[e]&&-1!==e.indexOf("ext_")&&(t[e.substr(4).replace(/_/g," ")]=this[e]);return JSON.stringify(t)},getProfile:function(){var t={};for(var e in this)null!==this[e]&&"function"!=typeof this[e]&&-1===e.indexOf("ext_")&&("navTime"===e&&(this[e]=1e3*Math.round(+new Date/1e3-this.connectionTime),this[e]<0&&(this[e]=3e3)),t[e]=this[e]);return JSON.stringify(t)}},o=function(t){if(t){r.history_id=+t.history_id;for(var e in t)if(t.hasOwnProperty(e)&&"va_"===e.substring(0,3)){var n=e.substring(3),i=t[e];r.val(n,i)}r.transactionProbability=t.transactionProbability,r.isLastEventProbability=t.isLastEventProbability,r.addCartProbability=t.addCartProbability,r.chatAcceptedProbability=t.chatAcceptedProbability}},a=function(t){for(var e in t)t.hasOwnProperty(e)&&(r[e]=t[e])},s=function(o){r.actualURI=decodeURI(document.location.href),r.referrer_lastPage=document.referrer,o?(r.referrer_lastPage=r.actualScreen,r.actualScreen=o):r.actualScreen=r.actualURI,r.actualURI.search(/idz-[a-z0-9]{5}$/)>0&&(r.merpLink=!0,r.merpHash=r.actualURI.substr(r.actualURI.indexOf("idz-")));var a=(0,i.default)();if(r.winWidth=n(window).width(),r.winHeight=n(window).height(),r.browserInfo=a.browser+" "+a.version,r.deviceInfo=a.OS,r.userAgent=navigator.userAgent,r.deviceType=a.deviceType,r.vuid=e.vuid,void 0!==window.idzCustomData){for(var s in idzCustomData)null!==idzCustomData[s]&&"undefined"!==idzCustomData[s]&&r.val(s,idzCustomData[s]);var c=idzCustomData.custProfile||"",u=idzCustomData.extID||"";ue=idzCustomData.cust_email||idzCustomData.user_email||"",""===c&&""===u&&""===ue||e.JSONStore.saveData({custProfile:c,extID:u,email:ue})}try{for(var l=0,d=e.insiteCD.length;l<d;l++){var f=e.insiteCD[l],h=n(f.path).text()||n(f.path).val();h&&"INTEGER"===f.type&&(h=parseInt(h.replace(/,/g,".").replace(/[^\d.]+/g,""),10)),h&&"FLOAT"===f.type&&(h=parseFloat(h.replace(/,/g,".").replace(/[^\d.]+/g,""),10));var p=e.Store.get("ext_"+f.field);if("count"!==f.valtype&&"prev"!==f.valtype&&p===t&&(p=h),"current"===f.valtype)h!==t?r["ext_"+f.field]=h:delete r["ext_"+f.field];else if("prev"===f.valtype)p!==t&&(r["ext_"+f.field]=p),h!==t&&(p=h,e.Store.set("ext_"+f.field,p));else if("max"===f.valtype)h!==t&&h>=p&&(p=h,e.Store.set("ext_"+f.field,p)),p!==t&&(r["ext_"+f.field]=p);else if(h!==t&&"min"===f.valtype)h!==t&&h<=p&&(p=h,e.Store.set("ext_"+f.field,p)),p!==t&&(r["ext_"+f.field]=p);else if("count"===f.valtype){if(f.val){var m=!1;"STRING"!==f.type&&h==f.val?m=!0:"STRING"===f.type&&h&&-1!==h.indexOf(f.val)&&(m=!0),m&&(p=p||0,p++,e.Store.set("ext_"+f.field,p))}r["ext_"+f.field]=p||0}}}catch(t){console&&console.log&&console.log(t)}};return a(e.vProf),r.lang=e.curlang,r.activeSince=r.lastMove=(new Date).getTime(),r.history_id=0,o(e.flags),s(),{refresh:s,resetFlags:o,resetProfile:a}}},{"./DeviceInformationExtractor":103}],146:[function(e,n,r){n.exports=function(e,n){return{getAttribute:function(n,r){var i=e.getValue(n);return i===t?r:i},setAttribute:function(t,r){return e.val(t,r),{persist:function(){var e={};e["va_"+t]=r,n.saveData(e)}}}}}},{}],147:[function(t,e,n){"use strict";e.exports={OnConversationVisioRequested:"conversations.visio.requested",OnConversationVisioClosed:"conversations.visio.closed",OnConversationVisioRefused:"conversations.visio.refused",OnConversationVisioTimeout:"conversations.visio.timeout",OnConversationVisioClose:"conversations.visio.close",OnConversationVisioRoutingDone:"conversations.visio.routingDone"}},{}],148:[function(e,n,r){Object.defineProperty(r,"__esModule",{value:!0});var i=function(t,e){for(var n in t)e(t[n],n)},o=function(e,n){var r=[];for(var i in e)e[i]!==t&&r.push(n(e[i],i));return r},a=function(t){return o(t,function(t,e){return e+": "+t+";"}).join(" ")},s=function(t,e){i(e,function(e,n){"style"!==n?"onClick"!==n?!0!==e?t.setAttribute(n,e):t.setAttribute(n,""):t.addEventListener("click",e):t.setAttribute(n,a(e))})},c={A:["href"],APPLET:["codebase"],AREA:["href"],BASE:["href"],BLOCKQUOTE:["cite"],BODY:["background"],DEL:["cite"],FORM:["action"],FRAME:["longdesc","src"],HEAD:["profile"],IFRAME:["longdesc","src"],IMG:["longdesc","src","usemap"],INPUT:["src","usemap","formaction"],INS:["cite"],LINK:["href"],OBJECT:["classid","codebase","data","usemap"],Q:["cite"],SCRIPT:["src"],AUDIO:["src"],BUTTON:["formaction"],COMMAND:["icon"],EMBED:["src"],HTML:["manifest"],SOURCE:["src"],TRACK:["src"],VIDEO:["poster","src"]},u=function(t){return{renderAsString:function(){var e=t.tagName===l?t.innerHTML:t.outerHTML,n=c[t.tagName];return n?n.reduce(function(t,e){return t.replace(new RegExp(e+'=".+?"',"g"),function(t){return t.replace(/&amp;/g,"&")})},e):e},render:function(){if(t.tagName===l){for(var e=[],n=0;n<t.childNodes.length;n++)e.push(t.childNodes[n]);return e}return t}}},l=(r.html=function(t,e){for(var n=arguments.length,r=Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];var o=document.createElement(t);return s(o,e||{}),r.forEach(function(t){if("string"!=typeof t){if(t){var e=t.render();if(e instanceof Array)return void e.forEach(function(t){return o.appendChild(t)});o.appendChild(e)}}else o.appendChild(document.createTextNode(t))}),u(o)},r.Fragment="DOMHELPERSINTERNALEMPTYFRAGMENTCOMPONENT");r.render=function(t,e){var n=t.render();n instanceof Array?n.forEach(e.appendChild):e.appendChild(t.render())},r.renderAsString=function(t){return t.renderAsString()}},{}]},{},[34,79]),e&&(define=e)}();